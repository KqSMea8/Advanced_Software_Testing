<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:46:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7483/HBASE-7483.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7483] TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7483</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Seen in TestHRegionOnCluster and TestSplitTransactionOnCluster.&lt;br/&gt;
Stack in both cases it:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.reflect.UndeclaredThrowableException
	at $Proxy20.move(Unknown Source)
	at org.apache.hadoop.hbase.client.HBaseAdmin.move(HBaseAdmin.java:1426)
	at org.apache.hadoop.hbase.regionserver.TestHRegionOnCluster.testDataCorrectnessReplayingRecoveredEdits(TestHRegionOnCluster.java:94)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:62)
Caused by: org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hbase.UnknownRegionException: cc372cfe78f796e467f6d383da1fecba
	at org.apache.hadoop.hbase.master.HMaster.move(HMaster.java:1141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:364)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1426)

	at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:1021)
	at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Invoker.invoke(WritableRpcEngine.java:150)
	... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12625799">HBASE-7483</key>
            <summary>TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Jan 2013 01:14:44 +0000</created>
                <updated>Tue, 5 Feb 2013 03:58:18 +0000</updated>
                            <resolved>Sat, 5 Jan 2013 23:13:42 +0000</resolved>
                                                    <fixVersion>0.94.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13542640" author="lhofhansl" created="Thu, 3 Jan 2013 01:32:47 +0000"  >&lt;p&gt;Somehow there is a race condition, where the region is moved, but the AssignmentManager does not know about this immediately, when the region is attempted to be moved again the AssignmentManager does not know about it.&lt;/p&gt;</comment>
                            <comment id="13542647" author="apurtell" created="Thu, 3 Jan 2013 01:41:59 +0000"  >&lt;p&gt;We used to see this in with TestMasterObserver. I think Enis fixed it with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7235&quot; title=&quot;TestMasterObserver is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7235&quot;&gt;&lt;del&gt;HBASE-7235&lt;/del&gt;&lt;/a&gt; but I wasn&apos;t watching closely at the time.&lt;/p&gt;</comment>
                            <comment id="13542648" author="lhofhansl" created="Thu, 3 Jan 2013 01:43:21 +0000"  >&lt;p&gt;In the debugger I see that the AssignmentManager&apos;s state is updated asynchronously via ZK trackers. That explains (I think) the problem in tests.&lt;br/&gt;
Will check out &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7235&quot; title=&quot;TestMasterObserver is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7235&quot;&gt;&lt;del&gt;HBASE-7235&lt;/del&gt;&lt;/a&gt; too.&lt;/p&gt;</comment>
                            <comment id="13542655" author="lhofhansl" created="Thu, 3 Jan 2013 01:59:08 +0000"  >&lt;p&gt;I think we should just test whether the region is online again (as seen from the AssignmentManager, thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt; for that suggestion).&lt;/p&gt;</comment>
                            <comment id="13542658" author="lhofhansl" created="Thu, 3 Jan 2013 02:05:00 +0000"  >&lt;p&gt;0.94 patch. Won&apos;t bother with 0.96, since this all has/will change(d) there.&lt;/p&gt;</comment>
                            <comment id="13542662" author="lhofhansl" created="Thu, 3 Jan 2013 02:13:59 +0000"  >&lt;p&gt;And a version that fixes the same for TestSplitTransactionOnCluster&lt;/p&gt;</comment>
                            <comment id="13542668" author="lhofhansl" created="Thu, 3 Jan 2013 02:28:43 +0000"  >&lt;p&gt;Slightly better patch&lt;/p&gt;</comment>
                            <comment id="13542709" author="lhofhansl" created="Thu, 3 Jan 2013 04:31:48 +0000"  >&lt;p&gt;Committing soon, unless there are objections.&lt;/p&gt;</comment>
                            <comment id="13542737" author="jmhsieh" created="Thu, 3 Jan 2013 06:07:45 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;</comment>
                            <comment id="13542743" author="hudson" created="Thu, 3 Jan 2013 06:29:19 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #696 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/696/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/696/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7483&quot; title=&quot;TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7483&quot;&gt;&lt;del&gt;HBASE-7483&lt;/del&gt;&lt;/a&gt; TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move() (Revision 1428171)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13542780" author="hudson" created="Thu, 3 Jan 2013 07:45:58 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #93 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/93/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/93/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7483&quot; title=&quot;TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7483&quot;&gt;&lt;del&gt;HBASE-7483&lt;/del&gt;&lt;/a&gt; TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move() (Revision 1428171)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13544394" author="hudson" created="Sat, 5 Jan 2013 00:42:21 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #10 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/10/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/10/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7483&quot; title=&quot;TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7483&quot;&gt;&lt;del&gt;HBASE-7483&lt;/del&gt;&lt;/a&gt; TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move() (Revision 1428171)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13545190" author="lhofhansl" created="Sat, 5 Jan 2013 22:03:07 +0000"  >&lt;p&gt;Meh. This is still happening. I can&apos;t explain how, though. This exception happens when the assignment manager does not know about this region.&lt;br/&gt;
My previous patch checks whether the assignment manager does know this region, so it seems impossible now.&lt;/p&gt;</comment>
                            <comment id="13545192" author="lhofhansl" created="Sat, 5 Jan 2013 22:05:25 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Stacktrace

java.lang.reflect.UndeclaredThrowableException
	at $Proxy20.move(Unknown Source)
	at org.apache.hadoop.hbase.client.HBaseAdmin.move(HBaseAdmin.java:1426)
	at org.apache.hadoop.hbase.regionserver.TestHRegionOnCluster.testDataCorrectnessReplayingRecoveredEdits(TestHRegionOnCluster.java:95)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:62)
Caused by: org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hbase.UnknownRegionException: 84ab505d0aab4d6b5921bd8e3be83a4a
	at org.apache.hadoop.hbase.master.HMaster.move(HMaster.java:1160)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13545198" author="lhofhansl" created="Sat, 5 Jan 2013 22:24:10 +0000"  >&lt;p&gt;I think there&apos;s still a race. The assignment manager might still have the old region server. I can modify the condition to check whether the assignment manager indeed has registered the new region server for the moved region.&lt;/p&gt;</comment>
                            <comment id="13545204" author="lhofhansl" created="Sat, 5 Jan 2013 22:35:41 +0000"  >&lt;p&gt;Unfortunate I am not able to reproduce this on my machine. So I&apos;ll make a the check in the test a bit more air tight and see what happens.&lt;/p&gt;</comment>
                            <comment id="13545214" author="lhofhansl" created="Sat, 5 Jan 2013 23:10:55 +0000"  >&lt;p&gt;Here&apos;s an addendum that verifies that the region as moved &lt;b&gt;and&lt;/b&gt; the assignment manager has been informed of its new location.&lt;/p&gt;</comment>
                            <comment id="13545215" author="lhofhansl" created="Sat, 5 Jan 2013 23:13:42 +0000"  >&lt;p&gt;Let&apos;s see if that fixes it.&lt;/p&gt;</comment>
                            <comment id="13545245" author="hudson" created="Sun, 6 Jan 2013 00:53:14 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #705 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/705/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/705/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7483&quot; title=&quot;TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7483&quot;&gt;&lt;del&gt;HBASE-7483&lt;/del&gt;&lt;/a&gt; Addendum (Revision 1429421)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegionOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13554229" author="hudson" created="Tue, 15 Jan 2013 19:40:19 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #95 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/95/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/95/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7483&quot; title=&quot;TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7483&quot;&gt;&lt;del&gt;HBASE-7483&lt;/del&gt;&lt;/a&gt; Addendum (Revision 1429421)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegionOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13570947" author="hudson" created="Tue, 5 Feb 2013 03:58:18 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #11 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/11/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/11/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7483&quot; title=&quot;TestHRegionOnCluster and TestSplitTransactionOnCluster are racy with HBaseAdmin.move()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7483&quot;&gt;&lt;del&gt;HBASE-7483&lt;/del&gt;&lt;/a&gt; Addendum (Revision 1429421)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegionOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12628112">HBASE-7617</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12563446" name="7483-addendum.txt" size="823" author="lhofhansl" created="Sat, 5 Jan 2013 23:10:55 +0000"/>
                            <attachment id="12563018" name="7483-v2.txt" size="2276" author="lhofhansl" created="Thu, 3 Jan 2013 02:13:59 +0000"/>
                            <attachment id="12563020" name="7483-v3.txt" size="1759" author="lhofhansl" created="Thu, 3 Jan 2013 02:28:43 +0000"/>
                            <attachment id="12563015" name="7483.txt" size="1439" author="lhofhansl" created="Thu, 3 Jan 2013 02:05:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Jan 2013 01:41:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302345</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1709z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249012</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>