<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:08:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3198/HBASE-3198.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3198] Log rolling archives files prematurely</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3198</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From the mailing list, Erdem Agaoglu found a case where when an HLog gets rolled from the periodic log roller and it gets archived even tho the region (ROOT) still has edits in the MemStore. I did an experiment on a local empty machine and it does look broken:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hbase.regionserver.LogRoller: Hlog roll period 6000ms elapsed
org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogWriter: Using syncFs -- HDFS-200
org.apache.hadoop.hbase.regionserver.wal.HLog: Roll /hbase-89-su/.logs/hbasedev,60020,1288977933643/10.10.1.177%3A60020.1288977933829, entries=1,
 filesize=295. New hlog /hbase-89-su/.logs/hbasedev,60020,1288977933643/10.10.1.177%3A60020.1288977943913
org.apache.hadoop.hbase.regionserver.wal.HLog: Found 1 hlogs to remove  out of total 1; oldest outstanding sequenceid is 270055 from region -ROOT-,,0
org.apache.hadoop.hbase.regionserver.wal.HLog: moving old hlog file /hbase-89-su/.logs/hbasedev,60020,1288977933643/10.10.1.177%3A60020.1288977933829
 whose highest sequenceid is 270054 to /hbase-89-su/.oldlogs/10.10.1.177%3A60020.1288977933829
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Marking as Blocker and taking a deeper look.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12479237">HBASE-3198</key>
            <summary>Log rolling archives files prematurely</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Nov 2010 17:40:53 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:45 +0000</updated>
                            <resolved>Fri, 5 Nov 2010 22:50:02 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12928702" author="kannanm" created="Fri, 5 Nov 2010 17:48:31 +0000"  >&lt;p&gt;JD: Keep us posted. This looks important. Thanks for looking into this.&lt;/p&gt;</comment>
                            <comment id="12928817" author="jdcryans" created="Fri, 5 Nov 2010 21:04:46 +0000"  >&lt;p&gt;So some digging revealed interesting things. When we print the &quot;whose sequenceid is x&quot;, it&apos;s always smaller than the real one by 1 since in the code we do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputfiles.put(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.valueOf(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.logSeqNum.get() - 1), oldFile);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It may have been right to do this at some point in the past, but now since rolling is async from appending it means that the current logSeqNum is in fact the last one in the log. It&apos;s wrong to -1. Then there&apos;s this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    TreeSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; sequenceNumbers =
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputfiles.headMap(
      (&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.valueOf(oldestOutstandingSeqNum.longValue() + 1L))).keySet());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here we are getting the log files that we can delete since we know that their oldest edit&apos;s sequence number is still smaller than the oldest edit. I don&apos;t know why we&apos;re doing a +1L, since you don&apos;t really  want to delete log files that do contain it. It may be a &quot;fix&quot; to my previous finding, but it&apos;s still broken since as I showed when creating this jira rolling does remove logs with unflushed edits.&lt;/p&gt;

&lt;p&gt;I&apos;m changing the title of this jira to a more broad scope, as any log rolling is at risk of lowering data durability.&lt;/p&gt;</comment>
                            <comment id="12928829" author="hbasereviewboard" created="Fri, 5 Nov 2010 21:24:26 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1181/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1181/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Removes the +1, -1 madness that I described in the jira and adds a unit test for log cleaning.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3198&quot; title=&quot;Log rolling archives files prematurely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3198&quot;&gt;&lt;del&gt;HBASE-3198&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-3198&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-3198&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /trunk/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 1031797 &lt;br/&gt;
  /trunk/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java 1031797 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/1181/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1181/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12928839" author="hbasereviewboard" created="Fri, 5 Nov 2010 21:52:23 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1181/#review1825&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1181/#review1825&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Looks good to me (after chatting more with j-d)&lt;/p&gt;


&lt;p&gt;/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1181/#comment5902&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1181/#comment5902&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is not your comment but I don&apos;t understand what its trying to say... can you fix?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12928858" author="jdcryans" created="Fri, 5 Nov 2010 22:49:43 +0000"  >&lt;p&gt;Here&apos;s a patch that applies to 0.89&lt;/p&gt;</comment>
                            <comment id="12928860" author="jdcryans" created="Fri, 5 Nov 2010 22:50:02 +0000"  >&lt;p&gt;Committed to trunk, thanks for the review Stack!&lt;/p&gt;</comment>
                            <comment id="12929802" author="kannanm" created="Mon, 8 Nov 2010 23:12:50 +0000"  >&lt;p&gt;Nice catch. Good debugging...&lt;/p&gt;</comment>
                            <comment id="12929913" author="kannanm" created="Tue, 9 Nov 2010 03:11:15 +0000"  >&lt;p&gt;The patch and what was committed are different for the test:&lt;/p&gt;

&lt;p&gt;What&apos;s committed for TestHLog.java:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    HLog log = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLog(fs, dir, oldLogDir, conf);
+    HRegionInfo hri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRegionInfo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTableDescriptor(tableName),
+        HConstants.EMPTY_START_ROW, HConstants.EMPTY_END_ROW);
+    HRegionInfo hri2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRegionInfo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTableDescriptor(tableName),      &amp;lt;&amp;lt;&amp;lt;&amp;lt; ### tableName should be tableName2.
+        HConstants.EMPTY_START_ROW, HConstants.EMPTY_END_ROW);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12930199" author="jdcryans" created="Tue, 9 Nov 2010 17:29:49 +0000"  >&lt;p&gt;@Kannan&lt;/p&gt;

&lt;p&gt;Yes it&apos;s different, and I committed the change to trunk a few minutes after I discovered my error when doing the 0.89 patch. What I saw is that in trunk we treat that table name differently than in the latest version of 0.89, so my original patch for trunk was working ok but porting it to 0.89 TestHLog was failing.&lt;/p&gt;</comment>
                            <comment id="12930283" author="kannanm" created="Tue, 9 Nov 2010 20:43:43 +0000"  >&lt;p&gt;JD: Thanks. Aah-- I only imported the first of the commits. Didn&apos;t realize &lt;br/&gt;
there was another related commit. Thanks. Glad to hear it is already &lt;br/&gt;
fixed in trunk. &lt;/p&gt;</comment>
                            <comment id="15017063" author="lars_francke" created="Fri, 20 Nov 2015 12:41:45 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12479435">HBASE-3208</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12458963" name="HBASE-3198_for_0.89.patch" size="4999" author="jdcryans" created="Fri, 5 Nov 2010 22:49:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Nov 2010 17:48:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hl53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>