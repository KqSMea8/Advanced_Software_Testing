<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:15:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4094/HBASE-4094.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4094] improve hbck tool to fix more hbase problem</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4094</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The hbck tool(org.apache.hadoop.hbase.util.HBaseFsck) can check and repair consistency problem.&lt;br/&gt;
some error just be checked but not supply the way to repair, I plan to fix it by other tool(close_region...)or by new method.&lt;br/&gt;
First, list it and discuss that is it right?&lt;/p&gt;

&lt;p&gt;Part A:check meta info&lt;br/&gt;
1.errors.reportError(ERROR_CODE.NULL_ROOT_REGION,&quot;Root Region or some of its attributes are null.&quot;); &lt;br/&gt;
		 ------&amp;gt; after delete the root table,execute hbck tool to check but the tool run error. how to reproduce this error?&lt;/p&gt;

&lt;p&gt;2.errors.reportError(ERROR_CODE.NO_META_REGION, &quot;.META. is not found on any region.&quot;);&lt;br/&gt;
         ------&amp;gt;after delete the meta table,execute hbck tool to check but the tool run error. how to reproduce this error?&lt;/p&gt;

&lt;p&gt;3.errors.reportError(ERROR_CODE.MULTI_META_REGION, &quot;.META. is found on more than one region.&quot;);&lt;br/&gt;
		 -----&amp;gt;the logic:scan the root table to get META table regioninfo,if META table&apos;s regions is more than one,throw the error.&lt;br/&gt;
					  HBase allow META table has more than one region,is it?&lt;/p&gt;

&lt;p&gt;Part B:check Consistency&lt;br/&gt;
4.ERROR_CODE.NOT_IN_META_HDFS----&amp;gt;close it from regionserver.&lt;/p&gt;

&lt;p&gt;5.ERROR_CODE.NOT_IN_META_OR_DEPLOYED----&amp;gt;do nothing,maybe it will be used to fix the chain hole in part C.&lt;/p&gt;

&lt;p&gt;6.ERROR_CODE.NOT_IN_META----&amp;gt;close it from regionserver.&lt;/p&gt;

&lt;p&gt;7.ERROR_CODE.NOT_IN_HDFS_OR_DEPLOYED----&amp;gt;delete it from META table,it will make a chain hole, when check chain integrity(in part C) to fix it.&lt;/p&gt;

&lt;p&gt;8.ERROR_CODE.NOT_IN_HDFS----&amp;gt;delete it from META table and close it from regionserver,when check chain integrity(in part C) to fix it.&lt;/p&gt;

&lt;p&gt;9.ERROR_CODE.NOT_DEPLOYED----&amp;gt;assign it.&lt;/p&gt;

&lt;p&gt;10.ERROR_CODE.SHOULD_NOT_BE_DEPLOYED----&amp;gt;delete if from META table and close it from regionserver.&lt;/p&gt;

&lt;p&gt;11.ERROR_CODE.MULTI_DEPLOYED---&amp;gt;close all from regionservers,and reassign it.&lt;/p&gt;

&lt;p&gt;12.ERROR_CODE.SERVER_DOES_NOT_MATCH_META----&amp;gt;close all from regionservers,and reassign it.&lt;/p&gt;

&lt;p&gt;Part C:check chain Integrity&lt;br/&gt;
13.ERROR_CODE.FIRST_REGION_STARTKEY_NOT_EMPTY---&amp;gt;treat it as a hole problem(ERROR_CODE.HOLE_IN_REGION_CHAIN).&lt;/p&gt;

&lt;p&gt;14.ERROR_CODE.LAST_REGION_ENDKEY_NOT_EMPTY(new add)---&amp;gt;treat it as a hole problem(ERROR_CODE.HOLE_IN_REGION_CHAIN).&lt;/p&gt;

&lt;p&gt;15.ERROR_CODE.REGION_CYCLE----&amp;gt;shut down cluster and merge two region by merge tool(org.apache.hadoop.hbase.util.Merge)&lt;/p&gt;

&lt;p&gt;16.ERROR_CODE.DUPE_STARTKEYS---&amp;gt;shut down cluster and merge two region by merge tool(org.apache.hadoop.hbase.util.Merge)&lt;/p&gt;

&lt;p&gt;17.ERROR_CODE.OVERLAP_IN_REGION_CHAIN---&amp;gt;shut down cluster and merge two region by merge tool(org.apache.hadoop.hbase.util.Merge)&lt;/p&gt;

&lt;p&gt;18.ERROR_CODE.HOLE_IN_REGION_CHAIN---&amp;gt;write a new method to fix it,the logic is:for recover the data,collect the regionfo from regionserver and hdfs.if a region&apos;s key range is overlaping with the hole range,put it in META table and assign it,maybe it will create overlapping problem,we can fix it by merge tool.if no region be collected,create a new region by the hole key range to fix it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514029">HBASE-4094</key>
            <summary>improve hbck tool to fix more hbase problem</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="feng xu">feng xu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jul 2011 08:39:34 +0000</created>
                <updated>Sat, 14 Apr 2012 12:52:58 +0000</updated>
                            <resolved>Sat, 14 Apr 2012 12:51:08 +0000</resolved>
                                    <version>0.90.3</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="43200">12h</timeoriginalestimate>
                            <timeestimate seconds="43200">12h</timeestimate>
                                        <comments>
                            <comment id="13067590" author="feng xu" created="Tue, 19 Jul 2011 09:16:51 +0000"  >&lt;p&gt;check the table key chain just bese on the META info, if the region no deployed on any regionserver,we can delete it from META by hbase shell, so it will make a hole in chain,we can read regioninfo from hdfs or make a new region to fix the hole.&lt;/p&gt;</comment>
                            <comment id="13067607" author="jeason" created="Tue, 19 Jul 2011 10:29:25 +0000"  >&lt;p&gt;There&apos;s so many failure-scenarios listed above. Most of those make sense to me.&lt;br/&gt;
I have one question about the patch, is it just fix one of those scenarios??&lt;/p&gt;</comment>
                            <comment id="13068098" author="feng xu" created="Wed, 20 Jul 2011 00:46:03 +0000"  >&lt;p&gt;some fail-scenarios(ERROR_CODE.MULTI_DEPLOYED,ERROR_CODE.NOT_DEPLOYED..) have been fixed by hbck tool.&lt;br/&gt;
but many fail-scenarios the hbck do not supply the method to fix,like hole problem.&lt;/p&gt;

&lt;p&gt;this patch(HbaseFsck_TableChain.patch) will check the table chain hole in META,and next I plan to fix hole problem.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;18.ERROR_CODE.HOLE_IN_REGION_CHAIN---&amp;gt;write a new method to fix it,the logic is:for recover the data,collect the &amp;gt;&amp;gt;regionfo from regionserver and hdfs.if a region&apos;s key range is overlaping with the hole range,put it in META table and &amp;gt;&amp;gt;assign it,maybe it will create overlapping problem,we can fix it by merge tool.if no region be collected,create a new &amp;gt;&amp;gt;region by the hole key range to fix it. &lt;/p&gt;</comment>
                            <comment id="13068699" author="stack" created="Wed, 20 Jul 2011 23:09:19 +0000"  >&lt;p&gt;@Feng Thank you for digging in on this important issue.  As Jieshan asks, are you going to fix all the issues not already addressed by --fix listed above?  If so, do you think it best to do it one per issue (if you&apos;d rather piecemeal it) or do you want to make a monster patch to do them all in this issue?&lt;/p&gt;

&lt;p&gt;I looked at your patch and it seems to comment out a line of code and add a comment.&lt;/p&gt;

&lt;p&gt;Regards 18 above, when you say collect the regioninfo from regionserver and hdfs, what do you mean?  What if the region is not on a regionserver?  If its in the filesystem, how will you find it?  You only have the gap in the table and from here you need to get to the encoded name of the region in the filesystem.  Are you thinking of looking at all the regions in the filesystem and getting all of their .regioninfos and then checking for which has a start and stop key that matches the hole?&lt;/p&gt;

&lt;p&gt;If this fails, yes, create a new region to bridge the hole.&lt;/p&gt;

&lt;p&gt;Do you think this issue has overlap with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4058&quot; title=&quot;Extend TestHBaseFsck with a complete .META. recovery scenario&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4058&quot;&gt;&lt;del&gt;HBASE-4058&lt;/del&gt;&lt;/a&gt; Feng?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13068899" author="feng xu" created="Thu, 21 Jul 2011 10:58:40 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;Regards 18 above, when you say collect the regioninfo from regionserver and hdfs, what do you mean? &lt;br/&gt;
the regions that in hole maybe be deployed on the reginserver,if not,maybe in hdfs. just to find them to fix the hole,it can recover the hole data.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;What if the region is not on a regionserver? If its in the filesystem, how will you find it? &lt;br/&gt;
the hbck tool will check the regionserver(WorkItemRegion()) and hdfs(WorkItemHdfsDir()),if the region that from regionserver or hdfs, store it and &lt;br/&gt;
sign it where from by enum INFO_FROM. when check table chain,we can reference it to fix the hole.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Are you thinking of looking at all the regions in the filesystem and getting all of their .regioninfos &lt;br/&gt;
yes, but just get the regions that not signed in META table from regionserver or filesystem .&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;then checking for which has a start and stop key that matches the hole?&lt;br/&gt;
the hole maybe need some regions to fix, in my patch ,if the region from regionserver or filesystem that the key range is overlapping with the hole,&lt;br/&gt;
I will use it to fix the hole, I also know it will make the overlapping problem in META table,but it can recover hole data,we can fix the overlapping problem&lt;br/&gt;
by merge tool,is it right?&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Do you think this issue has overlap with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4058&quot; title=&quot;Extend TestHBaseFsck with a complete .META. recovery scenario&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4058&quot;&gt;&lt;del&gt;HBASE-4058&lt;/del&gt;&lt;/a&gt; Feng?&lt;br/&gt;
yes, this issue is also relate with the hbck tool to fix the cluster problem.&lt;/p&gt;


&lt;p&gt;I have filed another issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4122&quot; title=&quot;improve hbck tool to fix .META. hole issue.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4122&quot;&gt;&lt;del&gt;HBASE-4122&lt;/del&gt;&lt;/a&gt; which is about how to fix the chain hole problem and submitted a patch. &lt;/p&gt;</comment>
                            <comment id="13193654" author="ram_krish" created="Thu, 26 Jan 2012 08:23:10 +0000"  >&lt;p&gt;Moving to 0.90.7.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5128&quot; title=&quot;[uber hbck] Online automated repair of table integrity and region consistency problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5128&quot;&gt;&lt;del&gt;HBASE-5128&lt;/del&gt;&lt;/a&gt; also is related to improving hbck tool.&lt;/p&gt;</comment>
                            <comment id="13253125" author="anoopsamjohn" created="Fri, 13 Apr 2012 05:28:59 +0000"  >&lt;p&gt;This may be closed duplicate as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5128&quot; title=&quot;[uber hbck] Online automated repair of table integrity and region consistency problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5128&quot;&gt;&lt;del&gt;HBASE-5128&lt;/del&gt;&lt;/a&gt; handles these valid scenarios now.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;14.ERROR_CODE.LAST_REGION_ENDKEY_NOT_EMPTY(new add)---&amp;gt;treat it as a hole problem(ERROR_CODE.HOLE_IN_REGION_CHAIN). &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This check is not there now. But there is another issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4379&quot; title=&quot;[hbck] Does not complain about tables with no end region [Z,]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4379&quot;&gt;&lt;del&gt;HBASE-4379&lt;/del&gt;&lt;/a&gt; on this.&lt;/p&gt;</comment>
                            <comment id="13253741" author="stack" created="Fri, 13 Apr 2012 20:58:21 +0000"  >&lt;p&gt;Resolving at Anoop&apos;s suggestion as dup of hbase-5128&lt;/p&gt;</comment>
                            <comment id="13254103" author="jmhsieh" created="Sat, 14 Apr 2012 12:51:08 +0000"  >&lt;p&gt;Changed to duplicate.&lt;/p&gt;</comment>
                            <comment id="13254104" author="jmhsieh" created="Sat, 14 Apr 2012 12:52:14 +0000"  >&lt;p&gt;Cleaned up jira to follow convention.  Marked as duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5128&quot; title=&quot;[uber hbck] Online automated repair of table integrity and region consistency problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5128&quot;&gt;&lt;del&gt;HBASE-5128&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12537273">HBASE-5128</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12486984" name="HbaseFsck_TableChain.patch" size="1013" author="feng xu" created="Tue, 19 Jul 2011 09:29:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jul 2011 10:29:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33364</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hpcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101369</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>