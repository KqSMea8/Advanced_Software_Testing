<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:50:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1114/HBASE-1114.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1114] Weird NPEs compacting</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1114</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Over on apurtell cluster, hbase TRUNK on hadoop 0.18.0 branch, see below.&lt;/p&gt;

&lt;p&gt;They are weird because first would seem to be an empty fileystem data member and the second&apos;s line number is start of the method and even then, we check for null everywhere first before doing stuff in here (because of Erik Holstad experience in past).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2009-01-09 16:28:21,262 INFO org.apache.hadoop.hbase.regionserver.HRegion: starting  compaction on region content,c84bbfc94b2143e41ba119d159be2958,1231518442461
2009-01-09 16:28:21,265 ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region content,c84bbfc94b2143e41ba119d159be2958,1231518442461
java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.HStore.compact(HStore.java:869)
        at org.apache.hadoop.hbase.regionserver.HRegion.compactStores(HRegion.java:709)
        at org.apache.hadoop.hbase.regionserver.HRegion.compactStores(HRegion.java:666)
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.run(CompactSplitThread.java:105)
2009-01-09 16:28:45,896 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: java.lang.NullPointerException
2009-01-09 16:28:45,896 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 2 on 60020, call next(3999959915225939603, 30) from XX.XX.XX.33:36665: error: java.io.IOException: java.lang.NullPointerException
java.io.IOException: java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.HRegionServer.checkOOME(HRegionServer.java:696)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.cleanup(HRegionServer.java:664)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.cleanup(HRegionServer.java:648)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1579)
        at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
2009-01-09 16:28:47,947 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: java.lang.NullPointerException
2009-01-09 16:28:47,948 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 9 on 60020, call next(3999959915225939603, 30) from XX.XX.XX.33:36665: error: java.io.IOException: java.lang.NullPointerException
java.io.IOException: java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.HRegionServer.checkOOME(HRegionServer.java:696)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.cleanup(HRegionServer.java:664)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.cleanup(HRegionServer.java:648)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1579)
        at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12412077">HBASE-1114</key>
            <summary>Weird NPEs compacting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Jan 2009 19:52:21 +0000</created>
                <updated>Sun, 13 Sep 2009 22:26:37 +0000</updated>
                            <resolved>Sun, 11 Jan 2009 21:49:17 +0000</resolved>
                                                    <fixVersion>0.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12662587" author="stack" created="Sat, 10 Jan 2009 00:56:33 +0000"  >&lt;p&gt;Hmm... the code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 869         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus fstatus:fs.listStatus(path)) {
 870           len += fstatus.getLen();
 871         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;.. is hiding fact that listStatus returns FileStatus [], not an Iterator, and that it can return null.&lt;/p&gt;

&lt;p&gt;Then, the NPE ran into checkOOME.  Because the NPE was not an OOME, we tried all combinations of the search for OOME the last of which is looking for &apos;java.lang.OutOfMemoryError&apos; in the Throwable&apos;s message only in this case, going by stack traces above, it looks like message could be null.&lt;/p&gt;

&lt;p&gt;Patch is small:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
drwxr-xr-x+ 74 stack  stack      2516 Jan  9 16:22 .
Index: src/java/org/apache/hadoop/hbase/regionserver/HStore.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (revision 732490)
+++ src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (working copy)
@@ -866,8 +866,10 @@
           &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
         }
         &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; len = 0;
-        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus fstatus:fs.listStatus(path)) {
-          len += fstatus.getLen();
+        &lt;span class=&quot;code-comment&quot;&gt;// listStatus can come back &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
&lt;/span&gt;+        FileStatus [] fss = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.listStatus(path);
+        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ii = 0; fss != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; i &amp;lt; fss.length; ii++) {
+          len += fss[ii].getLen();
         }
         fileSizes[i] = len;
         totalSize += len;
Index: src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java    (revision 732490)
+++ src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java    (working copy)
@@ -695,8 +695,9 @@
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; checkOOME(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Throwable e) {
     &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; stop = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; OutOfMemoryError ||
-        (e.getCause()!= &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; e.getCause() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; OutOfMemoryError) ||
-        e.getMessage().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.OutOfMemoryError&quot;&lt;/span&gt;)) {
+      (e.getCause() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; e.getCause() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; OutOfMemoryError) ||
+      (e.getMessage() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp;
+        e.getMessage().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.OutOfMemoryError&quot;&lt;/span&gt;))) {
       LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;OutOfMemoryError, aborting.&quot;&lt;/span&gt;, e);
       abort();
       stop = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12662708" author="apurtell" created="Sun, 11 Jan 2009 00:05:13 +0000"  >&lt;p&gt;Stack, your patch for this broke trunk. See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1117&quot; title=&quot;Failed region assignments on startup after Hadoop upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1117&quot;&gt;&lt;del&gt;HBASE-1117&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="12662716" author="apurtell" created="Sun, 11 Jan 2009 03:05:12 +0000"  >&lt;p&gt;Testing attached patch 1114-filestatus.patch, which addresses case where fs.listStatus() returns null. &lt;/p&gt;</comment>
                            <comment id="12662720" author="stack" created="Sun, 11 Jan 2009 04:59:57 +0000"  >&lt;p&gt;Yeah.  Over in hbase-1117 I say thanks for fixing my boo-boo.  I committed without running tests.   Will be gone the rest of the w/e at reeducation camp.&lt;/p&gt;</comment>
                            <comment id="12662722" author="stack" created="Sun, 11 Jan 2009 05:04:14 +0000"  >&lt;p&gt;Oh, sorry, read the rest of my mail.  Let me take a look.&lt;/p&gt;</comment>
                            <comment id="12662723" author="stack" created="Sun, 11 Jan 2009 05:07:02 +0000"  >&lt;p&gt;So, my patch refactored the loop but didn&apos;t test for null &amp;#8211; the point of the refactoring?  Does your patch fix things for you Andrew?&lt;/p&gt;</comment>
                            <comment id="12662743" author="apurtell" created="Sun, 11 Jan 2009 08:23:11 +0000"  >&lt;p&gt;No what I mean to say is I am testing a patch that only addresses the NPE around listStatus in HStore but touches only that one area. This works for me.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12397633" name="1104-filestatus.patch" size="713" author="apurtell" created="Sun, 11 Jan 2009 03:04:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 11 Jan 2009 00:05:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hbev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99111</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>