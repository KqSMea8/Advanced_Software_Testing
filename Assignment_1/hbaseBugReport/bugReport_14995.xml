<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:58:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14995/HBASE-14995.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14995] Optimize setting tagsPresent in DefaultMemStore.java</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14995</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The current implementation calls e.getTagsLength() for each cell. Once tagsPresent is set, e.getTagsLength() can be avoided.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; addToCellSet(Cell e) {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; b = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cellSet.add(e);
    &lt;span class=&quot;code-comment&quot;&gt;// In no tags &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; NoTagsKeyValue.getTagsLength() is a cheap call.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// When we use ACL CP or Visibility CP which deals with Tags during
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// mutation, the TagRewriteCell.getTagsLength() is a cheaper call. We &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// parse the &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] to identify the tags length.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(e.getTagsLength() &amp;gt; 0) {
      tagsPresent = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
    setOldestEditTimeToNow();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; b;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12922526">HBASE-14995</key>
            <summary>Optimize setting tagsPresent in DefaultMemStore.java</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="huaxiang">huaxiang sun</assignee>
                                    <reporter username="huaxiang">huaxiang sun</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2015 22:13:15 +0000</created>
                <updated>Fri, 18 Dec 2015 23:47:34 +0000</updated>
                                            <version>2.0.0</version>
                    <version>1.2.0</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="15061062" author="yuzhihong@gmail.com" created="Wed, 16 Dec 2015 22:55:18 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;</comment>
                            <comment id="15061069" author="huaxiang" created="Wed, 16 Dec 2015 22:59:03 +0000"  >&lt;p&gt;Change format a little bit to be consistent.&lt;/p&gt;</comment>
                            <comment id="15061302" author="hadoopqa" created="Thu, 17 Dec 2015 01:47:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12778121/HBASE-14995-v001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12778121/HBASE-14995-v001.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit e965b614b34201b5c37863830e85348f9f596f42.&lt;br/&gt;
  ATTACHMENT ID: 12778121&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;. The applied patch does not generate new checkstyle errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16890//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15061333" author="yuzhihong@gmail.com" created="Thu, 17 Dec 2015 02:20:32 +0000"  >&lt;p&gt;Thanks for the patch, Huaxiang.&lt;/p&gt;</comment>
                            <comment id="15061373" author="hadoopqa" created="Thu, 17 Dec 2015 02:54:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12778128/HBASE-14995-v002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12778128/HBASE-14995-v002.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 3dec8582f527e4e7e35280cd34c4928648290658.&lt;br/&gt;
  ATTACHMENT ID: 12778128&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;. The applied patch does not generate new checkstyle errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16894//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15061400" author="hudson" created="Thu, 17 Dec 2015 03:37:25 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #379 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/379/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/379/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Optimize setting tagsPresent in DefaultMemStore.java (tedyu: rev b9070b2a452804ab5694f609485fb88b091a0fed)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061449" author="hudson" created="Thu, 17 Dec 2015 04:32:38 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #346 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/346/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/346/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Optimize setting tagsPresent in DefaultMemStore.java (tedyu: rev 6e9ee012371077155420ef951c059c769b73fe67)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061538" author="ram_krish" created="Thu, 17 Dec 2015 05:44:52 +0000"  >&lt;p&gt;I remember purposefully this check was avoided when the getTagsLength() change was done to avoid parsing the tag length just becuase this is a volatile boolean and its check will be much costlier than the getTAgsLength() called on NoTagsKeyValue and TagRewritecell.&lt;/p&gt;</comment>
                            <comment id="15061554" author="ram_krish" created="Thu, 17 Dec 2015 05:56:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huaxiang&quot; class=&quot;user-hover&quot; rel=&quot;huaxiang&quot;&gt;huaxiang sun&lt;/a&gt;&lt;br/&gt;
If there is some improvement coming out of this change then it is fine. If it is going to add overhead we can avoid this. What do you observe?&lt;/p&gt;</comment>
                            <comment id="15061556" author="yuzhihong@gmail.com" created="Thu, 17 Dec 2015 05:58:44 +0000"  >&lt;p&gt;Looks like some javadoc for this part of code would help people who read it better understand.&lt;/p&gt;

&lt;p&gt;If the cell doesn&apos;t have tag, we skip assigning the volatile variable.&lt;br/&gt;
If the cell has tag(s), previous formation is not slower than the one proposed here.&lt;/p&gt;</comment>
                            <comment id="15061579" author="hudson" created="Thu, 17 Dec 2015 06:30:58 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #449 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/449/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/449/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Optimize setting tagsPresent in DefaultMemStore.java (tedyu: rev 6e9ee012371077155420ef951c059c769b73fe67)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061595" author="hudson" created="Thu, 17 Dec 2015 06:43:24 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3 #443 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/443/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/443/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Optimize setting tagsPresent in DefaultMemStore.java (tedyu: rev b9070b2a452804ab5694f609485fb88b091a0fed)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061638" author="hudson" created="Thu, 17 Dec 2015 07:09:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #380 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/380/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Revert according to Ram&apos;s feedback (tedyu: rev 988ab048ee3e327c03da3de1c65224c589d0567e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061651" author="anoop.hbase" created="Thu, 17 Dec 2015 07:28:35 +0000"  >&lt;p&gt;As of now there is no way to pass Tags directly from client. We will strip them. (Though it is possible by using codec with Tag support)&lt;br/&gt;
Tags will come in the Cell (when it reaches Memstore) if Cell is having ACL or visibility or TTL.  But at that time, it will be TagRewriteCell on which getTagsLength() call don&apos;t have any parsing. It is simple array length calc. When the Cell dont have any tags, it will be NoTagsKeyValue on which getTagsLength() call just return 0.  &lt;br/&gt;
Considering these, as of now, there is no need for any fix. (When tags are there or not).  We may close it.&lt;br/&gt;
Or may we just write some comments as stated above in the mentioned code area (As Ted suggested).  Later when we support tags to passed in a cell directly from client, we can see how we can optimize it.&lt;/p&gt;</comment>
                            <comment id="15061662" author="huaxiang" created="Thu, 17 Dec 2015 07:35:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; and @ramkrishna.s.vasudevan  Thanks for explaining!&lt;/p&gt;</comment>
                            <comment id="15061664" author="hudson" created="Thu, 17 Dec 2015 07:39:57 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #560 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/560/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/560/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Optimize setting tagsPresent in DefaultMemStore.java (tedyu: rev 546ac1cbb379acb198b2debabbf14c878ffb8a33)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061678" author="hudson" created="Thu, 17 Dec 2015 07:55:00 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #347 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/347/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/347/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Revert according to Ram&apos;s feedback (tedyu: rev d02a4d6dc1c14d9697e12427673d5ad0071c72cc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061706" author="huaxiang" created="Thu, 17 Dec 2015 08:23:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;, For my educational purpose, in HFileWriterImpl.java&apos;s append(), is the cell either NoTagsKeyValue or TagRewriteCell? Thanks.&lt;/p&gt;</comment>
                            <comment id="15061884" author="hudson" created="Thu, 17 Dec 2015 10:52:35 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #444 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/444/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/444/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Revert according to Ram&apos;s feedback (tedyu: rev 988ab048ee3e327c03da3de1c65224c589d0567e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061913" author="hudson" created="Thu, 17 Dec 2015 11:13:56 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #450 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/450/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/450/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Revert according to Ram&apos;s feedback (tedyu: rev d02a4d6dc1c14d9697e12427673d5ad0071c72cc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061917" author="hudson" created="Thu, 17 Dec 2015 11:17:23 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #561 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/561/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/561/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14995&quot; title=&quot;Optimize setting tagsPresent in DefaultMemStore.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14995&quot;&gt;HBASE-14995&lt;/a&gt; Revert according to Ram&apos;s feedback (tedyu: rev d78eddfdc8bad5068600e28a039276cc55063ce2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061976" author="anoop.hbase" created="Thu, 17 Dec 2015 12:25:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;in HFileWriterImpl.java&apos;s append(), is the cell either NoTagsKeyValue or TagRewriteCell&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That was a good question.  It made me to read the write flow again. Yes ideally we think it will be any of these. But the fact is it wont be any of these (by default).&lt;br/&gt;
 By default we have MSLAB usage enabled which makes the cell to be reconstructed (by copying the bytes to a new byte[] and create a KeyValue object) just before adding it to CSLM in Memstore.  So the optimization what we thought wont getting applied.!!   Our bad... did not think abt this before. We need some optimization. CC  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15062329" author="ram_krish" created="Thu, 17 Dec 2015 16:55:35 +0000"  >&lt;p&gt;Ya. We need some optimization here. Good catch. Even I thought it is TagRewriteCell or NoTagsKeyValue.. Atleast during compaction case we can be sure that there will not be much parsing because it is always NoTagsKV or TAgsKeyValue. Only during flush this may happen. We can optimize this not directly in the hot path but still better to do it. &lt;/p&gt;</comment>
                            <comment id="15062375" author="huaxiang" created="Thu, 17 Dec 2015 17:23:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; @ramkrishna.s.vasudevan &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; Thank you very much for the detailed explain, learned a lot from the discussion. &lt;/p&gt;</comment>
                            <comment id="15062419" author="stack" created="Thu, 17 Dec 2015 17:48:29 +0000"  >&lt;p&gt;Whats the upshot then? Resolve this issue and open a new one to add doc. and needed optimization uncovered by mighty &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huaxiang&quot; class=&quot;user-hover&quot; rel=&quot;huaxiang&quot;&gt;huaxiang sun&lt;/a&gt;? Or do it here?&lt;/p&gt;</comment>
                            <comment id="15062427" author="ram_krish" created="Thu, 17 Dec 2015 17:54:58 +0000"  >&lt;p&gt;As part of this patch update the doc and revert the patch here. Raise a new JIRA for the other find by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huaxiang&quot; class=&quot;user-hover&quot; rel=&quot;huaxiang&quot;&gt;huaxiang sun&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15062460" author="anoop.hbase" created="Thu, 17 Dec 2015 18:09:15 +0000"  >&lt;p&gt;Ya we thought initially that TagRewriteCell or NoTagsKeyValue will help us to avoid the parsing of tag length but wont because of the MSLAB..  We need fix.   If the clone with MSLAB copy can create the same Cell type that would have been the best solution IMO.&lt;/p&gt;</comment>
                            <comment id="15063453" author="ram_krish" created="Fri, 18 Dec 2015 04:52:07 +0000"  >&lt;p&gt;Checking the code - first I thought we could create the Cells that are created by HFileReader.getCell() because even there parsing is cheaper.  But it will have more states in addition to KV.  But in case of TagRewriteCell it has a Cell and a byte[] as its state so may occupy more heap size in memstore. &lt;br/&gt;
So create another Cell where we can directly get the TagsLength would be better.  &lt;/p&gt;</comment>
                            <comment id="15063467" author="anoop.hbase" created="Fri, 18 Dec 2015 05:05:02 +0000"  >&lt;p&gt;Yes new Cell which is not having any additional field. Like NoTagsKeyValue.&lt;/p&gt;</comment>
                            <comment id="15064992" author="huaxiang" created="Fri, 18 Dec 2015 23:47:34 +0000"  >&lt;p&gt;I will work on a doc patch for this jira, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12778121" name="HBASE-14995-v001.patch" size="818" author="huaxiang" created="Wed, 16 Dec 2015 22:28:41 +0000"/>
                            <attachment id="12778128" name="HBASE-14995-v002.patch" size="819" author="huaxiang" created="Wed, 16 Dec 2015 22:59:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Dec 2015 22:55:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q06v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>