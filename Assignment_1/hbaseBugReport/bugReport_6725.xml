<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6725/HBASE-6725.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6725] Check and Put can fail when using locks</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6725</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When multiple threads race using CAP with and a lock on the same row, several instances may be allowed to update the cell with the new value (although the expected value is different).&lt;br/&gt;
If all threads race with a wrong expected value and a lock, none will be able to update.&lt;/p&gt;</description>
                <environment>&lt;p&gt;tested on mac os x&lt;/p&gt;</environment>
        <key id="12606422">HBASE-6725</key>
            <summary>Check and Put can fail when using locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nicothieb">Nicolas Thi&#233;baud</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Sep 2012 15:44:48 +0000</created>
                <updated>Wed, 16 Nov 2016 22:16:27 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 22:16:25 +0000</resolved>
                                    <version>0.90.4</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13449749" author="nicothieb" created="Thu, 6 Sep 2012 15:45:33 +0000"  >&lt;p&gt;Example test case&lt;/p&gt;</comment>
                            <comment id="13449875" author="yuzhihong@gmail.com" created="Thu, 6 Sep 2012 18:07:26 +0000"  >&lt;p&gt;@Nicolas:&lt;br/&gt;
Can you format ConcurrentCAPWithLocks class as a proper test so that we can easily verify this bug ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13450468" author="nicothieb" created="Fri, 7 Sep 2012 08:47:32 +0000"  >&lt;p&gt;Hi Ted,&lt;/p&gt;

&lt;p&gt;I did my best to format the test case as a patch against the trunk. Please tell me if this is correctly testable.&lt;/p&gt;</comment>
                            <comment id="13450781" author="yuzhihong@gmail.com" created="Fri, 7 Sep 2012 16:53:43 +0000"  >&lt;p&gt;I tried the test against 0.92 and trunk:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed tests:   testConcurrentCAPWithLocks(org.apache.hadoop.hbase.client.TestConcurrentCAPWithLocks): expected:&amp;lt;5&amp;gt; but was:&amp;lt;1&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13450819" author="yuzhihong@gmail.com" created="Fri, 7 Sep 2012 17:39:28 +0000"  >&lt;p&gt;nit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; c : counts) Assert.assertEquals(c, 1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;c and 1 should be exchanged so that the assertion failure is clear to the user.&lt;/p&gt;

&lt;p&gt;Does this only fail with an empty array as expected value ?&lt;/p&gt;

&lt;p&gt;It would be nice if you can provide patch for this issue.&lt;/p&gt;</comment>
                            <comment id="13451272" author="nicothieb" created="Sat, 8 Sep 2012 07:32:47 +0000"  >&lt;p&gt;It also fails with non-empty expected value. I&apos;m going to try to find the bug and provide a patch.&lt;/p&gt;</comment>
                            <comment id="13452235" author="nicothieb" created="Mon, 10 Sep 2012 17:46:30 +0000"  >&lt;p&gt;The bug comes from the fact that checkAndMutate uses getLock(lockId, get.getRow(), true) and resuses the provided lock. Since several client threads use the same lock many are allowed to mutate.&lt;/p&gt;

&lt;p&gt;I believe there are 2 solutions:&lt;br/&gt;
a. Use some sort of internal lock, which requires a specific lock set for check and mutate&lt;br/&gt;
b. Consider CAP with locks as bad usage of locks and deprecate the feature.&lt;/p&gt;

&lt;p&gt;I&apos;m willing to contribute for this patch, but I&apos;m not sure how to go on from now.&lt;/p&gt;</comment>
                            <comment id="13452246" author="yuzhihong@gmail.com" created="Mon, 10 Sep 2012 17:56:24 +0000"  >&lt;p&gt;@Nicolas:&lt;br/&gt;
Thanks for the finding.&lt;/p&gt;

&lt;p&gt;For point b, can you write a summary on dev@ list to poll people&apos;s opinion ?&lt;/p&gt;</comment>
                            <comment id="13452513" author="nicothieb" created="Mon, 10 Sep 2012 22:12:21 +0000"  >&lt;p&gt;Done.&lt;/p&gt;</comment>
                            <comment id="15671842" author="stack" created="Wed, 16 Nov 2016 22:16:27 +0000"  >&lt;p&gt;Resolving because against 0.90 hbase. Also locking is different now in that we don&apos;t take it across whole row so should not conflict w/ checkAndPut.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544060" name="CAPwithLocks.zip" size="2382" author="nicothieb" created="Thu, 6 Sep 2012 15:45:33 +0000"/>
                            <attachment id="12544188" name="TestCase_HBASE_6725.patch" size="3897" author="nicothieb" created="Fri, 7 Sep 2012 08:47:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Sep 2012 18:07:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02c4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>