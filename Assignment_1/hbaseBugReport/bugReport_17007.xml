<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:20:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-17007/HBASE-17007.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-17007] Move ZooKeeper logging to its own log file</title>
                <link>https://issues.apache.org/jira/browse/HBASE-17007</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ZooKeeper logging can be too verbose. Lets move ZooKeeper logging to a different log file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13017446">HBASE-17007</key>
            <summary>Move ZooKeeper logging to its own log file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="esteban">Esteban Gutierrez</assignee>
                                    <reporter username="esteban">Esteban Gutierrez</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Nov 2016 23:14:40 +0000</created>
                <updated>Fri, 4 Nov 2016 22:33:03 +0000</updated>
                                                                            <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15630937" author="stack" created="Wed, 2 Nov 2016 23:48:53 +0000"  >&lt;p&gt;I think this is a good idea. Lets do it for 2.0.0. Let me mark this as incompatible change. Want to add a release note &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=esteban&quot; class=&quot;user-hover&quot; rel=&quot;esteban&quot;&gt;Esteban Gutierrez&lt;/a&gt; It works? Lets just check it in and see how it does.&lt;/p&gt;</comment>
                            <comment id="15631006" author="enis" created="Thu, 3 Nov 2016 00:20:33 +0000"  >&lt;p&gt;I don&apos;t think this is a good approach. ZK client level log should be in the same file because we have to check for correlation. &lt;/p&gt;</comment>
                            <comment id="15631570" author="stack" created="Thu, 3 Nov 2016 04:48:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; A few of us were sitting around trying to tidy up logs.&lt;/p&gt;

&lt;p&gt;ZK spews all over our log. It duplicates stuff we emit like the CLASSPATH and JVM properties and then usually dumps a few Connection exceptions in our log just for good measure though the cluster startup is &apos;clean&apos; (unsettling any newbie operator for sure). It dumps all info at LOG.info level so we can&apos;t even turn it down. Mighty &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=esteban&quot; class=&quot;user-hover&quot; rel=&quot;esteban&quot;&gt;Esteban Gutierrez&lt;/a&gt; had the good idea of having the zk emissions in their own file. The separated log can still be correlated w/ events in the hbase log given they timestamp the same on the rare occasion we need to match the two (we have our own logging around lost session again making the zk back and forth around this event redundant).&lt;/p&gt;

&lt;p&gt;Rare if at all does the zk log have anything of import in it. Mostly it is just noise obscuring the good stuff w/ its three or four lines every tens seconds heartbeating the ensemble.&lt;/p&gt;

&lt;p&gt;This is what we were thinking today at least.&lt;/p&gt;</comment>
                            <comment id="15633788" author="enis" created="Thu, 3 Nov 2016 18:44:06 +0000"  >&lt;p&gt;Are you guys talking about ZK server logs in case of mini-cluster / single master or ZK client logs? I would like to keep the ZK Client logs together with the region server logs. The ZK server logs in case we start the process can go into a different log. &lt;/p&gt;

&lt;p&gt;If you are talking about log lines like this: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2016-06-16 19:14:56,931 INFO  [ProcessThread(sid:0 cport:2181):] server.PrepRequestProcessor: Got user-level KeeperException when processing sessionid:0x1555c23be730001 type:create cxid:0x7 zxid:0x14 tx
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;these are coming from the server side. &lt;/p&gt;

&lt;p&gt;I just checked RS logs, but did not see anything like an exception or an entry logged frequently from the ZK Client.  &lt;/p&gt;</comment>
                            <comment id="15633961" author="stack" created="Thu, 3 Nov 2016 19:33:07 +0000"  >&lt;p&gt;We are referring to the dup log of environment and classpath all at INFO level.&lt;/p&gt;

&lt;p&gt;Four lines each time it makes a connection:&lt;/p&gt;

&lt;p&gt;487532 2016-11-01 23:06:35,577 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;regionserver/ve0528.halxg.cloudera.com/10.17.240.22:16020&amp;#93;&lt;/span&gt; zookeeper.ZooKeeper: Initiating client connection, connectString=ve0524.halxg.cloudera.com:2222 sessionTimeout=90000 watcher=org.apache.hadoo       p.hbase.zookeeper.PendingWatcher@76ae1cc9&lt;br/&gt;
487533 2016-11-01 23:06:35,578 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;regionserver/ve0528.halxg.cloudera.com/10.17.240.22:16020-SendThread(ve0524.halxg.cloudera.com:2222)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Opening socket connection to server ve0524.halxg.cloudera.com/10.17.240.20:2       222. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
487534 2016-11-01 23:06:35,578 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;regionserver/ve0528.halxg.cloudera.com/10.17.240.22:16020-SendThread(ve0524.halxg.cloudera.com:2222)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Socket connection established to ve0524.halxg.cloudera.com/10.17.240.20:2222       , initiating session&lt;br/&gt;
487535 2016-11-01 23:06:35,587 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;regionserver/ve0528.halxg.cloudera.com/10.17.240.22:16020-SendThread(ve0524.halxg.cloudera.com:2222)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Session establishment complete on server ve0524.halxg.cloudera.com/10.17.240       .20:2222, sessionid = 0x15823a5618b0018, negotiated timeout = 90000&lt;/p&gt;


&lt;p&gt;In particular, a new user starting up a standalone instance gets 200 lines of logs just on startup of which &amp;gt; 10% are zk for the most part duplicating what we&apos;ve already said. Doesn&apos;t look the best.&lt;/p&gt;</comment>
                            <comment id="15634259" author="esteban" created="Thu, 3 Nov 2016 20:59:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; I think what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; said is pretty much one of the main problems with the current logging that we have in the RSs. I think it doesn&apos;t hurt doing this change and helps to reduce the clutter specially during startup of the RS.&lt;/p&gt;</comment>
                            <comment id="15634294" author="esteban" created="Thu, 3 Nov 2016 21:14:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; I think what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; said is pretty much one of the main problems with the current logging that we have in the RSs. I think it doesn&apos;t hurt doing this change and helps to reduce the clutter specially during startup of the RS.&lt;/p&gt;</comment>
                            <comment id="15634534" author="enis" created="Thu, 3 Nov 2016 22:31:48 +0000"  >&lt;p&gt;I have referred to the ZK connection logs before for debugging JAAS setup issues in customer settings and sometimes referred to zk sessionIds etc. I would rather have extra lines than having to manually correlate lines from two different files. It is fine to remove logs which duplicate data like classpath.  &lt;/p&gt;</comment>
                            <comment id="15637883" author="esteban" created="Fri, 4 Nov 2016 22:19:21 +0000"  >&lt;p&gt;We thought about removing only the classpath initially but that requires to patch ZooKeeper to change the client logging level for ZK.  Also ZooKeeper is used by some coprocessors like Tephra and Phoenix and logs get polluted quite easily due other tasks done by those CPs. There is another alternative and that&apos;s removing the duplicated classpath from the logs by adding CLASSPATH  to the list of skipwords in ServerCommandLine but usually the CLASSPATH environment string is shorter than java.class.path as reported by the jvm which is what ZK si dumping. In a quick test the whole line with java.class.path is 63076 bytes long vs 14293 bytes long for the string that contains the CLASSPATH.&lt;/p&gt;</comment>
                            <comment id="15637912" author="stack" created="Fri, 4 Nov 2016 22:33:03 +0000"  >&lt;p&gt;NP. Just thought occassional pain correlating between the two logs rather than one on the rare case of a zk issue small price to pay for some general clean up. Lets see if any other opinions.&lt;/p&gt;

&lt;p&gt;On sessionids, they will still be in the logs reported by our RecoverableZooKeeper.&lt;/p&gt;

&lt;p&gt;We can&apos;t remove the duplication. ZK spews at INFO level and logs properties and CLASSPATH duplicating our doing emissions of the same. Can&apos;t turn it off. &lt;/p&gt;

&lt;p&gt;Then there are also the occasional complaints from client like below (here it is timing around shutdown):&lt;/p&gt;

&lt;p&gt;2016-11-03 12:39:49,832 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;M:0;172.21.1.131:61739&amp;#93;&lt;/span&gt; zookeeper.MiniZooKeeperCluster: Shutdown MiniZK cluster with all ZK servers&lt;br/&gt;
2016-11-03 12:39:49,982 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;172.21.1.131:61739.activeMasterManager-SendThread(localhost:2181)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2016-11-03 12:39:49,983 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;172.21.1.131:61739.activeMasterManager-SendThread(localhost:2181)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Session 0x1582ba35a740006 for server null, unexpected error, closing socket connection and attempting reconnect&lt;br/&gt;
java.net.ConnectException: Connection refused&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717)&lt;br/&gt;
        at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:361)&lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1141)&lt;/p&gt;

&lt;p&gt;They are harmless but to a noobie operator, they probably look worrisome.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12836683" name="0001-HBASE-17007-Move-ZooKeeper-logging-to-its-own-log-fi.patch" size="1701" author="esteban" created="Wed, 2 Nov 2016 23:21:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Nov 2016 23:48:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35rlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>