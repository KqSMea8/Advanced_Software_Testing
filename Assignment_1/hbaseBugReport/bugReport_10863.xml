<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:17:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10863/HBASE-10863.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10863] Scan doesn&apos;t return rows for user who has authorization by visibility label in secure deployment</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10863</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;b&gt;In secure deployment&lt;/b&gt; of 0.98 tip, I did:&lt;br/&gt;
as user hbase:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
add_labels &apos;A&apos;
create &apos;tb&apos;, &apos;f1&apos;
put &apos;tb&apos;, &apos;row&apos;, &apos;f1:q&apos;, &apos;v1&apos;, {VISIBILITY=&amp;gt;&apos;A&apos;}
set_auths &apos;oozie&apos;, [&apos;A&apos;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as user oozie:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):001:0&amp;gt; scan &apos;tb&apos;, { AUTHORIZATIONS =&amp;gt; [&apos;A&apos;]}
ROW                                          COLUMN+CELL
0 row(s) in 0.1030 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is my config:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;hfile.format.version&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;3&amp;lt;/value&amp;gt;
  &amp;lt;/property&amp;gt;
  &amp;lt;property&amp;gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.master.classes&amp;lt;/name&amp;gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.visibility.VisibilityController&amp;lt;/value&amp;gt;
  &amp;lt;/property&amp;gt;
  &amp;lt;property&amp;gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.visibility.VisibilityController&amp;lt;/value&amp;gt;
  &amp;lt;/property&amp;gt;
  &amp;lt;property&amp;gt;
   &amp;lt;name&amp;gt;hbase.regionserver.scan.visibility.label.generator.class&amp;lt;/name&amp;gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.visibility.DefaultScanLabelGenerator&amp;lt;/value&amp;gt;
  &amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12704298">HBASE-10863</key>
            <summary>Scan doesn&apos;t return rows for user who has authorization by visibility label in secure deployment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Mar 2014 16:46:56 +0000</created>
                <updated>Sat, 21 Feb 2015 23:30:22 +0000</updated>
                            <resolved>Sat, 29 Mar 2014 13:10:32 +0000</resolved>
                                    <version>0.98.0</version>
                                    <fixVersion>0.98.1</fixVersion>
                    <fixVersion>0.99.0</fixVersion>
                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13951722" author="yuzhihong@gmail.com" created="Sat, 29 Mar 2014 03:10:53 +0000"  >&lt;p&gt;In region server log, I found:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-03-28 20:11:20,449 DEBUG [RpcServer.handler=19,port=60020] visibility.DefaultScanLabelGenerator: Labels [A] in Scan/Get visibility attributes dropped as user oozie/hor9n04@H.NET having no auth set &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; those.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This was due to oozie/hor9n04@H.NET being parameter for kinit command.&lt;/p&gt;

&lt;p&gt;I came up with a patch which uses user.getShortName() to retrieve labels if user.getName() results in empty passedLabels.&lt;/p&gt;

&lt;p&gt;Still debugging.&lt;/p&gt;</comment>
                            <comment id="13951745" author="anoop.hbase" created="Sat, 29 Mar 2014 03:59:23 +0000"  >&lt;p&gt;I think we can change &lt;br/&gt;
String userName = user.getName();&lt;br/&gt;
to&lt;br/&gt;
String userName = user.getShortName();&lt;/p&gt;

&lt;p&gt;That should work for all cases?&lt;/p&gt;

&lt;p&gt;Good on you Ted. Thanks a lot for debugging this.&lt;/p&gt;</comment>
                            <comment id="13951820" author="apurtell" created="Sat, 29 Mar 2014 09:55:26 +0000"  >&lt;p&gt;We should use getShortName to be consistent with how the AccessController works with krb principals. &lt;/p&gt;</comment>
                            <comment id="13951827" author="yuzhihong@gmail.com" created="Sat, 29 Mar 2014 10:11:23 +0000"  >&lt;p&gt;Tested patch in a secure deployment.&lt;br/&gt;
Here is the result of scan:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):001:0&amp;gt; scan &apos;tb&apos;, { AUTHORIZATIONS =&amp;gt; [&apos;A&apos;]}
ROW                                          COLUMN+CELL
 row                                         column=f1:q, timestamp=1395971660859, value=v1
 row2                                        column=f1:q, timestamp=1395972271343, value=v2
 row3                                        column=f1:q, timestamp=1396067477702, value=v3
3 row(s) in 0.1310 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Rows &apos;row&apos; and &apos;row3&apos; were inserted with label &apos;A&apos;.&lt;br/&gt;
Row &apos;row2&apos; was inserted without label.&lt;br/&gt;
Row &apos;row1&apos; was inserted with label &apos;B&apos;, hence filtered.&lt;/p&gt;</comment>
                            <comment id="13951828" author="yuzhihong@gmail.com" created="Sat, 29 Mar 2014 10:12:13 +0000"  >&lt;p&gt;Patch v2 adopts review comments and was verified to work in a secure deployment.&lt;/p&gt;</comment>
                            <comment id="13951833" author="apurtell" created="Sat, 29 Mar 2014 10:27:40 +0000"  >&lt;p&gt;+1 on v2 patch&lt;/p&gt;</comment>
                            <comment id="13951843" author="anoop.hbase" created="Sat, 29 Mar 2014 10:58:59 +0000"  >&lt;p&gt;+1 for v2.  Thanks for the analysis and fix Ted..&lt;/p&gt;</comment>
                            <comment id="13951871" author="hadoopqa" created="Sat, 29 Mar 2014 12:24:25 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12637621/10863-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12637621/10863-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12637621&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9136//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9136//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13954262" author="hudson" created="Sat, 29 Mar 2014 13:44:06 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #257 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/257/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/257/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10863&quot; title=&quot;Scan doesn&amp;#39;t return rows for user who has authorization by visibility label in secure deployment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10863&quot;&gt;&lt;del&gt;HBASE-10863&lt;/del&gt;&lt;/a&gt; Scan doesn&apos;t return rows for user who has authorization by visibility label (tedyu: rev 1582978)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/DefaultScanLabelGenerator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13954285" author="hudson" created="Sat, 29 Mar 2014 15:24:19 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #241 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/241/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/241/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10863&quot; title=&quot;Scan doesn&amp;#39;t return rows for user who has authorization by visibility label in secure deployment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10863&quot;&gt;&lt;del&gt;HBASE-10863&lt;/del&gt;&lt;/a&gt; Scan doesn&apos;t return rows for user who has authorization by visibility label (tedyu: rev 1582978)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/DefaultScanLabelGenerator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13954302" author="hudson" created="Sat, 29 Mar 2014 15:42:53 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5050 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5050/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5050/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10863&quot; title=&quot;Scan doesn&amp;#39;t return rows for user who has authorization by visibility label in secure deployment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10863&quot;&gt;&lt;del&gt;HBASE-10863&lt;/del&gt;&lt;/a&gt; Scan doesn&apos;t return rows for user who has authorization by visibility label (tedyu: rev 1582979)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/DefaultScanLabelGenerator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13954342" author="ram_krish" created="Sat, 29 Mar 2014 17:07:56 +0000"  >&lt;p&gt;Thanks Ted.  Appreciate your patient debugging. Patch looks good to me. Belated +1&lt;/p&gt;</comment>
                            <comment id="14330683" author="enis" created="Sat, 21 Feb 2015 23:30:22 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12637600" name="10863-v1.txt" size="1212" author="yuzhihong@gmail.com" created="Sat, 29 Mar 2014 03:11:46 +0000"/>
                            <attachment id="12637621" name="10863-v2.txt" size="949" author="yuzhihong@gmail.com" created="Sat, 29 Mar 2014 10:12:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 29 Mar 2014 03:59:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382632</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tx5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382900</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>