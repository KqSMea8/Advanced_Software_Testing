<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:08:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9934/HBASE-9934.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9934] Mesh replication (a.k.a. multi master replication)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9934</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is to setup NxN replication.&lt;/p&gt;

&lt;p&gt;See background discussion here: &lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/hbase-user/201311.mbox/%3CCAOiuM-4UMmLA7UHMp4hhjpLWUrHDxg1t4tN4aWvnZUMcTxG%2BKQ%40mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/hbase-user/201311.mbox/%3CCAOiuM-4UMmLA7UHMp4hhjpLWUrHDxg1t4tN4aWvnZUMcTxG%2BKQ%40mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We can add a new mode in replication to not forward edits from other clusters. Not sure what should be done when some clusters are configured with this setting and some aren&apos;t.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12678378">HBASE-9934</key>
            <summary>Mesh replication (a.k.a. multi master replication)</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ishanc">Ishan Chhabra</assignee>
                                    <reporter username="ishanc">Ishan Chhabra</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Nov 2013 03:44:20 +0000</created>
                <updated>Tue, 26 Nov 2013 17:31:14 +0000</updated>
                                                                            <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13818028" author="lhofhansl" created="Sat, 9 Nov 2013 05:46:51 +0000"  >&lt;p&gt;The main task here is to find an intuitive way to set this up. The implementation itself shouldn&apos;t be difficult.&lt;/p&gt;</comment>
                            <comment id="13819329" author="ishanc" created="Mon, 11 Nov 2013 20:21:11 +0000"  >&lt;p&gt;I agree. &lt;/p&gt;

&lt;p&gt;Let me setup a graph of HBase clusters for further discussion. Lets say we have 6 clusters, C1..C6.&lt;br/&gt;
C1..C3 want to replicate to each other in the NxN fashion (i.e. with no forwarding) and the following master master replications are setup: C4 &amp;lt;&amp;#45;&amp;gt; C3, C5 &amp;lt;&amp;#45;&amp;gt; C3 and C6 &amp;lt;-&amp;gt; C5&lt;/p&gt;

&lt;p&gt;C4 &amp;lt;&amp;#45;&amp;gt; C3 &amp;lt;&amp;#45;&amp;gt; C5 &amp;lt;-&amp;gt; C6&lt;br/&gt;
           /    \&lt;br/&gt;
        C1 - C2&lt;/p&gt;

&lt;p&gt;1. The source cluster sets the replication scope for the column family that is being replicated as SINGLE_HOP_ONLY and the targets clusters do not forward KeyValues with families that have their scope set as this. The decision on whether a write should be forwarded ahead thus lies with the source cluster in this case. This will work if we just had C1..C3 but will &lt;b&gt;not&lt;/b&gt; work in the above example since a write from C4 will not have the correct scope set and will circulate more in C1..C3 than needed. We could say that such a mixed setting is not supported, but it is hard to prevent someone from shooting themselves in their foot.&lt;/p&gt;

&lt;p&gt;2.  Having thought about this, this looks more like a property of the link (whether it is a part of mesh network or a standard Master-Slave / Master-Master link). If a link is a part of the mesh network, then &lt;b&gt;all&lt;/b&gt; writes coming from that link (including ones that could have originated at a different cluster) should not be forwarded. To do this setup, we would have to add this as a property for the peer (in the zookeeper state?) and then when an edit is sent across a link, it should be marked as &quot;do not forward&quot;. This could be a part of the WALEdit key or we could add support for tags to WALEdit (similar to cells) and add it there.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13819517" author="ishanc" created="Mon, 11 Nov 2013 22:29:00 +0000"  >&lt;p&gt;Changed the title to Mesh replication as that describes the feature request better. Multi-master replication may not be the best term but is used by the DBA community for these setups for MySQL or other RDBMS.&lt;/p&gt;</comment>
                            <comment id="13819538" author="lhofhansl" created="Mon, 11 Nov 2013 22:48:55 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ishanc&quot; class=&quot;user-hover&quot; rel=&quot;ishanc&quot;&gt;Ishan Chhabra&lt;/a&gt;, trying to follow. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
So if I understand you correctly you want be able to say at the source to replication only exactly one hop.&lt;br/&gt;
That might be the typical setup anyway. I do not think many folks will use &quot;cyclic replication&quot; (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2195&quot; title=&quot;Support cyclic replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2195&quot;&gt;&lt;del&gt;HBASE-2195&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13819608" author="ishanc" created="Mon, 11 Nov 2013 23:45:43 +0000"  >&lt;p&gt;That is the first proposal. It will not work where people have a mixed setup. The 2nd one, where a link (source, sink) pair is specified to be belonging to a mesh network should work better, but might be more dev work.&lt;/p&gt;

&lt;p&gt;Also, when you were cleaning my comment, the diagram got changed. Below is the fixed version.&lt;/p&gt;

&lt;p&gt;C4 &amp;lt;&amp;#45;&amp;gt; C3 &amp;lt;&amp;#45;&amp;gt; C5 &amp;lt;-&amp;gt; C6&lt;br/&gt;
            / \&lt;br/&gt;
       C1 - C2&lt;/p&gt;</comment>
                            <comment id="13819610" author="ishanc" created="Mon, 11 Nov 2013 23:46:56 +0000"  >&lt;p&gt;Ok. The above one is not right again. The spaces are removed when I save and the weird strike though comes in. C1 and C2 are connected to C3 and not C4.&lt;/p&gt;</comment>
                            <comment id="13819694" author="lhofhansl" created="Tue, 12 Nov 2013 01:06:00 +0000"  >&lt;p&gt;Fixed the comment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;OK I get it, each source-sink pair has to be declared to only do one hop. Hmm. As you said it makes sense to expose this via addPeer. Then where to put this information? Maybe in ZK. Then we need to a good way to check that information when it is time to replicate at the sink for that data. Maybe it&apos;s not quite as simple as I thought.&lt;/p&gt;

&lt;p&gt;Do you have time to work up a patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ishanc&quot; class=&quot;user-hover&quot; rel=&quot;ishanc&quot;&gt;Ishan Chhabra&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13819711" author="nidmhbase" created="Tue, 12 Nov 2013 01:28:28 +0000"  >&lt;p&gt;if expose this (one-hop) property through addPeer, that will impact everything replicated to that particular peer. How about expose it at colfamily level? For example, we turn on replication of a colfam by set &apos;REPLICATION_SCOPE&apos; to a none-zero value. maybe we can reuse this field? &lt;/p&gt;</comment>
                            <comment id="13819871" author="lhofhansl" created="Tue, 12 Nov 2013 06:21:37 +0000"  >&lt;p&gt;If I understood Ishan correctly, he wants to be able replicate the same change to some cluster in a chain and directly to some other clusters.&lt;/p&gt;</comment>
                            <comment id="13819887" author="ishanc" created="Tue, 12 Nov 2013 07:11:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nidmhbase&quot; class=&quot;user-hover&quot; rel=&quot;nidmhbase&quot;&gt;Demai Ni&lt;/a&gt; Lars&apos; understanding is correct. That is why this should be specified at peer level and not CF level. Also, when per cf peer definition will be supported, this would fit in automatically at peer level. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Ill give this a shot. Can you assign this to me?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 9 Nov 2013 05:46:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1po8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>