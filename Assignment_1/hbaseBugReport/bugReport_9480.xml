<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:04:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9480/HBASE-9480.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9480] Regions are unexpectedly made offline in certain failure conditions</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9480</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Came across this issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9338&quot; title=&quot;Test Big Linked List fails on Hadoop 2.1.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9338&quot;&gt;&lt;del&gt;HBASE-9338&lt;/del&gt;&lt;/a&gt; test):&lt;br/&gt;
1. Client issues a request to move a region from ServerA to ServerB&lt;br/&gt;
2. ServerA is compacting that region and doesn&apos;t close region immediately. In fact, it takes a while to complete the request.&lt;br/&gt;
3. The master in the meantime, sends another close request.&lt;br/&gt;
4. ServerA sends it a NotServingRegionException&lt;br/&gt;
5. Master handles the exception, deletes the znode, and invokes regionOffline for the said region.&lt;br/&gt;
6. ServerA fails to operate on ZK in the CloseRegionHandler since the node is deleted.&lt;/p&gt;

&lt;p&gt;The region is permanently offline.&lt;/p&gt;


&lt;p&gt;There are potentially other situations where when a RegionServer is offline and the client asks for a region move off from that server, the master makes the region offline.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12667699">HBASE-9480</key>
            <summary>Regions are unexpectedly made offline in certain failure conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jxiang">Jimmy Xiang</assignee>
                                    <reporter username="devaraj">Devaraj Das</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Sep 2013 23:47:12 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:06 +0000</updated>
                            <resolved>Sat, 14 Sep 2013 20:00:13 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.96.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="13762499" author="jeffreyz" created="Tue, 10 Sep 2013 00:11:30 +0000"  >&lt;p&gt;The code pattern is like the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transitionInZK) {
          &lt;span class=&quot;code-comment&quot;&gt;// delete the node. &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no node exists need not bother.
&lt;/span&gt;          deleteClosingOrClosedNode(region);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          regionOffline(region);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The deleteClosingOrClosedNode is fatal as it breaks AssignmentManager state transition loop by deleting the RIT ZNode.&lt;/p&gt;

&lt;p&gt;I think we should throw exception for current JIRA issues such as DeadServer or NotServicing.&lt;/p&gt;</comment>
                            <comment id="13763107" author="devaraj" created="Tue, 10 Sep 2013 15:15:00 +0000"  >&lt;p&gt;This is the patch that I have been working with.&lt;/p&gt;</comment>
                            <comment id="13763120" author="jxiang" created="Tue, 10 Sep 2013 15:31:12 +0000"  >&lt;p&gt;I think a proper fix should be aborting the region server at step 6.&lt;/p&gt;</comment>
                            <comment id="13763160" author="devaraj" created="Tue, 10 Sep 2013 16:10:23 +0000"  >&lt;p&gt;Hmm.. yeah the patch i uploaded was mostly to get me out of the woods. We should see what the right fix is.&lt;/p&gt;</comment>
                            <comment id="13763197" author="jeffreyz" created="Tue, 10 Sep 2013 16:45:40 +0000"  >&lt;p&gt;It&apos;s not ideal to abort here. Because the aborting is on master(Single Failure Point) which handles region assignment &amp;amp; SSH and may have other chain effects or master may keep aborting. &lt;/p&gt;

&lt;p&gt;Since the issue is more caused by &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;deleteClosingOrClosedNode(region);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; which stopped the assignment state machine, I think we can remove them(there are two places in this unassign function). &lt;/p&gt;

&lt;p&gt;The longer term fix should allow unassign to throw exception to let different code paths handle differently and fast fail move region request(either by a user or balancer) before a region move or during a move.&lt;/p&gt;</comment>
                            <comment id="13763211" author="devaraj" created="Tue, 10 Sep 2013 16:51:19 +0000"  >&lt;p&gt;Jimmy I think meant aborting the RS in question.&lt;/p&gt;</comment>
                            <comment id="13763259" author="jeffreyz" created="Tue, 10 Sep 2013 17:19:46 +0000"  >&lt;p&gt;Oh, my bad I thought aborting master. Aborting RS may still not fully cover the issue because exception may triggered by current RS is in SSH already and outer retry loop still could delete RIT node and interfere with SSH handling. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; Any issue do you see if we remove the following two lines in function unassign? Thanks.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transitionInZK) {
          &lt;span class=&quot;code-comment&quot;&gt;// delete the node. &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no node exists need not bother.
&lt;/span&gt;          deleteClosingOrClosedNode(region);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          regionOffline(region);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13763499" author="jxiang" created="Tue, 10 Sep 2013 20:52:33 +0000"  >&lt;p&gt;Aborting the RS may not be a good solution. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, you meant the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt; posted, right?  I think it is ok. +1.&lt;/p&gt;</comment>
                            <comment id="13763528" author="jeffreyz" created="Tue, 10 Sep 2013 21:23:29 +0000"  >&lt;p&gt;Yeah. In &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt; patch, he only touched one place how about removing the similar one above in the same unassign function like the following and keep the &quot;return&quot; because there is no need to retry. Thanks.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maximumAttempts; i++) {
       &lt;span class=&quot;code-comment&quot;&gt;// ClosedRegionhandler can remove the server from &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions
&lt;/span&gt;       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!serverManager.isServerOnline(server)) {
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transitionInZK) {
-          &lt;span class=&quot;code-comment&quot;&gt;// delete the node. &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no node exists need not bother.
&lt;/span&gt;-          deleteClosingOrClosedNode(region);
-        }
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
-          regionOffline(region);
-        }
+        &lt;span class=&quot;code-comment&quot;&gt;// SSH will transition the region
&lt;/span&gt;         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
       }
       &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
@@ -1772,12 +1766,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class AssignmentManager &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ZooKeeperListener {
         }
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (t &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; NotServingRegionException
             || t &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; RegionServerStoppedException) {
-          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transitionInZK) {
-            deleteClosingOrClosedNode(region);
-          }
-          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
-            regionOffline(region);
-          }
+          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;sendRegionClose failed because &quot;&lt;/span&gt; + region.getEncodedName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; isn&apos;t on server&quot;&lt;/span&gt;
+              + server, t);
           &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13763544" author="jxiang" created="Tue, 10 Sep 2013 21:34:41 +0000"  >&lt;p&gt;I knew the first one. I think we should keep it because a server is not online doesn&apos;t mean SSH is going to handle it. At least, we don&apos;t see the same problem as for the second one, do we?&lt;/p&gt;</comment>
                            <comment id="13763569" author="jxiang" created="Tue, 10 Sep 2013 21:51:54 +0000"  >&lt;p&gt;Realized that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt;&apos;s patch removed the return too. No need to retry, right?&lt;/p&gt;</comment>
                            <comment id="13763658" author="jeffreyz" created="Tue, 10 Sep 2013 22:57:46 +0000"  >&lt;blockquote&gt;
&lt;p&gt;At least, we don&apos;t see the same problem as for the second one, do we?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We saw it in one test case where SSH was aborted and later a region move request come in to move the region to somewhere else. In reality this could happen though rarely. I&apos;m fine to leave it as it is or cross check dead servers being processed by SSH before issuing deletes. &lt;/p&gt;</comment>
                            <comment id="13763819" author="devaraj" created="Wed, 11 Sep 2013 01:27:28 +0000"  >&lt;p&gt;The &quot;inconsistency&quot; I see is that although the region&apos;s RIT znode is deleted and the region is offlined, the master will reenable it when the master is restarted. Kind of a no-op in that sense. It makes sense to not delete that znode at all..&lt;/p&gt;</comment>
                            <comment id="13763887" author="jxiang" created="Wed, 11 Sep 2013 02:42:12 +0000"  >&lt;p&gt;Let me think about to make the region server throw a region already in transition exception in this case, which is not accurate to throw a not serve region exception.  If a region is indeed not served in a region server, I think we should delete the znode.&lt;/p&gt;</comment>
                            <comment id="13764585" author="stack" created="Wed, 11 Sep 2013 18:15:26 +0000"  >&lt;p&gt;So, a subclass of NSRE, say, NotServingClosingRegionException, one that a client would treat as NSRE but that the master would wait on?  For pure NSRE, master would do as it currently does, delete the znode.&lt;/p&gt;</comment>
                            <comment id="13764590" author="jxiang" created="Wed, 11 Sep 2013 18:22:43 +0000"  >&lt;p&gt;Attached a patch to make sure the znode is not deleted in this case.  RS throws a region already in transition exception. Master moves the region to failed_to_close state once tries run out.  The region can still be closed and reassigned if it is eventually closed.&lt;/p&gt;

&lt;p&gt;Trying to add a test case now.&lt;/p&gt;</comment>
                            <comment id="13764592" author="jeffreyz" created="Wed, 11 Sep 2013 18:24:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;If a region is indeed not served in a region server, I think we should delete the znode.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The RIT zk node deletion here is on intermediate states(closing &amp;amp; closed) not the final state nodes. Deleting them stops state transition abruptly and causes region lost as there are multiple parties(master &amp;amp; region server) in state transition. We also see similar RIT premature deletion(hbase-9387) cause region lost. IMHO, it&apos;s better to keep RIT znodes and let region state machine proceed.&lt;/p&gt;</comment>
                            <comment id="13764717" author="hadoopqa" created="Wed, 11 Sep 2013 20:25:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12602617/trunk-9480.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12602617/trunk-9480.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7156//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13764728" author="jxiang" created="Wed, 11 Sep 2013 20:32:54 +0000"  >&lt;p&gt;I&apos;d like to take this issue.&lt;/p&gt;</comment>
                            <comment id="13764777" author="jeffreyz" created="Wed, 11 Sep 2013 21:08:17 +0000"  >&lt;p&gt;I reviewed trunk-9480.patch. Since we have outer loop retries, the new retry could trigger NotServingRegionException if the region is closed at the RS or the RS just dies between retries &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;!serverManager.isServerOnline(server)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; would kick in. In addition, we still will have the issue depending on the time when region is closed at the hosting RS. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; so you don&apos;t want remove the znode deletion part from unassign? Thanks.&lt;/p&gt;</comment>
                            <comment id="13764818" author="jxiang" created="Wed, 11 Sep 2013 21:38:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, thanks for reviewing it. I just attached v1.1 (not much changes, just added two test cases).&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;so you don&apos;t want remove the znode deletion part from unassign?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If the region is not there, we should delete the znode and re-assign the region.  This is used by hbck/admin to fix some region stuck in transition. Now, since we throw region already in transition, we don&apos;t need to delete the znode any more, right?&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;new retry could trigger NotServingRegionException if the region is closed at the RS or the RS just dies between retries&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If rs dies in the middle, it&apos;s ok, the region is offline anyway. If the region is closed while we are unassigning it, the znode should be already deleted.&lt;/p&gt;</comment>
                            <comment id="13764844" author="jeffreyz" created="Wed, 11 Sep 2013 22:00:28 +0000"  >&lt;p&gt;The region isn&apos;t there could be the case that a region is in transition(or move). There are some time widow that a region is closed at the hosting RS(znode isn&apos;t deleted because the region is about to open in a different RS) and before the znode state changes to offline, the current retry loop or the timing we send the CLOSE RPC could still let us hit the origin code path.&lt;/p&gt;</comment>
                            <comment id="13764861" author="jxiang" created="Wed, 11 Sep 2013 22:15:51 +0000"  >&lt;p&gt;Even the region is closed, we still mark the region is closing in the region server (regionsInTransitionInRS).  Only after the znode is deleted, we remove it from the map. I will fix a minor issue in the patch and attach a new one.&lt;/p&gt;</comment>
                            <comment id="13764871" author="jxiang" created="Wed, 11 Sep 2013 22:23:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, how about version 1.2? If you still see some problem, can you show me how to reproduce it so that I can add a testcase to cover it?&lt;/p&gt;</comment>
                            <comment id="13764951" author="stack" created="Wed, 11 Sep 2013 23:30:29 +0000"  >&lt;p&gt;I think it funny how presumption of state keeps biting us (in this case, master thinking the RS &apos;gone&apos; so does cleanup of znode so can give region elsewhere).&lt;/p&gt;</comment>
                            <comment id="13764965" author="jxiang" created="Wed, 11 Sep 2013 23:37:33 +0000"  >&lt;p&gt;Yes, we need to have a better way to do this, most likely after 0.98.&lt;/p&gt;</comment>
                            <comment id="13765031" author="hadoopqa" created="Thu, 12 Sep 2013 01:05:43 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12602688/trunk-9480_v1.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12602688/trunk-9480_v1.2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestAssignmentManagerOnCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7165//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13765246" author="jeffreyz" created="Thu, 12 Sep 2013 07:47:04 +0000"  >&lt;p&gt;I reviewed the 1.2 patch. The newly introduced RegionAlreadyInTransition exception makes the TestAssignmentManagerOnCluster flaky. It depends on if the retry loop(once RegionAlreadyInTransition is raised) can hit the old code path. I think you can safely revert the code in HRegionServer because the newly added following code resumes region transition after zk node deletion. &lt;/p&gt;

&lt;p&gt;The rest looks good to me though I&apos;m wondering if it&apos;s possible that you can move the following code inside unsign itself immediately after &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;regionOffline(region);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; so caller don&apos;t need call the following explicitly.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (regionStates.isRegionOffline(region)) {
+        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClosedRegionHandler(server, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, region).process();
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13765703" author="jxiang" created="Thu, 12 Sep 2013 17:58:23 +0000"  >&lt;p&gt;I am looking the flaky test, will fix it soon.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think you can safely revert the code in HRegionServer because the newly added following code resumes region transition after zk node deletion&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I really worried about double-assignment. That&apos;s why I want to make sure the region is closed before we start to assign it somewhere else. I think it is a right thing to differentiate not serving from still closing. We can fix new issues caused by this, right?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m wondering if it&apos;s possible that you can move the following code inside unsign itself immediately after&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I thought about this too.  The reason I didn&apos;t do that is because sometimes we don&apos;t want to re-assign the region now. For example, inside handleRegion when an unexpected RS_ZK_REGION_OPENED is received.&lt;/p&gt;</comment>
                            <comment id="13765777" author="jeffreyz" created="Thu, 12 Sep 2013 19:01:00 +0000"  >&lt;blockquote&gt;
&lt;p&gt;For example, inside handleRegion when an unexpected RS_ZK_REGION_OPENED is received.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You might gave a wrong example. In the above case, ClosedRegionHandler won&apos;t be trigged because NULL is passed for RegionState. I&apos;m fine you leave as it is to limit the impact. &lt;/p&gt;</comment>
                            <comment id="13765781" author="jxiang" created="Thu, 12 Sep 2013 19:07:37 +0000"  >&lt;p&gt;You are right.  That&apos;s one doesn&apos;t apply. The force assign one should apply. Yes, I meant to limit the impact.&lt;/p&gt;</comment>
                            <comment id="13765932" author="jxiang" created="Thu, 12 Sep 2013 21:49:14 +0000"  >&lt;p&gt;Attached v2, now the test should not be flaky any more.&lt;/p&gt;</comment>
                            <comment id="13766997" author="stack" created="Fri, 13 Sep 2013 21:38:55 +0000"  >&lt;p&gt;Patch looks good to me on skim but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt; are you good w/ it? You have been paying attention.&lt;/p&gt;</comment>
                            <comment id="13767002" author="stack" created="Fri, 13 Sep 2013 21:42:31 +0000"  >&lt;p&gt;After talking w/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;, this is not a blocker; state comes about because of outside intervention, not by normal operation (Yes, we need to make it so that outside intervention cannot put hbase into odd state but also need to allow administrators to do fixup &amp;#8211; TODO: Make it so only privileged user can do status threatening ops).&lt;/p&gt;</comment>
                            <comment id="13767044" author="jeffreyz" created="Fri, 13 Sep 2013 22:10:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; v2 patch looks good to me.(+1) Thanks. We need to find a better way to simplify AM because it&apos;s not a good thing to have many edge cases to cover. &lt;/p&gt;</comment>
                            <comment id="13767068" author="stack" created="Fri, 13 Sep 2013 22:30:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt; Agreed.  There are too many corner cases and then there is amount of resources consumed getting this whole rube goldberg machine working reliably.  There are scaling issues too (see the flurry talk at the last hbase meetup).  We should have a chat about it &amp;#8211; post 0.96.0 rollout?  There are a few ideas floating about.  Should come up with a strawman at least while the pain is fresh in our minds.&lt;/p&gt;

&lt;p&gt;(Cc&apos;ing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fenghh&quot; class=&quot;user-hover&quot; rel=&quot;fenghh&quot;&gt;Honghua Feng&lt;/a&gt; since he expressed interest in this area too as is &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; of course)&lt;/p&gt;</comment>
                            <comment id="13767175" author="jxiang" created="Fri, 13 Sep 2013 23:34:00 +0000"  >&lt;p&gt;Agreed. We need to make things much simpler. It is really nice to discuss with you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;. Thanks everyone. I will commit it tomorrow.&lt;/p&gt;</comment>
                            <comment id="13767560" author="jxiang" created="Sat, 14 Sep 2013 20:00:13 +0000"  >&lt;p&gt;Integrated into 0.96 and trunk. Thanks.&lt;/p&gt;</comment>
                            <comment id="13767588" author="hudson" created="Sat, 14 Sep 2013 21:34:03 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #48 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/48/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/48/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9480&quot; title=&quot;Regions are unexpectedly made offline in certain failure conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9480&quot;&gt;&lt;del&gt;HBASE-9480&lt;/del&gt;&lt;/a&gt; Regions are unexpectedly made offline in certain failure conditions (jxiang: rev 1523308)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-client/src/main/java/org/apache/hadoop/hbase/master/RegionState.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13767606" author="hudson" created="Sat, 14 Sep 2013 22:31:04 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4507 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4507/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4507/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9480&quot; title=&quot;Regions are unexpectedly made offline in certain failure conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9480&quot;&gt;&lt;del&gt;HBASE-9480&lt;/del&gt;&lt;/a&gt; Regions are unexpectedly made offline in certain failure conditions (jxiang: rev 1523303)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/master/RegionState.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13767614" author="hudson" created="Sat, 14 Sep 2013 23:20:08 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96-hadoop2 #27 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/27/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/27/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9480&quot; title=&quot;Regions are unexpectedly made offline in certain failure conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9480&quot;&gt;&lt;del&gt;HBASE-9480&lt;/del&gt;&lt;/a&gt; Regions are unexpectedly made offline in certain failure conditions (jxiang: rev 1523308)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-client/src/main/java/org/apache/hadoop/hbase/master/RegionState.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13767650" author="hudson" created="Sun, 15 Sep 2013 01:51:47 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #729 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/729/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/729/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9480&quot; title=&quot;Regions are unexpectedly made offline in certain failure conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9480&quot;&gt;&lt;del&gt;HBASE-9480&lt;/del&gt;&lt;/a&gt; Regions are unexpectedly made offline in certain failure conditions (jxiang: rev 1523303)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/master/RegionState.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13767696" author="lhofhansl" created="Sun, 15 Sep 2013 05:38:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;, is this an issue in 0.94 as well?&lt;/p&gt;</comment>
                            <comment id="13767994" author="jxiang" created="Mon, 16 Sep 2013 01:38:44 +0000"  >&lt;p&gt;0.94 doesn&apos;t have the same issue since RS#closeRegion already throws RegionAlreadyInTransitionException in this case.&lt;/p&gt;</comment>
                            <comment id="13768293" author="fenghh" created="Mon, 16 Sep 2013 13:05:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;(Cc&apos;ing Feng Honghua since he expressed interest in this area too as is Jimmy Xiang of course)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. Seems current master/zk/RS&apos;s main communication pattern (RS updates zk node, master watches change of zk node), together with the asynchronous and &apos;one-time&apos; nature of zk watch, result in too many corner cases for assignment manager(and region split). I&apos;m making a proposal for new master/zk/RS&apos;s communcation pattern. The main theme is master sends request to RS, RS responses the progress back to master, master persists the request progress in another system table(like meta table), why not zk is for better throughput/performance for huge table with big number of regions... &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13768420" author="stack" created="Mon, 16 Sep 2013 15:35:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fenghh&quot; class=&quot;user-hover&quot; rel=&quot;fenghh&quot;&gt;Honghua Feng&lt;/a&gt; Sounds great.  Make new issue and we&apos;ll pile on.&lt;/p&gt;</comment>
                            <comment id="15016141" author="lars_francke" created="Fri, 20 Nov 2015 11:54:06 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602350" name="9480-1.txt" size="1162" author="devaraj" created="Tue, 10 Sep 2013 15:15:00 +0000"/>
                            <attachment id="12602617" name="trunk-9480.patch" size="6465" author="jxiang" created="Wed, 11 Sep 2013 18:22:43 +0000"/>
                            <attachment id="12602674" name="trunk-9480_v1.1.patch" size="17893" author="jxiang" created="Wed, 11 Sep 2013 21:16:23 +0000"/>
                            <attachment id="12602688" name="trunk-9480_v1.2.patch" size="19966" author="jxiang" created="Wed, 11 Sep 2013 22:23:34 +0000"/>
                            <attachment id="12602890" name="trunk-9480_v2.patch" size="22642" author="jxiang" created="Thu, 12 Sep 2013 21:49:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Sep 2013 00:11:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347636</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ny0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347935</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>