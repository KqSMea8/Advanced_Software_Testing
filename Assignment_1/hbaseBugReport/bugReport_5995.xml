<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5995/HBASE-5995.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5995] Fix and reenable TestLogRolling.testLogRollOnPipelineRestart</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5995</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5984&quot; title=&quot;TestLogRolling.testLogRollOnPipelineRestart failed with HADOOP 2.0.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5984&quot;&gt;&lt;del&gt;HBASE-5984&lt;/del&gt;&lt;/a&gt; disabled this flakey test (See the issue for more).  This issue is about getting it enabled again.  Made a blocker on 0.96.0 so it gets attention.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12555037">HBASE-5995</key>
            <summary>Fix and reenable TestLogRolling.testLogRollOnPipelineRestart</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12609485">HBASE-6891</parent>
                                    <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 May 2012 21:41:48 +0000</created>
                <updated>Mon, 23 Sep 2013 19:08:13 +0000</updated>
                            <resolved>Wed, 15 May 2013 18:53:55 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.95.1</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13274759" author="apurtell" created="Mon, 14 May 2012 17:12:20 +0000"  >&lt;p&gt;+1 for blocker status, thanks Stack. HBase should be able to survive a rolling DN restart and we need to test for that.&lt;/p&gt;</comment>
                            <comment id="13470752" author="yuzhihong@gmail.com" created="Fri, 5 Oct 2012 22:46:46 +0000"  >&lt;p&gt;When I ran the test against hadoop 2.0, it failed with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testLogRollOnPipelineRestart(org.apache.hadoop.hbase.regionserver.wal.TestLogRolling)  Time elapsed: 0.243 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.io.IOException: Cannot obtain block length &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; LocatedBlock{BP-1150895311-10.249.196.101-1349476630606:blk_7782056094701760427_1026; getBlockSize()=1472; corrupt=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; offset=0; locs=[127.0.0.1:44729, 127.0.0.1:38785]}
  at org.apache.hadoop.hdfs.DFSInputStream.readBlockLength(DFSInputStream.java:232)
  at org.apache.hadoop.hdfs.DFSInputStream.fetchLocatedBlocksAndGetLastBlockLength(DFSInputStream.java:177)
  at org.apache.hadoop.hdfs.DFSInputStream.openInfo(DFSInputStream.java:119)
  at org.apache.hadoop.hdfs.DFSInputStream.&amp;lt;init&amp;gt;(DFSInputStream.java:112)
  at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:966)
  at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:212)
  at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:75)
  at org.apache.hadoop.io.SequenceFile$Reader.openFile(SequenceFile.java:1768)
  at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader$WALReader.openFile(SequenceFileLogReader.java:63)
  at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1688)
  at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1709)
  at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader$WALReader.&amp;lt;init&amp;gt;(SequenceFileLogReader.java:56)
  at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.init(SequenceFileLogReader.java:176)
  at org.apache.hadoop.hbase.regionserver.wal.HLogFactory.createReader(HLogFactory.java:82)
  at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.testLogRollOnPipelineRestart(TestLogRolling.java:501)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13470872" author="apurtell" created="Sat, 6 Oct 2012 02:21:59 +0000"  >&lt;p&gt;This fails consistently against Hadoop 2.&lt;/p&gt;</comment>
                            <comment id="13498351" author="stack" created="Thu, 15 Nov 2012 21:27:57 +0000"  >&lt;p&gt;Todd said he&apos;d have a look... might have some advice for us.&lt;/p&gt;</comment>
                            <comment id="13499236" author="stack" created="Fri, 16 Nov 2012 23:22:16 +0000"  >&lt;p&gt;I tried the test w/ hadoop 2.0.2-alpha and it fails same way.&lt;/p&gt;</comment>
                            <comment id="13499250" author="tlipcon" created="Fri, 16 Nov 2012 23:46:09 +0000"  >&lt;p&gt;I&apos;m remembering now that this was due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-2288&quot; title=&quot;Replicas awaiting recovery should return a full visible length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-2288&quot;&gt;&lt;del&gt;HDFS-2288&lt;/del&gt;&lt;/a&gt;, which got closed as invalid. But, I still think &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-2288&quot; title=&quot;Replicas awaiting recovery should return a full visible length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-2288&quot;&gt;&lt;del&gt;HDFS-2288&lt;/del&gt;&lt;/a&gt; is valid, so I will do my best to revive it and convince other HDFS developers of that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13629421" author="sershe" created="Thu, 11 Apr 2013 21:29:57 +0000"  >&lt;p&gt;This appears to be stuck.&lt;/p&gt;</comment>
                            <comment id="13629426" author="stack" created="Thu, 11 Apr 2013 21:34:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; A bunch has changed since what w/ fs op retries and the like.  I have not tried the test lately.  I would do that first.  There is probably something to hdfs-2288 too...&lt;/p&gt;</comment>
                            <comment id="13633514" author="enis" created="Tue, 16 Apr 2013 22:49:17 +0000"  >&lt;p&gt;Assigning this to myself to understand what is going on. Will update with results. &lt;/p&gt;</comment>
                            <comment id="13646390" author="enis" created="Wed, 1 May 2013 05:20:54 +0000"  >&lt;p&gt;This still fails with 2.0.4-alpha. It seems that all the replicas are in state RWR, and we cannot get the length of the block while the replicas are waiting to be recovered. Will inspect more and share the results. &lt;/p&gt;</comment>
                            <comment id="13650270" author="enis" created="Tue, 7 May 2013 00:15:16 +0000"  >&lt;p&gt;Attaching a candidate patch for this. As per my initial analysis, it seems that we have to call recoverLease before opening the wal files for read. &lt;/p&gt;

&lt;p&gt;We do not crash the region servers in this test, so normally all log files should be closed, and recoverLease() should not be necessary. However, we do restart all the datanodes, and when we trigger a log roll, then the DFSOuputStream.close() receives exception on the close: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-05-03 11:38:28,366 ERROR [RegionServer:1;10.11.3.18,51418,1367606292279.logRoller] wal.FSHLog(691): Failed close of HLog writer
java.io.IOException: All datanodes 127.0.0.1:51404 are bad. Aborting...
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:941)
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:756)
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:425)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We just ride over the close() exception, thus should call recoverLease() afterwards. &lt;/p&gt;

&lt;p&gt;I have yet to check why on earth we are able to run this successfully with Hadoop1. &lt;/p&gt;

&lt;p&gt;The test succeeds with the patch. &lt;/p&gt;</comment>
                            <comment id="13650300" author="yuzhihong@gmail.com" created="Tue, 7 May 2013 00:30:57 +0000"  >&lt;p&gt;Under hadoop 1.0, testLogRollOnPipelineRestart took more than two minutes on MacBook:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Running org.apache.hadoop.hbase.regionserver.wal.TestLogRolling
2013-05-06 17:25:33.239 java[26563:1203] Unable to load realm info from SCDynamicStore
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 159.722 sec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can this test be separated into its own ?&lt;/p&gt;

&lt;p&gt;Good job.&lt;/p&gt;</comment>
                            <comment id="13650487" author="stack" created="Tue, 7 May 2013 03:56:21 +0000"  >&lt;p&gt;OK.  Makes sense.  Test always passes even though our recoverLease is currently kinda broke w/ its 4 second wait (my guess is the dn&apos;s in the test have much long socket timeouts than this?  We don&apos;t seem to change the default looking at head of the test).&lt;/p&gt;

&lt;p&gt;-1 on moving to its own test.  Why?  (Or why would having test standalone make it run faster?)&lt;/p&gt;</comment>
                            <comment id="13650594" author="hadoopqa" created="Tue, 7 May 2013 08:16:19 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12582007/hbase-5995_v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12582007/hbase-5995_v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5572//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13655009" author="enis" created="Fri, 10 May 2013 23:21:40 +0000"  >&lt;p&gt;Here is a second attempt. This patch also fixes a condition where we the hdfs output stream is closed because of errors, but we try to continuously do hflush() before closing the stream, although it is already closed. FSDataOutputStream does not have an isClosed() kind of API, or throw a special exception, so I had to parse the exception msg (which is ugly I admit). &lt;/p&gt;

&lt;p&gt;In hadoop2, we check the GS&apos;s of the block and replica to reason about the file length, which is why we get the error. In hadoop1, it seems that we do not do that, and except the replica length with checking GS (I might be wrong on this though, haven&apos;t confirmed it with hdfs folks). &lt;/p&gt;</comment>
                            <comment id="13655090" author="hadoopqa" created="Sat, 11 May 2013 01:12:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12582735/hbase-5995_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12582735/hbase-5995_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5633//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13656575" author="sershe" created="Tue, 14 May 2013 00:20:21 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        closeBarrier.endOp();
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!closed) {
+          closeBarrier.endOp();
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The start code is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed = closed;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isClosed || !closeBarrier.beginOp()) {
          LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;HLog &quot;&lt;/span&gt; + (isClosed ? &lt;span class=&quot;code-quote&quot;&gt;&quot;closed&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;closing&quot;&lt;/span&gt;) + &lt;span class=&quot;code-quote&quot;&gt;&quot;. Skipping rolling of writer&quot;&lt;/span&gt;);
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; regionsToFlush;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;End should not be called only if &quot;isClosed || !closeBarrier.beginOp()&quot; is false. isClosed needs to be checked lest &quot;closed&quot; changed, and whether we could start the op.&lt;br/&gt;
In fact maybe it&apos;s better to move that if before &quot;try&quot;? (and keep logRollRunning in)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+            sync();
+          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe.getMessage().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;DFSOutputStream is closed&quot;&lt;/span&gt;)) {
+              &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; here, sync() failed we will just close the writer
&lt;/span&gt;+            }
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This &quot;if&quot; is pointless... should it throw in other cases? Also comment could be made more descriptive &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13656639" author="enis" created="Tue, 14 May 2013 02:06:36 +0000"  >&lt;p&gt;Thanks Sergey for taking a look.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;End should not be called only if &quot;isClosed || !closeBarrier.beginOp()&quot; is false. isClosed needs to be checked lest &quot;closed&quot; changed&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right. Closed is not changed once it is set to true, but it might change between false -&amp;gt; true. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;In fact maybe it&apos;s better to move that if before &quot;try&quot;? (and keep logRollRunning in)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Then we have to replicate the log and return statements. This looked cleaner. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This &quot;if&quot; is pointless... should it throw in other cases? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yes, it should definitely throw the exception in else. &lt;/p&gt;</comment>
                            <comment id="13657632" author="stack" created="Tue, 14 May 2013 22:46:51 +0000"  >&lt;p&gt;If we do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-          sync();
+          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+            sync();
+          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe.getMessage().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;DFSOutputStream is closed&quot;&lt;/span&gt;)) {
+              &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; here, sync() failed we will just close the writer
&lt;/span&gt;+            }
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... we will skip this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed close of HLog writer&quot;&lt;/span&gt;, e);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; errors = closeErrorCount.incrementAndGet();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (errors &amp;lt;= closeErrorsTolerated &amp;amp;&amp;amp; !hasDeferredEntries()) {
          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Riding over HLog close failure! error count=&quot;&lt;/span&gt;+errors);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasDeferredEntries()) {
            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Aborting due to unflushed edits in HLog&quot;&lt;/span&gt;);
          }
          &lt;span class=&quot;code-comment&quot;&gt;// Failed close of log file.  Means we&apos;re losing edits.  For now,
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// shut ourselves down to minimize loss.  Alternative is to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// keep going.  See HBASE-930.
&lt;/span&gt;          FailedLogCloseException flce =
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FailedLogCloseException(&lt;span class=&quot;code-quote&quot;&gt;&quot;#&quot;&lt;/span&gt; + currentfilenum);
          flce.initCause(e);
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; flce;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... in particular, the abort of the server because we failed sync out some deferred edits.&lt;/p&gt;

&lt;p&gt;Should the close into a finally?&lt;/p&gt;

&lt;p&gt;Else looks good&lt;/p&gt;
</comment>
                            <comment id="13657860" author="enis" created="Wed, 15 May 2013 03:36:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;we will skip this:.. in particular, the abort of the server because we failed sync out some deferred edits.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;good catch. Although we are only catching the IOE in sync(), not in close(), we might need the below lines for aborting RS. I removed exception catching there altogether. I had put it there because the logs were getting filled with hundreds of &quot;DFSOutputStream is closed&quot; exceptions, but with the sleep statement added in LogScyner exception, I think this is not the case anymore. &lt;/p&gt;</comment>
                            <comment id="13657861" author="enis" created="Wed, 15 May 2013 03:36:47 +0000"  >&lt;p&gt;v3 patch addressing review comments. &lt;/p&gt;</comment>
                            <comment id="13657897" author="stack" created="Wed, 15 May 2013 04:33:20 +0000"  >&lt;p&gt;+1 if test passes.&lt;/p&gt;</comment>
                            <comment id="13657899" author="hadoopqa" created="Wed, 15 May 2013 04:46:08 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12583273/hbase-5995_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12583273/hbase-5995_v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.client.TestHCM.testDeleteForZKConnLeak(TestHCM.java:855)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5696//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13658661" author="enis" created="Wed, 15 May 2013 18:50:21 +0000"  >&lt;p&gt;Failing test is possibly due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8535&quot; title=&quot;Test for zk leak does not account for unsynchronized access to zk watcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8535&quot;&gt;&lt;del&gt;HBASE-8535&lt;/del&gt;&lt;/a&gt;. Will commit this now. &lt;/p&gt;</comment>
                            <comment id="13658666" author="enis" created="Wed, 15 May 2013 18:53:55 +0000"  >&lt;p&gt;Finally committed this. Thanks for reviews. &lt;/p&gt;</comment>
                            <comment id="13658963" author="hudson" created="Wed, 15 May 2013 22:57:41 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #196 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/196/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/196/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5995&quot; title=&quot;Fix and reenable TestLogRolling.testLogRollOnPipelineRestart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5995&quot;&gt;&lt;del&gt;HBASE-5995&lt;/del&gt;&lt;/a&gt; Fix and reenable TestLogRolling.testLogRollOnPipelineRestart (Revision 1483006)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRolling.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13659153" author="hudson" created="Thu, 16 May 2013 02:35:37 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #4122 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4122/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4122/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5995&quot; title=&quot;Fix and reenable TestLogRolling.testLogRollOnPipelineRestart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5995&quot;&gt;&lt;del&gt;HBASE-5995&lt;/del&gt;&lt;/a&gt; Fix and reenable TestLogRolling.testLogRollOnPipelineRestart (Revision 1483004)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRolling.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13659233" author="hudson" created="Thu, 16 May 2013 05:19:49 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #532 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/532/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/532/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5995&quot; title=&quot;Fix and reenable TestLogRolling.testLogRollOnPipelineRestart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5995&quot;&gt;&lt;del&gt;HBASE-5995&lt;/del&gt;&lt;/a&gt; Fix and reenable TestLogRolling.testLogRollOnPipelineRestart (Revision 1483004)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRolling.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13659267" author="hudson" created="Thu, 16 May 2013 06:13:05 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #101 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/101/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/101/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5995&quot; title=&quot;Fix and reenable TestLogRolling.testLogRollOnPipelineRestart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5995&quot;&gt;&lt;del&gt;HBASE-5995&lt;/del&gt;&lt;/a&gt; Fix and reenable TestLogRolling.testLogRollOnPipelineRestart (Revision 1483006)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRolling.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13716044" author="stack" created="Tue, 23 Jul 2013 04:43:35 +0000"  >&lt;p&gt;TestLogRolling.testLogRollOnPipelineRestart failed on hadoop1 here: &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/352/consoleText&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/352/consoleText&lt;/a&gt;  It went zombie.&lt;/p&gt;

&lt;p&gt;In the double thread dump on the end:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-1-thread-1&quot;&lt;/span&gt; prio=10 tid=0x73f9dc00 nid=0x3a34 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x7517d000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	- waiting on &amp;lt;0xcf624ad0&amp;gt; (a java.util.concurrent.atomic.AtomicLong)
	at org.apache.hadoop.hbase.client.AsyncProcess.waitForNextTaskDone(AsyncProcess.java:634)
	- locked &amp;lt;0xcf624ad0&amp;gt; (a java.util.concurrent.atomic.AtomicLong)
	at org.apache.hadoop.hbase.client.AsyncProcess.waitForMaximumCurrentTasks(AsyncProcess.java:659)
	at org.apache.hadoop.hbase.client.AsyncProcess.waitUntilDone(AsyncProcess.java:670)
	at org.apache.hadoop.hbase.client.HTable.backgroundFlushCommits(HTable.java:813)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:1170)
	at org.apache.hadoop.hbase.client.HTable.put(HTable.java:753)
	at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.doPut(TestLogRolling.java:640)
	at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.writeData(TestLogRolling.java:248)
	at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.testLogRollOnPipelineRestart(TestLogRolling.java:515)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... we are stuck here.&lt;/p&gt;

&lt;p&gt;The math looks like it could go wonky.  But looking in the output for the test, it seems that when this test ran we got this:&lt;/p&gt;

&lt;p&gt;2013-07-23 01:23:29,560 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(922): Minicluster is down&lt;br/&gt;
2013-07-23 01:23:29,574 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.ResourceChecker(171): after: regionserver.wal.TestLogRolling#testLogRollOnPipelineRestart Thread=39 (was 31) - Thread LEAK? -, OpenFileDescriptor=312 (was 272) - OpenFileDescriptor LEAK? -, MaxFileDescriptor=40000 (was 40000), SystemLoadAverage=351 (was 368), ProcessCount=144 (was 142) - ProcessCount LEAK? -, AvailableMemoryMB=906 (was 1995), ConnectionCount=0 (was 0)&lt;/p&gt;

&lt;p&gt;So we were up against the fd limit.&lt;/p&gt;</comment>
                            <comment id="13716053" author="stack" created="Tue, 23 Jul 2013 05:04:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;So we were up against the fd limit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When I say the above, I am wrong.  I am misreading the output of the ResourceChecker.  We are not up against the limit.  This test went zombie on us.  Let me open new issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12659254">HBASE-9024</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12582007" name="hbase-5995_v1.patch" size="4106" author="enis" created="Tue, 7 May 2013 00:15:16 +0000"/>
                            <attachment id="12582735" name="hbase-5995_v2.patch" size="6417" author="enis" created="Fri, 10 May 2013 23:21:40 +0000"/>
                            <attachment id="12583273" name="hbase-5995_v3.patch" size="6248" author="enis" created="Wed, 15 May 2013 03:36:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 May 2012 17:12:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239291</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05h7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29884</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>