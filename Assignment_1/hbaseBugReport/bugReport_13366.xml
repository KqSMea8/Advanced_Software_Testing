<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:42:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13366/HBASE-13366.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13366] Throw DoNotRetryIOException instead of read only IOException</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13366</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, the read only region just throws an IOException to the clients who send write requests to it. This will cause the clients retry for configured times or until operation timeout.&lt;/p&gt;

&lt;p&gt;Changing this exception to DoNotRetryIOException will make the client failed fast.&lt;/p&gt;

&lt;p&gt;Suggestions are welcomed~ Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="12786978">HBASE-13366</key>
            <summary>Throw DoNotRetryIOException instead of read only IOException</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liushaohui">Liu Shaohui</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Mar 2015 09:38:57 +0000</created>
                <updated>Mon, 31 Aug 2015 22:39:32 +0000</updated>
                            <resolved>Thu, 2 Apr 2015 03:55:55 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.13</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="14388319" author="liushaohui" created="Tue, 31 Mar 2015 09:41:47 +0000"  >&lt;p&gt;Simple patch for master&lt;/p&gt;</comment>
                            <comment id="14388408" author="hadoopqa" created="Tue, 31 Mar 2015 12:00:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12708399/HBASE-13366-v1.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12708399/HBASE-13366-v1.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit f1f4b6618334767d0da0f47965309b21676e7e9f.&lt;br/&gt;
  ATTACHMENT ID: 12708399&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13504//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14388732" author="eclark" created="Tue, 31 Mar 2015 15:48:53 +0000"  >&lt;p&gt;When are you seeing requests coming to a read only replica?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If the requests are coming while a region is getting opened then we&apos;ll want the exceptions to signal wait some time. In fact here it&apos;s really really important not to send a to no retry exception as the read replicas are the best place to open a failed region. They already have lots of the blocks in cache.&lt;/li&gt;
	&lt;li&gt;If the requests are going to a read only replica just normally then there&apos;s a bug and we should fix that.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14388888" author="ndimiduk" created="Tue, 31 Mar 2015 17:30:01 +0000"  >&lt;p&gt;What Elliott said. For that matter, we&apos;d want some higher granularity &amp;#8211; is it all requests that should not be retried? Seems in this case it should only be write requests. IIRC, DoNotRetry exceptions have consequences to the client at layers beyond the individual request (i.e., location caching and the like).&lt;/p&gt;</comment>
                            <comment id="14389317" author="enis" created="Tue, 31 Mar 2015 20:17:01 +0000"  >&lt;p&gt;&lt;tt&gt;WriteState.readOnly&lt;/tt&gt; is set only in region initialization, before the region is added to the onlineRegions. It is not changed again in the regions lifetime. So it should be fine I think. &lt;/p&gt;</comment>
                            <comment id="14389324" author="eclark" created="Tue, 31 Mar 2015 20:23:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; take the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;RS1 has region A&lt;/li&gt;
	&lt;li&gt;RS2 has read replica for A&lt;/li&gt;
	&lt;li&gt;Client wants to Put to region A&lt;/li&gt;
	&lt;li&gt;Master wants RS2 to open Region A&lt;/li&gt;
	&lt;li&gt;RS1 is asked to close region A with knowledge that RS2 is going to open it.&lt;/li&gt;
	&lt;li&gt;Client gets RegionMovedException from RS1 with extra info.&lt;/li&gt;
	&lt;li&gt;RS2 still has the replica open and sees the request.&lt;/li&gt;
	&lt;li&gt;Client now fails something that should be retired in short order&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14389418" author="enis" created="Tue, 31 Mar 2015 21:08:48 +0000"  >&lt;p&gt;Each replica of a region has a different encoded name, and each request (whether read or write) comes with target encoded region name. In no case, a request intended for the primary ends up routed to the secondary (even if they are in the same server). The client meta routing / caching layer also treats them as different regions in terms of routing. &lt;/p&gt;</comment>
                            <comment id="14390563" author="liushaohui" created="Wed, 1 Apr 2015 13:47:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;&lt;br/&gt;
As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; said, the read only state of region has no relationship with the region replica and this attribute can only be set to table descriptor. &lt;/p&gt;

&lt;p&gt;This failed tests are unrelated.  Could someone help to review the simple patch? Thanks&lt;/p&gt;</comment>
                            <comment id="14390948" author="stack" created="Wed, 1 Apr 2015 16:36:34 +0000"  >&lt;p&gt;+1 on patch (after consideration of the helpful discussion above). You good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14390953" author="eclark" created="Wed, 1 Apr 2015 16:40:39 +0000"  >&lt;p&gt;Yep thanks for the info everyone. Today I learned something new.&lt;/p&gt;

&lt;p&gt;+1 on patch&lt;/p&gt;</comment>
                            <comment id="14392089" author="liushaohui" created="Thu, 2 Apr 2015 03:55:35 +0000"  >&lt;p&gt;Committed it. Thanks  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14392197" author="hudson" created="Thu, 2 Apr 2015 05:56:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6333 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6333/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6333/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13366&quot; title=&quot;Throw DoNotRetryIOException instead of read only IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13366&quot;&gt;&lt;del&gt;HBASE-13366&lt;/del&gt;&lt;/a&gt; Throw DoNotRetryIOException instead of read only IOException (Shaohui Liu) (liushaohui: rev a609e5e10748db758d91826058806723f97972da)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14527278" author="apurtell" created="Mon, 4 May 2015 20:55:38 +0000"  >&lt;p&gt;This seems generally applicable to all active branches, no?&lt;/p&gt;</comment>
                            <comment id="14527772" author="liushaohui" created="Tue, 5 May 2015 02:00:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;br/&gt;
Yes. Most branches have this issue.&lt;/p&gt;</comment>
                            <comment id="14527775" author="apurtell" created="Tue, 5 May 2015 02:02:03 +0000"  >&lt;p&gt;Let&apos;s pick this to all of them. I can do it tomorrow if someone doesn&apos;t get to it first.&lt;/p&gt;</comment>
                            <comment id="14529720" author="apurtell" created="Wed, 6 May 2015 01:24:12 +0000"  >&lt;p&gt;Pushed to 0.98 and 1.x&lt;/p&gt;</comment>
                            <comment id="14529757" author="hudson" created="Wed, 6 May 2015 02:01:36 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #978 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/978/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/978/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13366&quot; title=&quot;Throw DoNotRetryIOException instead of read only IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13366&quot;&gt;&lt;del&gt;HBASE-13366&lt;/del&gt;&lt;/a&gt; Throw DoNotRetryIOException instead of read only IOException (Shaohui Liu) (apurtell: rev 593db050500e69bb87d5666ac235e1588d0f268b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14529806" author="hudson" created="Wed, 6 May 2015 03:04:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #901 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/901/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/901/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13366&quot; title=&quot;Throw DoNotRetryIOException instead of read only IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13366&quot;&gt;&lt;del&gt;HBASE-13366&lt;/del&gt;&lt;/a&gt; Throw DoNotRetryIOException instead of read only IOException (Shaohui Liu) (apurtell: rev fd19f8d44b8d298d750186d05e028c406d71759a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14529831" author="hudson" created="Wed, 6 May 2015 03:28:27 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #467 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/467/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/467/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13366&quot; title=&quot;Throw DoNotRetryIOException instead of read only IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13366&quot;&gt;&lt;del&gt;HBASE-13366&lt;/del&gt;&lt;/a&gt; Throw DoNotRetryIOException instead of read only IOException (Shaohui Liu) (apurtell: rev 8d3e933de8288704f5be9f5cc3234a72e7083a0e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14529867" author="hudson" created="Wed, 6 May 2015 04:05:34 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #60 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/60/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/60/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13366&quot; title=&quot;Throw DoNotRetryIOException instead of read only IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13366&quot;&gt;&lt;del&gt;HBASE-13366&lt;/del&gt;&lt;/a&gt; Throw DoNotRetryIOException instead of read only IOException (Shaohui Liu) (apurtell: rev 308d51594933ba24f92319746e30b6bb7722d09f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14530157" author="hudson" created="Wed, 6 May 2015 08:47:18 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #931 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/931/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/931/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13366&quot; title=&quot;Throw DoNotRetryIOException instead of read only IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13366&quot;&gt;&lt;del&gt;HBASE-13366&lt;/del&gt;&lt;/a&gt; Throw DoNotRetryIOException instead of read only IOException (Shaohui Liu) (apurtell: rev 593db050500e69bb87d5666ac235e1588d0f268b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14724186" author="enis" created="Mon, 31 Aug 2015 22:39:32 +0000"  >&lt;p&gt;Closing this issue after 1.0.2 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12708399" name="HBASE-13366-v1.diff" size="1090" author="liushaohui" created="Tue, 31 Mar 2015 09:41:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 31 Mar 2015 12:00:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 15 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27l13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>