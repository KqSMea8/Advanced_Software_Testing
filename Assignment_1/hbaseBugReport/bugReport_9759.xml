<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:07:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9759/HBASE-9759.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9759] Prevent random number collision in IntegrationTestBulkLoad</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9759</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ITBL failed recently in our test harness. Inspecting the failure made me believe that the only reason that particular failure might have happened is that there is a collision in random longs generated by the test. &lt;/p&gt;

&lt;p&gt;The test creates 50 mappers by default, and each mapper writes a 500K random rows starting with row = 0. By default there are 5 iterations.&lt;/p&gt;

&lt;p&gt;The check job outputs these counters: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-10-13 07:48:01,134 Map input records=124999751
2013-10-13 07:48:01,134 Map output records=124999999
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The number of input records seems fine because&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
124999751 = 1 + 5 * (0.5M - 1) * 50
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;5 = num iterations, 0.5M = num rows, 50 = num mappers, and 1 is for row =0 which every chain writes to. &lt;/p&gt;

&lt;p&gt;Output records should be 125M, however we see one cell missing. Since the map input records matches expected number of distinct rows, I suspect that row = 0 had a collision. &lt;/p&gt;

&lt;p&gt;In one of the generate jobs, we can see that the reducer output count does not match the reducer input count. Given that we are using KVSortReducer, this confirms that there is a collision in KeyValues received by this task.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-10-13 06:48:12,738 Reduce input records=75000000
2013-10-13 06:48:12,738 Reduce output records=74999997
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The count is off by 3 because we are writing 3 columns per row. &lt;/p&gt;

&lt;p&gt;My only theory for explaining this is that we had a collision in chainId&apos;s or one of the chains reused row = 0 as the next row. &lt;/p&gt;

&lt;p&gt;This is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8700&quot; title=&quot;IntegrationTestBigLinkedList can fail due to random number collision&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8700&quot;&gt;&lt;del&gt;HBASE-8700&lt;/del&gt;&lt;/a&gt;, however, in this the probability is much much much lower. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12673802">HBASE-9759</key>
            <summary>Prevent random number collision in IntegrationTestBulkLoad</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Oct 2013 00:51:21 +0000</created>
                <updated>Mon, 16 Dec 2013 18:46:38 +0000</updated>
                            <resolved>Mon, 28 Oct 2013 23:11:26 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.96.1</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13794826" author="enis" created="Tue, 15 Oct 2013 03:10:38 +0000"  >&lt;p&gt;Here is a patch for eliminating chain collision probability. We can apply this patch to see whether the theory is correct and continue to monitor the test. &lt;/p&gt;

&lt;p&gt;Tested the patch on a cluster. &lt;/p&gt;</comment>
                            <comment id="13794859" author="stack" created="Tue, 15 Oct 2013 04:09:55 +0000"  >&lt;p&gt;+1 on trying the patch.  How does it provent collision (I did not review closely).&lt;/p&gt;

&lt;p&gt;If you do a select on row 0, does it have more versions than other rows.&lt;/p&gt;

&lt;p&gt;What is to prevent our clashing randomly on another row?  Because our randoms generation is within a fixed range per iteration?&lt;/p&gt;
</comment>
                            <comment id="13794860" author="stack" created="Tue, 15 Oct 2013 04:10:12 +0000"  >&lt;p&gt;Why this&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;s.setBatch(100);&lt;br/&gt;
+    s.setBatch(1000);&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13794875" author="hadoopqa" created="Tue, 15 Oct 2013 04:36:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12608424/hbase-9759_v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12608424/hbase-9759_v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7542//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13795442" author="enis" created="Tue, 15 Oct 2013 18:00:29 +0000"  >&lt;p&gt;The data was gone, so I was not able to look at the actual data.&lt;br/&gt;
Thanks Stack for looking. The way to prevent collisions is something like: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for chainIds generated for each mapper, we hash out the least significant bits of the random so that (chainId % num_total_maps) == unique taskId across jobs&lt;/li&gt;
	&lt;li&gt;for row keys within a chain, we hash out the least significant bits of the random so that (rowKey % chain_length) == sort_index&lt;br/&gt;
The batch change is there just for lesser rpcs. 100 seemed too low. &lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13803261" author="stack" created="Wed, 23 Oct 2013 20:14:32 +0000"  >&lt;p&gt;You going to commit &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13807447" author="enis" created="Mon, 28 Oct 2013 23:01:16 +0000"  >&lt;p&gt;yep, was waiting whether you had any other comments. Let me commit shortly. &lt;/p&gt;</comment>
                            <comment id="13807456" author="enis" created="Mon, 28 Oct 2013 23:11:26 +0000"  >&lt;p&gt;Committed. Thanks Stack for looking. &lt;/p&gt;</comment>
                            <comment id="13807519" author="hudson" created="Tue, 29 Oct 2013 00:20:38 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96-hadoop2 #103 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/103/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/103/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9759&quot; title=&quot;Prevent random number collision in IntegrationTestBulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9759&quot;&gt;&lt;del&gt;HBASE-9759&lt;/del&gt;&lt;/a&gt; Prevent random number collision in IntegrationTestBulkLoad (enis: rev 1536552)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestBulkLoad.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13807577" author="hudson" created="Tue, 29 Oct 2013 01:42:07 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #813 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/813/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/813/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9759&quot; title=&quot;Prevent random number collision in IntegrationTestBulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9759&quot;&gt;&lt;del&gt;HBASE-9759&lt;/del&gt;&lt;/a&gt; Prevent random number collision in IntegrationTestBulkLoad (enis: rev 1536551)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestBulkLoad.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13807613" author="hudson" created="Tue, 29 Oct 2013 02:50:42 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #165 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/165/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/165/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9759&quot; title=&quot;Prevent random number collision in IntegrationTestBulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9759&quot;&gt;&lt;del&gt;HBASE-9759&lt;/del&gt;&lt;/a&gt; Prevent random number collision in IntegrationTestBulkLoad (enis: rev 1536552)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestBulkLoad.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13807628" author="hudson" created="Tue, 29 Oct 2013 03:17:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4651 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4651/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4651/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9759&quot; title=&quot;Prevent random number collision in IntegrationTestBulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9759&quot;&gt;&lt;del&gt;HBASE-9759&lt;/del&gt;&lt;/a&gt; Prevent random number collision in IntegrationTestBulkLoad (enis: rev 1536551)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestBulkLoad.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13849458" author="stack" created="Mon, 16 Dec 2013 18:46:38 +0000"  >&lt;p&gt;Released in 0.96.1.  Issue closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12608424" name="hbase-9759_v1.patch" size="14863" author="enis" created="Tue, 15 Oct 2013 03:10:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Oct 2013 04:09:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oxmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353717</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>