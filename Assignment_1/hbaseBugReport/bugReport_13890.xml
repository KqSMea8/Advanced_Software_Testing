<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:47:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13890/HBASE-13890.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13890] Get/Scan from MemStore only (Client API)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13890</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is short-circuit read for get/scan when recent data (version) of a cell can be found only in MemStore (with very high probability). &lt;/p&gt;

&lt;p&gt;Good examples are: Atomic counters and appends. This feature will allow to bypass completely store file scanners and improve performance and latency.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12837250">HBASE-13890</key>
            <summary>Get/Scan from MemStore only (Client API)</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="vrodionov">Vladimir Rodionov</assignee>
                                    <reporter username="vrodionov">Vladimir Rodionov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jun 2015 22:05:49 +0000</created>
                <updated>Thu, 9 Jul 2015 18:51:42 +0000</updated>
                                                                            <component>API</component>
                    <component>Client</component>
                    <component>Scanners</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14615888" author="vrodionov" created="Mon, 6 Jul 2015 23:36:02 +0000"  >&lt;p&gt;First cut.&lt;/p&gt;</comment>
                            <comment id="14615894" author="vrodionov" created="Mon, 6 Jul 2015 23:38:17 +0000"  >&lt;p&gt;The new API was added to &lt;b&gt;OperationsWithAttributes&lt;/b&gt;: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * This method allows you to set in-memory-only operation mode.
   * Queries: Get and Scan as well as Increment and Append will
   * work only on data in RAM (MemStore). 
   * If data is missing in RAM, the following will be returned:
   *  Empty Result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Get, Increment, Append and Scan
   *  
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OperationWithAttributes setMemstoreOnly(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; v){
    setAttribute(MEMSTORE_ONLY_ATTRIBUTE, Bytes.toBytes(v));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
  }
  /**
   * Checks &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we are in-memory-only mode
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; yes
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isMemstoreOnly(){
    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] attr = getAttribute(MEMSTORE_ONLY_ATTRIBUTE);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; attr != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; Bytes.toBoolean(attr) == &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14615905" author="vrodionov" created="Mon, 6 Jul 2015 23:41:03 +0000"  >&lt;p&gt;The new API contract is the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;No guarantee on a data (if it is not in MemStore - nothing you get)&lt;/li&gt;
	&lt;li&gt;Data can be partial&lt;/li&gt;
	&lt;li&gt;Always check a result of an operation - call regular operation if result is empty or partial.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14616108" author="hadoopqa" created="Tue, 7 Jul 2015 03:06:35 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12743838/HBASE-13890-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12743838/HBASE-13890-v1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit c220635c7893c96db675cb2b80af6ade4a44e3d4.&lt;br/&gt;
  ATTACHMENT ID: 12743838&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +        new byte[][] &lt;/p&gt;
{ Bytes.toBytes(&quot;family1&quot;), Bytes.toBytes(&quot;family2&quot;), Bytes.toBytes(&quot;family3&quot;) };&lt;br/&gt;
+        new byte[][] { Bytes.toBytes(&quot;family1&quot;), Bytes.toBytes(&quot;family2&quot;), Bytes.toBytes(&quot;family3&quot;) }
&lt;p&gt;;&lt;br/&gt;
+        new byte[][] &lt;/p&gt;
{ Bytes.toBytes(&quot;family1&quot;), Bytes.toBytes(&quot;family2&quot;), Bytes.toBytes(&quot;family3&quot;) };&lt;br/&gt;
+        new byte[][] { Bytes.toBytes(&quot;family1&quot;), Bytes.toBytes(&quot;family2&quot;), Bytes.toBytes(&quot;family3&quot;) }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14684//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14616119" author="jmspaggi" created="Tue, 7 Jul 2015 03:33:11 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Always check a result of an operation - call regular operation if result is empty or partial.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But this will require an extra RPC call.&lt;/p&gt;

&lt;p&gt;Is it not possible to have something like MEMSTORE_ONLY_ATTRIBUTE_ELSE_NORMAL where if you have something in the memstore you return, and if not you do a &quot;normal&quot; operation without having to go back to the client?&lt;/p&gt;</comment>
                            <comment id="14616143" author="anoop.hbase" created="Tue, 7 Jul 2015 04:07:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Good examples are: Atomic counters and appends&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So if some how the old cell is not there in memstore, the increment op will result in a wrong result no?&lt;br/&gt;
For normal Scan/Get, agree it can be like read recent data alone. If not found in memstore not giving back the data might be ok.   Only concern is with append/increment.&lt;/p&gt;</comment>
                            <comment id="14616216" author="vrodionov" created="Tue, 7 Jul 2015 05:50:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; asked:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;So if some how the old cell is not there in memstore, the increment op will result in a wrong result no?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, increment/append will return empty result. Empty result means - operation from memstore failed, repeat regular one. For counters this will happen very rarely. Its hard to imagine that a counter is not in a memstore.&lt;/p&gt;</comment>
                            <comment id="14616225" author="vrodionov" created="Tue, 7 Jul 2015 05:55:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; wrote:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;But this will require an extra RPC call.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but very rarely. The point of using memstore_only operation is to achieve better performance/latency in 99% of calls, when data, with a very high probability is in a memstore.   &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Is it not possible to have something like MEMSTORE_ONLY_ATTRIBUTE_ELSE_NORMAL where if you have something in the memstore you return, and if not you do a &quot;normal&quot; operation without having to go back to the client?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, of course, but I think this should be additional hint/attribute of an operation. &lt;/p&gt;
</comment>
                            <comment id="14616234" author="ram_krish" created="Tue, 7 Jul 2015 06:03:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes, of course, but I think this should be additional hint/attribute of an operation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Having an additional hint or option should be the best option rather than another RPC call.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Data can be partial&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So the result is getting marked as partial? &lt;/p&gt;</comment>
                            <comment id="14616309" author="anoop.hbase" created="Tue, 7 Jul 2015 07:24:12 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(results.size() == 0 &amp;amp;&amp;amp; get.isMemstoreOnly()){
7071	              &lt;span class=&quot;code-comment&quot;&gt;// memory store mode
&lt;/span&gt;7072	              &lt;span class=&quot;code-comment&quot;&gt;// Nothing was found - &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; empty result or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;7073	              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; increment.isReturnResults() ? Result.create(results) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
7074	            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see..  Checking the patch now.  So this will fail it to client..  Can the get op be repeated (with out memstore only setting) at server side only?&lt;/p&gt;</comment>
                            <comment id="14616950" author="vrodionov" created="Tue, 7 Jul 2015 16:37:47 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I see.. Checking the patch now. So this will fail it to client.. Can the get op be repeated (with out memstore only setting) at server side only?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I think it can be improved. I am working on patch #2. I want to clarify little bit what is this patch is for.&lt;/p&gt;

&lt;p&gt;This is mostly to improve high performance counters (HPC), not Get, not Append (is anybody using them anyway) and not Scan operations. Most recent version of HPCs are always in Memstore (99.99% of a time), but each store file in this region/cf has its version as well (before major compaction). When HBase reads counter it has to go through all store files and compare results - very inefficient. This patch allows to bypass store files completely most of the time. &lt;/p&gt;

&lt;p&gt;For &lt;/p&gt;</comment>
                            <comment id="14619649" author="stack" created="Thu, 9 Jul 2015 00:31:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is mostly to improve high performance counters (HPC)....&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just reading them?&lt;/p&gt;

&lt;p&gt;Or is it to speed increments?&lt;/p&gt;</comment>
                            <comment id="14619863" author="anoop.hbase" created="Thu, 9 Jul 2015 04:23:28 +0000"  >&lt;p&gt;If the increment will try to find latest counter from memstore only (ya mostly it will be there)  it will improve the increment latency greatly.  The read will be the max time taking stuff in the op. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This is mostly to improve high performance counters (HPC), not Get, not Append (is anybody using them anyway) and not Scan operations. Most recent version of HPCs are always in Memstore (99.99% of a time), but each store file in this region/cf has its version as well (before major compaction)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Said that, can we limit the feature for increment only then?  There might be use cases for other reads as well but keep it for later IAs?&lt;/p&gt;</comment>
                            <comment id="14619866" author="anoop.hbase" created="Thu, 9 Jul 2015 04:26:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;public OperationWithAttributes setMemstoreOnly(boolean v){&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We will have to override this method in Get, Scan, Append and Increment (wherever  we want the feature) and return those types rather than OperationWithAttributes.    Also Put, Delete etc also will have this method available.  Do we need to throw Exception when some one calls this on Put, Delete etc?&lt;/p&gt;</comment>
                            <comment id="14621063" author="vrodionov" created="Thu, 9 Jul 2015 18:51:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; wrote:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We will have to override this method in Get, Scan, Append and Increment (wherever we want the feature) and return those types rather than OperationWithAttributes. Also Put, Delete etc also will have this method available. Do we need to throw Exception when some one calls this on Put, Delete etc?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK. Good point.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12743838" name="HBASE-13890-v1.patch" size="19420" author="vrodionov" created="Mon, 6 Jul 2015 23:36:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Jul 2015 03:06:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fy67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>