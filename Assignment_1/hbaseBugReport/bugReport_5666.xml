<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:29:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5666/HBASE-5666.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5666] RegionServer doesn&apos;t retry to check if base node is available</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5666</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;ve a script that starts hbase and a couple of region servers in distributed mode (hbase.cluster.distributed = true)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$HBASE_HOME/bin/start-hbase.sh
$HBASE_HOME/bin/local-regionservers.sh start 1 2 3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but the region servers are not able to start...&lt;br/&gt;
It seems that during the RS start the the znode is still not available, and HRegionServer.initializeZooKeeper() check just once if the base not is available.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-03-28 21:54:05,013 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: STOPPED: Check the value configured in &apos;zookeeper.znode.parent&apos;. There could be a mismatch with the one configured in the master.
2012-03-28 21:54:08,598 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server localhost,60202,1332964444824: Initialization of RS failed.  Hence aborting RS.
java.io.IOException: Received the shutdown message &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting.
	at org.apache.hadoop.hbase.regionserver.HRegionServer.blockAndCheckIfStopped(HRegionServer.java:626)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.initializeZooKeeper(HRegionServer.java:596)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.preRegistrationInitialization(HRegionServer.java:558)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:672)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12548546">HBASE-5666</key>
            <summary>RegionServer doesn&apos;t retry to check if base node is available</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="mbertozzi">Matteo Bertozzi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2012 20:37:32 +0000</created>
                <updated>Fri, 25 May 2012 17:56:13 +0000</updated>
                            <resolved>Fri, 25 May 2012 17:56:13 +0000</resolved>
                                    <version>0.92.1</version>
                    <version>0.94.0</version>
                    <version>0.95.2</version>
                                                    <component>regionserver</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13240751" author="zhihyu@ebaysf.com" created="Wed, 28 Mar 2012 21:30:46 +0000"  >&lt;p&gt;@Matteo:&lt;br/&gt;
You&apos;re suggesting addition of a loop to wait for base node to become available (in place of what we have now below) ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; == tracker.checkIfBaseNodeAvailable()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ramkrishna added the check.&lt;br/&gt;
@Ram:&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="13240757" author="mbertozzi" created="Wed, 28 Mar 2012 21:40:08 +0000"  >&lt;p&gt;@Zhihong Yu:&lt;br/&gt;
Probably a retry loop is the simplest solution...&lt;br/&gt;
But retry for how long? an infinite loop hoping that the node become available seems wrong, maybe we can add another parameter to define a ZK_RETRY_TIMEOUT.&lt;/p&gt;</comment>
                            <comment id="13242684" author="stack" created="Fri, 30 Mar 2012 20:00:07 +0000"  >&lt;p&gt;We used to retry our very first zk operation a few times IIRC.&lt;/p&gt;</comment>
                            <comment id="13242687" author="zhihyu@ebaysf.com" created="Fri, 30 Mar 2012 20:06:05 +0000"  >&lt;p&gt;I think we can introduce something similar to the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      conf.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.catalogtracker.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.timeout&quot;&lt;/span&gt;, 1000));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can call the new config parameter &quot;hbase.basenode.avail.timeout&quot;&lt;/p&gt;</comment>
                            <comment id="13242696" author="stack" created="Fri, 30 Mar 2012 20:23:36 +0000"  >&lt;p&gt;Please be careful here.&lt;/p&gt;

&lt;p&gt;What version of hbase are we talking of.&lt;/p&gt;

&lt;p&gt;We used to retry the first zk operation and then recoverablezk took over thereafter.   Code in trunk was recently refactored as part of &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5399&quot; title=&quot;Cut the link between the client and the zookeeper ensemble&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5399&quot;&gt;&lt;del&gt;HBASE-5399&lt;/del&gt;&lt;/a&gt; Cut the link between the client and the zookeeper ensemble&apos;.  Is this a teething issue that comes of that commit?&lt;/p&gt;</comment>
                            <comment id="13242734" author="mbertozzi" created="Fri, 30 Mar 2012 20:57:47 +0000"  >&lt;p&gt;The exception seems to be present in 0.92 and trunk, but I&apos;ve only looked at trunk code&lt;/p&gt;</comment>
                            <comment id="13242796" author="nkeywal" created="Fri, 30 Mar 2012 21:55:58 +0000"  >&lt;p&gt;I confirm I didn&apos;t modify this part in trunk. But who knows. I will have a look at it this week end.&lt;/p&gt;</comment>
                            <comment id="13242801" author="mbertozzi" created="Fri, 30 Mar 2012 22:06:56 +0000"  >&lt;p&gt;yep, just checked and the code seems unchanged from trunk to 0.92...&lt;br/&gt;
Anyone has a different idea on that?&lt;br/&gt;
or I can try to implement a retry loop?&lt;/p&gt;</comment>
                            <comment id="13243236" author="mbertozzi" created="Sat, 31 Mar 2012 17:24:56 +0000"  >&lt;p&gt;diving into the code, I&apos;ve also noticed that there&apos;s a ZKUtil.waitForBaseZNode() that has already the retry logic but:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It takes a Configuration object&lt;/li&gt;
	&lt;li&gt;The timeout is set internally to 10000ms&lt;/li&gt;
	&lt;li&gt;It&apos;s only used by test/.../hbase/util/ProcessBasedLocalHBaseCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13243239" author="zhihyu@ebaysf.com" created="Sat, 31 Mar 2012 17:32:40 +0000"  >&lt;p&gt;Refactoring ZKUtil.waitForBaseZNode() so that it can be used by region server and the test would be good.&lt;/p&gt;</comment>
                            <comment id="13243250" author="mbertozzi" created="Sat, 31 Mar 2012 18:09:01 +0000"  >&lt;p&gt;don&apos;t know... I&apos;ve tried to refactor the method to get something useful and shared...&lt;br/&gt;
The problem is that checkExists() called by checkIfBaseNodeAvailable() uses a ZooKeeperWatcher and call exists() on  a RecoverableZooKeeper object, while waitForBaseZNode() has a plain ZooKeeper node... &lt;br/&gt;
so the checkExists(ZooKeeperWatcher) implementation relays on the fact that the RecoverableZooKeeper.exists() is implemented as RZK.getZooKeeper().exists() which I don&apos;t like...&lt;/p&gt;</comment>
                            <comment id="13243296" author="zhihyu@ebaysf.com" created="Sat, 31 Mar 2012 21:36:53 +0000"  >&lt;p&gt;Patch makes sense.&lt;br/&gt;
Can you integrate it into HRegionServer ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13243302" author="mbertozzi" created="Sat, 31 Mar 2012 21:45:43 +0000"  >&lt;p&gt;I was thinking to patch ZooKeeperNodeTracker.checkIfBaseNodeAvailable() and HConnectionImplementation.checkIfBaseNodeAvailable() instead of only the HRegionServer...&lt;/p&gt;

&lt;p&gt;what do you think?&lt;/p&gt;</comment>
                            <comment id="13243310" author="zhihyu@ebaysf.com" created="Sat, 31 Mar 2012 22:02:31 +0000"  >&lt;p&gt;HConnectionImplementation.checkIfBaseNodeAvailable() doesn&apos;t take Abortable.&lt;br/&gt;
We can limit the scope of change in this JIRA.&lt;/p&gt;

&lt;p&gt;Is that Okay ?&lt;/p&gt;</comment>
                            <comment id="13243672" author="mbertozzi" created="Sun, 1 Apr 2012 07:12:59 +0000"  >&lt;p&gt;Patch attached to retry only on HRegionServer . Using &quot;hbase.basenode.avail.timeout&quot; as conf key.&lt;/p&gt;</comment>
                            <comment id="13243845" author="yuzhihong@gmail.com" created="Sun, 1 Apr 2012 20:38:39 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (keeperEx != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
+      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; keeperEx;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please either lift the throw to the same line as if or add curly braces.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        checkExists(zk, parentZNode, maxTimeMs);
+        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Parent znode exists: &quot;&lt;/span&gt; + parentZNode);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If checkExists() returns -1, would the log statement still be true ?&lt;/p&gt;</comment>
                            <comment id="13243855" author="mbertozzi" created="Sun, 1 Apr 2012 20:58:52 +0000"  >&lt;p&gt;@Ted woo good catch&lt;br/&gt;
I&apos;ve just &quot;translated&quot; the method without thinking...&lt;br/&gt;
and this &quot;simplified&quot; version emphasizes a problem already present in the previous version.&lt;br/&gt;
If you take a look at the original version, (the LOG.info is under if, ok)&lt;br/&gt;
but what happens if the method return and the znode is not available?&lt;br/&gt;
no exception is raised... but I think that the caller of waitForXyz() expect some exception in case of timeout, in the other case the value that I&apos;m looking for must be present...&lt;br/&gt;
(this function is just called by one test)&lt;/p&gt;</comment>
                            <comment id="13243863" author="yuzhihong@gmail.com" created="Sun, 1 Apr 2012 21:23:50 +0000"  >&lt;p&gt;Patch v2 looks good.&lt;/p&gt;</comment>
                            <comment id="13243871" author="hadoopqa" created="Sun, 1 Apr 2012 21:46:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520825/HBASE-5666-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520825/HBASE-5666-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.TestHBaseFsck&lt;br/&gt;
                  org.apache.hadoop.hbase.TestZooKeeper&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1360//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1360//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1360//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1360//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1360//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1360//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13243902" author="hadoopqa" created="Sun, 1 Apr 2012 23:26:56 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520850/HBASE-5666-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520850/HBASE-5666-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestZooKeeper&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1363//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1363//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1363//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1363//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1363//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1363//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13244120" author="hadoopqa" created="Mon, 2 Apr 2012 11:06:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520963/HBASE-5666-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520963/HBASE-5666-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.TestHBaseFsck&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestFromClientSide&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1368//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1368//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1368//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1368//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1368//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1368//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13244471" author="stack" created="Mon, 2 Apr 2012 19:11:50 +0000"  >&lt;p&gt;On creation of ZooKeeperWatcher, we do following.  Why is it not sufficient?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// The first call against zk can fail with connection loss.  Seems common.
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// Apparently &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is recoverable.  Retry a &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;.
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// See http://wiki.apache.org/hadoop/ZooKeeper/ErrorHandling
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// TODO: Generalize out in ZKUtil.
&lt;/span&gt;      &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; wait = conf.getLong(HConstants.ZOOKEEPER_RECOVERABLE_WAITTIME,
          HConstants.DEFAULT_ZOOKEPER_RECOVERABLE_WAITIME);
      &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; finished = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() + wait;
      KeeperException ke = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          ZKUtil.createAndFailSilent(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, baseZNode);
          ke = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException.ConnectionLossException e) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled() &amp;amp;&amp;amp; (isFinishedRetryingRecoverable(finished))) {
            LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Retrying zk create &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; another &quot;&lt;/span&gt; +
              (finished - &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()) +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;ms; set &apos;hbase.zookeeper.recoverable.waittime&apos; to change &quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;wait time); &quot;&lt;/span&gt; + e.getMessage());
          }
          ke = e;
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (isFinishedRetryingRecoverable(finished));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is the wait too short?&lt;/p&gt;</comment>
                            <comment id="13244488" author="mbertozzi" created="Mon, 2 Apr 2012 19:25:57 +0000"  >&lt;p&gt;The problem here is that there&apos;s no ConnectionLossException... if you take a look at the log you can see that there&apos;s no KeeperException but zookeeper respond that the base node doesn&apos;t exists.&lt;/p&gt;</comment>
                            <comment id="13244492" author="stack" created="Mon, 2 Apr 2012 19:30:57 +0000"  >&lt;p&gt;This is the code that is supposed to create the base node right?  If we come out of here and there is no base node, then thats a problem?  Should the fix be down here in ZKW rather than up in regionserver?&lt;/p&gt;</comment>
                            <comment id="13244537" author="mbertozzi" created="Mon, 2 Apr 2012 20:14:14 +0000"  >&lt;p&gt;m... maybe i&apos;ve lost something but, in 0.92 and trunk that code was removed and there&apos;s just a call to ZKUtil.createAndFailSilent() that doesn&apos;t retry. Any idea?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hbase/commit/6dc7ccf3779add13188bd73011e0d25bbab77a05&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hbase/commit/6dc7ccf3779add13188bd73011e0d25bbab77a05&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13244560" author="stack" created="Mon, 2 Apr 2012 20:26:53 +0000"  >&lt;p&gt;Thanks for digging.  Seems like the RecoverableZK is failing silently (smile).  Seriously, it may be retrying any ConnectionLossException but if no base dir up on in zk, there&apos;s nothing for ZKW to &apos;watch&apos;... it should fail construction (or this test needs to be moved out to an init method or something ...).  What you reckon?&lt;/p&gt;</comment>
                            <comment id="13244564" author="hadoopqa" created="Mon, 2 Apr 2012 20:28:16 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12521011/HBASE-5666-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12521011/HBASE-5666-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1370//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1370//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1370//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1370//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1370//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1370//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13245720" author="mbertozzi" created="Tue, 3 Apr 2012 20:53:46 +0000"  >&lt;p&gt;Still looking at the 0.90 code...&lt;br/&gt;
The new ZooKeeperWatcher (&amp;gt;=0.92) calls the ZKUtil.createAndFailSilent(), to create base node and others, only if called by HMaster (canCreateBaseZNode = true), while before the code path was the same for everyone.&lt;/p&gt;

&lt;p&gt;So now, if HMaster has not reached the &quot;create base node&quot; point, before the HRegionServer checks the existence of base node... the region server crashes...&lt;/p&gt;

&lt;p&gt;If we want to keep the previous logic, the first one that arrives create the base node &amp;amp; co, we can remove the canCreateBaseZNode flag, else we can use &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5666&quot; title=&quot;RegionServer doesn&amp;#39;t retry to check if base node is available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5666&quot;&gt;&lt;del&gt;HBASE-5666&lt;/del&gt;&lt;/a&gt;-v4.patch to wait and retry on checkExists().&lt;/p&gt;

&lt;p&gt;what do you think?&lt;/p&gt;</comment>
                            <comment id="13245734" author="zhihyu@ebaysf.com" created="Tue, 3 Apr 2012 21:03:00 +0000"  >&lt;p&gt;Patch v4 looks good. Minor comments below:&lt;/p&gt;

&lt;p&gt;Since timeout of 0 is treated specially in this method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; checkExists(ZooKeeperWatcher zkw, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; znode, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; timeout)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;javadoc should mention special value of 0.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; baseznode exists.
+   *         &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; doesnot exists.
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; checkIfBaseNodeAvailable(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; timeout) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The false return doesn&apos;t have to be mentioned. If you want to keep it, it should read &apos;if baseznode does not exist&apos;&lt;/p&gt;</comment>
                            <comment id="13245758" author="mbertozzi" created="Tue, 3 Apr 2012 21:14:30 +0000"  >&lt;p&gt;The problem that I see with the patch v4 and the if (timeout == 0) special case is that exists() is different for ZooKeeper and RecoverableZookeeper.&lt;/p&gt;

&lt;p&gt;RecoverableZookeeper has some internal retry logic for CONNECTIONLOSS, SESSIONEXPIRED, and OPERATIONTIMEOUT, to keep the code simple we can add this logic in ZKUtil.checkExist() in this way we can remove the special case, and remove the code in RecoverabeZK.&lt;/p&gt;</comment>
                            <comment id="13245795" author="zhihyu@ebaysf.com" created="Tue, 3 Apr 2012 21:55:03 +0000"  >&lt;p&gt;Interesting idea above.&lt;br/&gt;
+1 on removing special case of timeout == 0.&lt;/p&gt;</comment>
                            <comment id="13246764" author="zhihyu@ebaysf.com" created="Wed, 4 Apr 2012 21:50:19 +0000"  >&lt;p&gt;For patch v5, please add javadoc for:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; checkExists(ZooKeeperWatcher zkw, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; znode, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; timeout)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13246804" author="hadoopqa" created="Wed, 4 Apr 2012 22:40:07 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12521398/HBASE-5666-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12521398/HBASE-5666-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestMasterObserver&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1393//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1393//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1393//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1393//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1393//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1393//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13248646" author="hadoopqa" created="Fri, 6 Apr 2012 19:39:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12521711/HBASE-5666-v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12521711/HBASE-5666-v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1433//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1433//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1433//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1433//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1433//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1433//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13248666" author="mbertozzi" created="Fri, 6 Apr 2012 19:57:41 +0000"  >&lt;p&gt;Since the logical flow is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;HMaster start and create the base node&lt;/li&gt;
	&lt;li&gt;Region Servers wait for base node to be available&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I prefer to use &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5666&quot; title=&quot;RegionServer doesn&amp;#39;t retry to check if base node is available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5666&quot;&gt;&lt;del&gt;HBASE-5666&lt;/del&gt;&lt;/a&gt;-v6.patch adding the retry logic to ZKUtil.checkExists() in this way we&apos;ve the &quot;wait for base node step&quot;.&lt;/p&gt;

&lt;p&gt;In the other case (@stack: fixing the ZookeeperWatcher) the first (master|RS) that arrive create the base node... but doesn&apos;t sounds right. &lt;/p&gt;</comment>
                            <comment id="13249136" author="umamaheswararao" created="Sat, 7 Apr 2012 02:32:40 +0000"  >&lt;p&gt;Linking to the HDFS issue.&lt;/p&gt;</comment>
                            <comment id="13249141" author="umamaheswararao" created="Sat, 7 Apr 2012 02:55:18 +0000"  >&lt;p&gt;Wrong JIRA...please ignore my previous comment. It was for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5745&quot; title=&quot;SequenceFileLogReader#getPos may get wrong length on DFS restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5745&quot;&gt;&lt;del&gt;HBASE-5745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13250269" author="stack" created="Mon, 9 Apr 2012 22:49:16 +0000"  >&lt;p&gt;Patch looks good.&lt;/p&gt;

&lt;p&gt;Logs &apos;{&lt;br/&gt;
+            LOG.warn(zkw.prefix(&quot;Unable to set watcher on znode (&quot; + znode + &quot;)&quot;), keeperEx);&lt;br/&gt;
&apos;&lt;br/&gt;
... but the method says its checkExists w/o setting watch.&lt;/p&gt;

&lt;p&gt;I think this a bad idea; i.e. sleeping w/o interrupt.  How long is SOCKET_RETRY_WAIT_MS?  What if we try to stop the hosting server in meantime?  We have to wait on this to come up out of this loop?&lt;/p&gt;

&lt;p&gt;+        Threads.sleepWithoutInterrupt(HConstants.SOCKET_RETRY_WAIT_MS);&lt;/p&gt;

&lt;p&gt;Passing 0, are we supposed to try once only?  My guess is that we could try more than once given how the loop runs; i.e. we may loop multiple times in same millisecond.. you might want to exit loop if timeout is zero.&lt;/p&gt;

&lt;p&gt;What happens if a client comes in during this time?  It will crash out immediately because no base node?&lt;/p&gt;

&lt;p&gt;Thanks Matteo.&lt;/p&gt;</comment>
                            <comment id="13250868" author="mbertozzi" created="Tue, 10 Apr 2012 17:46:37 +0000"  >&lt;p&gt;The SOCKET_RETRY_WAIT_MS is 200ms but yes, is better sleeping with interrupt since the code can accept interrupt. The only real difference is that you&apos;ve to wait the timeout if you want kill the inizialization.&lt;/p&gt;

&lt;p&gt;The retry loop is tricky to understand since RecoverableZookeeper is used...&lt;br/&gt;
So if you give 0 as timeout, you&apos;re supposed to try once... &lt;br/&gt;
but recoverableZookeeper.exists() retries in case of CONNECTIONLOSS, SESSIONEXPIRED and OPERATIONTIMEOUT.&lt;br/&gt;
The idea here is to retry for x millisec until znode become available while (recoverableZookeeper.exists() == null)&lt;/p&gt;

&lt;p&gt;If the client comes up during this time I think that should crash anyway because the HRegion is still in the initialize() method...&lt;/p&gt;</comment>
                            <comment id="13250889" author="stack" created="Tue, 10 Apr 2012 18:04:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;If the client comes up during this time I think that should crash anyway because the HRegion is still in the initialize() method...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You might try it?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;but recoverableZookeeper.exists() retries in case of CONNECTIONLOSS, SESSIONEXPIRED and OPERATIONTIMEOUT.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats fine I&apos;d say.  We want that.  We want it to actually get through the above and get to zk to check whether base node exists.&lt;/p&gt;

&lt;p&gt;Otherwise I think the patch good.  Does this need to be public?  +  public boolean checkIfBaseNodeAvailable(int timeout) {?&lt;/p&gt;</comment>
                            <comment id="13250907" author="mbertozzi" created="Tue, 10 Apr 2012 18:16:53 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Does this need to be public? + public boolean checkIfBaseNodeAvailable(int timeout) {?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ZooKeeperNodeTracker.checkIfBaseNodeAvailable(timeout) is used by the HRegion so needs to be public&lt;/p&gt;</comment>
                            <comment id="13250915" author="stack" created="Tue, 10 Apr 2012 18:21:30 +0000"  >&lt;p&gt;@Matteo Mind trying what client does when no hbase root node?  If all is well, I&apos;ll commit this latest patch.&lt;/p&gt;</comment>
                            <comment id="13250927" author="hadoopqa" created="Tue, 10 Apr 2012 18:26:58 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12522134/HBASE-5666-v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12522134/HBASE-5666-v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1466//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1466//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1466//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1466//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1466//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1466//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13250933" author="mbertozzi" created="Tue, 10 Apr 2012 18:31:16 +0000"  >&lt;p&gt;@Stack The client crash with this message&lt;br/&gt;
(easy way to test put a long sleep in ZKUtil.createAndFailSilent() on /hbase node)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
12/04/10 20:29:36 ERROR client.HConnectionManager$HConnectionImplementation: The node /hbase is not in ZooKeeper. It should have been written by the master. Check the value configured in &apos;zookeeper.znode.parent&apos;. There could be a mismatch with the one configured in the master.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13250941" author="stack" created="Tue, 10 Apr 2012 18:35:53 +0000"  >&lt;p&gt;Should we admend the message to include &apos;Check the master is running?&apos; Otherwise I don&apos;t think the message bad.&lt;/p&gt;</comment>
                            <comment id="13251056" author="hadoopqa" created="Tue, 10 Apr 2012 20:53:41 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12522165/HBASE-5666-0.92.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12522165/HBASE-5666-0.92.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause mvn compile goal to fail.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1469//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1469//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1469//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1469//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13251100" author="mbertozzi" created="Tue, 10 Apr 2012 21:57:44 +0000"  >&lt;p&gt;@stack&lt;br/&gt;
do you mean, change the log message in HConnectionManager?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
===================================================================
--- src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java	(revision 1311874)
+++ src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java	(working copy)
@@ -776,6 +776,7 @@
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ZKUtil.checkExists(zkw, zkw.baseZNode) == -1) {
           errorMsg = &lt;span class=&quot;code-quote&quot;&gt;&quot;The node &quot;&lt;/span&gt; + zkw.baseZNode+&lt;span class=&quot;code-quote&quot;&gt;&quot; is not in ZooKeeper. &quot;&lt;/span&gt;
             + &lt;span class=&quot;code-quote&quot;&gt;&quot;It should have been written by the master. &quot;&lt;/span&gt;
+            + &lt;span class=&quot;code-quote&quot;&gt;&quot;Check the master is running? &quot;&lt;/span&gt;
             + &lt;span class=&quot;code-quote&quot;&gt;&quot;Check the value configured in &apos;zookeeper.znode.parent&apos;. &quot;&lt;/span&gt;
             + &lt;span class=&quot;code-quote&quot;&gt;&quot;There could be a mismatch with the one configured in the master.&quot;&lt;/span&gt;;
           LOG.error(errorMsg);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13251351" author="stack" created="Wed, 11 Apr 2012 05:45:33 +0000"  >&lt;p&gt;Yes.  That looks good.  Let me retry against hadoopqa.  A test hung above.&lt;/p&gt;</comment>
                            <comment id="13251352" author="stack" created="Wed, 11 Apr 2012 05:47:23 +0000"  >&lt;p&gt;I see that you don&apos;t have the above change in v7.  You want to add it in a v8 and retry hadoopqa?   Thanks Matteo.&lt;/p&gt;</comment>
                            <comment id="13251377" author="hadoopqa" created="Wed, 11 Apr 2012 06:53:01 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12522213/HBASE-5666-v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12522213/HBASE-5666-v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestSplitLogManager&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestFromClientSide&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1475//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1475//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1475//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1475//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1475//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1475//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13251462" author="hadoopqa" created="Wed, 11 Apr 2012 10:46:16 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12522220/HBASE-5666-v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12522220/HBASE-5666-v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestHLog&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1477//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1477//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1477//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1477//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1477//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1477//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13283636" author="mbertozzi" created="Fri, 25 May 2012 17:56:13 +0000"  >&lt;p&gt;Fixed with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5849&quot; title=&quot;On first cluster startup, RS aborts if root znode is not available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5849&quot;&gt;&lt;del&gt;HBASE-5849&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12522165" name="HBASE-5666-0.92.patch" size="4907" author="mbertozzi" created="Tue, 10 Apr 2012 20:49:25 +0000"/>
                            <attachment id="12520825" name="HBASE-5666-v1.patch" size="5403" author="mbertozzi" created="Sun, 1 Apr 2012 12:32:35 +0000"/>
                            <attachment id="12520850" name="HBASE-5666-v2.patch" size="5477" author="mbertozzi" created="Sun, 1 Apr 2012 21:17:27 +0000"/>
                            <attachment id="12520963" name="HBASE-5666-v3.patch" size="5631" author="mbertozzi" created="Mon, 2 Apr 2012 10:16:58 +0000"/>
                            <attachment id="12521011" name="HBASE-5666-v4.patch" size="5657" author="mbertozzi" created="Mon, 2 Apr 2012 19:04:40 +0000"/>
                            <attachment id="12521401" name="HBASE-5666-v5.patch" size="3960" author="mbertozzi" created="Wed, 4 Apr 2012 21:53:32 +0000"/>
                            <attachment id="12521711" name="HBASE-5666-v6.patch" size="4097" author="mbertozzi" created="Fri, 6 Apr 2012 18:50:03 +0000"/>
                            <attachment id="12522134" name="HBASE-5666-v7.patch" size="4319" author="mbertozzi" created="Tue, 10 Apr 2012 17:36:39 +0000"/>
                            <attachment id="12522220" name="HBASE-5666-v8.patch" size="5096" author="mbertozzi" created="Wed, 11 Apr 2012 09:59:42 +0000"/>
                            <attachment id="12520311" name="hbase-1-regionserver.log" size="35593" author="mbertozzi" created="Wed, 28 Mar 2012 20:38:07 +0000"/>
                            <attachment id="12520312" name="hbase-2-regionserver.log" size="35593" author="mbertozzi" created="Wed, 28 Mar 2012 20:38:07 +0000"/>
                            <attachment id="12520313" name="hbase-3-regionserver.log" size="52972" author="mbertozzi" created="Wed, 28 Mar 2012 20:38:07 +0000"/>
                            <attachment id="12520314" name="hbase-master.log" size="87763" author="mbertozzi" created="Wed, 28 Mar 2012 20:38:07 +0000"/>
                            <attachment id="12520315" name="hbase-regionserver.log" size="23157" author="mbertozzi" created="Wed, 28 Mar 2012 20:38:07 +0000"/>
                            <attachment id="12520316" name="hbase-zookeeper.log" size="22130" author="mbertozzi" created="Wed, 28 Mar 2012 20:38:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>15.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Mar 2012 21:30:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06913:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34394</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>