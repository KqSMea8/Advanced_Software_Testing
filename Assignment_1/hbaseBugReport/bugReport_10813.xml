<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:17:25 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10813/HBASE-10813.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10813] Possible over-catch of exceptions</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10813</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There are a few cases found by a tool that are possibly over-catch of exceptions, especially those that will abort the server. Over-catching these exceptions may unexpectedly abort the server, and may cause problems in the future when code in the try-block evolves. I am attaching a patch against trunk that constrains the catch blocks to the exact exceptions that were thrown. &lt;/p&gt;

&lt;p&gt;My tool actually found one more case in 0.96.1, but I found it has already been fixed in trunk:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Line: 1175, File: &quot;org/apache/hadoop/hbase/master/SplitLogManager.java&quot;
1173:             try {
1174:               Thread.sleep(20);
1175:-            } catch (Exception ignoreE) {
1175:+           } catch (InterruptedException e) {
1176:               // ignore
1177:             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any feedbacks are much appreciated!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12703114">HBASE-10813</key>
            <summary>Possible over-catch of exceptions</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="d.yuan">Ding Yuan</assignee>
                                    <reporter username="d.yuan">Ding Yuan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Mar 2014 02:03:53 +0000</created>
                <updated>Sat, 21 Feb 2015 23:28:51 +0000</updated>
                            <resolved>Wed, 9 Apr 2014 16:13:14 +0000</resolved>
                                    <version>0.96.1</version>
                                    <fixVersion>0.99.0</fixVersion>
                                    <component>regionserver</component>
                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13944831" author="haosdent@gmail.com" created="Mon, 24 Mar 2014 09:13:23 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Over-catching these exceptions may unexpectedly abort the server.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This sounds reasonable. The patch looks well for me.&lt;/p&gt;</comment>
                            <comment id="13945150" author="nkeywal" created="Mon, 24 Mar 2014 14:21:47 +0000"  >&lt;p&gt;yep, lgtm. Will commit if there is no objection.&lt;/p&gt;</comment>
                            <comment id="13945800" author="stack" created="Mon, 24 Mar 2014 22:39:04 +0000"  >&lt;p&gt;lgtm and lgtm for 0.96 but not going to hold up RC for it.&lt;/p&gt;</comment>
                            <comment id="13946396" author="d.yuan" created="Tue, 25 Mar 2014 11:35:03 +0000"  >&lt;p&gt;One comment for this code block:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;      try {
        if (zk &amp;amp;&amp;amp; !ZKAssign.checkClosingState(server.getZooKeeper(), regionInfo, expectedVersion)){
          // bad znode state
          return; // We&apos;re node deleting the znode, but it&apos;s not ours...
        }

        // TODO: If we need to keep updating CLOSING stamp to prevent against
        // a timeout if this is long-running, need to spin up a thread?
        if (region.close(abort) == null) {
          // This region got closed.  Most likely due to a split. So instead
          // of doing the setClosedState() below, let&apos;s just ignore cont
          // The split message will clean up the master state.
          LOG.warn(&quot;Can&apos;t close region: was already closed during close(): &quot; +
            regionInfo.getRegionNameAsString());
          return;
        }
      } catch (Throwable t) {
        // A throwable here indicates that we couldn&apos;t successfully flush the
        // memstore before closing. So, we need to abort the server and allow
        // the master to split our logs in order to recover the data.
        server.abort(&quot;Unrecoverable exception while closing region &quot; +
          regionInfo.getRegionNameAsString() + &quot;, still finishing close&quot;, t);
        throw new RuntimeException(t);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;checkClosingState could throw KeeperException, which will also abort the server. Currently my patch followed the same logic, but is it the desired logic (without system specific understanding I couldn&apos;t tell)? I&apos;m asking because the comment of the catch block seems to suggest that the abort is to only defend against an exception in region.close().&lt;/p&gt;</comment>
                            <comment id="13964204" author="d.yuan" created="Wed, 9 Apr 2014 14:30:12 +0000"  >&lt;p&gt;Hi folks,&lt;br/&gt;
any chance to commit this patch soon? &lt;/p&gt;</comment>
                            <comment id="13964277" author="nkeywal" created="Wed, 9 Apr 2014 15:25:01 +0000"  >&lt;p&gt;I need to have a look at the point you raised. Will do.&lt;/p&gt;</comment>
                            <comment id="13964316" author="nkeywal" created="Wed, 9 Apr 2014 16:03:59 +0000"  >&lt;p&gt;Hum, it seems safer to abord here: we&apos;re required to close the connection, but we cannot check the state in ZK. That&apos;s a critical situation. Doing an abort as we do today is not ideal but doing differently looks like looking for splitbrain situation.&lt;/p&gt;

&lt;p&gt;I&apos;m going to commit the patch as it is.&lt;/p&gt;</comment>
                            <comment id="13964323" author="nkeywal" created="Wed, 9 Apr 2014 16:12:41 +0000"  >&lt;p&gt;Oops, now that I&apos;ve just committed it, I&apos;m seeing that we didn&apos;t get a qa run.&lt;br/&gt;
Running it now, I will revert if there is anything fancy.&lt;/p&gt;</comment>
                            <comment id="13964646" author="hudson" created="Wed, 9 Apr 2014 20:43:27 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5074 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5074/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5074/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10813&quot; title=&quot;Possible over-catch of exceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10813&quot;&gt;&lt;del&gt;HBASE-10813&lt;/del&gt;&lt;/a&gt; Possible over-catch of exceptions (Ding Yuan) (nkeywal: rev 1586006)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/Merge.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13964805" author="mantonov" created="Wed, 9 Apr 2014 23:28:44 +0000"  >&lt;p&gt;Attached one-liner patch to fix TestCloseRegionHandler. The second test which has failed on hadoop-qa runs fine on my machine.&lt;/p&gt;</comment>
                            <comment id="13964813" author="mantonov" created="Wed, 9 Apr 2014 23:37:34 +0000"  >&lt;p&gt;That&apos;s assuming (according to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4270&quot; title=&quot;IOE ignored during flush-on-close causes dataloss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4270&quot;&gt;&lt;del&gt;HBASE-4270&lt;/del&gt;&lt;/a&gt;), that DroppedSnapshotException is what we&apos;re catching to trigger log replay, and no other exception shall be possible thrown to trigger it?&lt;/p&gt;</comment>
                            <comment id="13965392" author="nkeywal" created="Thu, 10 Apr 2014 14:25:53 +0000"  >&lt;p&gt;Thanks for the fix, Michael. Thanks for committing it Stack.&lt;/p&gt;</comment>
                            <comment id="13965397" author="d.yuan" created="Thu, 10 Apr 2014 14:35:24 +0000"  >&lt;p&gt;Thanks all!&lt;/p&gt;</comment>
                            <comment id="14330488" author="enis" created="Sat, 21 Feb 2015 23:28:51 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12707635">HBASE-10954</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12639487" name="HBASE-10813_trunk_fixed_tests.patch" size="989" author="mantonov" created="Wed, 9 Apr 2014 23:28:44 +0000"/>
                            <attachment id="12636283" name="HBase-10813-trunk.patch" size="2684" author="d.yuan" created="Mon, 24 Mar 2014 02:06:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 24 Mar 2014 09:13:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tpyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>