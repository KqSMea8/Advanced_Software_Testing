<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4118/HBASE-4118.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4118] method regionserver.MemStore#updateColumnValue: the check for qualifier and family is missing</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4118</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
           [...]
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (it.hasNext()) {
                KeyValue kv = it.next();

                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; isnt the row we are interested in, then bail:
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!firstKv.matchingColumn(family, qualifier) || !firstKv.matchingRow(kv)) {
                    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// rows dont match, bail.
&lt;/span&gt;                }

                [...]
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should be replaced by:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; isnt the row we are interested in, then bail:
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!kv.matchingColumn(family, qualifier) || !firstKv.matchingRow(kv)) {
                    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// rows dont match, bail.
&lt;/span&gt;                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12514797">HBASE-4118</key>
            <summary>method regionserver.MemStore#updateColumnValue: the check for qualifier and family is missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2011 15:17:19 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:28 +0000</updated>
                            <resolved>Wed, 20 Jul 2011 23:08:07 +0000</resolved>
                                    <version>0.90.3</version>
                                    <fixVersion>0.90.4</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13068479" author="nkeywal" created="Wed, 20 Jul 2011 16:32:48 +0000"  >&lt;p&gt;This patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix the point mention in the bug&lt;/li&gt;
	&lt;li&gt;modify the order of the test before updating the now value to improve the performances&lt;/li&gt;
	&lt;li&gt;remove a redundant array creation in the return.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java b/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;br/&gt;
index 4b5d62f..d75c30e 100644&lt;br/&gt;
&amp;#8212; a/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;br/&gt;
+++ b/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;br/&gt;
@@ -458,25 +458,24 @@ public class MemStore implements HeapSize {&lt;br/&gt;
         KeyValue kv = it.next();&lt;/p&gt;

&lt;p&gt;         // if this isnt the row we are interested in, then bail:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!firstKv.matchingColumn(family,qualifier) || !firstKv.matchingRow(kv) ) {&lt;br/&gt;
+        if (!kv.matchingColumn(family,qualifier) || !firstKv.matchingRow(kv) ) 
{
           break; // rows dont match, bail.
         }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         // if the qualifier matches and it&apos;s a put, just RM it out of the kvset.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (firstKv.matchingQualifier(kv)) {&lt;/li&gt;
	&lt;li&gt;// to be extra safe we only remove Puts that have a memstoreTS==0&lt;/li&gt;
	&lt;li&gt;if (kv.getType() == KeyValue.Type.Put.getCode()) {&lt;/li&gt;
	&lt;li&gt;now = Math.max(now, kv.getTimestamp());&lt;br/&gt;
+        if (kv.getType() == KeyValue.Type.Put.getCode() &amp;amp;&amp;amp;&lt;br/&gt;
+                  kv.getTimestamp() &amp;gt; now &amp;amp;&amp;amp;&lt;br/&gt;
+                firstKv.matchingQualifier(kv)&lt;br/&gt;
+              ) 
{
+            now = kv.getTimestamp();
           }
&lt;p&gt;         }&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       // create or update (upsert) a new KeyValue with&lt;br/&gt;
       // &apos;now&apos; and a 0 memstoreTS == immediately visible&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return upsert(Arrays.asList(new KeyValue [] 
{
-          new KeyValue(row, family, qualifier, now,
-              Bytes.toBytes(newValue))
-      }
&lt;p&gt;));&lt;br/&gt;
+      return upsert(Arrays.asList(&lt;br/&gt;
+              new KeyValue(row, family, qualifier, now, Bytes.toBytes(newValue)))&lt;br/&gt;
+      );&lt;br/&gt;
     } finally &lt;/p&gt;
{
       this.lock.readLock().unlock();
     }&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13068485" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 16:46:40 +0000"  >&lt;p&gt;I corrected an error in the body of this JIRA.&lt;/p&gt;

&lt;p&gt;Please generate a patch file and attach to this issue. Don&apos;t paste changes directly as comment.&lt;/p&gt;

&lt;p&gt;Also, verify that all tests pass.&lt;/p&gt;</comment>
                            <comment id="13068493" author="nkeywal" created="Wed, 20 Jul 2011 17:12:58 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;If I read well your modification, the new version is:&lt;/p&gt;

&lt;p&gt;                if (!kv.matchingColumn(family, qualifier) || !*&lt;br/&gt;
kv.matchingRow(kv)*) &lt;/p&gt;
{
                    break; // rows dont match, bail.
                }

&lt;p&gt;&quot;kv.matchingRow(kv)&quot; is really what you want? This should noy  always return&lt;br/&gt;
true (I am a beginner here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;

&lt;p&gt;And not kv.matchingRow(row) (equivalent to firstKv.matchingRow(kv), but&lt;br/&gt;
cleaner imho)?&lt;/p&gt;







</comment>
                            <comment id="13068494" author="stack" created="Wed, 20 Jul 2011 17:14:16 +0000"  >&lt;p&gt;Mr N.  This is a good find.  We should make a KV#matchingRowAndColumn rather than go in there twice?&lt;/p&gt;</comment>
                            <comment id="13068501" author="stack" created="Wed, 20 Jul 2011 17:23:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;&quot;kv.matchingRow(kv)&quot; is really what you want?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It should be firstKv.matchingRow(kv)?&lt;/p&gt;

&lt;p&gt;Mr. N, can you attach the patch to the issue rather than paste it in.  Makes it easier review and apply.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13068506" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 17:44:09 +0000"  >&lt;p&gt;I restored the body of this JIRA and formatted a little.&lt;/p&gt;</comment>
                            <comment id="13068632" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 20:57:49 +0000"  >&lt;p&gt;Patch with slight modification.&lt;/p&gt;

&lt;p&gt;TestGlobalMemStoreSize, TestMemStore and TestMemStoreLAB passed&lt;/p&gt;</comment>
                            <comment id="13068648" author="nkeywal" created="Wed, 20 Jul 2011 21:11:09 +0000"  >&lt;p&gt;Sorry for the delay. I will create a proper patch next time. I am going to execute the tests on your patch on my env and will come back to you, so far it seems ok for me.&lt;/p&gt;


&lt;p&gt;On &quot;We should make a KV#matchingRowAndColumn rather than go in there twice?&quot;, I don&apos;t know yet. It seems that multiple optimizations are possible. I am going to proposethe easiest ones first, and then check what remains. &lt;/p&gt;
</comment>
                            <comment id="13068665" author="stack" created="Wed, 20 Jul 2011 21:52:57 +0000"  >&lt;p&gt;+1 on patch (It looks like you did kv.matchingRow(firstKv) to address N&apos;s comment above Ted).&lt;/p&gt;</comment>
                            <comment id="13068670" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 22:09:51 +0000"  >&lt;p&gt;This is the version I plan to commit.&lt;/p&gt;</comment>
                            <comment id="13068678" author="nkeywal" created="Wed, 20 Jul 2011 22:29:23 +0000"  >&lt;p&gt;Seems ok to me as well. I executed the tests on the previous patch version, they&apos;re ok.&lt;/p&gt;</comment>
                            <comment id="13068698" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 23:07:51 +0000"  >&lt;p&gt;Integrated to branch and TRUNK.&lt;/p&gt;

&lt;p&gt;Please use two spaces for tab in the future.&lt;/p&gt;

&lt;p&gt;Thanks for the patch nkeywal.&lt;/p&gt;</comment>
                            <comment id="13068778" author="hudson" created="Thu, 21 Jul 2011 03:13:06 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2045 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2045/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2045/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4118&quot; title=&quot;method regionserver.MemStore#updateColumnValue: the check for qualifier and family is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4118&quot;&gt;&lt;del&gt;HBASE-4118&lt;/del&gt;&lt;/a&gt;  method regionserver.MemStore#updateColumnValue: the check for &lt;br/&gt;
               qualifier and family is missing (N Keywal via Ted Yu)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016234" author="lars_francke" created="Fri, 20 Nov 2015 11:54:28 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487225" name="4118-v2.txt" size="1645" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 22:09:51 +0000"/>
                            <attachment id="12487214" name="4118.txt" size="1739" author="yuzhihong@gmail.com" created="Wed, 20 Jul 2011 20:57:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Jul 2011 16:46:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hpgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>