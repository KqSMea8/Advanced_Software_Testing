<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:29:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5617/HBASE-5617.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5617] Provide coprocessor hooks in put flow while rollbackMemstore.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5617</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;With coprocessors hooks while put happens we have the provision to create new puts to other tables or regions.  These puts can be done with writeToWal as false.&lt;br/&gt;
In 0.94 and above the puts are first written to memstore and then to WAL.  If any failure in the WAL append or sync the memstore is rollbacked.  &lt;br/&gt;
Now the problem is that if the put that happens in the main flow fails there is no way to rollback the &lt;br/&gt;
puts that happened in the prePut.&lt;/p&gt;

&lt;p&gt;We can add coprocessor hooks to like pre/postRoolBackMemStore.  Is any one hook enough here?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12547614">HBASE-5617</key>
            <summary>Provide coprocessor hooks in put flow while rollbackMemstore.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Mar 2012 15:24:27 +0000</created>
                <updated>Mon, 22 Jun 2015 17:48:17 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                    <component>Coprocessors</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13239460" author="ram_krish" created="Tue, 27 Mar 2012 13:51:37 +0000"  >&lt;p&gt;Pls review the patch.  This patch also adds additional hooks to the doMiniBatchPut.&lt;/p&gt;

&lt;p&gt;We found some gaps in the coprocessor hooks available and hence added the new hooks.&lt;br/&gt;
For eg, the preBatchPut hook will help us to do any puts after the timestamp is updated in the kv and it will be called once with all the current puts that has acquired the locks.&lt;/p&gt;

&lt;p&gt;The postBatchPut hook is needed before the completeMemStoreInsert so that any new puts we do using the hooks can also adhere to the principles of mvcc. &lt;/p&gt;

&lt;p&gt;Similarly a final hook is also introduced so that any clean up operation can be done.&lt;br/&gt;
Rollback memstore is also needed with a hook.&lt;br/&gt;
Pls feel free to comment on the new hooks added.  &lt;br/&gt;
If only rollback memstore hook is needed then i will prepare a patch with that alone. &lt;br/&gt;
This is just a version so that folks can get an idea on what has been added and where it has been added.&lt;/p&gt;</comment>
                            <comment id="13239510" author="hadoopqa" created="Tue, 27 Mar 2012 14:38:19 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520114/HBASE-5617_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520114/HBASE-5617_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1321//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1321//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1321//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1321//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1321//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1321//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13239537" author="zhihyu@ebaysf.com" created="Tue, 27 Mar 2012 14:59:53 +0000"  >&lt;p&gt;Haven&apos;t gone through the patch yet.&lt;br/&gt;
The lines w.r.t. prePut() seem to be unrelated. It would be nice to remove them.&lt;/p&gt;

&lt;p&gt;Do we need two hooks for memstore rollback ?&lt;/p&gt;</comment>
                            <comment id="13239567" author="stack" created="Tue, 27 Mar 2012 15:42:47 +0000"  >&lt;p&gt;No test Ram that new functionality works?&lt;/p&gt;</comment>
                            <comment id="13239675" author="apurtell" created="Tue, 27 Mar 2012 17:30:57 +0000"  >&lt;p&gt;-1 on patch, API changes exceed the scope of this issue as defined.&lt;/p&gt;</comment>
                            <comment id="13240981" author="anoopsamjohn" created="Thu, 29 Mar 2012 05:18:51 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Do we need two hooks for memstore rollback ?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;+1 for pre and post... As per the use case one can use pre or post hook...&lt;/p&gt;</comment>
                            <comment id="13240982" author="ram_krish" created="Thu, 29 Mar 2012 05:19:15 +0000"  >&lt;p&gt;@Andy&lt;br/&gt;
Yes, this patch adds some more hooks other than the one specified in the JIRA title.&lt;br/&gt;
My intention was to know if it is ok to add new hooks like the one in the patch.&lt;/p&gt;

&lt;p&gt;If it is fine i can raise another JIRA for the same and leave this JIRA with only hooks for rollbackOfMemStore.&lt;/p&gt;</comment>
                            <comment id="13241043" author="ram_krish" created="Thu, 29 Mar 2012 07:21:05 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
I will be adding test cases for the rollback scenarios.  I wanted to get the things clarified before giving a patch.&lt;/p&gt;</comment>
                            <comment id="13241367" author="ram_krish" created="Thu, 29 Mar 2012 16:31:17 +0000"  >&lt;p&gt;@Andy&lt;br/&gt;
This patch deals only with what is intended in the title of the JIRA.&lt;br/&gt;
Can i raise another JIRA for adding other hooks?&lt;/p&gt;</comment>
                            <comment id="13241379" author="lhofhansl" created="Thu, 29 Mar 2012 16:52:16 +0000"  >&lt;p&gt;In 0.94+ there are more places where we rollback the memstore.&lt;br/&gt;
Check out HRegion.mutateRowsWithLocks in 0.94 and HRegion.processRowsWithLocks in 0.96.&lt;/p&gt;</comment>
                            <comment id="13241395" author="zhihyu@ebaysf.com" created="Thu, 29 Mar 2012 17:13:52 +0000"  >&lt;p&gt;rollbackMemstore() doesn&apos;t throw exception.&lt;br/&gt;
I want to understand why we need two hooks for the rollback scenario.&lt;/p&gt;</comment>
                            <comment id="13241399" author="hadoopqa" created="Thu, 29 Mar 2012 17:18:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520451/HBASE-5617_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520451/HBASE-5617_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestHRegion&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1343//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1343//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1343//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1343//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1343//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1343//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13241435" author="ram_krish" created="Thu, 29 Mar 2012 17:54:09 +0000"  >&lt;p&gt;@Lars &lt;br/&gt;
I will update in other places also.&lt;br/&gt;
@Ted&lt;br/&gt;
What do you think? Only one hook is enough?  For our use case one hook is enough.&lt;br/&gt;
From your previous comment i felt you suggested like its better we have two.&lt;/p&gt;</comment>
                            <comment id="13241446" author="zhihyu@ebaysf.com" created="Thu, 29 Mar 2012 18:00:52 +0000"  >&lt;p&gt;I think one hook should be enough.&lt;/p&gt;</comment>
                            <comment id="13242231" author="ram_krish" created="Fri, 30 Mar 2012 10:26:08 +0000"  >
&lt;blockquote&gt;&lt;p&gt;Check out HRegion.mutateRowsWithLocks in 0.94 and HRegion.processRowsWithLocks in 0.96.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These apis roll back the kvs directly.  In my patch i thought of having putList.&lt;/p&gt;

&lt;p&gt;So can we now pass kvs?&lt;br/&gt;
Or can we pass List&amp;lt;Mutation&amp;gt; and leave the user to do a instanceof check and proceed?&lt;/p&gt;

&lt;p&gt;Also is the name ok to have rollbackMemstore in it or only rollback?  Kindly let me know your opinion on this.  &lt;br/&gt;
Also in trunk the processor.postProcess is done even if there is a failure.  But in 0.94 its not.&lt;/p&gt;</comment>
                            <comment id="13242421" author="zhihyu@ebaysf.com" created="Fri, 30 Mar 2012 15:14:29 +0000"  >&lt;p&gt;I think passing List&amp;lt;KeyValue&amp;gt; is general.&lt;/p&gt;

&lt;p&gt;rollbackMemstore would be a good name. See javadoc for Store.rollback().&lt;/p&gt;</comment>
                            <comment id="13476065" author="ram_krish" created="Mon, 15 Oct 2012 10:09:53 +0000"  >&lt;p&gt;I would like to revive this patch? Thougths...?&lt;/p&gt;</comment>
                            <comment id="13741929" author="ram_krish" created="Fri, 16 Aug 2013 05:20:28 +0000"  >&lt;p&gt;Am linking this to the Secondary index parent JIRA.  If this hooks makes sense we can add the hooks.&lt;/p&gt;</comment>
                            <comment id="13849665" author="hadoopqa" created="Mon, 16 Dec 2013 20:06:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520451/HBASE-5617_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520451/HBASE-5617_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8179//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8179//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14126665" author="hadoopqa" created="Tue, 9 Sep 2014 06:14:00 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520451/HBASE-5617_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520451/HBASE-5617_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12520451&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10775//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10775//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12663357">HBASE-9203</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12520114" name="HBASE-5617_1.patch" size="19872" author="ram_krish" created="Tue, 27 Mar 2012 13:46:46 +0000"/>
                            <attachment id="12520451" name="HBASE-5617_2.patch" size="20272" author="ram_krish" created="Thu, 29 Mar 2012 16:31:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Mar 2012 14:38:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232712</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02eqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11990</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>