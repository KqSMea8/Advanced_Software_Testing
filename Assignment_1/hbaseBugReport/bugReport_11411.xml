<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:22:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11411/HBASE-11411.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11411] [AccessController] Cell level permissions were not checked when using CELL_FIRST_STRATEGY</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11411</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In doing read operations with ACL we were checking there is read permission granted on the table&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AuthResult authResult = permissionGranted(opType, user, env, families, Action.READ);
    HRegion region = getRegion(env);
    TableName table = getTableName(region);
    Map&amp;lt;ByteRange, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; cfVsMaxVersions = Maps.newHashMap();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HColumnDescriptor hcd : region.getTableDesc().getFamilies()) {
      cfVsMaxVersions.put(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleByteRange(hcd.getName()), hcd.getMaxVersions());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If there is no permission then we were checking for the type of cell level permission &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; CHECK_CELL_DEFAULT: {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (authManager.authorize(user, table, family, qualifier, Permission.Action.READ) ||
            authManager.authorize(user, table, cell, Permission.Action.READ)) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ReturnCode.INCLUDE;
        }
      }
      &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
      &lt;span class=&quot;code-comment&quot;&gt;// Cell permissions must authorize
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; CHECK_CELL_FIRST: {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (authManager.authorize(user, table, cell, Permission.Action.READ) &amp;amp;&amp;amp;
            authManager.authorize(user, table, family, qualifier, Permission.Action.READ)) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ReturnCode.INCLUDE;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For CELL_FIRST_STRATEGY &lt;br/&gt;
-&amp;gt; if the user had granted READ permission on the table itself then even if cell level was not granting access we were able to read the cell.&lt;br/&gt;
-&amp;gt;If table level READ permission was not there then the &amp;amp;&amp;amp; condition was failing from reading any cell even with READ permission. &lt;br/&gt;
The 2nd one was an intended behaviour but for the first one I think we should see if really the cell was readable too.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12723564">HBASE-11411</key>
            <summary>[AccessController] Cell level permissions were not checked when using CELL_FIRST_STRATEGY</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jun 2014 05:39:51 +0000</created>
                <updated>Sat, 28 Jun 2014 00:50:00 +0000</updated>
                            <resolved>Sat, 28 Jun 2014 00:50:00 +0000</resolved>
                                    <version>0.98.3</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14043063" author="ram_krish" created="Wed, 25 Jun 2014 05:41:36 +0000"  >&lt;p&gt;Patch for trunk.&lt;/p&gt;</comment>
                            <comment id="14043066" author="ram_krish" created="Wed, 25 Jun 2014 05:43:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;br/&gt;
Pls change the fix version if you feel this need not go in 0.98.4.&lt;br/&gt;
The patch also corrects the usage of IntegrationTestWithACL for non kerberos based set up also.&lt;/p&gt;</comment>
                            <comment id="14043138" author="hadoopqa" created="Wed, 25 Jun 2014 07:32:18 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12652342/HBASE-11411.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12652342/HBASE-11411.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12652342&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +        // Here we know that the table/CF has read permission and so we could allow the cell first strategy &lt;br/&gt;
+        AccessControlProtos.Permission.Action[] actions = &lt;/p&gt;
{ AccessControlProtos.Permission.Action.READ }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9844//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14044149" author="apurtell" created="Wed, 25 Jun 2014 22:45:27 +0000"  >&lt;p&gt;You haven&apos;t convinced me the behavior is incorrect. CHECK_CELL_FIRST won&apos;t work by default after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11070&quot; title=&quot;[AccessController] Restore early-out access denial if the user has no access at the table or CF level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11070&quot;&gt;HBASE-11070&lt;/a&gt; on trunk (where compatible early termination is enabled by default) but will in 0.98 (where compatible early termination is disabled by default). See the issue for more discussion.&lt;/p&gt;

&lt;p&gt;Need a unit test verifying the problem in 0.98 first. &lt;/p&gt;</comment>
                            <comment id="14044150" author="apurtell" created="Wed, 25 Jun 2014 22:47:40 +0000"  >&lt;p&gt;I would also not be opposed to just removing CHECK_CELL_FIRST strategy all together, because &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11070&quot; title=&quot;[AccessController] Restore early-out access denial if the user has no access at the table or CF level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11070&quot;&gt;HBASE-11070&lt;/a&gt; essentially disables it by default on trunk. I don&apos;t think we have any active use cases for it.&lt;/p&gt;</comment>
                            <comment id="14044151" author="apurtell" created="Wed, 25 Jun 2014 22:49:46 +0000"  >&lt;p&gt;Resolving as invalid.&lt;/p&gt;

&lt;p&gt;Feel free to reopen with a patch/unit test that demonstrates there is an actual issue on 0.98, where compatible early termination is NOT enabled by default.&lt;/p&gt;

&lt;p&gt;Or, consider filing a new issue that removes the cell first strategy all together.&lt;/p&gt;

&lt;p&gt;Again, refer to background on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11070&quot; title=&quot;[AccessController] Restore early-out access denial if the user has no access at the table or CF level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11070&quot;&gt;HBASE-11070&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14044300" author="ram_krish" created="Thu, 26 Jun 2014 03:10:07 +0000"  >&lt;p&gt;The LoadTestTool running with ACL IT itself is a test case that exhibits this behaviour. I will come with a simple UT too for showing this.  &lt;/p&gt;</comment>
                            <comment id="14044301" author="apurtell" created="Thu, 26 Jun 2014 03:11:12 +0000"  >&lt;p&gt;Uh.. sure, as long as you realize that cell first cannot work by design by default on trunk because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11070&quot; title=&quot;[AccessController] Restore early-out access denial if the user has no access at the table or CF level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11070&quot;&gt;HBASE-11070&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14044832" author="apurtell" created="Thu, 26 Jun 2014 16:38:04 +0000"  >&lt;p&gt;Ok, Ram convinced me internally that cell first doesn&apos;t really work as intended in 0.98 either.&lt;/p&gt;

&lt;p&gt;I would like to see us just remove &apos;cell first&apos; as an idea that isn&apos;t working out. It cannot work by default on trunk after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11070&quot; title=&quot;[AccessController] Restore early-out access denial if the user has no access at the table or CF level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11070&quot;&gt;HBASE-11070&lt;/a&gt;. This is on me.&lt;/p&gt;

&lt;p&gt;Leaving this issue open but think we should resolve it as Wont Fix and do another JIRA to remove the concept and the related code.&lt;/p&gt;</comment>
                            <comment id="14046568" author="apurtell" created="Sat, 28 Jun 2014 00:50:00 +0000"  >&lt;p&gt;Re-resolving. Fixing elsewhere.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12652342" name="HBASE-11411.patch" size="9508" author="ram_krish" created="Wed, 25 Jun 2014 05:41:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Jun 2014 07:32:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x5gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401818</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>