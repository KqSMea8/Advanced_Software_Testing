<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:38:25 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6625/HBASE-6625.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6625] If we have hundreds of thousands of  regions getChildren will encouter zk exception</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6625</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;2012-05-13 19:37:37,528 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$ExistsUnassignedAsyncCallback: rs=CreateNewTableWith100000Regions,\x05\xB3\x06 &lt;br/&gt;
g\xE8r\xBB]\x09\xCF,1336724029944.079cb2f8a375e66fa089291b82f2a03f. state=OFFLINE, ts=1336909053108 &lt;br/&gt;
2012-05-13 19:37:37,528 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$CreateUnassignedAsyncCallback: rs=CreateNewTableWith100000Regions,\x08s\x84\x8 &lt;br/&gt;
8$7\xB1\xC4\xFCg,1336724030660.76c07780231942231013c7feb5e5eb14. state=OFFLINE, ts=1336909055089, server=dw76.kgb.sqa.cm4,60020,1336908983944 &lt;br/&gt;
2012-05-13 19:37:37,528 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$CreateUnassignedAsyncCallback: rs=CreateNewTableWith100000Regions,\x08s\x89\xC &lt;br/&gt;
B\x9B\xF0\xE4\xCA\x97\xB0,1336724030660.fa38b9d8367387a64a327087cb43b3e0. state=OFFLINE, ts=1336909055089, server=dw76.kgb.sqa.cm4,60020,1336908983944 &lt;br/&gt;
2012-05-13 19:37:37,528 INFO org.apache.hadoop.hbase.master.AssignmentManager: dw76.kgb.sqa.cm4,60020,1336908983944 unassigned znodes=58464 of total=120002 &lt;br/&gt;
2012-05-13 19:37:37,758 WARN org.apache.zookeeper.ClientCnxn: Session 0x13745fc2c8d0001 for server dw51.kgb.sqa.cm4/10.232.98.51:2180, unexpected error, clos &lt;br/&gt;
ing socket connection and attempting reconnect &lt;br/&gt;
java.io.IOException: Packet len4320092 is out of range! &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$SendThread.readLength(ClientCnxn.java:710) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$SendThread.doIO(ClientCnxn.java:869) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1130) &lt;br/&gt;
2012-05-13 19:37:37,860 WARN org.apache.hadoop.hbase.zookeeper.ZKUtil: master:60000-0x13745fc2c8d0001 Unable to list children of znode /hbase-new4/unassigned &lt;/p&gt;

&lt;p&gt;org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /hbase-new4/unassigned &lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:90) &lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42) &lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1243) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.listChildrenAndWatchForNewChildren(ZKUtil.java:302) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.watchAndGetNewChildren(ZKUtil.java:413) &lt;br/&gt;
        at org.apache.hadoop.hbase.master.AssignmentManager.nodeChildrenChanged(AssignmentManager.java:759) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher.process(ZooKeeperWatcher.java:314) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:530) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:506) &lt;br/&gt;
2012-05-13 19:37:37,861 ERROR org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher: master:60000-0x13745fc2c8d0001 Received unexpected KeeperException, re-thro &lt;br/&gt;
wing exception &lt;br/&gt;
org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /hbase-new4/unassigned &lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:90) &lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42) &lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1243) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.listChildrenAndWatchForNewChildren(ZKUtil.java:302) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.watchAndGetNewChildren(ZKUtil.java:413) &lt;br/&gt;
        at org.apache.hadoop.hbase.master.AssignmentManager.nodeChildrenChanged(AssignmentManager.java:759) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher.process(ZooKeeperWatcher.java:314) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:530) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:506) &lt;br/&gt;
2012-05-13 19:37:37,861 FATAL org.apache.hadoop.hbase.master.HMaster: Unexpected ZK exception reading unassigned children &lt;br/&gt;
org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /hbase-new4/unassigned &lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:90) &lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42) &lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1243) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.listChildrenAndWatchForNewChildren(ZKUtil.java:302) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.watchAndGetNewChildren(ZKUtil.java:413) &lt;br/&gt;
        at org.apache.hadoop.hbase.master.AssignmentManager.nodeChildrenChanged(AssignmentManager.java:759) &lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher.process(ZooKeeperWatcher.java:314) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:530) &lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:506) &lt;br/&gt;
2012-05-13 19:37:37,861 INFO org.apache.hadoop.hbase.master.HMaster: Aborting&lt;/p&gt;</description>
                <environment></environment>
        <key id="12604182">HBASE-6625</key>
            <summary>If we have hundreds of thousands of  regions getChildren will encouter zk exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="zhou wen jian">Zhou wenjian</assignee>
                                    <reporter username="zhou wen jian">Zhou wenjian</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Aug 2012 07:50:56 +0000</created>
                <updated>Sat, 19 Jan 2013 23:33:28 +0000</updated>
                            <resolved>Sat, 19 Jan 2013 23:33:28 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13438522" author="zhou wen jian" created="Tue, 21 Aug 2012 07:57:46 +0000"  >&lt;p&gt;the log appears in 90. &lt;br/&gt;
zk version&#65306; 3.3.3&lt;br/&gt;
seems 3.4 is affected too. &lt;/p&gt;

&lt;p&gt;when the client read from zk, it will check the length of data default is 4M&lt;br/&gt;
if (len &amp;lt; 0 || len &amp;gt;= ClientCnxn.packetLen) &lt;/p&gt;
{
            throw new IOException(&quot;Packet len&quot; + len + &quot; is out of range!&quot;);
        }
&lt;p&gt;I think maybe we can increase the size of jute.maxbuffer when we start the cluster.&lt;/p&gt;</comment>
                            <comment id="13439863" author="jmhsieh" created="Wed, 22 Aug 2012 21:31:19 +0000"  >&lt;p&gt;the jute.maxbuffer is a ZK setting.  Maybe instead we should enforce a max number of regions per region server?  &lt;/p&gt;

&lt;p&gt;Maybe since most region should have at most 100 for 92+ and 1000 for 90 we should instead change the default of hbase.regionserver.regionSplitLimit to something like 1000 instead of MAX_INT to avoid the problem.&lt;/p&gt;</comment>
                            <comment id="13439876" author="zhihyu@ebaysf.com" created="Wed, 22 Aug 2012 21:40:12 +0000"  >&lt;p&gt;At the moment, merging region is an action people don&apos;t usually want to tackle.&lt;br/&gt;
With lowered hbase.regionserver.regionSplitLimit, some regions would grow almost without bound in size. How are we going to deal with that ?&lt;/p&gt;</comment>
                            <comment id="13439928" author="jmhsieh" created="Wed, 22 Aug 2012 23:06:28 +0000"  >&lt;p&gt;I&apos;ve feel that we should make merging regions a robust and constantly tested feature instead of just a script.  There was some discussion about this with 0.92 becuase of HFile v2.  When we have that then we can make a long running system test to merge/split/merge/split while read/write load is going on.&lt;/p&gt;</comment>
                            <comment id="13439936" author="jmhsieh" created="Wed, 22 Aug 2012 23:21:11 +0000"  >&lt;p&gt;If we lowered regionsplit limit to something 10x what is considered reasonable?  Max int is quite large, 100k regions is also quite large.  If you have that many regions your are &quot;doing it wrong&quot; or purposely trying to break hbase. &lt;/p&gt;

&lt;p&gt;If we have 100k 10GB regions, this means we have 1 Exabyte (10^15) of region data &lt;b&gt;per&lt;/b&gt; region server.  I believe the largest hdfs clusters haven&apos;t gotten to that size yet. &lt;/p&gt;

&lt;p&gt;I don&apos;t see the point of allowing that to happen (even accidentially).  Setting it to something an order of mag larger than reasonable would hold us over for a year or so. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  &lt;/p&gt;</comment>
                            <comment id="13439953" author="stack" created="Wed, 22 Aug 2012 23:49:55 +0000"  >&lt;p&gt;I like your suggestion of bounding the total Jon (and the merge suggestion).  Its simple.  Lets get it in now and then have the discussion about how to go beyond this limitation?&lt;/p&gt;</comment>
                            <comment id="13439955" author="jmhsieh" created="Wed, 22 Aug 2012 23:53:04 +0000"  >&lt;p&gt;I slightly misspoke in my previous comment &amp;#8211; the exception is in the assignment manager so this would be 100k regions per cluster.  So its an exabyte of data for the hbase cluster (not per region server).  Still, large enough to last for at least a year or two. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13558122" author="stack" created="Sat, 19 Jan 2013 23:33:28 +0000"  >&lt;p&gt;Resolving as a dup of hbase-4246.  We also have a comment on workaround in here &lt;a href=&quot;http://hbase.apache.org/book.html#trouble.master&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#trouble.master&lt;/a&gt;  Jon&apos;s suggestion that we bound the maximum number of regions on a cluster is a good one.  Lets do that in another issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12519890">HBASE-4246</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 22 Aug 2012 21:31:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02dxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>