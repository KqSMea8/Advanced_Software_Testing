<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4199/HBASE-4199.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4199] blockCache summary - backend</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4199</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is the backend work for the blockCache summary.  Change to BlockCache interface, Summarization in LruBlockCache, BlockCacheSummaryEntry, addition to HRegionInterface, and HRegionServer.&lt;/p&gt;

&lt;p&gt;This will NOT include any of the web UI or anything else like that.  That is for another sub-task.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12518794">HBASE-4199</key>
            <summary>blockCache summary - backend</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12513845">HBASE-4089</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dmeil">Doug Meil</assignee>
                                    <reporter username="dmeil">Doug Meil</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Aug 2011 21:41:51 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:19 +0000</updated>
                            <resolved>Tue, 23 Aug 2011 14:41:03 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13084856" author="yuzhihong@gmail.com" created="Sun, 14 Aug 2011 16:01:18 +0000"  >&lt;p&gt;It would be easier for other developers to make review comments if review board was used.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+/**
+ * This class provides tests &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the {@link HTableUtil} class
+ *
+ */
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestBlockCacheSummary {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please update javadoc with brief description of what is tested in the above class.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  /**
+   * 
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; BlockCacheSummaryEntry() {
+    
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above can be made package private. Please also fill in javadoc.&lt;br/&gt;
Earlier in the same class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; columnFamily;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would it be more general if the above two fields were declared as byte[] ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; heapSize
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getBlocks() {
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; blocks;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please correct javadoc.&lt;/p&gt;</comment>
                            <comment id="13084864" author="dmeil" created="Sun, 14 Aug 2011 16:51:04 +0000"  >&lt;p&gt;BlockCacheSummaryEntry can&apos;t be made package private because it&apos;s also the class that is eventually returned by the RegionServer API.&lt;/p&gt;

&lt;p&gt;I&apos;ll fix the javadoc.&lt;/p&gt;

&lt;p&gt;How do you use the review board?  I don&apos;t see anything on &quot;More Actions&quot; or &quot;Workflow&quot; in Jira.&lt;/p&gt;</comment>
                            <comment id="13084881" author="yuzhihong@gmail.com" created="Sun, 14 Aug 2011 18:43:52 +0000"  >&lt;p&gt;I was talking about the default ctor for BlockCacheSummaryEntry. Throughout the patch, after BlockCacheSummaryEntry() is called, table and columnFamily are filled in.&lt;br/&gt;
So I think BlockCacheSummaryEntry(String table, String columnFamily) should be used.&lt;/p&gt;

&lt;p&gt;Please see Mingjie&apos;s comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4197&quot; title=&quot;RegionServer expects all scanner to be subclasses of HRegion.RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4197&quot;&gt;&lt;del&gt;HBASE-4197&lt;/del&gt;&lt;/a&gt; about using review board.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13085207" author="jdcryans" created="Mon, 15 Aug 2011 17:51:57 +0000"  >&lt;p&gt;I&apos;m sorta confused by TestBlockCacheSummary.testBlockCacheSummary, you have 3 region servers but then you create a BC from StoreFile.getBlockCache that isn&apos;t related to any RS (because the get a different conf object in MiniHBaseCluster.init). What is it testing exactly? Do you need 3 RS btw?&lt;/p&gt;

&lt;p&gt;You should set BlockCacheSummaryEntry&apos;s attributes to some default values because you might end up with NPEs that are hard to debug, just a precaution with Writables.&lt;/p&gt;

&lt;p&gt;There&apos;s some cleanup to do too, long lines and whatnot.&lt;/p&gt;</comment>
                            <comment id="13085251" author="dmeil" created="Mon, 15 Aug 2011 18:42:03 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;re:  &quot;minicluster.&quot;&lt;br/&gt;
Doesn&apos;t need to be 3.  I copied that from some other test that happened to be 3.  Changed to the no-arg method which is 1.&lt;/p&gt;

&lt;p&gt;re:  &quot;defaults&quot;&lt;br/&gt;
Good one.  Changed&lt;/p&gt;

&lt;p&gt;re:  &quot;different config&quot;&lt;br/&gt;
How is it different?  It&apos;s using the same config as the TEST_UTIL.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  BlockCache bc = StoreFile.getBlockCache(TEST_UTIL.getConfiguration());
   List&amp;lt;BlockCacheSummaryEntry&amp;gt; bcs = bc.getBlockCacheSummary(TEST_UTIL.getConfiguration());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;re:  &quot;what&quot;&lt;br/&gt;
I&apos;m just trying to create some activity and have it wind up in the block cache.  The only thing that seems to be in there in the unit test is the &lt;del&gt;ROOT&lt;/del&gt; table with the &apos;info&apos; CF, which I&apos;m asserting against.&lt;/p&gt;</comment>
                            <comment id="13085257" author="jdcryans" created="Mon, 15 Aug 2011 18:51:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m just trying to create some activity and have it wind up in the block cache. The only thing that seems to be in there in the unit test is the ROOT table with the &apos;info&apos; CF, which I&apos;m asserting against.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;d be preferable to look at some real data, here it seems you saw it contained ROOT by chance and now check against it. Force flush that table you&apos;re writing to, then scan and then check the content of the block cache.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How is it different? It&apos;s using the same config as the TEST_UTIL.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like I wrote, this is what MiniHBaseCluster does:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Configuration rsConf = HBaseConfiguration.create(conf);
User user = HBaseTestingUtility.getDifferentUser(rsConf,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;.hfs.&quot;&lt;/span&gt;+index++);
hbaseCluster.addRegionServer(rsConf, i, user);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I&apos;m mixing stuff here, I was thinking the same way we usually use Configs for connections but that&apos;s not the case here. The block cache is shared between all region servers in the same JVM, which is kinda wrong if you ask me, but it makes testing somehow easier. Anyways, disregard.&lt;/p&gt;</comment>
                            <comment id="13085463" author="dmeil" created="Tue, 16 Aug 2011 00:55:19 +0000"  >&lt;p&gt;Adding an updated version of this patch&lt;/p&gt;</comment>
                            <comment id="13085464" author="dmeil" created="Tue, 16 Aug 2011 00:57:59 +0000"  >&lt;p&gt;The unit test has been updated in this v2 patch and now does the flush with an assertion on 2 tables which also now appear in the block cache.&lt;br/&gt;
Looked for wide-lines, added default-values in BlockCacheSummaryEntry, added some additional Javadoc.&lt;/p&gt;</comment>
                            <comment id="13086317" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 13:54:26 +0000"  >&lt;p&gt;Please use better table names below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; TEST_TABLE = &lt;span class=&quot;code-quote&quot;&gt;&quot;testFamily&quot;&lt;/span&gt;;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; TEST_TABLE2 = &lt;span class=&quot;code-quote&quot;&gt;&quot;testFamily2&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Javadoc for BlockCacheSummaryEntry should mention entry:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+/**
+ * Represents a summary of the blockCache by Table and ColumnFamily  
+ *
+ */
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class BlockCacheSummaryEntry &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Writable, Comparable&amp;lt;BlockCacheSummaryEntry&amp;gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the code below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      bcse = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockCacheSummaryEntry();
+      bcse.setTable(s[ s.length - 4]);   &lt;span class=&quot;code-comment&quot;&gt;// 4th from the end
&lt;/span&gt;+      bcse.setColumnFamily(s[ s.length - 2]);   &lt;span class=&quot;code-comment&quot;&gt;// 2nd from the end&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should be replaced with calling the two parameter ctor. The default ctor should be made package private.&lt;/p&gt;</comment>
                            <comment id="13086405" author="dmeil" created="Wed, 17 Aug 2011 15:50:09 +0000"  >&lt;p&gt;Thanks Ted.&lt;/p&gt;

&lt;p&gt;I&apos;ll fix the Javadoc and the unit test table constants.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure I agree about the overloaded constructor.  Doing this...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bcse = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockCacheSummaryEntry( s[ s.length - 4], s[s.length - 2]);
{code]
... seems less clear to me.  I think the &apos;setTable&apos; with the comment reminder on why it&apos;s being done makes more sense.

And doing &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;String table = ...;   &lt;br/&gt;
String cf = ...;&lt;br/&gt;
bcse = new BlockCacheSummaryEntry(table, cf);&lt;br/&gt;
{code]&lt;br/&gt;
... results in basically the same 3 lines of code that exist now.&lt;/p&gt;</comment>
                            <comment id="13086421" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 16:02:28 +0000"  >&lt;p&gt;Please use curly braces for the code directive.&lt;br/&gt;
The advantage of using two parameter ctor is that table and column family would be set at the same time, reducing the chance of inconsistency between them now that the two fields carry default values.&lt;/p&gt;

&lt;p&gt;This is my personal opinion.&lt;/p&gt;</comment>
                            <comment id="13086435" author="dmeil" created="Wed, 17 Aug 2011 16:33:38 +0000"  >&lt;p&gt;Uploading v3 with all requested changes.&lt;/p&gt;</comment>
                            <comment id="13087122" author="jdcryans" created="Thu, 18 Aug 2011 17:14:35 +0000"  >&lt;p&gt;+1 commit.&lt;/p&gt;</comment>
                            <comment id="13087244" author="dmeil" created="Thu, 18 Aug 2011 20:16:52 +0000"  >&lt;p&gt;Great!  Do this need more +1&apos;s, or can it be committed?&lt;/p&gt;</comment>
                            <comment id="13087302" author="stack" created="Thu, 18 Aug 2011 21:22:43 +0000"  >&lt;p&gt;Here&apos;s some feedback.&lt;/p&gt;

&lt;p&gt;This is very nice funcionality.  Thanks for adding it.&lt;/p&gt;

&lt;p&gt;The constructor that takes no args has empty javadoc.  Remove it or fill it in (perhaps note this method is for deserializing only)&lt;/p&gt;

&lt;p&gt;No need to assign &quot;&quot; to table and columnfamily on declaration?  Let a NPE out if this class ill-initialized&lt;/p&gt;

&lt;p&gt;You are inconsistent w/ lines separating methods.  Looks sloppy (Usually we put a single line between methods)&lt;/p&gt;

&lt;p&gt;Whats up with this BlockCacheSummaryEntry?  Its a summary or is it an entry?  If a summary, its odd that I can set things like blocks and heapSize post construction and even table and columnfamily.  Maybe this should be an immmutable object where you pass in all variables on construction?&lt;/p&gt;

&lt;p&gt;I suppose its a summary for the passed table and cf?  Hmm.  Thats what you say in the class javadoc so strike the above rumination on class name (the whether it should be immutable comment stands).&lt;/p&gt;

&lt;p&gt;+    this.heapSize = this.heapSize + heapSize; is usually written this.heapSize += heapSize... but no biggie.&lt;/p&gt;

&lt;p&gt;In the below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void readFields(DataInput arg0) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&apos;arg0&apos; is a bad name for a param (Same on the write).&lt;/p&gt;

&lt;p&gt;In hashCode you do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; prime = 31;
+    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; result = 1;
+    result = prime * result
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why the &apos;int result = 1&apos; at all?  Why not &apos;int result = prime + ....&apos;&lt;/p&gt;

&lt;p&gt;I like your equals implementation.&lt;/p&gt;

&lt;p&gt;In your toString, why include name of this class?&lt;/p&gt;

&lt;p&gt;Should we throw exception if path does not have four elements in it?&lt;/p&gt;

&lt;p&gt;Would suggest you add the stuff you have in comments down in createFromStoreFilePath up into the javadoc; would help clarify the kinda path we are expecting.&lt;/p&gt;

&lt;p&gt;You are inconsistent with spacings below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table = s[ s.length - 4];  &lt;span class=&quot;code-comment&quot;&gt;// 4th from the end
&lt;/span&gt;+      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cf = s[ s.length - 2];     &lt;span class=&quot;code-comment&quot;&gt;// 2nd from the end&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Be careful w/ line lengths.  Usually &amp;lt; 80.&lt;/p&gt;

&lt;p&gt;How often is getBlockCacheSummary called?  For each invocation we do inspection of all under hbase.rootdir?  This seems like a pretty costly operation.&lt;/p&gt;

&lt;p&gt;Looking at getTableStoreFilePathMap, we should make a storefiles filter.  Seems like it&apos;d get used more than once (but thats for another JIRA).&lt;/p&gt;

&lt;p&gt;This comment looks wrong?  &quot; Under each of these, should be one file only.&quot;&lt;/p&gt;

&lt;p&gt;Why do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    BlockCacheSummaryEntry e2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockCacheSummaryEntry();
+    e2.setTable(e.getTable());
+    e2.setColumnFamily(e.getColumnFamily());
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; e2;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why not do return BlockCacheSummaryEntry(e.getTable(), e.getColumnFamily());&lt;/p&gt;

&lt;p&gt;The below should be a Set?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    Map&amp;lt;BlockCacheSummaryEntry, BlockCacheSummaryEntry&amp;gt; bcs = 
+      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;BlockCacheSummaryEntry, BlockCacheSummaryEntry&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or, strike that... I see how you are using it.  Its a little unusual that equality is on only two of the datamembers.  Nothing wrong with this but I&apos;d call this out in the class comment for this class, that two instances are compared the same if table+cf agree (though counts differ).&lt;/p&gt;

&lt;p&gt;I like doing if (s.length &amp;lt;= 0) continue rather than below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s.length &amp;gt; 0) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Advantage of former is that save an indentation.  Similar for the if (path != null).. I&apos;d rather do if (path == null) continue;&lt;/p&gt;

&lt;p&gt;In javadoc should you should say that getBlockCacheSummary returns a list sorted by table name + cf (or you don&apos;t want to have sort in contract for this method?)&lt;/p&gt;

&lt;p&gt;Why do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    BlockCacheSummaryEntry[] ar = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockCacheSummaryEntry[list.size()];
+    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; list.size(); i++) {
+      ar[i]=list.get(i);
+    }
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ar;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why not return the List?  (In future, doing something like above, you can use &lt;a href=&quot;http://download.oracle.com/javase/6/docs/api/java/util/List.html#toArray(T[&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/6/docs/api/java/util/List.html#toArray(T[&lt;/a&gt;]))&lt;/p&gt;

&lt;p&gt;I see now that this is a feature use with low frequency so the fact that it is heavyweight should be fine.  You might add this to javadoc though that it includes scan of fs&lt;/p&gt;

&lt;p&gt;Why the double javadoc?  You have &apos;Performs block cache summary&apos; but then you also have @Override (we will pick up the javadoc from the interface so the extra stuff in here from HREgionServer is not needed).&lt;/p&gt;

&lt;p&gt;Tests look good.&lt;/p&gt;

&lt;p&gt;Just remove the below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setUp()  {
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remove javadoc w/ nothing in it.  Looks bad.&lt;/p&gt;

&lt;p&gt;Good stuff Doug.&lt;/p&gt;
</comment>
                            <comment id="13087469" author="dmeil" created="Fri, 19 Aug 2011 02:55:23 +0000"  >
&lt;p&gt;1.	BlockCacheSummaryEntry name&lt;/p&gt;

&lt;p&gt;I&apos;m struggling with the name.  &apos;BlockCacheSummary&apos; makes it seem like you should get exactly one object back (I.e., a summary).  So what &apos;BlockCacheSummaryEntry&apos; is intended to be is an entry in the summary.&lt;/p&gt;

&lt;p&gt;Is BlockCacheTableCfSummary a better class name?&lt;/p&gt;

&lt;p&gt;2.	RegionServer returning Lists&lt;/p&gt;

&lt;p&gt;Can the interface do this?  I thought that everything returned had to implement Writable.  If RegionServers can return Lists, then I think that&apos;s a better structure.&lt;/p&gt;

&lt;p&gt;3.	Eclipse-generated methods&lt;/p&gt;

&lt;p&gt;Equals, hashcode, and the writable signature (e.g., arg0), and toString were all generated by Eclipse.  &lt;/p&gt;

&lt;p&gt;4.	Cost of method&lt;/p&gt;

&lt;p&gt;Yeah, this is not an inexpensive operation, but adding that method to FsUtils was the only way I could find getting the lookup from StoreFile to CF/Table.  That could be cached, but there are all sorts of issues with cache invalidation every times a new store-file is written.  &lt;/p&gt;

&lt;p&gt;5.    Default Values&lt;/p&gt;

&lt;p&gt;JD told me that BlockCacheSummaryEntry should have those with default values for the purpose of serialization (same for default constructor)!       &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13087474" author="stack" created="Fri, 19 Aug 2011 03:02:34 +0000"  >&lt;p&gt;On 1., BlockCacheColumnFamilySummary?  CF needs the table to qualify it but scope is column family?&lt;/p&gt;

&lt;p&gt;On 2., Normally that is so but looking in the Interfaces, e.g. HRegionInterface.java, I see that some methods take Lists.&lt;/p&gt;

&lt;p&gt;This is the class that does the serialization: src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java&lt;/p&gt;

&lt;p&gt;It seems to do some special stuff to do a List.&lt;/p&gt;

&lt;p&gt;Presumes List of Writables.&lt;/p&gt;

&lt;p&gt;On 3., Yeah.  That was obvious (smile).&lt;/p&gt;

&lt;p&gt;On 4., Yes.  You thing it will be invoked frequently?&lt;/p&gt;

&lt;p&gt;On 5., Hmm... yeah, or just check for null when serializing.&lt;/p&gt;

&lt;p&gt;Good stuff.&lt;/p&gt;</comment>
                            <comment id="13087475" author="stack" created="Fri, 19 Aug 2011 03:02:38 +0000"  >&lt;p&gt;On 1., BlockCacheColumnFamilySummary?  CF needs the table to qualify it but scope is column family?&lt;/p&gt;

&lt;p&gt;On 2., Normally that is so but looking in the Interfaces, e.g. HRegionInterface.java, I see that some methods take Lists.&lt;/p&gt;

&lt;p&gt;This is the class that does the serialization: src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java&lt;/p&gt;

&lt;p&gt;It seems to do some special stuff to do a List.&lt;/p&gt;

&lt;p&gt;Presumes List of Writables.&lt;/p&gt;

&lt;p&gt;On 3., Yeah.  That was obvious (smile).&lt;/p&gt;

&lt;p&gt;On 4., Yes.  You thing it will be invoked frequently?&lt;/p&gt;

&lt;p&gt;On 5., Hmm... yeah, or just check for null when serializing.&lt;/p&gt;

&lt;p&gt;Good stuff.&lt;/p&gt;</comment>
                            <comment id="13087670" author="dmeil" created="Fri, 19 Aug 2011 12:10:34 +0000"  >&lt;p&gt;Thanks Stack!&lt;/p&gt;

&lt;p&gt;1.  I&apos;ll change the class to BlockCacheColumnFamilySummary, and the RS and BlockCache method to getBlockCacheColumnFamilySummary (instead of getBlockCacheSummary).  It&apos;s more verbose, but I think it helps the conceptual clarity.&lt;/p&gt;

&lt;p&gt;2.  List vs. array.  Knowing now that Lists are allowed in RS interfaces, I&apos;ll change the RS interface to List.  The only reason I returned an array was that I didn&apos;t think it was supported.  &lt;/p&gt;

&lt;p&gt;3.  Since this is auto-generated code, leave it alone?  &lt;/p&gt;

&lt;p&gt;4.  This would be the backing method to the new web-page (another sub-task) to present this data.  I think it&apos;s &quot;low frequency access.&quot;  One option if this becomes an issue is to cache the result in the RS with a timestamp of when it was last calculated.  And basically don&apos;t allow the RS to do a summary of this less than 30 seconds or so.  I&apos;d rather do that than trying to introduce any StoreFile caching in FsUtils.&lt;/p&gt;

&lt;p&gt;Good point about adding the potential expense of the method in the Javadoc.&lt;/p&gt;

&lt;p&gt;5.  If it&apos;s ok with everybody, I&apos;d rather leave this one alone too.&lt;/p&gt;</comment>
                            <comment id="13087914" author="dmeil" created="Fri, 19 Aug 2011 19:38:51 +0000"  >&lt;p&gt;Ok, v4 patch with requested changes.  The only part I feel like I&apos;m between a rock and a hard place is the line-breaks.  One one hand, you guys are saying &quot;don&apos;t do long lines&quot; - fair enough.  But on the other hand you don&apos;t like the line-breaking, and I don&apos;t see how the way I&apos;m breaking is much different from the way anybody else is doing it.&lt;/p&gt;

&lt;p&gt;All the big stuff is taken care of though.  BlockCacheSummaryEntry renamed to BlockCacheColumnFamilySummary.  Method renamed to getBlockCacheColumnFamilySummary as well.  &lt;/p&gt;

&lt;p&gt;Expanded Javadoc to include more verbiage on the cost of method (e.g., will do FS scan, etc.) and other places as mentioned.&lt;/p&gt;

&lt;p&gt;Fingers crossed!&lt;/p&gt;</comment>
                            <comment id="13087923" author="dmeil" created="Fri, 19 Aug 2011 19:59:20 +0000"  >&lt;p&gt;Also, RS interface changed to return List instead of array.&lt;/p&gt;</comment>
                            <comment id="13087948" author="stack" created="Fri, 19 Aug 2011 20:30:57 +0000"  >&lt;p&gt;On 3., you can&apos;t use &apos;auto-gen&apos; as excuse (smile).  Fix your templates so &apos;auto-gen&apos; does right thing or fix the auto-gen&apos;d stuff.  Else all the rest of your changes seem good.&lt;/p&gt;</comment>
                            <comment id="13087956" author="dmeil" created="Fri, 19 Aug 2011 20:38:40 +0000"  >&lt;p&gt;Fair enough.  In my defense, I did change writable methods to use &apos;arg&apos; instead of &apos;arg0&apos; in this patch.&lt;/p&gt;

&lt;p&gt;What else is left?&lt;/p&gt;</comment>
                            <comment id="13088307" author="yuzhihong@gmail.com" created="Sun, 21 Aug 2011 03:50:35 +0000"  >&lt;p&gt;Patch version 4 is in a commit-table state. &lt;/p&gt;

&lt;p&gt;Minor comments:&lt;br/&gt;
In BlockCache:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;BlockCacheColumnFamilySummary&amp;gt; getBlockCacheColumnFamilySummary(Configuration conf) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think getBlockCacheColumnFamilySummaries might be a better name.&lt;/p&gt;

&lt;p&gt;For HRegionInterface:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Performs a BlockCache summary and returns a List of BlockCacheColumnFamily objects.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;BlockCacheColumnFamilySummary objects are returned. Again, the method name should pluralize Summaries.&lt;/p&gt;

&lt;p&gt;Good work, Doug.&lt;/p&gt;</comment>
                            <comment id="13089069" author="yuzhihong@gmail.com" created="Mon, 22 Aug 2011 22:10:39 +0000"  >&lt;p&gt;Patch version 5 changes parameter arg to in/out for readFields()/write()&lt;/p&gt;</comment>
                            <comment id="13089104" author="jdcryans" created="Mon, 22 Aug 2011 22:44:15 +0000"  >&lt;p&gt;Still +1, good work!&lt;/p&gt;</comment>
                            <comment id="13089121" author="yuzhihong@gmail.com" created="Mon, 22 Aug 2011 22:59:17 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Doug.&lt;br/&gt;
Thanks for the review Stack and J-D.&lt;/p&gt;</comment>
                            <comment id="13089229" author="hudson" created="Tue, 23 Aug 2011 02:40:01 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2131 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2131/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2131/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4199&quot; title=&quot;blockCache summary - backend&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4199&quot;&gt;&lt;del&gt;HBASE-4199&lt;/del&gt;&lt;/a&gt;  blockCache summary - backend (Doug Meil)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/SimpleBlockCache.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/BlockCacheColumnFamilySummary.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/BlockCache.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestStoreFileBlockCacheSummary.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/hfile/TestBlockCacheColumnFamilySummary.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14025941" author="stack" created="Mon, 9 Jun 2014 23:50:12 +0000"  >&lt;p&gt;This was never hooked up unfortunately.  Removed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4809&quot; title=&quot;Per-CF set RPC metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4809&quot;&gt;&lt;del&gt;HBASE-4809&lt;/del&gt;&lt;/a&gt; commit.&lt;/p&gt;</comment>
                            <comment id="15016196" author="lars_francke" created="Fri, 20 Nov 2015 11:54:19 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12491274" name="4199.v5" size="27524" author="yuzhihong@gmail.com" created="Mon, 22 Aug 2011 22:10:39 +0000"/>
                            <attachment id="12490358" name="java_HBASE_4199.patch" size="24811" author="dmeil" created="Sat, 13 Aug 2011 21:44:56 +0000"/>
                            <attachment id="12490496" name="java_HBASE_4199_v2.patch" size="25527" author="dmeil" created="Tue, 16 Aug 2011 00:55:19 +0000"/>
                            <attachment id="12490670" name="java_HBASE_4199_v3.patch" size="25577" author="dmeil" created="Wed, 17 Aug 2011 16:33:38 +0000"/>
                            <attachment id="12490993" name="java_HBASE_4199_v4.patch" size="27505" author="dmeil" created="Fri, 19 Aug 2011 19:38:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 14 Aug 2011 16:01:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hpun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>