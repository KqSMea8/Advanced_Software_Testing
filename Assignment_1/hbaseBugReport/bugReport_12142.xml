<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:30:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12142/HBASE-12142.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12142] Truncate command does not preserve ACLs table</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12142</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The current truncate command does not preserve acls on a table. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12745323">HBASE-12142</key>
            <summary>Truncate command does not preserve ACLs table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="avandana">Vandana Ayyalasomayajula</assignee>
                                    <reporter username="avandana">Vandana Ayyalasomayajula</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Wed, 1 Oct 2014 18:50:06 +0000</created>
                <updated>Sat, 21 Feb 2015 23:45:56 +0000</updated>
                            <resolved>Tue, 4 Nov 2014 03:32:00 +0000</resolved>
                                    <version>0.98.6</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.8</fixVersion>
                    <fixVersion>0.99.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="14155296" author="yuzhihong@gmail.com" created="Wed, 1 Oct 2014 18:56:48 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-    requirePermission(&lt;span class=&quot;code-quote&quot;&gt;&quot;truncateTable&quot;&lt;/span&gt;, tableName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Action.ADMIN, Action.CREATE);
+    requirePermission(&lt;span class=&quot;code-quote&quot;&gt;&quot;truncateTable&quot;&lt;/span&gt;, tableName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Action.ADMIN);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is dropping Action.CREATE intentional ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    shouldPreserveAcls = conf.getBoolean(AccessControlConstants.PRESERVE_ACLS_ON_TRUNCATE, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Where is the above variable used ?&lt;/p&gt;</comment>
                            <comment id="14155297" author="mbertozzi" created="Wed, 1 Oct 2014 18:58:53 +0000"  >&lt;p&gt;Looks ok to me, &lt;br/&gt;
should we batch the reinsertion? (just an optimization so we can do that later)&lt;br/&gt;
another consideration is that one problem that we have with the coprocessor is that you don&apos;t get a failure event, so in this case you&apos;ll end up with the acl map referencing the acls for the failed operation until the next retry.&lt;/p&gt;</comment>
                            <comment id="14155464" author="avandana" created="Wed, 1 Oct 2014 20:40:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; yes, the change is intentional, for the two reasons, (1) once a table is created, we grant all &quot;RWXCA&quot; perms to the user who created it. So I think its fair to assume that in most of the cases, a user who wants to truncate a table will be its admin, (2) To read acls of a table, the user need to be admin.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; Yes, thats a valid point that we don&apos;t have a failure event. I used a weak hash map, so that the objects are collected by GC, if they remain long enough.  &lt;/p&gt;</comment>
                            <comment id="14155563" author="apurtell" created="Wed, 1 Oct 2014 21:23:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I think its fair to assume that in most of the cases, a user who wants to truncate a table will be its admin, (2) To read acls of a table, the user need to be admin.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think it&apos;s correct to make that assumption. Admins can delegate perms. On the other hand, this is splitting hairs and truncate is a very disruptive operation, so the change is fine on that merit IMHO.&lt;/p&gt;</comment>
                            <comment id="14156305" author="anoop.hbase" created="Thu, 2 Oct 2014 10:32:51 +0000"  >&lt;p&gt;Why we need a config based approach?  When truncate should remove the ACLs for a table?&lt;/p&gt;</comment>
                            <comment id="14156769" author="avandana" created="Thu, 2 Oct 2014 17:11:27 +0000"  >&lt;p&gt;I meant to use the config variable to retain old behavior if needed. If you think its unnecessary, lets remove the config variable and restore acls in all cases.&lt;/p&gt;</comment>
                            <comment id="14159006" author="anoop.hbase" created="Sat, 4 Oct 2014 06:59:32 +0000"  >&lt;p&gt;IMO config is not needed. This is a bug fix. The truncate is not supposed to remove the table ACLs.&lt;/p&gt;</comment>
                            <comment id="14162125" author="avandana" created="Tue, 7 Oct 2014 17:06:03 +0000"  >&lt;p&gt;The latest patch removed the config parameter.&lt;/p&gt;</comment>
                            <comment id="14165156" author="avandana" created="Thu, 9 Oct 2014 14:07:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; &amp;#8211; Any chance to review the latest patch ? Thanks for your time.&lt;/p&gt;</comment>
                            <comment id="14165264" author="mbertozzi" created="Thu, 9 Oct 2014 15:31:23 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14165931" author="stack" created="Thu, 9 Oct 2014 22:56:41 +0000"  >&lt;p&gt;Applied to master branch only.  I tried backporting but the new test fails when I run it so skipping for now.  Maybe you want to look at this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avandana&quot; class=&quot;user-hover&quot; rel=&quot;avandana&quot;&gt;Vandana Ayyalasomayajula&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Tests run: 47, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 100.759 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  testTruncatePerms(org.apache.hadoop.hbase.security.access.TestAccessController): org.apache.hadoop.hbase.TableNotEnabledException: testTruncatePerms is disabled.&lt;/p&gt;</comment>
                            <comment id="14165936" author="avandana" created="Thu, 9 Oct 2014 22:58:59 +0000"  >&lt;p&gt;On which branch did it fail ? &lt;/p&gt;</comment>
                            <comment id="14165964" author="hadoopqa" created="Thu, 9 Oct 2014 23:13:18 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12673385/HBASE-12142_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12673385/HBASE-12142_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12673385&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.hbase.regionserver.wal.TestHLogSplit.testSplitWillFailIfWritingToRegionFails(TestHLogSplit.java:734)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11294//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14165998" author="stack" created="Thu, 9 Oct 2014 23:37:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avandana&quot; class=&quot;user-hover&quot; rel=&quot;avandana&quot;&gt;Vandana Ayyalasomayajula&lt;/a&gt; I tried backporting to branch-1 and the test would fail for me.&lt;/p&gt;</comment>
                            <comment id="14166085" author="hudson" created="Fri, 10 Oct 2014 00:46:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5643 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5643/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5643/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12142&quot; title=&quot;Truncate command does not preserve ACLs table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12142&quot;&gt;&lt;del&gt;HBASE-12142&lt;/del&gt;&lt;/a&gt; Truncate command does not preserve ACLs table (Vandana Ayyalasomayajula) (stack: rev 5420b4c78bd156296e5f02ca6639afdd2b4762a1)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/access/AccessController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14166250" author="apurtell" created="Fri, 10 Oct 2014 03:48:30 +0000"  >&lt;p&gt;Reopening for branch-1 and 0.98&lt;/p&gt;</comment>
                            <comment id="14166299" author="apurtell" created="Fri, 10 Oct 2014 03:49:57 +0000"  >&lt;p&gt;Working on resolving the TestAccessController issues&lt;/p&gt;</comment>
                            <comment id="14166356" author="apurtell" created="Fri, 10 Oct 2014 04:00:56 +0000"  >&lt;p&gt;The test doesn&apos;t look right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avandana&quot; class=&quot;user-hover&quot; rel=&quot;avandana&quot;&gt;Vandana Ayyalasomayajula&lt;/a&gt;. Does HBaseTestingUtility.truncateTable do what you expect? The shell will disable a table then delete it, then create it again. HTU.truncateTable instead opens a scanner, reads every row key, and drops tombstones row-by-row . It can&apos;t possibly work after we&apos;ve just disabled the table. If the test passes on master, something&apos;s wrong with master. &lt;/p&gt;</comment>
                            <comment id="14166434" author="avandana" created="Fri, 10 Oct 2014 06:10:43 +0000"  >&lt;p&gt;Patch for branch-1. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; You are right, When I used the admin API, the test passed. I will create an addendum patch for master. &lt;/p&gt;</comment>
                            <comment id="14166451" author="avandana" created="Fri, 10 Oct 2014 06:22:20 +0000"  >&lt;p&gt;Patch for fixing unit test for master.&lt;/p&gt;</comment>
                            <comment id="14166468" author="avandana" created="Fri, 10 Oct 2014 06:54:28 +0000"  >&lt;p&gt;For 98 branch, there is no truncate API in the admin. So the acls need to be added in the ruby script. I will upload a patch soon.&lt;/p&gt;</comment>
                            <comment id="14166986" author="stack" created="Fri, 10 Oct 2014 15:31:38 +0000"  >&lt;p&gt;Master branch just failed with this: &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5646/testReport/org.apache.hadoop.hbase.security.access/TestAccessController/testPermissionList/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5646/testReport/org.apache.hadoop.hbase.security.access/TestAccessController/testPermissionList/&lt;/a&gt;  ... which is a different test but could fali be related?&lt;/p&gt;</comment>
                            <comment id="14167126" author="apurtell" created="Fri, 10 Oct 2014 17:07:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;For 98 branch, there is no truncate API in the admin. So the acls need to be added in the ruby script&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please port just that necessary part of the admin API. We should avoid implementing any significant admin functionality exclusively in the shell. As long as we are only adding a new method to an interface the change is compatible. &lt;/p&gt;</comment>
                            <comment id="14167135" author="apurtell" created="Fri, 10 Oct 2014 17:12:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Master branch just failed with this: &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5646/testReport/org.apache.hadoop.hbase.security.access/TestAccessController/testPermissionList/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5646/testReport/org.apache.hadoop.hbase.security.access/TestAccessController/testPermissionList/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, that failed because:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-10-10 09:00:03,829 WARN  [MASTER_TABLE_OPERATIONS-hemera:46872-0] access.AccessController(907): Not adding owner permission for table testPermissionList. hbase:acl is not yet created. AccessController should be configured as the first Coprocessor
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll open an issue for that.&lt;/p&gt;</comment>
                            <comment id="14167221" author="avandana" created="Fri, 10 Oct 2014 18:03:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; Should we consider backporting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8332&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-8332&lt;/a&gt; to 98 branch ? Then we can use the patch available in this JIRA directly.&lt;/p&gt;</comment>
                            <comment id="14167268" author="apurtell" created="Fri, 10 Oct 2014 18:32:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should we consider backporting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8332&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-8332&lt;/a&gt; to 98 branch ? Then we can use the patch available in this JIRA directly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds like a plan. Would you be willing to do this? If so, the shell should gracefully fall back to doing things manually if the new admin API isn&apos;t available, if a newer shell is talking to an older master. I think it&apos;s fine to print a warning in the old manual truncate shell code that ACLs won&apos;t be preserved, so there&apos;s no need to implement both the backport and carrying ACLs forward in the shell code.&lt;/p&gt;</comment>
                            <comment id="14167293" author="avandana" created="Fri, 10 Oct 2014 18:49:59 +0000"  >&lt;p&gt;I will do it.. Let me come up with a patch soon.&lt;/p&gt;</comment>
                            <comment id="14180228" author="avandana" created="Wed, 22 Oct 2014 17:45:48 +0000"  >&lt;p&gt;Patch for 98 branch. &lt;/p&gt;</comment>
                            <comment id="14180241" author="hadoopqa" created="Wed, 22 Oct 2014 17:52:42 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12676375/HBASE-12142_98.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12676375/HBASE-12142_98.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12676375&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11439//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11439//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14180822" author="apurtell" created="Thu, 23 Oct 2014 00:40:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Patch for 98 branch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The client changes look ok.&lt;/p&gt;

&lt;p&gt;The new coprocessor hooks look good to me. These will have to be applied in branch-1 and master too for consistency, assuming that is not a problem, ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;The refactoring changes to CreateTableHandler and DeleteTableHandler seem extraneous to the issue at hand and make me nervous. I&apos;m assuming these changes came in when porting the patch that introduced TruncateTableHandler on master but rather than port the wider set of changes to 0.98 can we port TruncateTableHandler to what exists already in 0.98? &lt;/p&gt;</comment>
                            <comment id="14180840" author="avandana" created="Thu, 23 Oct 2014 00:54:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; The coprocessor hooks are already there in branch-1 I think, as the patch for branch-1 is already in place. Your concern about create and delete handler is valid. I think I should not touch those pieces unnecessarily. Let me upload a new patch.&lt;/p&gt;</comment>
                            <comment id="14180969" author="enis" created="Thu, 23 Oct 2014 03:31:02 +0000"  >&lt;p&gt;It is hard to parse the addendum contents than the 8332 contents in the 0.98 patch. Which parts would have to be applied to branch-1 and master? &lt;/p&gt;</comment>
                            <comment id="14181691" author="apurtell" created="Thu, 23 Oct 2014 18:14:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Which parts would have to be applied to branch-1 and master?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;None it seems, I was looking at the 0.98 patch&lt;/p&gt;</comment>
                            <comment id="14181695" author="apurtell" created="Thu, 23 Oct 2014 18:14:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Let me upload a new patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avandana&quot; class=&quot;user-hover&quot; rel=&quot;avandana&quot;&gt;Vandana Ayyalasomayajula&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14181716" author="avandana" created="Thu, 23 Oct 2014 18:26:50 +0000"  >&lt;p&gt;Patch without any changes to create and delete table handlers. &lt;/p&gt;</comment>
                            <comment id="14181733" author="hadoopqa" created="Thu, 23 Oct 2014 18:33:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12676659/HBASE-12142_98_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12676659/HBASE-12142_98_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12676659&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11454//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11454//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14183501" author="apurtell" created="Fri, 24 Oct 2014 21:12:15 +0000"  >&lt;p&gt;Looks good. Let me put up another 0.98 patch in a sec that adds the tests from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8332&quot; title=&quot;Add truncate as HMaster method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8332&quot;&gt;&lt;del&gt;HBASE-8332&lt;/del&gt;&lt;/a&gt; also. &lt;/p&gt;</comment>
                            <comment id="14183508" author="apurtell" created="Fri, 24 Oct 2014 21:15:12 +0000"  >&lt;p&gt;Hey, look at that, you already did &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14183511" author="apurtell" created="Fri, 24 Oct 2014 21:15:54 +0000"  >&lt;p&gt;Going to commit to 0.98 shortly unless objection&lt;/p&gt;</comment>
                            <comment id="14183833" author="apurtell" created="Sat, 25 Oct 2014 01:10:22 +0000"  >&lt;p&gt;Pushed to 0.98.&lt;/p&gt;

&lt;p&gt;There is an impact to the running time of TestAdmin so I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12344&quot; title=&quot;Split up TestAdmin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12344&quot;&gt;&lt;del&gt;HBASE-12344&lt;/del&gt;&lt;/a&gt; for followup. &lt;/p&gt;

&lt;p&gt;We&apos;re still missing a commit to branch-1 before this issue can be resolved. Refreshed the branch-1 patch. The test passes locally for me.  Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;, for real this time. &lt;/p&gt;</comment>
                            <comment id="14183834" author="hadoopqa" created="Sat, 25 Oct 2014 01:12:38 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12677072/HBASE-12142_branch_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12677072/HBASE-12142_branch_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12677072&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11465//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11465//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14183872" author="avandana" created="Sat, 25 Oct 2014 02:35:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; The patch for branch-1 is already attached to the jira.I think you should be able to apply that directly.&lt;/p&gt;</comment>
                            <comment id="14183875" author="apurtell" created="Sat, 25 Oct 2014 02:39:51 +0000"  >&lt;p&gt;No it did not apply. TestAccessController needed a small fix up. &lt;/p&gt;</comment>
                            <comment id="14183889" author="hudson" created="Sat, 25 Oct 2014 03:11:35 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #631 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/631/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/631/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12142&quot; title=&quot;Truncate command does not preserve ACLs table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12142&quot;&gt;&lt;del&gt;HBASE-12142&lt;/del&gt;&lt;/a&gt; Truncate command does not preserve ACLs table (Vandana Ayyalasomayajula) (apurtell: rev 5b1380c3c691007625d624096f57559124518288)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;hbase-shell/src/main/ruby/hbase/admin.rb&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;hbase-protocol/src/main/java/org/apache/hadoop/hbase/protobuf/generated/MasterProtos.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/protobuf/RequestConverter.java&lt;/li&gt;
	&lt;li&gt;hbase-protocol/src/main/protobuf/Master.proto&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/util/ModifyRegionUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/TruncateTableHandler.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/access/AccessController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14183980" author="hudson" created="Sat, 25 Oct 2014 05:29:55 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #601 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/601/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/601/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12142&quot; title=&quot;Truncate command does not preserve ACLs table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12142&quot;&gt;&lt;del&gt;HBASE-12142&lt;/del&gt;&lt;/a&gt; Truncate command does not preserve ACLs table (Vandana Ayyalasomayajula) (apurtell: rev 5b1380c3c691007625d624096f57559124518288)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/util/ModifyRegionUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-protocol/src/main/protobuf/Master.proto&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;hbase-protocol/src/main/java/org/apache/hadoop/hbase/protobuf/generated/MasterProtos.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/TruncateTableHandler.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/protobuf/RequestConverter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/access/AccessController.java&lt;/li&gt;
	&lt;li&gt;hbase-shell/src/main/ruby/hbase/admin.rb&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14187099" author="apurtell" created="Tue, 28 Oct 2014 17:00:40 +0000"  >&lt;p&gt;Pushed to branch-1 also so this issue can be resolved&lt;/p&gt;</comment>
                            <comment id="14187238" author="avandana" created="Tue, 28 Oct 2014 18:33:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; Thanks for the quick reviews.&lt;/p&gt;</comment>
                            <comment id="14187278" author="hudson" created="Tue, 28 Oct 2014 18:51:37 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #372 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/372/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/372/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12142&quot; title=&quot;Truncate command does not preserve ACLs table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12142&quot;&gt;&lt;del&gt;HBASE-12142&lt;/del&gt;&lt;/a&gt; Truncate command does not preserve ACLs table (Vandana Ayyalasomayajula) (apurtell: rev 81c4caf1f1ded4132339f4c7de17ce48725d81e5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/access/TestAccessController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/access/AccessController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14195604" author="apurtell" created="Tue, 4 Nov 2014 02:41:37 +0000"  >&lt;p&gt;Truncation is not working correctly, at least when testing 0.98.8-SNAPSHOT on a single master single slave cluster.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;./bin/hbase ltt -init_only&lt;/li&gt;
	&lt;li&gt;./bin/hbase shell&lt;br/&gt;
&amp;gt; truncate &apos;cluster_test&apos;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;TruncateTableHandler runs and claims to create table info, but it might not be moving the file into the right place:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-11-04 02:30:23,653 DEBUG [FifoRpcScheduler.handler1-thread-18] handler.TruncateTableHandler: Table &apos;cluster_test&apos; archived!
2014-11-04 02:30:23,679 DEBUG [FifoRpcScheduler.handler1-thread-18] util.FSTableDescriptors: Wrote descriptor into: hdfs://ip-10-33-129-9.us-west-2.compute.internal:8020/hbase/.tmp/.tabledesc/.tableinfo.0000000001
2014-11-04 02:30:23,680 INFO  [FifoRpcScheduler.handler1-thread-18] handler.TruncateTableHandler: Truncate will not preserve the regions
2014-11-04 02:30:23,681 INFO  [RegionOpenAndInitThread-cluster_test-1] regionserver.HRegion: creating HRegion cluster_test HTD == &apos;cluster_test&apos;, {TABLE_ATTRIBUTES =&amp;gt; {DURABILITY =&amp;gt; &apos;USE_DEFAULT&apos;}, {NAME =&amp;gt; &apos;test_cf&apos;, DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;, BLOOMFILTER =&amp;gt; &apos;ROW&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;1&apos;, TTL =&amp;gt; &apos;FOREVER&apos;, MIN_VERSIONS =&amp;gt; &apos;0&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;false&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, BLOCKCACHE =&amp;gt; &apos;true&apos;} RootDir = hdfs://ip-10-33-129-9.us-west-2.compute.internal:8020/hbase/.tmp Table name == cluster_test
2014-11-04 02:30:23,703 DEBUG [RegionOpenAndInitThread-cluster_test-1] regionserver.HRegion: Instantiated cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.
2014-11-04 02:30:23,703 DEBUG [RegionOpenAndInitThread-cluster_test-1] regionserver.HRegion: Closing cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.: disabling compactions &amp;amp; flushes
2014-11-04 02:30:23,703 DEBUG [RegionOpenAndInitThread-cluster_test-1] regionserver.HRegion: Updates disabled for region cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.
2014-11-04 02:30:23,703 INFO  [RegionOpenAndInitThread-cluster_test-1] regionserver.HRegion: Closed cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.
2014-11-04 02:30:23,707 INFO  [FifoRpcScheduler.handler1-thread-18] catalog.MetaEditor: Added 1
2014-11-04 02:30:23,708 DEBUG [FifoRpcScheduler.handler1-thread-18] master.AssignmentManager: Assigning 1 region(s) to ip-10-204-3-67.us-west-2.compute.internal,8120,1415068107305
2014-11-04 02:30:23,708 DEBUG [FifoRpcScheduler.handler1-thread-18] zookeeper.ZKAssign: master:8100-0x149780b006a010a, quorum=ip-10-33-129-9.us-west-2.compute.internal:2181, baseZNode=/hbase Async create of unassigned node c23e76525f0f025d51f74006db7903e2 with OFFLINE state
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the region will fail to open&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-11-04 02:30:23,738 DEBUG [main-EventThread] zookeeper.ZooKeeperWatcher: master:8100-0x149780b006a010a, quorum=ip-10-33-129-9.us-west-2.compute.internal:2181, baseZNode=/hbase Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/region-in-transition/c23e76525f0f025d51f74006db7903e2
2014-11-04 02:30:23,738 DEBUG [AM.ZK.Worker-pool2-t14] master.AssignmentManager: Handling RS_ZK_REGION_FAILED_OPEN, server=ip-10-204-3-67.us-west-2.compute.internal,8120,1415068107305, region=c23e76525f0f025d51f74006db7903e2, current_state={c23e76525f0f025d51f74006db7903e2 state=OPENING, ts=1415068223734, server=ip-10-204-3-67.us-west-2.compute.internal,8120,1415068107305}
2014-11-04 02:30:23,738 INFO  [AM.ZK.Worker-pool2-t14] master.RegionStates: Transition {c23e76525f0f025d51f74006db7903e2 state=OPENING, ts=1415068223734, server=ip-10-204-3-67.us-west-2.compute.internal,8120,1415068107305} to {c23e76525f0f025d51f74006db7903e2 state=CLOSED, ts=1415068223738, server=ip-10-204-3-67.us-west-2.compute.internal,8120,1415068107305}
2014-11-04 02:30:23,738 WARN  [AM.ZK.Worker-pool2-t14] master.AssignmentManager: Can&apos;t move c23e76525f0f025d51f74006db7903e2, there is no destination server available.
2014-11-04 02:30:23,739 DEBUG [AM.ZK.Worker-pool2-t14] handler.ClosedRegionHandler: Handling CLOSED event for c23e76525f0f025d51f74006db7903e2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because this is happening on the RegionServer side:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-11-04 02:30:23,704 INFO  [PriorityRpcServer.handler=16,queue=0,port=8120] regionserver.HRegionServer: Open cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.
2014-11-04 02:30:23,717 DEBUG [PriorityRpcServer.handler=16,queue=0,port=8120] util.FSTableDescriptors: Exception during readTableDecriptor. Current table name = cluster_test
org.apache.hadoop.hbase.TableInfoMissingException: No table descriptor file under hdfs://ip-10-33-129-9.us-west-2.compute.internal:8020/hbase/data/default/cluster_test
	at org.apache.hadoop.hbase.util.FSTableDescriptors.getTableDescriptorFromFs(FSTableDescriptors.java:510)
	at org.apache.hadoop.hbase.util.FSTableDescriptors.getTableDescriptorFromFs(FSTableDescriptors.java:487)
	at org.apache.hadoop.hbase.util.FSTableDescriptors.get(FSTableDescriptors.java:173)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.openRegion(HRegionServer.java:3826)
	at org.apache.hadoop.hbase.protobuf.generated.AdminProtos$AdminService$2.callBlockingMethod(AdminProtos.java:20164)
	at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2027)
	at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:108)
	at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:110)
	at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:90)
	at java.lang.Thread.run(Thread.java:745)
2014-11-04 02:30:23,719 DEBUG [RS_OPEN_REGION-ip-10-204-3-67:8120-2] zookeeper.ZKAssign: regionserver:8120-0x149780b006a0105, quorum=ec2-54-71-67-141.us-west-2.compute.amazonaws.com:2181, baseZNode=/hbase Transitioning c23e76525f0f025d51f74006db7903e2 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING
2014-11-04 02:30:23,723 DEBUG [RS_OPEN_REGION-ip-10-204-3-67:8120-2] zookeeper.ZKAssign: regionserver:8120-0x149780b006a0105, quorum=ec2-54-71-67-141.us-west-2.compute.amazonaws.com:2181, baseZNode=/hbase Transitioned node c23e76525f0f025d51f74006db7903e2 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING
2014-11-04 02:30:23,723 DEBUG [RS_OPEN_REGION-ip-10-204-3-67:8120-2] regionserver.HRegion: Opening region: {ENCODED =&amp;gt; c23e76525f0f025d51f74006db7903e2, NAME =&amp;gt; &apos;cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;}
2014-11-04 02:30:23,723 ERROR [RS_OPEN_REGION-ip-10-204-3-67:8120-2] handler.OpenRegionHandler: Failed open of region=cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2., starting to roll back the global memstore size.
java.lang.IllegalStateException: Could not instantiate a region instance.
	at org.apache.hadoop.hbase.regionserver.HRegion.newHRegion(HRegion.java:4266)
	at org.apache.hadoop.hbase.regionserver.HRegion.openHRegion(HRegion.java:4574)
	at org.apache.hadoop.hbase.regionserver.HRegion.openHRegion(HRegion.java:4547)
	at org.apache.hadoop.hbase.regionserver.HRegion.openHRegion(HRegion.java:4503)
	at org.apache.hadoop.hbase.regionserver.HRegion.openHRegion(HRegion.java:4454)
	at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.openRegion(OpenRegionHandler.java:482)
	at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.process(OpenRegionHandler.java:145)
	at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:128)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)
	at org.apache.hadoop.hbase.regionserver.HRegion.newHRegion(HRegion.java:4263)
	... 10 more
Caused by: java.lang.IllegalArgumentException: Need table descriptor
	at org.apache.hadoop.hbase.regionserver.HRegion.&amp;lt;init&amp;gt;(HRegion.java:556)
	at org.apache.hadoop.hbase.regionserver.HRegion.&amp;lt;init&amp;gt;(HRegion.java:532)
	... 15 more
2014-11-04 02:30:23,724 INFO  [RS_OPEN_REGION-ip-10-204-3-67:8120-2] handler.OpenRegionHandler: Opening of region {ENCODED =&amp;gt; c23e76525f0f025d51f74006db7903e2, NAME =&amp;gt; &apos;cluster_test,,1415068223680.c23e76525f0f025d51f74006db7903e2.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;} failed, transitioning from OPENING to FAILED_OPEN in ZK, expecting version 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14195611" author="apurtell" created="Tue, 4 Nov 2014 02:45:33 +0000"  >&lt;p&gt;Let&apos;s decide if we want an amendment, a revert and (re)commit of a fixed version, or just a revert for now. Unless this can be very quickly addressed I&apos;m inclined to revert the 0.98 change and then see what happens with this issue after the .8 release.&lt;/p&gt;</comment>
                            <comment id="14195651" author="esteban" created="Tue, 4 Nov 2014 03:27:40 +0000"  >&lt;p&gt;I&apos;m looking into an issue with truncate too. This was a regression I&lt;br/&gt;
introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12219&quot; title=&quot;Cache more efficiently getAll() and get() in FSTableDescriptors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12219&quot;&gt;&lt;del&gt;HBASE-12219&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;On Monday, November 3, 2014, Andrew Purtell (JIRA) &amp;lt;jira@apache.org&lt;/p&gt;



&lt;p&gt;&amp;#8211; &lt;br/&gt;
Sent from iPad&lt;/p&gt;</comment>
                            <comment id="14195657" author="apurtell" created="Tue, 4 Nov 2014 03:31:53 +0000"  >&lt;p&gt;Ah, yeah that makes sense &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=esteban&quot; class=&quot;user-hover&quot; rel=&quot;esteban&quot;&gt;Esteban Gutierrez&lt;/a&gt;. Ok I will close this again. Want a new issue for the regression?&lt;/p&gt;</comment>
                            <comment id="14195665" author="esteban" created="Tue, 4 Nov 2014 03:36:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; re-opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12219&quot; title=&quot;Cache more efficiently getAll() and get() in FSTableDescriptors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12219&quot;&gt;&lt;del&gt;HBASE-12219&lt;/del&gt;&lt;/a&gt; so I think it only needs an addendum to get the behavior right with truncate. &lt;/p&gt;</comment>
                            <comment id="14331692" author="enis" created="Sat, 21 Feb 2015 23:45:56 +0000"  >&lt;p&gt;Closing this issue after 0.99.2 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12750502">HBASE-12344</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12734733">HBASE-11769</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12672380" name="HBASE-12142_0.patch" size="6052" author="avandana" created="Wed, 1 Oct 2014 18:51:51 +0000"/>
                            <attachment id="12672579" name="HBASE-12142_1.patch" size="6152" author="avandana" created="Thu, 2 Oct 2014 17:11:27 +0000"/>
                            <attachment id="12673385" name="HBASE-12142_2.patch" size="4344" author="avandana" created="Tue, 7 Oct 2014 17:06:03 +0000"/>
                            <attachment id="12676375" name="HBASE-12142_98.patch" size="120414" author="avandana" created="Wed, 22 Oct 2014 17:45:48 +0000"/>
                            <attachment id="12676659" name="HBASE-12142_98_2.patch" size="109948" author="avandana" created="Thu, 23 Oct 2014 18:26:50 +0000"/>
                            <attachment id="12677072" name="HBASE-12142_branch_1.patch" size="4894" author="apurtell" created="Sat, 25 Oct 2014 01:10:22 +0000"/>
                            <attachment id="12674115" name="HBASE-12142_branch_1.patch" size="4298" author="avandana" created="Fri, 10 Oct 2014 06:10:43 +0000"/>
                            <attachment id="12674119" name="HBASE-12142_master_addendum.patch" size="973" author="avandana" created="Fri, 10 Oct 2014 06:22:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Oct 2014 18:56:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20p47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Prior to this change, the truncate shell command could not preserve ACLs on the table being truncated. In the 0.98 branch, this change also backports &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8332&quot; title=&quot;Add truncate as HMaster method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8332&quot;&gt;&lt;strike&gt;HBASE-8332&lt;/strike&gt;&lt;/a&gt;, which adds a master handler for table truncation and new HBaseAdmin APIs for same. &lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>