<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:59:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2117/HBASE-2117.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2117] Simple check on the master overview page if the number of currently running regionservers is unchanged.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2117</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Incidentally, it happens that some of our regionservers just stop working. The regionserver logs show some sort of termination and the affected regionserver is just removed from the master page. Besides the actual problem of the termination, what I was missing was some sort of warning (from either running client code or the master page) that some regionservers are having trouble.&lt;/p&gt;

&lt;p&gt;It seems like the Master is ok with the fact that a regionserver suddenly decides to stop. The result is that the clients depending on the data in Hbase will be presented an incomplete data set, at least as long as the failing regions are not re-assigned yet. In order to have this monitored, I decided to create a patch that exposes an extra piece of information on the master page. An &apos;OK:&apos; is presented if the current number of regionservers is unchanged since the start of the processes. An &apos;ERROR:&apos; is shown whenever the current number is not the same. What the master page does is reading the &apos;regionservers&apos; file once, and remember the number of slaves so that is can be used in the check. (So afterwards changes to this file are not supported).&lt;/p&gt;

&lt;p&gt;Perhaps this is not the right way of doing things. Please let me know if there are any existing solutions for these issues.&lt;/p&gt;

&lt;p&gt;I will attach a patch right away.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12445305">HBASE-2117</key>
            <summary>Simple check on the master overview page if the number of currently running regionservers is unchanged.</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ferdy.g">Ferdy Galema</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jan 2010 15:32:44 +0000</created>
                <updated>Tue, 20 Apr 2010 21:52:34 +0000</updated>
                            <resolved>Tue, 20 Apr 2010 21:52:34 +0000</resolved>
                                    <version>0.20.2</version>
                                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12799240" author="ferdy.g" created="Tue, 12 Jan 2010 15:41:31 +0000"  >&lt;p&gt;Set status to &apos;Patch available&apos;.&lt;/p&gt;</comment>
                            <comment id="12799286" author="stack" created="Tue, 12 Jan 2010 17:44:02 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;

&lt;p&gt;While its true that the regionserver file will usually list all members of a cluster, on occasion it may lag what is actually up and running: e.g. up on ec2, I believe the regionserver file is not in alignment with what servers make up the cluster.  So, rather than identifying the mismatch between actual cluster members and content of the regionserver file as an ERROR, rather, I&apos;d suggest it should be couched as a gentle hint that the two are not in alignment.  Admins should be able to easily ignore this message for the case where they have intentionally misaligned the two.  On the other hand, a gentle prompting could be handy reminder that a newly added regionserver needs to be added to the regionserver file if the admin wants it started as part of general cluster restart next time around.&lt;/p&gt;</comment>
                            <comment id="12799289" author="stack" created="Tue, 12 Jan 2010 17:47:19 +0000"  >&lt;p&gt;Please add apache license to head of your new class. Also add a class comment saying what your new class does.  getDiagnostics is an overly generic name for something that compares content of regionservers file to count of running nodes.  Otherwise patch looks good. &lt;/p&gt;</comment>
                            <comment id="12799366" author="ferdy.g" created="Tue, 12 Jan 2010 20:18:12 +0000"  >&lt;p&gt;Thank you for the suggestions.&lt;/p&gt;

&lt;p&gt;The patch now includes the ASF license and javadoc. The name of the method is now more specific and the diagnostic message is more subtle. Finally, the number of configured regionservers is reloaded every time the page is requested, which shouldn&apos;t be too expensive.&lt;/p&gt;</comment>
                            <comment id="12800155" author="larsgeorge" created="Thu, 14 Jan 2010 09:58:14 +0000"  >&lt;p&gt;My 2c is to use Nagios et al. Add the number of regionservers (max/current) to the hmaster metrics and use a check to verify that they are the same. If not then raise an alarm with the typical escalation. That method I could assume could be adopted by the Hadoop team for datanodes and jobtrackers. &lt;/p&gt;</comment>
                            <comment id="12801940" author="larsgeorge" created="Mon, 18 Jan 2010 20:36:36 +0000"  >&lt;p&gt;Quick update since I am currently working on JMX graphing and Nagios support for HBase, I saw that Hadoop actually has it in place, the NameNode exposes&lt;/p&gt;

&lt;p&gt;*numLiveDataNodes=INTEGER&lt;br/&gt;
*numDeadDataNodes=INTEGER&lt;/p&gt;

&lt;p&gt;which are two JMX operations querying the numbers. In Nagios this would then be checked against the known total number of nodes. I am opening an issue to add this to the HBase Master too. &lt;/p&gt;

&lt;p&gt;This is not to discourage you are slight the approach here, just saying that it has its own merits and should be available as well.&lt;/p&gt;</comment>
                            <comment id="12802142" author="ferdy.g" created="Tue, 19 Jan 2010 08:55:11 +0000"  >&lt;p&gt;Indeed, exposing those 2 metrics for Hbase (live and dead regionservers) is another approach. &lt;/p&gt;

&lt;p&gt;I was wondering though, what method whould you be using to check the number of dead regionservers?&lt;/p&gt;</comment>
                            <comment id="12802177" author="larsgeorge" created="Tue, 19 Jan 2010 10:13:17 +0000"  >&lt;p&gt;The ServerManager has this in a similar fashion&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /*
   * Set of known dead servers.  On znode expiration, servers are added here.
   * This is needed in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; of a network partitioning where the server&apos;s lease
   * expires, but the server is still running. After the network is healed,
   * and it&apos;s server logs are recovered, it will be told to call server startup
   * because by then, its regions have probably been reassigned.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; deadServers =
    Collections.synchronizedSet(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Of course this is not like checking the list of configured server from the config compared to what is live. But that might be another way to go about it.&lt;/p&gt;

&lt;p&gt;Does that make sense?&lt;/p&gt;</comment>
                            <comment id="12802255" author="ferdy.g" created="Tue, 19 Jan 2010 13:42:22 +0000"  >&lt;p&gt;I can&apos;t tell for sure whether all non-active regionservers are administrated in the field &apos;deadServers&apos;.&lt;/p&gt;

&lt;p&gt;There&apos;s always the possibility for a regionserver to shut down in a &apos;proper&apos; way, at least in such a way that the Master will not put in it&apos;s deadServers set. Also, please note the example of starting a single regionserver by hand. A check against the configuration allows for a reminder to add this newly added server to your configuration (as mentioned above by stack).&lt;/p&gt;</comment>
                            <comment id="12856990" author="larsgeorge" created="Wed, 14 Apr 2010 17:48:55 +0000"  >&lt;p&gt;I think we can close this issue as it is superseded by recent efforts to add this sort of info to ZooKeeper. I recall this being discussed on IRC or the Mailing List, this was also important to detect write failures during bulk import if a region server is lost (it shuts itself down because it &quot;loses&quot; contact to the DFS and panics) and does not flush its MemStores and &lt;b&gt;no&lt;/b&gt; WAL is used. Is there an issue for it already? &lt;/p&gt;

&lt;p&gt;Or this issue could be postponed until that info is available (make it dependent) in ZooKeeper and then adding the info is trivial?&lt;/p&gt;</comment>
                            <comment id="12859080" author="stack" created="Tue, 20 Apr 2010 21:52:34 +0000"  >&lt;p&gt;Will do via ZK.  Resolving as &quot;won&apos;t fix/won&apos;t apply this patch&quot;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12430040" name="HBASE-2117-v2.patch" size="4313" author="ferdy.g" created="Tue, 12 Jan 2010 20:18:12 +0000"/>
                            <attachment id="12430021" name="HBASE-2117.patch" size="2806" author="ferdy.g" created="Tue, 12 Jan 2010 15:36:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Jan 2010 17:44:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32416</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hghb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99932</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>