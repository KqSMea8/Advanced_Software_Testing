<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:52:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1302/HBASE-1302.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1302] When a new master comes up, regionservers should continue with their region assignments from the last master</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1302</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1205&quot; title=&quot;RegionServers should find new master when a new master comes up.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1205&quot;&gt;&lt;del&gt;HBASE-1205&lt;/del&gt;&lt;/a&gt;, we can now handle a master going down and coming up somewhere else. When this happens, the new master will scan everything and reassign all the regions, which is not ideal. Instead of doing that, we should keep the region assignments from the last master. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12421690">HBASE-1302</key>
            <summary>When a new master comes up, regionservers should continue with their region assignments from the last master</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="nitay">Nitay Joffe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Mar 2009 18:00:04 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:31 +0000</updated>
                            <resolved>Tue, 26 May 2009 18:02:24 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12694236" author="jimk" created="Tue, 31 Mar 2009 19:52:18 +0000"  >&lt;p&gt;What I would expect to happen is in Master.run() before calling startServiceThreads, the master should query ZK for known region servers and populate serversToServerInfo.&lt;/p&gt;

&lt;p&gt;In the case of a cluster that is already running, the master then needs to find out which server is serving the root region.&lt;/p&gt;

&lt;p&gt;Then, before calling startServiceThreads, it should invoke the method that recovers dead region server logs (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-698&quot; title=&quot;HLog recovery is not performed after master failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-698&quot;&gt;&lt;del&gt;HBASE-698&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
Making this issue a blocker for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-698&quot; title=&quot;HLog recovery is not performed after master failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-698&quot;&gt;&lt;del&gt;HBASE-698&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12694237" author="jimk" created="Tue, 31 Mar 2009 19:54:46 +0000"  >&lt;p&gt;In the case of an entire cluster startup, region servers should not register with ZK until after they have completed &apos;reportForDuty&apos;&lt;/p&gt;</comment>
                            <comment id="12706575" author="jdcryans" created="Wed, 6 May 2009 20:11:37 +0000"  >&lt;p&gt;I will follow jim&apos;s advices which are relatively the same as what&apos;s in the bigtable paper.&lt;/p&gt;</comment>
                            <comment id="12707047" author="jdcryans" created="Thu, 7 May 2009 19:08:41 +0000"  >&lt;p&gt;First cut on this issue, don&apos;t know if it passes the unit tests. It was used on a 4 nodes with 24 regions cluster with no stress and it was working. &lt;/p&gt;</comment>
                            <comment id="12707408" author="apurtell" created="Fri, 8 May 2009 16:40:33 +0000"  >&lt;p&gt;Testing this patch here now. (Also on a 4 node cluster.)&lt;/p&gt;</comment>
                            <comment id="12707502" author="apurtell" created="Fri, 8 May 2009 20:02:00 +0000"  >&lt;p&gt;Failover activity can happen if the cluster is restarted relatively quickly. I use a HBase ZK session timeout of 30000 (30 seconds). If I do stop-hbase.sh, wait for the master to exit, then do a start-hbase.sh within a few seconds, I see&lt;/p&gt;

&lt;p&gt;2009-05-8 19:55;36,906 INFO org.apache.hadoop.hbase.master.HMaster: This is a failover, ZK inspection begins...&lt;br/&gt;
2009-05-8 19:55;36,940 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /172.20.3.229:60020. Already tried 0 time(s).&lt;/p&gt;

&lt;p&gt;Then nothing. &lt;/p&gt;</comment>
                            <comment id="12707507" author="jdcryans" created="Fri, 8 May 2009 20:12:29 +0000"  >&lt;p&gt;Yes this is something I&apos;ve seen too. Maybe when a master shuts down cleanly it should clear up the folders in ZK?&lt;/p&gt;</comment>
                            <comment id="12707510" author="apurtell" created="Fri, 8 May 2009 20:22:27 +0000"  >&lt;p&gt;That sounds like a good idea.&lt;/p&gt;</comment>
                            <comment id="12711283" author="jdcryans" created="Wed, 20 May 2009 18:31:44 +0000"  >&lt;p&gt;Second version of the patch. The RS directory is now cleared when the master is cleanly shutting down.&lt;/p&gt;</comment>
                            <comment id="12711794" author="stack" created="Thu, 21 May 2009 20:51:49 +0000"  >&lt;p&gt;This patch is amazing.  I have a little cluster up, I kill the master..... while its down, I can scan.  I bring the master back up.  All regions stay where they were previous.  Again I can scan.  Let me do a bit more heavy-duty testing but this is eXXXXXXcellent.&lt;/p&gt;</comment>
                            <comment id="12711813" author="jdcryans" created="Thu, 21 May 2009 21:17:59 +0000"  >&lt;p&gt;Adding a link to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1445&quot; title=&quot;Add the ability to start a master from any machine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1445&quot;&gt;&lt;del&gt;HBASE-1445&lt;/del&gt;&lt;/a&gt;, you want that feature if you want multiple masters.&lt;/p&gt;</comment>
                            <comment id="12711874" author="stack" created="Thu, 21 May 2009 23:59:17 +0000"  >&lt;p&gt;+1 on this patch.&lt;/p&gt;

&lt;p&gt;I spent some testing killing master bringing it back up again after a little while and all continued without hiccup.  Commit!&lt;/p&gt;

&lt;p&gt;Only issue I ran into was when I tried to start master on another machine.  Then things got a little odd.  Had to change the master address &amp;#8211; as fellas have already speculated &amp;#8211; but then I was getting this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-05-21 23:58:28,669 [main] WARN org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Failed to create /hbase:
org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:90)
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42)
        at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:518)
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper.ensureExists(ZooKeeperWrapper.java:293)
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper.ensureParentExists(ZooKeeperWrapper.java:314)
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper.writeMasterAddress(ZooKeeperWrapper.java:402)
        at org.apache.hadoop.hbase.master.HMaster.writeAddressToZooKeeper(HMaster.java:259)
        at org.apache.hadoop.hbase.master.HMaster.&amp;lt;init&amp;gt;(HMaster.java:249)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
        at org.apache.hadoop.hbase.master.HMaster.doMain(HMaster.java:1093)
        at org.apache.hadoop.hbase.master.HMaster.main(HMaster.java:1130)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which seems wrong.  Why does it not just to assume what is under /hbase?&lt;/p&gt;</comment>
                            <comment id="12712199" author="jdcryans" created="Fri, 22 May 2009 18:32:28 +0000"  >&lt;p&gt;Stack, if you used a hbase-handled ZK instance then your zoo.cfg got this line:&lt;/p&gt;

&lt;p&gt;server.0=$&lt;/p&gt;
{hbase.master.hostname}
&lt;p&gt;:2888:3888&lt;/p&gt;

&lt;p&gt;And when you changed hbase.master.hostname in hbase-site.xml it changed it there too, so your new master tried to connect on itself. I&apos;d say that stuff is in the scope of 1357/1445. Waiting after your confirmation to commit.&lt;/p&gt;</comment>
                            <comment id="12712226" author="jdcryans" created="Fri, 22 May 2009 19:31:42 +0000"  >&lt;p&gt;I actually tried to do the same, I didn&apos;t get the &quot;failed to create&quot; exception but got this (it never stops): &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-05-22 14:59:48,126 WARN org.apache.hadoop.hbase.regionserver.HRegionServer: unable to report to master &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 445473 milliseconds - retrying
2009-05-22 14:59:49,127 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 0 time(s).
2009-05-22 14:59:50,128 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 1 time(s).
2009-05-22 14:59:51,129 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 2 time(s).
2009-05-22 14:59:52,129 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 3 time(s).
2009-05-22 14:59:53,130 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 4 time(s).
2009-05-22 14:59:54,131 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 5 time(s).
2009-05-22 14:59:55,132 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 6 time(s).
2009-05-22 14:59:56,132 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 7 time(s).
2009-05-22 14:59:57,133 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 8 time(s).
2009-05-22 14:59:58,134 INFO org.apache.hadoop.ipc.HBaseClass: Retrying connect to server: /192.168.1.81:62000. Already tried 9 time(s).
2009-05-22 14:59:58,135 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: Exceeded max retries: 10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We don&apos;t get this forever when the master is restarted on the same node because HRS.hbaseMaster is at the same place. In fact the problem is in this code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(WatchedEvent event) {
    EventType type = event.getType();
    KeeperState state = event.getState();
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Got ZooKeeper event, state: &quot;&lt;/span&gt; + state + &lt;span class=&quot;code-quote&quot;&gt;&quot;, type: &quot;&lt;/span&gt; +
              type + &lt;span class=&quot;code-quote&quot;&gt;&quot;, path: &quot;&lt;/span&gt; + event.getPath());

    &lt;span class=&quot;code-comment&quot;&gt;// Ignore events &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we&apos;re shutting down.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stopRequested.get()) {
      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Ignoring ZooKeeper event &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; shutting down&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state == KeeperState.Expired) {
      LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZooKeeper session expired&quot;&lt;/span&gt;);
      restart();
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type == EventType.NodeCreated) {
      getMaster();

      &lt;span class=&quot;code-comment&quot;&gt;// ZooKeeper watches are one time only, so we need to re-register our watch.
&lt;/span&gt;      watchMasterAddress();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see that the node is deleted but I never see it being created because we don&apos;t set a watch after a NodeDeleted tho we should because we will never know when the master comes back. This should be changed. Instead, we have set a watch when the master node is deleted and then set a watch on the folder to see when it&apos;s recreated. &lt;/p&gt;</comment>
                            <comment id="12712230" author="jdcryans" created="Fri, 22 May 2009 19:55:22 +0000"  >&lt;p&gt;Patch that fixes the NodeCreated/NodeDeleted confusion. Now I see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-05-22 15:47:32,344 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Got ZooKeeper event, state: SyncConnected, type: NodeCreated, path: /hbase/master
2009-05-22 15:47:32,345 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Read ZNode /hbase/master got 192.168.1.81:62000
2009-05-22 15:47:32,345 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Telling master at 192.168.1.81:62000 that we are up
....
....
2009-05-22 15:49:12,250 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Got ZooKeeper event, state: SyncConnected, type: NodeDeleted, path: /hbase/master
2009-05-22 15:49:12,252 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Set watcher on master address ZNode /hbase/master
2009-05-22 15:49:12,285 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Got ZooKeeper event, state: SyncConnected, type: NodeCreated, path: /hbase/master
2009-05-22 15:49:12,286 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Read ZNode /hbase/master got 192.168.1.83:62000
2009-05-22 15:49:12,286 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Telling master at 192.168.1.83:62000 that we are up
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12712765" author="stack" created="Mon, 25 May 2009 18:29:58 +0000"  >&lt;p&gt;Yes, I did as you speculated J-D.  I changed hbase-site.xml only.  And yes, I agree, we need to fix it but it belongs elsewhere.&lt;/p&gt;

&lt;p&gt;I took a quick look at patch and looks good.  I&apos;d say go ahead and commit.&lt;/p&gt;
</comment>
                            <comment id="12713167" author="jdcryans" created="Tue, 26 May 2009 18:02:24 +0000"  >&lt;p&gt;Committed in trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12398550">HBASE-698</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12426065">HBASE-1445</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12415107">HBASE-1205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12407566" name="hbase-1302-v1.patch" size="13887" author="jdcryans" created="Thu, 7 May 2009 19:08:41 +0000"/>
                            <attachment id="12408608" name="hbase-1302-v2.patch" size="15145" author="jdcryans" created="Wed, 20 May 2009 18:31:44 +0000"/>
                            <attachment id="12408836" name="hbase-1302-v3.patch" size="15420" author="jdcryans" created="Fri, 22 May 2009 19:55:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 31 Mar 2009 19:52:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hchj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99285</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>