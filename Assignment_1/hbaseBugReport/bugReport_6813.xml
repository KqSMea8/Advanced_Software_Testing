<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:40:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6813/HBASE-6813.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6813] Optimise the time spent holding the updateLock under log roll</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6813</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Log roll entails syncing the old log, closing it and creating a new log file.&lt;/p&gt;

&lt;p&gt;We currently do all the 3 steps while holding the updateLock. This causes latency spikes for puts during this time.&lt;/p&gt;

&lt;p&gt;We only need to sync the old log under the lock. Creating the new file, can be done before grabbing the lock. Closing the old file can be done after we release the lock.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608148">HBASE-6813</key>
            <summary>Optimise the time spent holding the updateLock under log roll</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitanand">Amitanand Aiyer</assignee>
                                    <reporter username="amitanand">Amitanand Aiyer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 22:21:58 +0000</created>
                <updated>Mon, 25 Mar 2013 18:28:13 +0000</updated>
                            <resolved>Sun, 24 Mar 2013 05:35:09 +0000</resolved>
                                                    <fixVersion>0.89-fb</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13458390" author="jdcryans" created="Wed, 19 Sep 2012 03:47:39 +0000"  >&lt;p&gt;We actually create the file outside of that lock, so it&apos;s cleanupCurrentWriter that needs to be broken up.&lt;/p&gt;</comment>
                            <comment id="13611990" author="amitanand" created="Sun, 24 Mar 2013 05:34:14 +0000"  >&lt;p&gt;Looks like creating the file was done outside the lock in trunk already; but not in 0.89-fb.&lt;/p&gt;

&lt;p&gt;So, closing this as a 0.89-fb fix.&lt;/p&gt;

&lt;p&gt;Additionally, in 0.89-fb, we also write a &quot;dummy&quot; log record, outside the lock. This is done&lt;br/&gt;
because the first write to the block is typically costly (involves a trip to NN) and we would&lt;br/&gt;
like to avoid it in the HLog sync code path. This might be something, that may be ported, if needed.&lt;/p&gt;</comment>
                            <comment id="13611991" author="amitanand" created="Sun, 24 Mar 2013 05:35:30 +0000"  >&lt;p&gt; &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1387430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1387430&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13612058" author="yuzhihong@gmail.com" created="Sun, 24 Mar 2013 10:42:44 +0000"  >&lt;p&gt;W.r.t. the first write to the block, do you have quantitative measure how slow it is ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13612935" author="amitanand" created="Mon, 25 Mar 2013 18:16:35 +0000"  >&lt;p&gt;Overall, we have seen that the update lock used to be held for about 500-700ms before the diff. &lt;/p&gt;

&lt;p&gt;Will get some numbers on how much writing the first dummy entry contributes.&lt;/p&gt;</comment>
                            <comment id="13612948" author="amitanand" created="Mon, 25 Mar 2013 18:24:16 +0000"  >&lt;p&gt;Looks like writing the dummy entry takes about 10-35 ms. On the average.&lt;/p&gt;</comment>
                            <comment id="13612950" author="yuzhihong@gmail.com" created="Mon, 25 Mar 2013 18:28:13 +0000"  >&lt;p&gt;Thanks for the quick response, Amit.&lt;/p&gt;

&lt;p&gt;So it is worth porting the dummy entry write (outside update lock) to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Sep 2012 03:47:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i016sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4869</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>