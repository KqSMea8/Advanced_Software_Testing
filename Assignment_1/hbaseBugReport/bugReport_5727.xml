<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:30:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5727/HBASE-5727.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5727] secure hbase build broke because of &apos;HBASE-5451 Switch RPC call envelope/headers to PBs&apos;</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5727</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;If you build with the security profile &amp;#8211; i.e. add &apos;-P security&apos; on the command line &amp;#8211; you&apos;ll see that the secure build is broke since we messed in rpc.&lt;/p&gt;

&lt;p&gt;Assigning Deveraj to take a look.   If you can&apos;t work on this now DD, just give it back to me and I&apos;ll have a go at it.  Thanks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12549740">HBASE-5727</key>
            <summary>secure hbase build broke because of &apos;HBASE-5451 Switch RPC call envelope/headers to PBs&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="devaraj">Devaraj Das</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Apr 2012 15:31:12 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:44 +0000</updated>
                            <resolved>Tue, 10 Apr 2012 14:26:34 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13247329" author="devaraj" created="Thu, 5 Apr 2012 16:13:02 +0000"  >&lt;p&gt;I will get to it today. Sorry that I broke the build.&lt;/p&gt;</comment>
                            <comment id="13247469" author="apurtell" created="Thu, 5 Apr 2012 18:28:44 +0000"  >&lt;p&gt;I commented over on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5451&quot; title=&quot;Switch RPC call envelope/headers to PBs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5451&quot;&gt;&lt;del&gt;HBASE-5451&lt;/del&gt;&lt;/a&gt;: Subclassing of RPC engines was introduced to deal with incompatibilities in security related classes between Hadoop versions. If we are specifying Hadoop 1.0 (or equivalent shims) as a build requirement, then we could instead use a single RPC envelope and the User abstraction to paper over the remaining differences.&lt;/p&gt;</comment>
                            <comment id="13247474" author="apurtell" created="Thu, 5 Apr 2012 18:30:53 +0000"  >&lt;p&gt;So, to be clear, I mean as part of this work consolidate the RPC engines assuming Hadoop 1.0 or equivalent shims. Then the -P security profile would just build coprocessors. There would be little (no?) need for a security profile at all. &lt;/p&gt;</comment>
                            <comment id="13247494" author="devaraj" created="Thu, 5 Apr 2012 18:39:09 +0000"  >&lt;p&gt;Attaching a patch that makes the build go through (at least compiles). I haven&apos;t run the tests with this.&lt;/p&gt;</comment>
                            <comment id="13247507" author="apurtell" created="Thu, 5 Apr 2012 18:44:03 +0000"  >&lt;p&gt;@Stack, @Devaraj: Do you want to try removing the need for separate RPC engines (maybe as a follow on issue)?&lt;/p&gt;</comment>
                            <comment id="13247511" author="stack" created="Thu, 5 Apr 2012 18:46:46 +0000"  >&lt;p&gt;@Andrew Please advise.  I&apos;m not up on whats involved.  What you think of the DD patch attached?&lt;/p&gt;

&lt;p&gt;On the patch DD, its just what was done on HBaseServer applied to SecureServer?  It looks good to me.&lt;/p&gt;</comment>
                            <comment id="13247512" author="devaraj" created="Thu, 5 Apr 2012 18:47:04 +0000"  >&lt;p&gt;Yes, I agree that we should merge the secure/unsecure RPC layers, as a follow up. &lt;/p&gt;</comment>
                            <comment id="13247515" author="devaraj" created="Thu, 5 Apr 2012 18:48:23 +0000"  >&lt;p&gt;Pushing through Hudson. Let me know if I should run any other test on this patch.&lt;/p&gt;</comment>
                            <comment id="13247517" author="apurtell" created="Thu, 5 Apr 2012 18:50:52 +0000"  >&lt;p&gt;@Stack. Fixing the build as an interim step toward merging RPC is fine.&lt;/p&gt;</comment>
                            <comment id="13247520" author="apurtell" created="Thu, 5 Apr 2012 18:52:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Pushing through Hudson. Let me know if I should run any other test on this patch&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;HudsonQA doesn&apos;t test the security profile IIRC. How about running &apos;mvn -P security -P localTests test&apos; locally?&lt;/p&gt;</comment>
                            <comment id="13247529" author="devaraj" created="Thu, 5 Apr 2012 18:59:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about running &apos;mvn -P security -P localTests test&apos; locally?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks, this was what I was looking for.&lt;/p&gt;

&lt;p&gt;I raised &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5732&quot; title=&quot;Remove the SecureRPCEngine and merge the security-related logic in the core engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5732&quot;&gt;&lt;del&gt;HBASE-5732&lt;/del&gt;&lt;/a&gt; as a follow up to discuss removing the secure RPC engine.&lt;/p&gt;</comment>
                            <comment id="13247630" author="hadoopqa" created="Thu, 5 Apr 2012 20:29:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12521546/5727.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12521546/5727.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1410//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1410//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1410//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1410//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1410//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1410//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13247662" author="stack" created="Thu, 5 Apr 2012 20:59:58 +0000"  >&lt;p&gt;I committed this patch and forced build of secure trunk.  Won&apos;t close till that build is running again.&lt;/p&gt;</comment>
                            <comment id="13247664" author="hudson" created="Thu, 5 Apr 2012 21:04:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #158 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/158/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/158/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5727&quot; title=&quot;secure hbase build broke because of &amp;#39;HBASE-5451 Switch RPC call envelope/headers to PBs&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5727&quot;&gt;&lt;del&gt;HBASE-5727&lt;/del&gt;&lt;/a&gt; secure hbase build broke because of &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5451&quot; title=&quot;Switch RPC call envelope/headers to PBs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5451&quot;&gt;&lt;del&gt;HBASE-5451&lt;/del&gt;&lt;/a&gt; Switch RPC call envelope/headers to PBs (Revision 1310073)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13247719" author="hudson" created="Thu, 5 Apr 2012 21:42:07 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2715 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2715/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2715/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5727&quot; title=&quot;secure hbase build broke because of &amp;#39;HBASE-5451 Switch RPC call envelope/headers to PBs&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5727&quot;&gt;&lt;del&gt;HBASE-5727&lt;/del&gt;&lt;/a&gt; secure hbase build broke because of &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5451&quot; title=&quot;Switch RPC call envelope/headers to PBs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5451&quot;&gt;&lt;del&gt;HBASE-5451&lt;/del&gt;&lt;/a&gt; Switch RPC call envelope/headers to PBs (Revision 1310073)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13249289" author="zhihyu@ebaysf.com" created="Sat, 7 Apr 2012 15:57:04 +0000"  >&lt;p&gt;One test consistently fails in secure build:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK-security/161/testReport/org.apache.hadoop.hbase.coprocessor/TestRowProcessorEndpoint/org_apache_hadoop_hbase_coprocessor_TestRowProcessorEndpoint/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK-security/161/testReport/org.apache.hadoop.hbase.coprocessor/TestRowProcessorEndpoint/org_apache_hadoop_hbase_coprocessor_TestRowProcessorEndpoint/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I reproduced it on MacBook. Here is the tail of test output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-04-07 08:45:17,801 WARN  [RegionServer:0;192.168.0.17,59758,1333813404805] regionserver.HRegionServer(1813): Unable to connect to master. Retrying. Error was:
java.io.IOException: Call to /192.168.0.17:59756 failed on local exception: java.io.EOFException
  at org.apache.hadoop.hbase.ipc.HBaseClient.wrapException(HBaseClient.java:945)
  at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:914)
  at org.apache.hadoop.hbase.ipc.SecureRpcEngine$Invoker.invoke(SecureRpcEngine.java:164)
  at $Proxy18.getProtocolVersion(Unknown Source)
  at org.apache.hadoop.hbase.ipc.SecureRpcEngine.getProxy(SecureRpcEngine.java:208)
  at org.apache.hadoop.hbase.ipc.HBaseRPC.getProxy(HBaseRPC.java:305)
  at org.apache.hadoop.hbase.ipc.HBaseRPC.getProxy(HBaseRPC.java:282)
  at org.apache.hadoop.hbase.ipc.HBaseRPC.getProxy(HBaseRPC.java:334)
  at org.apache.hadoop.hbase.ipc.HBaseRPC.waitForProxy(HBaseRPC.java:238)
  at org.apache.hadoop.hbase.regionserver.HRegionServer.getMaster(HRegionServer.java:1799)
  at org.apache.hadoop.hbase.regionserver.HRegionServer.reportForDuty(HRegionServer.java:1845)
  at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:672)
  at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.runRegionServer(MiniHBaseCluster.java:140)
  at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.access$000(MiniHBaseCluster.java:93)
  at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer$1.run(MiniHBaseCluster.java:124)
  at java.security.AccessController.doPrivileged(Native Method)
  at javax.security.auth.Subject.doAs(Subject.java:337)
  at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1075)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
  at java.lang.reflect.Method.invoke(Method.java:597)
  at org.apache.hadoop.hbase.util.Methods.call(Methods.java:41)
  at org.apache.hadoop.hbase.security.User.call(User.java:617)
  at org.apache.hadoop.hbase.security.User.access$700(User.java:54)
  at org.apache.hadoop.hbase.security.User$SecureHadoopUser.runAs(User.java:457)
  at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.run(MiniHBaseCluster.java:122)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:680)
Caused by: java.io.EOFException
  at java.io.DataInputStream.readInt(DataInputStream.java:375)
  at org.apache.hadoop.hbase.ipc.SecureClient$SecureConnection.receiveResponse(SecureClient.java:344)
  at org.apache.hadoop.hbase.ipc.HBaseClient$Connection.run(HBaseClient.java:507)

2012-04-07 08:45:18,002 INFO  [RegionServer:0;192.168.0.17,59758,1333813404805] regionserver.HRegionServer(1794): Attempting connect to Master server at 192.168.0.17,59756,1333813402649

2012-04-07 08:45:18,223 WARN  [IPC Reader 3 on port 59756] ipc.HBaseServer$Listener(723): IPC Server listener on 59756: readAndProcess threw exception java.lang.NullPointerException. Count of bytes read: 0
java.lang.NullPointerException
  at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:605)
  at org.apache.hadoop.hbase.ipc.Invocation.readFields(Invocation.java:127)
  at org.apache.hadoop.hbase.ipc.SecureServer$SecureConnection.processData(SecureServer.java:597)
  at org.apache.hadoop.hbase.ipc.SecureServer$SecureConnection.processOneRpc(SecureServer.java:575)
  at org.apache.hadoop.hbase.ipc.SecureServer$SecureConnection.readAndProcess(SecureServer.java:474)
  at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.doRead(HBaseServer.java:719)
  at org.apache.hadoop.hbase.ipc.HBaseServer$Listener$Reader.doRunLoop(HBaseServer.java:510)
  at org.apache.hadoop.hbase.ipc.HBaseServer$Listener$Reader.run(HBaseServer.java:485)
  at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:680)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13249292" author="devaraj" created="Sat, 7 Apr 2012 16:19:09 +0000"  >&lt;p&gt;Thanks, Zhihong. Will take a look.&lt;/p&gt;</comment>
                            <comment id="13249608" author="devaraj" created="Sun, 8 Apr 2012 20:37:15 +0000"  >&lt;p&gt;This patch provides a fix to the problem. Basically the secure RPC request was calling the PB stuff (HBaseClient.Connection.sendParam) but the secure server side doesn&apos;t handle PB (yet). The patch overrides the RPC request creation on the secure client to do the earlier non-PB stuff.&lt;/p&gt;

&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5732&quot; title=&quot;Remove the SecureRPCEngine and merge the security-related logic in the core engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5732&quot;&gt;&lt;del&gt;HBASE-5732&lt;/del&gt;&lt;/a&gt; should aim to provide a global fix by integrating the secure/unsecure RPC implementations. &lt;/p&gt;

&lt;p&gt;While debugging the problem, I also hit a bug to do with ZKUtil. The problem being that an &apos;add&apos; gets attempted on an immutable list (introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5722&quot; title=&quot;NPE in ZKUtil#getChildDataAndWatchForNewChildren when ZK not available or NW down.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5722&quot;&gt;&lt;del&gt;HBASE-5722&lt;/del&gt;&lt;/a&gt;). Fixed that as well in the patch.&lt;/p&gt;</comment>
                            <comment id="13249609" author="devaraj" created="Sun, 8 Apr 2012 20:38:03 +0000"  >&lt;p&gt;trying hudson.&lt;/p&gt;</comment>
                            <comment id="13249612" author="yuzhihong@gmail.com" created="Sun, 8 Apr 2012 21:03:20 +0000"  >&lt;p&gt;TestRowProcessorEndpoint in security profile passed smoothly with latest patch.&lt;/p&gt;

&lt;p&gt;+1 on integrating the patch and launching another secure build.&lt;/p&gt;

&lt;p&gt;Thanks for working over the weekend, Devaraj.&lt;/p&gt;</comment>
                            <comment id="13249616" author="hadoopqa" created="Sun, 8 Apr 2012 21:25:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12521896/5727.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12521896/5727.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1451//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1451//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1451//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1451//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1451//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1451//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13249865" author="stack" created="Mon, 9 Apr 2012 15:16:46 +0000"  >&lt;p&gt;+1 on patch.  On commit should add curlies around the log statement.&lt;/p&gt;</comment>
                            <comment id="13249879" author="devaraj" created="Mon, 9 Apr 2012 15:35:57 +0000"  >&lt;p&gt;Ok here is the patch with the curlies around the LOG. I don&apos;t think we need to bother hudson since the only delta in this patch is the curly-brace.&lt;/p&gt;</comment>
                            <comment id="13249889" author="stack" created="Mon, 9 Apr 2012 15:44:29 +0000"  >&lt;p&gt;Committed to trunk.  Thanks DD.&lt;/p&gt;</comment>
                            <comment id="13249917" author="hadoopqa" created="Mon, 9 Apr 2012 16:24:29 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12521965/5727.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12521965/5727.2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1454//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1454//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1454//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1454//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1454//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1454//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13249931" author="hudson" created="Mon, 9 Apr 2012 16:37:28 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2731 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2731/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2731/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5727&quot; title=&quot;secure hbase build broke because of &amp;#39;HBASE-5451 Switch RPC call envelope/headers to PBs&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5727&quot;&gt;&lt;del&gt;HBASE-5727&lt;/del&gt;&lt;/a&gt; secure hbase build broke because of &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5451&quot; title=&quot;Switch RPC call envelope/headers to PBs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5451&quot;&gt;&lt;del&gt;HBASE-5451&lt;/del&gt;&lt;/a&gt; Switch RPC call envelope/headers to PBs&apos; (Revision 1311287)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13249934" author="hudson" created="Mon, 9 Apr 2012 16:42:06 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #164 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/164/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/164/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5727&quot; title=&quot;secure hbase build broke because of &amp;#39;HBASE-5451 Switch RPC call envelope/headers to PBs&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5727&quot;&gt;&lt;del&gt;HBASE-5727&lt;/del&gt;&lt;/a&gt; secure hbase build broke because of &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5451&quot; title=&quot;Switch RPC call envelope/headers to PBs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5451&quot;&gt;&lt;del&gt;HBASE-5451&lt;/del&gt;&lt;/a&gt; Switch RPC call envelope/headers to PBs&apos; (Revision 1311287)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13249953" author="devaraj" created="Mon, 9 Apr 2012 16:53:30 +0000"  >&lt;p&gt;I guess Zhihong forgot to &apos;resolve&apos; the issue.&lt;/p&gt;</comment>
                            <comment id="13249954" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 16:54:13 +0000"  >&lt;p&gt;Nicolas checked in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5335&quot; title=&quot;Dynamic Schema Configurations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5335&quot;&gt;&lt;del&gt;HBASE-5335&lt;/del&gt;&lt;/a&gt; a little earlier than Stack checked in this patch.&lt;br/&gt;
So we now have the following compilation failure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) on project hbase: Compilation failure: Compilation failure:
[ERROR] /Users/zhihyu/trunk-hbase/security/src/main/java/org/apache/hadoop/hbase/security/access/AccessController.java:[194,23] cannot find symbol
[ERROR] symbol  : method getConf()
[ERROR] location: class org.apache.hadoop.hbase.regionserver.HRegion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13249959" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 16:56:47 +0000"  >&lt;p&gt;The compilation issue is real.&lt;/p&gt;</comment>
                            <comment id="13249967" author="devaraj" created="Mon, 9 Apr 2012 17:02:56 +0000"  >&lt;p&gt;But this isn&apos;t related to the patch committed, right? The committed patch doesn&apos;t touch any of the affected files. Or, am i missing something?&lt;/p&gt;</comment>
                            <comment id="13249968" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 17:07:23 +0000"  >&lt;p&gt;@Devaraj:&lt;br/&gt;
I should have explained in clearer terms.&lt;br/&gt;
Since Nicolas removed the getConf() method in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5335&quot; title=&quot;Dynamic Schema Configurations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5335&quot;&gt;&lt;del&gt;HBASE-5335&lt;/del&gt;&lt;/a&gt;, I would expect the patch in this JIRA to be rebased.&lt;/p&gt;

&lt;p&gt;Another option is to ask Nicolas to put the getConf() method back.&lt;/p&gt;</comment>
                            <comment id="13249975" author="devaraj" created="Mon, 9 Apr 2012 17:17:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Another option is to ask Nicolas to put the getConf() method back.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Zhihong, that will be better IMHO, given that this patch didn&apos;t touch anything close to do with getConf(). In other words the build would have been broken even without the commit of the patch on this jira. &lt;/p&gt;</comment>
                            <comment id="13249980" author="stack" created="Mon, 9 Apr 2012 17:25:18 +0000"  >&lt;p&gt;Or just add it back w/ addendum on this patch.&lt;/p&gt;</comment>
                            <comment id="13249981" author="stack" created="Mon, 9 Apr 2012 17:25:50 +0000"  >&lt;p&gt;Sorry.  Scratch the above suggestion.&lt;/p&gt;</comment>
                            <comment id="13249994" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 17:45:03 +0000"  >&lt;p&gt;I tend to agree with Devaraj in that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5335&quot; title=&quot;Dynamic Schema Configurations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5335&quot;&gt;&lt;del&gt;HBASE-5335&lt;/del&gt;&lt;/a&gt; should have gone through compilation against secure HBase.&lt;br/&gt;
In AccessController.java, I don&apos;t see reference to HRegionServer through which the config can be obtained.&lt;/p&gt;</comment>
                            <comment id="13249998" author="stack" created="Mon, 9 Apr 2012 17:48:56 +0000"  >&lt;p&gt;@Ted No. Thats why we run a secure build up on jenkins to find those rare cases where a commit on insecure breaks secure.&lt;/p&gt;
</comment>
                            <comment id="13250013" author="apurtell" created="Mon, 9 Apr 2012 18:07:57 +0000"  >&lt;p&gt;Removing getConf() was an action that had implications for all coprocessors; AccessController just exposed it by being the only thing in tree currently that uses it.&lt;/p&gt;

&lt;p&gt;We can unify the build by integrating RPC security in the 0.96 RPC singularity. These issues with secure versus nonsecure build should be as short a transitional phase as possible, i.e. 0.92 and 0.94 use it to bridge Hadoop core differences until 0.96 specifies Hadoop 1.0 or equivalent security shims as a minimum requirement. &lt;/p&gt;</comment>
                            <comment id="13250028" author="nspiegelberg" created="Mon, 9 Apr 2012 18:23:56 +0000"  >&lt;p&gt;I agree with Stack, this isn&apos;t a common occurrence and is pretty trivial to fix.&lt;/p&gt;

&lt;p&gt;getConf() was, sadly, a hack API that was public because one of the tests wasn&apos;t in the same namespace originally.  It shouldn&apos;t have been public because the config has traditionally been at a per-server granularity.  Now, with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5335&quot; title=&quot;Dynamic Schema Configurations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5335&quot;&gt;&lt;del&gt;HBASE-5335&lt;/del&gt;&lt;/a&gt;, the per-server config object can be per-server or per-region/per-CF depending upon how it&apos;s used and the functionality you want.  Now: HRegion.conf != HRegionServer.conf != Store.conf.  If your coprocessor uses the HRegionServer.conf, it should work the same as it always has.  If your corprocessor uses HRegion.conf, a compilation error is better than a subtle runtime error that you have to spend a week hunting down.  Of course, this is part of why we tell people they are playing with fire if they use a coprocessor (vs. MySQL triggers).&lt;/p&gt;

&lt;p&gt;Taking a look at the security code, it looks like you want to use HRegionServer.conf because both calling classes seem to access global security data.  See HRegionServer.getConfiguration(), which is used in other sections of the AccessController class.&lt;/p&gt;</comment>
                            <comment id="13250037" author="apurtell" created="Mon, 9 Apr 2012 18:32:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;If your coprocessor uses the HRegionServer.conf, it should work the same as it always has. If your corprocessor uses HRegion.conf, a compilation error is better than a subtle runtime error that you have to spend a week hunting down.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes I agree. I didn&apos;t mean to imply it was an incorrect change in some way, just that the change had implications (obviously...)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Taking a look at the security code, it looks like you want to use HRegionServer.conf because both calling classes seem to access global security data.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="13250058" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 18:47:19 +0000"  >&lt;p&gt;The attached patch allows TestRowProcessorEndpoint to pass.&lt;/p&gt;</comment>
                            <comment id="13250077" author="stack" created="Mon, 9 Apr 2012 19:10:39 +0000"  >&lt;p&gt;Patch looks right to me; its providing the region context configuration making access determination to a particular region.&lt;/p&gt;</comment>
                            <comment id="13250140" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 20:18:43 +0000"  >&lt;p&gt;If there is no objection, I will integrate the addendum in 3 hours.&lt;/p&gt;</comment>
                            <comment id="13250348" author="zhihyu@ebaysf.com" created="Tue, 10 Apr 2012 00:52:37 +0000"  >&lt;p&gt;Integrated addendum to trunk.&lt;/p&gt;

&lt;p&gt;Jenkins is having trouble performing build at the moment.&lt;br/&gt;
Will resolve once a good build is produced.&lt;/p&gt;</comment>
                            <comment id="13250690" author="zhihyu@ebaysf.com" created="Tue, 10 Apr 2012 14:26:34 +0000"  >&lt;p&gt;build #166 passed.&lt;/p&gt;</comment>
                            <comment id="13775099" author="stack" created="Mon, 23 Sep 2013 18:30:44 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12543629">HBASE-5451</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12521896" name="5727.1.patch" size="2746" author="devaraj" created="Sun, 8 Apr 2012 20:37:14 +0000"/>
                            <attachment id="12521965" name="5727.2.patch" size="2757" author="devaraj" created="Mon, 9 Apr 2012 15:35:57 +0000"/>
                            <attachment id="12521546" name="5727.patch" size="4647" author="devaraj" created="Thu, 5 Apr 2012 18:39:09 +0000"/>
                            <attachment id="12521990" name="AccessController.diff" size="1620" author="zhihyu@ebaysf.com" created="Mon, 9 Apr 2012 18:47:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Apr 2012 16:13:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i016bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4795</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>