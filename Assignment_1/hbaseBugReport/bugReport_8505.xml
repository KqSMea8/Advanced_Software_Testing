<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:55:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8505/HBASE-8505.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8505] References to split daughters should not be deleted separately from parent META entry</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8505</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In CatalogJanitor, we clean up the parent regions whose daughters does not have any more references to their parent regions. In doing so, we do two Delete&apos;s one for removing the split daughter columns, and the other for removing the row. &lt;/p&gt;

&lt;p&gt;The first one seems unnecessary, and causes NPE from concurrent MetaScanner. &lt;/p&gt;

&lt;p&gt;Stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-05-07 04:49:40,828|machine|INFO|Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
2013-05-07 04:49:40,828|machine|INFO|at org.apache.hadoop.hbase.util.Writables.getWritable(Writables.java:103)
2013-05-07 04:49:40,828|machine|INFO|at org.apache.hadoop.hbase.util.Writables.getHRegionInfo(Writables.java:147)
2013-05-07 04:49:40,829|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner$BlockingMetaScannerVisitor.processRow(MetaScanner.java:406)
2013-05-07 04:49:40,829|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner$TableMetaScannerVisitor.processRow(MetaScanner.java:487)
2013-05-07 04:49:40,830|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:224)
2013-05-07 04:49:40,830|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner.access$000(MetaScanner.java:54)
2013-05-07 04:49:40,830|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner$1.connect(MetaScanner.java:133)
2013-05-07 04:49:40,831|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner$1.connect(MetaScanner.java:130)
2013-05-07 04:49:40,831|machine|INFO|at org.apache.hadoop.hbase.client.HConnectionManager.execute(HConnectionManager.java:384)
2013-05-07 04:49:40,831|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:130)
2013-05-07 04:49:40,832|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:105)
2013-05-07 04:49:40,832|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:83)
2013-05-07 04:49:40,832|machine|INFO|at org.apache.hadoop.hbase.client.MetaScanner.allTableRegions(MetaScanner.java:323)
2013-05-07 04:49:40,833|machine|INFO|at org.apache.hadoop.hbase.client.HTable.getRegionLocations(HTable.java:485)
2013-05-07 04:49:40,833|machine|INFO|at org.apache.hadoop.hbase.client.HTable.getStartEndKeys(HTable.java:438)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Master is doing the CatalogJanitor concurrently:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-05-07 04:49:40,636 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted daughters references, qualifier=splitA and qualifier=splitB, from parent IntegrationTestBigLinkedList,\x07\xFB\x98\xB7a\x89\xF5\xE6,1367898577620.4ef1329ff0e8911db998ac8ccd32108d.
2013-05-07 04:49:40,666 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted region IntegrationTestBigLinkedList,\x07\xFB\x98\xB7a\x89\xF5\xE6,1367898577620.4ef1329ff0e8911db998ac8ccd32108d. from META
2013-05-07 04:49:40,690 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted daughters references, qualifier=splitA and qualifier=splitB, from parent IntegrationTestBigLinkedList,\x0B\xF8n\xEA\xD3\xAA\xA9\x92,1367898577620.b502376df2623cb0be3f0c1664d799a6.
2013-05-07 04:49:40,716 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted region IntegrationTestBigLinkedList,\x0B\xF8n\xEA\xD3\xAA\xA9\x92,1367898577620.b502376df2623cb0be3f0c1664d799a6. from META
2013-05-07 04:49:40,742 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted daughters references, qualifier=splitA and qualifier=splitB, from parent IntegrationTestBigLinkedList,\x17\xF5\x11\xB9\xE3\xDB)\x0C,1367898541729.ec2df58fafb823cec6e793ba35e2241d.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is critical for 0.94, but not for 0.95 and trunk due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7721&quot; title=&quot;Atomic multi-row mutations in META&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7721&quot;&gt;&lt;del&gt;HBASE-7721&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12646530">HBASE-8505</key>
            <summary>References to split daughters should not be deleted separately from parent META entry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 May 2013 00:16:55 +0000</created>
                <updated>Tue, 15 Oct 2013 04:46:38 +0000</updated>
                            <resolved>Tue, 21 May 2013 23:28:20 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.8</fixVersion>
                    <fixVersion>0.95.1</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13651590" author="enis" created="Wed, 8 May 2013 03:31:07 +0000"  >&lt;p&gt;Attaching a patch for 0.94. &lt;br/&gt;
It fixes three related issues: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Removes first Delete just to delete the columns from parent.&lt;/li&gt;
	&lt;li&gt;Changes CatalogJanitor to use BlockingMetaScannerVisitor instead of MetaReader.Visitor.&lt;/li&gt;
	&lt;li&gt;Fixes CatalogJanitor.SplitParentFirstComparator so that it sorts the root region (region with empty start, end keys) to be sorted correctly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Trunk patch coming up. &lt;/p&gt;</comment>
                            <comment id="13652351" author="sershe" created="Wed, 8 May 2013 20:59:32 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Deleting region &quot;&lt;/span&gt; + parent.getRegionNameAsString() +
         &lt;span class=&quot;code-quote&quot;&gt;&quot; because daughter splits no longer hold references&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should this also be removed?&lt;/p&gt;</comment>
                            <comment id="13652355" author="enis" created="Wed, 8 May 2013 21:04:01 +0000"  >&lt;p&gt;That log entry is still valid, because we still delete the region from meta because daughters do not hold references. The difference is that we do not do two separate deletes. &lt;/p&gt;</comment>
                            <comment id="13652499" author="enis" created="Wed, 8 May 2013 23:13:28 +0000"  >&lt;p&gt;Attaching v2 patches for trunk and 0.94. &lt;/p&gt;

&lt;p&gt;Also attaching a v2-0.94-reduced patch, which only contains the essential fix for the NPE in MetaScanner and CatalogJanitor without the other bits. This is less intrusive than v2-0.94 patch. &lt;/p&gt;</comment>
                            <comment id="13657724" author="stack" created="Wed, 15 May 2013 00:05:14 +0000"  >&lt;p&gt;+1 on patch for trunk/0.95 Enis ... then we can move this to 0.94.&lt;/p&gt;</comment>
                            <comment id="13657809" author="sershe" created="Wed, 15 May 2013 02:12:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13657847" author="enis" created="Wed, 15 May 2013 03:24:12 +0000"  >&lt;p&gt;Thanks for reviews. Reattaching for hadoopqa. &lt;/p&gt;</comment>
                            <comment id="13657900" author="hadoopqa" created="Wed, 15 May 2013 04:46:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12583272/hbase-8505_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12583272/hbase-8505_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.hbase.client.TestHCM.testDeleteForZKConnLeak(TestHCM.java:855)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5695//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13659254" author="lhofhansl" created="Thu, 16 May 2013 05:45:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;The full version of the patch seems fine for 0.94 as well (the reduced version would do too).&lt;/p&gt;</comment>
                            <comment id="13659781" author="enis" created="Thu, 16 May 2013 18:07:51 +0000"  >&lt;p&gt;The test failures are not relevant. &lt;br/&gt;
Thanks for the reviews, I have committed to trunk, 0.95 and 0.94. 0.94. 0.94 is the full version (v2) after Lars&apos; blessing. &lt;/p&gt;</comment>
                            <comment id="13660002" author="hudson" created="Thu, 16 May 2013 21:05:13 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #198 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/198/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/198/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8505&quot; title=&quot;References to split daughters should not be deleted separately from parent META entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8505&quot;&gt;&lt;del&gt;HBASE-8505&lt;/del&gt;&lt;/a&gt; References to split daughters should not be deleted separately from parent META entry (Revision 1483483)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-client/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestMetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13660044" author="hudson" created="Thu, 16 May 2013 21:50:56 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #142 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/142/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/142/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8505&quot; title=&quot;References to split daughters should not be deleted separately from parent META entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8505&quot;&gt;&lt;del&gt;HBASE-8505&lt;/del&gt;&lt;/a&gt; References to split daughters should not be deleted separately from parent META entry (Revision 1483485)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestMetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13660054" author="hudson" created="Thu, 16 May 2013 21:58:54 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #985 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/985/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/985/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8505&quot; title=&quot;References to split daughters should not be deleted separately from parent META entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8505&quot;&gt;&lt;del&gt;HBASE-8505&lt;/del&gt;&lt;/a&gt; References to split daughters should not be deleted separately from parent META entry (Revision 1483485)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestMetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13660090" author="hudson" created="Thu, 16 May 2013 22:33:20 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #4124 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4124/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4124/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8505&quot; title=&quot;References to split daughters should not be deleted separately from parent META entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8505&quot;&gt;&lt;del&gt;HBASE-8505&lt;/del&gt;&lt;/a&gt; References to split daughters should not be deleted separately from parent META entry (Revision 1483481)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestMetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13660260" author="hudson" created="Fri, 17 May 2013 02:02:46 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #102 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/102/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/102/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8505&quot; title=&quot;References to split daughters should not be deleted separately from parent META entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8505&quot;&gt;&lt;del&gt;HBASE-8505&lt;/del&gt;&lt;/a&gt; References to split daughters should not be deleted separately from parent META entry (Revision 1483483)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-client/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestMetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13660286" author="hudson" created="Fri, 17 May 2013 03:09:35 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #533 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/533/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/533/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8505&quot; title=&quot;References to split daughters should not be deleted separately from parent META entry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8505&quot;&gt;&lt;del&gt;HBASE-8505&lt;/del&gt;&lt;/a&gt; References to split daughters should not be deleted separately from parent META entry (Revision 1483481)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestMetaScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13663156" author="apurtell" created="Tue, 21 May 2013 17:29:28 +0000"  >&lt;p&gt;TestMetaScanner is failing in EC2 Jenkins 0.94 security builds. Related?&lt;br/&gt;
  testConcurrentMetaScannerAndCatalogJanitor(org.apache.hadoop.hbase.client.TestMetaScanner): Split daughter region testConcurrentMetaScannerAndCatalogJanitor,\x1F\xFF\xFF\xFF\xFF\xFF\xFF\xFF,1369096528655.747595ba03c925e9d7153b4d4c28898e. cannot be found in META.&lt;/p&gt;</comment>
                            <comment id="13663172" author="lhofhansl" created="Tue, 21 May 2013 17:45:51 +0000"  >&lt;p&gt;Hmm... Passes locally. The Apache security jenkins also fails with this. Maybe there&apos;s a race somewhere only showing on EC2/VMs?&lt;/p&gt;

&lt;p&gt;Why would it only fail on security?&lt;/p&gt;</comment>
                            <comment id="13663181" author="apurtell" created="Tue, 21 May 2013 17:51:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why would it only fail on security?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No obvious reason, timing differences due to different RPC stack maybe.&lt;/p&gt;</comment>
                            <comment id="13663186" author="apurtell" created="Tue, 21 May 2013 17:53:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;timing differences due to different RPC stack maybe&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Checked a Hadoop 2 build and saw this too, which lends some support to this hypothesis.&lt;/p&gt;</comment>
                            <comment id="13663191" author="enis" created="Tue, 21 May 2013 17:58:57 +0000"  >&lt;p&gt;Thanks Andrew for the notice. let me take a look. &lt;/p&gt;</comment>
                            <comment id="13663196" author="lhofhansl" created="Tue, 21 May 2013 18:05:32 +0000"  >&lt;p&gt;Didn&apos;t fail in latest EC2 run. Sigh. I would like to release 0.94.8 soon.&lt;br/&gt;
I could revert this one for 0.94 and file a new backporting ticket for 0.94.9.&lt;/p&gt;</comment>
                            <comment id="13663442" author="enis" created="Tue, 21 May 2013 21:46:00 +0000"  >&lt;p&gt;From the logs at &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/ws/trunk/target/surefire-reports/org.apache.hadoop.hbase.client.TestMetaScanner-output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/ws/trunk/target/surefire-reports/org.apache.hadoop.hbase.client.TestMetaScanner-output.txt&lt;/a&gt;, I think I understand what is going on: &lt;br/&gt;
BlockingMetaScannerVisitor blocks and wait for the split daughter to appear when it sees a parent region (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5986&quot; title=&quot;Clients can see holes in the META table when regions are being split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5986&quot;&gt;&lt;del&gt;HBASE-5986&lt;/del&gt;&lt;/a&gt;). CatalogJanitor on the other hand will order the regions in a (kind-of) topological sort (based on parent child relation) so that it will guarantee parents are not GC&apos;d before daughters. &lt;/p&gt;

&lt;p&gt;What is happening in this issue is not related to the patch in this jira, but the test triggers this extremely rare case by running concurrent catalogjanitor, splits and metascanners. We have parent, splita and splitb regions, and catalogjanitor decides to delete parent first and splitb in one run. While there is a concurrent metascanner which will go over the parent, and sees that it is split, but before being able to read the split daughter, catalog janitor will delete both the parent and the child, which will lead to metascanner blocking until timeout and failing the test. &lt;/p&gt;

&lt;p&gt;On solution might be to also check whether the parent is still there in BlockingMetaScannerVisitor while we are blocking for the daughter. &lt;/p&gt;

&lt;p&gt;Good thing is that with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7721&quot; title=&quot;Atomic multi-row mutations in META&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7721&quot;&gt;&lt;del&gt;HBASE-7721&lt;/del&gt;&lt;/a&gt;, we don&apos;t need any of this in trunk. &lt;/p&gt;</comment>
                            <comment id="13663447" author="enis" created="Tue, 21 May 2013 21:48:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;I could revert this one for 0.94 and file a new backporting ticket for 0.94.9.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the bug I describe above is not directly caused by this patch. I think we should address this in a separate jira. I can provide a patch today, but not sure whether I can come up with a definitive test for this, it is hard. &lt;/p&gt;</comment>
                            <comment id="13663507" author="enis" created="Tue, 21 May 2013 22:34:52 +0000"  >&lt;p&gt;I&apos;ve opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8590&quot; title=&quot;[0.94] BlockingMetaScannerVisitor should check for parent meta entry while waiting for split daughter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8590&quot;&gt;&lt;del&gt;HBASE-8590&lt;/del&gt;&lt;/a&gt; to continue on the patch. &lt;/p&gt;</comment>
                            <comment id="13663549" author="lhofhansl" created="Tue, 21 May 2013 22:56:15 +0000"  >&lt;p&gt;Can I close this one and roll an RC? Are you still concerned &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13663567" author="apurtell" created="Tue, 21 May 2013 23:19:11 +0000"  >&lt;p&gt;No concerns &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;. Thanks for looking at it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13663581" author="lhofhansl" created="Tue, 21 May 2013 23:28:20 +0000"  >&lt;p&gt;Thanks Andy and Enis.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12649330">HBASE-8612</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12582247" name="hbase-8505_v1-0.94.patch" size="24721" author="enis" created="Wed, 8 May 2013 03:31:07 +0000"/>
                            <attachment id="12582376" name="hbase-8505_v2-0.94-reduced.patch" size="6989" author="enis" created="Wed, 8 May 2013 23:13:28 +0000"/>
                            <attachment id="12582377" name="hbase-8505_v2-0.94.patch" size="27355" author="enis" created="Wed, 8 May 2013 23:13:28 +0000"/>
                            <attachment id="12583272" name="hbase-8505_v2.patch" size="26311" author="enis" created="Wed, 15 May 2013 03:24:12 +0000"/>
                            <attachment id="12582378" name="hbase-8505_v2.patch" size="26311" author="enis" created="Wed, 8 May 2013 23:13:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 May 2013 20:59:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326888</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ke73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327233</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.96notable</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>