<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:07:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9773/HBASE-9773.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9773] Master aborted when hbck asked the master to assign a region that was already online</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9773</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Came across this situation (with a version of 0.96 very close to RC5 version created on 10/11):&lt;/p&gt;

&lt;p&gt;The sequence of events that happened:&lt;/p&gt;

&lt;p&gt;1. The hbck tool couldn&apos;t communicate with the RegionServer hosting namespace region due to some security exceptions. hbck INCORRECTLY assumed the region was not deployed.&lt;br/&gt;
In output.log (client side):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-12 10:42:57,067|beaver.machine|INFO|ERROR: Region { meta =&amp;gt; hbase:namespace,,1381564449706.a0ac0825ba2d0830614e7f808f31787a., hdfs =&amp;gt; hdfs://gs-hdp2-secure-1381559462-hbase-12.cs1cloud.internal:8020/apps/hbase/data/data/hbase/namespace/a0ac0825ba2d0830614e7f808f31787a, deployed =&amp;gt;  } not deployed on any region server.
2013-10-12 10:42:57,067|beaver.machine|INFO|Trying to fix unassigned region...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. This led to the hbck tool trying to tell the master to &quot;assign&quot; the region.&lt;br/&gt;
In master log (hbase-hbase-master-gs-hdp2-secure-1381559462-hbase-12.log):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-12 10:52:35,960 INFO  [RpcServer.handler=4,port=60000] master.HMaster: Client=hbase//172.18.145.105 assign hbase:namespace,,1381564449706.a0ac0825ba2d0830614e7f808f31787a.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. The master went through the steps - sent a CLOSE to the RegionServer hosting namespace region.&lt;br/&gt;
From master log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-12 10:52:35,981 DEBUG [RpcServer.handler=4,port=60000] master.AssignmentManager: Sent CLOSE to gs-hdp2-secure-1381559462-hbase-1.cs1cloud.internal,60020,1381564439794 for region hbase:namespace,,1381564449706.a0ac0825ba2d0830614e7f808f31787a.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4. The master then tried to assign the namespace region to a region server, and in the process ABORTED:&lt;br/&gt;
From master log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-12 10:52:36,025 DEBUG [RpcServer.handler=4,port=60000] master.AssignmentManager: No previous transition plan found (or ignoring an existing plan) for hbase:namespace,,1381564449706.a0ac0825ba2d0830614e7f808f31787a.; generated random plan=hri=hbase:namespace,,1381564449706.a0ac0825ba2d0830614e7f808f31787a., src=, dest=gs-hdp2-secure-1381559462-hbase-9.cs1cloud.internal,60020,1381564439807; 4 (online=4, available=4) available servers, forceNewPlan=true
2013-10-12 10:52:36,026 FATAL [RpcServer.handler=4,port=60000] master.HMaster: Master server abort: loaded coprocessors are: [org.apache.hadoop.hbase.security.access.AccessController]
2013-10-12 10:52:36,027 FATAL [RpcServer.handler=4,port=60000] master.HMaster: Unexpected state : {a0ac0825ba2d0830614e7f808f31787a state=OPEN, ts=1381564451344, server=gs-hdp2-secure-1381559462-hbase-1.cs1cloud.internal,60020,1381564439794} .. Cannot transit it to OFFLINE.
java.lang.IllegalStateException: Unexpected state : {a0ac0825ba2d0830614e7f808f31787a state=OPEN, ts=1381564451344, server=gs-hdp2-secure-1381559462-hbase-1.cs1cloud.internal,60020,1381564439794} .. Cannot transit it to OFFLINE.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;AssignmentManager.assign(HRegionInfo region, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; setOfflineInZK, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; forceNewPlan)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is the method that does all the above. This was called from the HMaster with true for both the boolean arguments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12673981">HBASE-9773</key>
            <summary>Master aborted when hbck asked the master to assign a region that was already online</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jxiang">Jimmy Xiang</assignee>
                                    <reporter username="devaraj">Devaraj Das</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Oct 2013 20:43:55 +0000</created>
                <updated>Mon, 16 Dec 2013 18:46:37 +0000</updated>
                            <resolved>Thu, 17 Oct 2013 17:29:31 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.96.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13795630" author="jxiang" created="Tue, 15 Oct 2013 21:02:29 +0000"  >&lt;p&gt;This is a regression I think.  I can post a patch unless someone else wants to take it.&lt;/p&gt;</comment>
                            <comment id="13795641" author="devaraj" created="Tue, 15 Oct 2013 21:10:15 +0000"  >&lt;p&gt;Regression w.r.t what?&lt;/p&gt;</comment>
                            <comment id="13795642" author="devaraj" created="Tue, 15 Oct 2013 21:14:24 +0000"  >&lt;p&gt;In my analysis, it seemed this wasn&apos;t introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9696&quot; title=&quot;Master recovery ignores online merge znode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9696&quot;&gt;&lt;del&gt;HBASE-9696&lt;/del&gt;&lt;/a&gt; if that&apos;s what you are referring to as causing the regression..&lt;/p&gt;</comment>
                            <comment id="13795754" author="jxiang" created="Tue, 15 Oct 2013 22:49:24 +0000"  >&lt;p&gt;It&apos;s introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9514&quot; title=&quot;Prevent region from assigning before log splitting is done&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9514&quot;&gt;&lt;del&gt;HBASE-9514&lt;/del&gt;&lt;/a&gt; I think.  I attached a patch to fix it, added a test too.&lt;/p&gt;</comment>
                            <comment id="13795774" author="hadoopqa" created="Tue, 15 Oct 2013 23:00:29 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12608596/trunk-9773.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12608596/trunk-9773.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7555//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7555//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13795777" author="jxiang" created="Tue, 15 Oct 2013 23:04:16 +0000"  >&lt;p&gt;Attached a wrong patch file.  Here is the right one.&lt;/p&gt;</comment>
                            <comment id="13796245" author="hadoopqa" created="Wed, 16 Oct 2013 00:28:16 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12608601/trunk-9773_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12608601/trunk-9773_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7556//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13796251" author="yuzhihong@gmail.com" created="Wed, 16 Oct 2013 00:31:20 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13796252" author="stack" created="Wed, 16 Oct 2013 00:34:41 +0000"  >&lt;p&gt;Patch looks good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;  Should the state check be tighter than just checking for null?  What could it be?  What would be legit and what not?&lt;/p&gt;</comment>
                            <comment id="13796254" author="hadoopqa" created="Wed, 16 Oct 2013 00:36:07 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12608601/trunk-9773_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12608601/trunk-9773_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7557//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13796341" author="jxiang" created="Wed, 16 Oct 2013 02:29:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;, if it is null, the state is managed by the caller so we leave it to the caller. If the transitionInZK is not set, the caller is just to do the best to close the region just in case to avoid double assignment. So we don&apos;t check the actual state here.&lt;/p&gt;</comment>
                            <comment id="13796358" author="jxiang" created="Wed, 16 Oct 2013 02:49:44 +0000"  >&lt;p&gt;Integrated into trunk and 0.96.  Thanks Devaraj for finding the issue. Thanks Stack, Ted for reviewing the patch.&lt;/p&gt;</comment>
                            <comment id="13796365" author="stack" created="Wed, 16 Oct 2013 03:08:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; makes sense.  I like the test.&lt;/p&gt;</comment>
                            <comment id="13796448" author="hudson" created="Wed, 16 Oct 2013 05:37:52 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4622 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4622/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4622/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9773&quot; title=&quot;Master aborted when hbck asked the master to assign a region that was already online&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9773&quot;&gt;&lt;del&gt;HBASE-9773&lt;/del&gt;&lt;/a&gt; Master aborted when hbck asked the master to assign a region that was already online (jxiang: rev 1532633)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796454" author="devaraj" created="Wed, 16 Oct 2013 05:51:08 +0000"  >&lt;p&gt;Cool. Now it seems this will also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9777&quot; title=&quot;Two consecutive RS crashes could lead to their SSH stepping on each other&amp;#39;s toes and cause master abort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9777&quot;&gt;&lt;del&gt;HBASE-9777&lt;/del&gt;&lt;/a&gt;. Would it?&lt;/p&gt;</comment>
                            <comment id="13796455" author="hudson" created="Wed, 16 Oct 2013 05:51:18 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96 #143 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/143/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/143/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9773&quot; title=&quot;Master aborted when hbck asked the master to assign a region that was already online&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9773&quot;&gt;&lt;del&gt;HBASE-9773&lt;/del&gt;&lt;/a&gt; Master aborted when hbck asked the master to assign a region that was already online (jxiang: rev 1532634)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796758" author="hudson" created="Wed, 16 Oct 2013 13:10:36 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96-hadoop2 #90 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/90/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/90/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9773&quot; title=&quot;Master aborted when hbck asked the master to assign a region that was already online&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9773&quot;&gt;&lt;del&gt;HBASE-9773&lt;/del&gt;&lt;/a&gt; Master aborted when hbck asked the master to assign a region that was already online (jxiang: rev 1532634)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796764" author="hudson" created="Wed, 16 Oct 2013 13:13:55 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #796 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/796/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/796/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9773&quot; title=&quot;Master aborted when hbck asked the master to assign a region that was already online&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9773&quot;&gt;&lt;del&gt;HBASE-9773&lt;/del&gt;&lt;/a&gt; Master aborted when hbck asked the master to assign a region that was already online (jxiang: rev 1532633)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796930" author="jxiang" created="Wed, 16 Oct 2013 16:10:17 +0000"  >&lt;p&gt;Yes, that&apos;s right.  It should have fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9777&quot; title=&quot;Two consecutive RS crashes could lead to their SSH stepping on each other&amp;#39;s toes and cause master abort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9777&quot;&gt;&lt;del&gt;HBASE-9777&lt;/del&gt;&lt;/a&gt; too. &lt;/p&gt;</comment>
                            <comment id="13797344" author="jeffreyz" created="Wed, 16 Oct 2013 22:11:25 +0000"  >&lt;p&gt;I checked the fix and I think it opens the door for double assignment. Basically closeRegion request is processed asynchronously. Even we send close RPC to a region&apos;s host region server, the region could open on another region server before the old region server really close the region. Then we end up in double assignment issue.&lt;/p&gt;

&lt;p&gt;In addition, we potentially have a data loss situation. AM#forceRegionStateToOffline doesn&apos;t wait for region is fully closed. If a region is open while the old RS still flush, then some store files may not open in the new location. Even more, if the old RS crashes, the WAL splitting will be skipped then we have a permanent data loss.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; Could you please double check the above? Meanwhile let me try to come up an addendum patch. Thanks.  &lt;/p&gt;</comment>
                            <comment id="13797358" author="jxiang" created="Wed, 16 Oct 2013 22:21:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, yes, I knew this issue.  I already have something in my local branch being tested. Let me uploaded it here. Hopefully we come to the same solution.&lt;/p&gt;</comment>
                            <comment id="13797364" author="jxiang" created="Wed, 16 Oct 2013 22:24:41 +0000"  >&lt;p&gt;The addendum I am testing now.&lt;/p&gt;</comment>
                            <comment id="13797498" author="jeffreyz" created="Thu, 17 Oct 2013 01:03:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; I checked your addendum. You use recursive way to wait for a region is fully closed. There is one problem on that: The caller will be blocked for quite a while. If the call request is handled by a thread pool, we could block the thread pool. In addition, we may run out stack if for whatever reason we have a bad RS.&lt;/p&gt;

&lt;p&gt;I think it&apos;s better to create a runnable and resubmit the runnable to wait for the region closed and then re-assign it.&lt;/p&gt;</comment>
                            <comment id="13797515" author="jxiang" created="Thu, 17 Oct 2013 01:27:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;we may run out stack if for whatever reason we have a bad RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good point. Let me think about it.&lt;/p&gt;</comment>
                            <comment id="13797535" author="jxiang" created="Thu, 17 Oct 2013 02:05:26 +0000"  >&lt;p&gt;There should be no stack issue since for the second call, we should get a region already in transition exception, or something else. Yes, this thread should be held for a while till the region is closed. With a runnable, it holds a thread too in waiting for the region to be closed, right? Holding a thread should be fine since this is some corner case, isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="13797615" author="jeffreyz" created="Thu, 17 Oct 2013 05:23:25 +0000"  >&lt;p&gt;With runnable, we can wait a little bit then resubmit it into the executor pool so that other runnable can have a chance to run. For example, a thread pool have max 5 threads if you firstly submit 5 runnable which are all long blocking like the way in the addendum and the following submitted work item won&apos;t get run until the first 5 completes even though they could complete very quickly. &lt;/p&gt;</comment>
                            <comment id="13798031" author="jxiang" created="Thu, 17 Oct 2013 16:16:20 +0000"  >&lt;p&gt;I will enhance the addendum a little to have a timeout, just like in the assign case.  I think we should not use runnable because the open will be retried usually.  If the unassign is timed out, the pool won&apos;t be blocked.&lt;/p&gt;</comment>
                            <comment id="13798134" author="jxiang" created="Thu, 17 Oct 2013 17:29:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, let&apos;s close this one and fix the double assignment issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9793&quot; title=&quot;Offline a region before it&amp;#39;s closed could cause double assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9793&quot;&gt;&lt;del&gt;HBASE-9793&lt;/del&gt;&lt;/a&gt;.  It may need some discussions.&lt;/p&gt;</comment>
                            <comment id="13798164" author="jeffreyz" created="Thu, 17 Oct 2013 17:45:20 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I will enhance the addendum a little to have a timeout, just like in the assign case. I think we should not use runnable because the open will be retried usually. If the unassign is timed out, the pool won&apos;t be blocked.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Since TimeoutMonitor is disable by default so the open won&apos;t retried. While for this JIRA issue, if we timeout unassign is a reasonable solution because in SSH case the host server is dead already so unassign will bail out quick without timeout. For other situations, we give up assignment is acceptable because region assignment is more like a hint to the system and master doesn&apos;t have to assign a region by user requests. &lt;/p&gt;</comment>
                            <comment id="13798171" author="jxiang" created="Thu, 17 Oct 2013 17:50:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, I posted a patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9793&quot; title=&quot;Offline a region before it&amp;#39;s closed could cause double assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9793&quot;&gt;&lt;del&gt;HBASE-9793&lt;/del&gt;&lt;/a&gt;. Could you please take a look? Thanks.&lt;/p&gt;</comment>
                            <comment id="13849457" author="stack" created="Mon, 16 Dec 2013 18:46:37 +0000"  >&lt;p&gt;Released in 0.96.1.  Issue closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12674349">HBASE-9793</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12608818" name="trunk-9773.addendum" size="2469" author="jxiang" created="Wed, 16 Oct 2013 22:24:41 +0000"/>
                            <attachment id="12608596" name="trunk-9773.patch" size="4268" author="jxiang" created="Tue, 15 Oct 2013 22:48:27 +0000"/>
                            <attachment id="12608601" name="trunk-9773_v2.patch" size="2444" author="jxiang" created="Tue, 15 Oct 2013 23:04:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Oct 2013 21:02:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353604</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oyqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353896</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>