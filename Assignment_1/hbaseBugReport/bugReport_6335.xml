<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6335/HBASE-6335.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6335] Switching log-splitting policy after last failure master start may cause data loss</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6335</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;How happen?&lt;/p&gt;

&lt;p&gt;If server A is down, and it has three log files, all the data is from one region.&lt;br/&gt;
File 1: kv01 kv02 kv03&lt;br/&gt;
File 2: kv04 kv05 kv06&lt;br/&gt;
File 3: kv07 kv08 kv09&lt;br/&gt;
Here,kv01 means, its log seqID is 01&lt;/p&gt;

&lt;p&gt;Case:Switch to maste-local-log-splitting from distributed-log-splitting&lt;/p&gt;

&lt;p&gt;1.Master find serverA is down, and start to split its log files using split-log-splitting.&lt;/p&gt;

&lt;p&gt;2.Successfully split log file2, and move it to oldLogs, and generate one edit file named 06 in region recover.edits dir.&lt;/p&gt;

&lt;p&gt;3.Master restart, and change the log-splitting policy to maste-local-log-splitting , and start to split file 1, file 3&lt;/p&gt;

&lt;p&gt;4.Successfully split log file1 and file3, and generate one edit file named 09 in region recover.edits dir.&lt;/p&gt;

&lt;p&gt;5.Region replay edits from edit file 06 and 09, Region&apos;s seqID is 06 after it replay edits from 06, and when replaying edit from 09, it will skip kv01,kv02,kv03, So these data loss.&lt;/p&gt;


&lt;p&gt;As the above case, if we switch  to distributed-log-splitting from maste-local-log-splitting, it could also cause data loss&lt;/p&gt;


&lt;p&gt;Should we fix this bug or avoid the case? I&apos;m not sure...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597690">HBASE-6335</key>
            <summary>Switching log-splitting policy after last failure master start may cause data loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jul 2012 03:45:17 +0000</created>
                <updated>Tue, 26 Feb 2013 04:49:43 +0000</updated>
                                            <version>0.92.1</version>
                    <version>0.94.0</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13408162" author="zhihyu@ebaysf.com" created="Fri, 6 Jul 2012 17:12:49 +0000"  >&lt;p&gt;Distributed log splitting is the recommended approach.&lt;br/&gt;
Would the switch actually happen in production ?&lt;/p&gt;</comment>
                            <comment id="13409126" author="zjushch" created="Mon, 9 Jul 2012 02:08:07 +0000"  >&lt;p&gt;Distributed log splitting will be very slow in some case mentioned on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6309&quot; title=&quot;[MTTR] Do NN operations outside of the ZK EventThread in SplitLogManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6309&quot;&gt;HBASE-6309&lt;/a&gt;,&lt;br/&gt;
It happened in our environment that distributed-log-splitting took 3+ hours,but local-master-log-splitting only took 22+ mins;(9 regionserver, 2500 regions per hlog file, total 280 hlog files, 16 ms per rename operation(2 ms per rename operation in common, but that time it took much more time, maybe because of high NN load))&lt;/p&gt;

&lt;p&gt;If you kill master in the progress of splitting log because too slow distributed-log-splitting, and switch to local-master-log-splitting,  you will find data loss.&lt;/p&gt;</comment>
                            <comment id="13409144" author="zhihyu@ebaysf.com" created="Mon, 9 Jul 2012 03:10:30 +0000"  >&lt;p&gt;We should focus on parallelizing rename operations so that there is no such bottleneck in distributed-log-splitting.&lt;/p&gt;</comment>
                            <comment id="13409154" author="lhofhansl" created="Mon, 9 Jul 2012 04:00:08 +0000"  >&lt;p&gt;Let&apos;s target to 0.94.2.&lt;/p&gt;</comment>
                            <comment id="13409161" author="zjushch" created="Mon, 9 Jul 2012 04:08:44 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Yes, we should improve distributed-log-splitting.&lt;br/&gt;
However, if this case happen, data will loss.&lt;br/&gt;
If we can&apos;t prevent it, should we warn users not to do it ?&lt;/p&gt;</comment>
                            <comment id="13409163" author="zhihyu@ebaysf.com" created="Mon, 9 Jul 2012 04:13:02 +0000"  >&lt;p&gt;I agree we should warn users about this scenario.&lt;/p&gt;</comment>
                            <comment id="13445298" author="lhofhansl" created="Thu, 30 Aug 2012 21:11:10 +0000"  >&lt;p&gt;We do not have a patch, and this is an existing issue. Pushing to the next point release.&lt;br/&gt;
Ted, how should we warn users about this? An entry in the book?&lt;br/&gt;
Is there merit to default to local master log splitting?&lt;/p&gt;</comment>
                            <comment id="13445306" author="yuzhihong@gmail.com" created="Thu, 30 Aug 2012 21:23:01 +0000"  >&lt;p&gt;An entry in the book about this scenario is good.&lt;/p&gt;</comment>
                            <comment id="13489851" author="lhofhansl" created="Fri, 2 Nov 2012 23:44:42 +0000"  >&lt;p&gt;No patch... Moving to 0.94.4&lt;/p&gt;</comment>
                            <comment id="13563760" author="lhofhansl" created="Sun, 27 Jan 2013 08:03:56 +0000"  >&lt;p&gt;Is this an issue in 0.94 only (or in 0.96 as well)?&lt;/p&gt;</comment>
                            <comment id="13564056" author="zjushch" created="Mon, 28 Jan 2013 05:33:13 +0000"  >&lt;p&gt;In 0.96 as well.&lt;/p&gt;

&lt;p&gt;For this problem, I don&apos;t have any good idea...&lt;/p&gt;</comment>
                            <comment id="13586750" author="lhofhansl" created="Tue, 26 Feb 2013 04:49:43 +0000"  >&lt;p&gt;Unscheduled from 0.94.&lt;br/&gt;
This has been shifted for 6 releases now without a patch.&lt;/p&gt;

&lt;p&gt;Maybe the best solution is to document that the split policy must only be changed after a clean cluster shutdown (along with a way to verify that the cluster was indeed shutdown cleanly).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Jul 2012 17:12:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241744</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02c47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>