<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:06:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3049/HBASE-3049.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3049] HLog size explosion</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3049</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Recently I&apos;ve been seeing some strange behavior around HLogs, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3038&quot; title=&quot;WALReaderFSDataInputStream.getPos() fails if Filesize &amp;gt; MAX_INT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3038&quot;&gt;&lt;del&gt;HBASE-3038&lt;/del&gt;&lt;/a&gt; is an example. Looking in my oldlogs folder, I see:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-rw-r--r--   3 hadoop supergroup  716716459 2010-09-29 01:08 /hbase/.oldlogs/10.20.20.176%3A60020.1285722528252
-rw-r--r--   3 hadoop supergroup   64841781 2010-09-29 01:10 /hbase/.oldlogs/10.20.20.176%3A60020.1285722620286
bunch of normally sized HLogs... then
-rw-r--r--   3 hadoop supergroup  769729956 2010-09-29 01:13 /hbase/.oldlogs/10.20.20.176%3A60020.1285722785347
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;680MB is way off the 64MB limit. My feeling is that the optimizations I did in the scope of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2922&quot; title=&quot;HLog preparation and cleanup are done under the updateLock, major slowdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2922&quot;&gt;&lt;del&gt;HBASE-2922&lt;/del&gt;&lt;/a&gt; that remove some blocking behavior have the side effect of getting a lot more data in a lot faster in some edge cases. Need to investigate more.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475370">HBASE-3049</key>
            <summary>HLog size explosion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Sep 2010 01:41:39 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:23 +0000</updated>
                            <resolved>Mon, 1 Nov 2010 23:46:43 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12927155" author="jdcryans" created="Mon, 1 Nov 2010 21:07:17 +0000"  >&lt;p&gt;Did some more digging, turns out it&apos;s a few factors that contribute to HLog size explosion. I added some debug lines in HLog (when a roll&apos;s requested, when it&apos;s preparing it and when it acquired the lock) to see exactly where we were adding all that data, and here&apos;s the explosion of one log during PE:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-11-01 13:34:10,921 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memstore flush for region 
TestTable,0000984576,1288637489953.64980bd9a7d72aeb13a92b3d68fe893e.; current region memstore size 101.4m
2010-11-01 13:34:10,921 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Finished snapshotting, commencing flushing stores
2010-11-01 13:34:10,944 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 60749074
2010-11-01 13:34:10,992 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 65088262
2010-11-01 13:34:10,992 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 65088262

... hiding about 30 lines of &quot;Log roll requested&quot;!

2010-11-01 13:34:12,054 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 120051310
2010-11-01 13:34:12,135 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 124390498
2010-11-01 13:34:12,135 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 124390498
2010-11-01 13:34:12,155 INFO org.apache.hadoop.hbase.regionserver.Store: Renaming flushed file at
 hdfs://hbasedev:9000/hbase-trunk/TestTable/64980bd9a7d72aeb13a92b3d68fe893e/.tmp/6522388362622022979 to 
 hdfs://hbasedev:9000/hbase-trunk/TestTable/64980bd9a7d72aeb13a92b3d68fe893e/info/1928466282107782255
2010-11-01 13:34:12,161 INFO org.apache.hadoop.hbase.regionserver.Store: 
 Added hdfs://hbasedev:9000/hbase-trunk/TestTable/64980bd9a7d72aeb13a92b3d68fe893e/info/1928466282107782255,
 entries=87444, sequenceid=51727166, memsize=101.4m, filesize=86.6m to TestTable,0000984576,1288637489953.64980bd9a7d72aeb13a92b3d68fe893e.
2010-11-01 13:34:12,161 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLog: Preparing to roll, current getLength =124390656
2010-11-01 13:34:12,161 INFO org.apache.hadoop.hbase.regionserver.HRegion: Finished memstore flush of ~101.4m for
 region TestTable,0000984576,1288637489953.64980bd9a7d72aeb13a92b3d68fe893e. in 1240ms, sequenceid=51727166, compaction requested=true
2010-11-01 13:34:12,211 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 128729824
2010-11-01 13:34:12,211 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Log roll requested, getLength is 128729824
2010-11-01 13:34:12,215 INFO org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogWriter: Using syncFs -- HDFS-200
2010-11-01 13:34:12,216 WARN org.apache.hadoop.hbase.regionserver.wal.HLog: Rolling a file that&apos;s more than 20% bigger than it should be:
 logrollsize=31876710, getLength =128729824
2010-11-01 13:34:12,221 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Roll
 /hbase-trunk/.logs/hbasedev,60020,1288643625308/10.10.1.177%3A60020.1288643647366, entries=93,
 filesize=128729824. New hlog /hbase-trunk/.logs/hbasedev,60020,1288643625308/10.10.1.177%3A60020.1288643652161
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first reason we let the log outgrow here is the MemStore flush since we can&apos;t do both at the same time. Then, although not in this specific excerpt, we also let a few inserts come in when preparing the HLog rolling due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2922&quot; title=&quot;HLog preparation and cleanup are done under the updateLock, major slowdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2922&quot;&gt;&lt;del&gt;HBASE-2922&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So this may not be a problem since it basically works how it&apos;s supposed to... and it means that under &quot;normal&quot; conditions it&apos;s not likely to go way over the log roll size. I suggest we close this issue.&lt;/p&gt;</comment>
                            <comment id="12927172" author="stack" created="Mon, 1 Nov 2010 21:56:17 +0000"  >&lt;p&gt;Thanks for digging J-D.  I&apos;m good w/ closing this issue.&lt;/p&gt;</comment>
                            <comment id="15017509" author="lars_francke" created="Fri, 20 Nov 2015 12:43:23 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Nov 2010 21:56:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26613</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hkhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100583</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>