<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6720/HBASE-6720.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6720] Optionally limit number of regions balanced in each balancer run</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6720</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3866&quot; title=&quot;Script to add regions gradually to a new regionserver.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3866&quot;&gt;&lt;del&gt;HBASE-3866&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606271">HBASE-6720</key>
            <summary>Optionally limit number of regions balanced in each balancer run</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Sep 2012 17:31:20 +0000</created>
                <updated>Wed, 19 Sep 2012 01:58:06 +0000</updated>
                            <resolved>Mon, 10 Sep 2012 22:33:31 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13448975" author="eclark" created="Wed, 5 Sep 2012 18:30:27 +0000"  >&lt;p&gt;When this is put in we need to make sure to change the StochasticLoadBalancer as well.  It right now has a setting hbase.master.balancer.stochastic.maxMoveRegions that sets the maximum number of regions to move at a time.&lt;/p&gt;</comment>
                            <comment id="13449404" author="lhofhansl" created="Thu, 6 Sep 2012 04:27:51 +0000"  >&lt;p&gt;Thanks Elliot. We&apos;ll just make hbase.master.balancer.stochastic.maxMoveRegion default to the new general setting.&lt;/p&gt;</comment>
                            <comment id="13449434" author="lhofhansl" created="Thu, 6 Sep 2012 05:38:05 +0000"  >&lt;p&gt;This is essentially Ted&apos;s patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3866&quot; title=&quot;Script to add regions gradually to a new regionserver.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3866&quot;&gt;&lt;del&gt;HBASE-3866&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13449440" author="stack" created="Thu, 6 Sep 2012 05:55:30 +0000"  >&lt;p&gt;Consider moving the HConstant change down into the master package since that is only place it is used.&lt;/p&gt;

&lt;p&gt;Also, maybe Ted can answer this, but why are we applying the balance filter outside of a balancer in the HMaster code and not inside the balance code as is done here w/ the Stochastic balancer?&lt;/p&gt;</comment>
                            <comment id="13449448" author="eclark" created="Thu, 6 Sep 2012 06:09:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; For per-table load balancing the balancer is only given regions of one table at a time.  So with the way the DefaultLoadBalancer is configured by default (per table balancing on) there&apos;s no way for to do it in the balancer.  &lt;/p&gt;

&lt;p&gt;Imo way too much balancing logic has leaked into the HMaster class.  I would think that timing and per table balancing should be moved into the Balancer.  That would then allow this limit to be moved into the balancer.&lt;/p&gt;</comment>
                            <comment id="13449459" author="stack" created="Thu, 6 Sep 2012 06:32:38 +0000"  >&lt;p&gt;Ok, then I change to a +1 on patch (with amendment of HConstant addition on commit) given Elliott&apos;s comment.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Imo way too much balancing logic has leaked into the HMaster class. I would think that timing and per table balancing should be moved into the Balancer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.  We need to add more to the Balancer Interface?&lt;/p&gt;</comment>
                            <comment id="13449463" author="eclark" created="Thu, 6 Sep 2012 06:39:52 +0000"  >&lt;p&gt;I&apos;m -1  &lt;br/&gt;
The patch doesn&apos;t work if per table balancing is turned off.  The patch also fails if the number of regions that need to be moved in one table is larger than the limit.&lt;/p&gt;</comment>
                            <comment id="13449811" author="stack" created="Thu, 6 Sep 2012 16:59:34 +0000"  >&lt;p&gt;Thanks Elliott.&lt;/p&gt;

&lt;p&gt;How so?  Won&apos;t all be well on the next go around of the balancer?&lt;/p&gt;</comment>
                            <comment id="13449870" author="eclark" created="Thu, 6 Sep 2012 18:04:15 +0000"  >&lt;p&gt;No you&apos;re right it will work the next time around.  I just mistook where the if statement was located.&lt;/p&gt;</comment>
                            <comment id="13449889" author="yuzhihong@gmail.com" created="Thu, 6 Sep 2012 18:16:00 +0000"  >&lt;p&gt;We already have cutoff time for region balancing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          rpCount++;
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rpCount &amp;lt; plans.size() &amp;amp;&amp;amp;
              &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; performing next balance exceeds cutoff time, exit the loop
&lt;/span&gt;              (&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() + (totalRegPlanExecTime / rpCount)) &amp;gt; cutoffTime) {
            LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;No more balancing till next balance run; maximumBalanceTime=&quot;&lt;/span&gt; +
              maximumBalanceTime);
            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is the above not enough ?&lt;/p&gt;</comment>
                            <comment id="13452520" author="lhofhansl" created="Mon, 10 Sep 2012 22:18:33 +0000"  >&lt;p&gt;Hmm... Maybe this is a none-issue now. I&apos;m happy to close as &quot;won&apos;t fix&quot;.&lt;/p&gt;</comment>
                            <comment id="13452523" author="yuzhihong@gmail.com" created="Mon, 10 Sep 2012 22:21:56 +0000"  >&lt;p&gt;That&apos;s fine.&lt;/p&gt;</comment>
                            <comment id="13452525" author="eclark" created="Mon, 10 Sep 2012 22:23:43 +0000"  >&lt;p&gt;The above code won&apos;t fix the described issue if regions are moving quickly but the load balancer is moving a lot.&lt;/p&gt;</comment>
                            <comment id="13452532" author="lhofhansl" created="Mon, 10 Sep 2012 22:33:31 +0000"  >&lt;p&gt;My bad. I thought this still needed fixing.&lt;/p&gt;</comment>
                            <comment id="13452544" author="eclark" created="Mon, 10 Sep 2012 22:45:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Sorry what I wrote was unclear.  I meant to say:  The code Ted posted won&apos;t stop the load balancer from moving lots of regions if the region moves happen quickly.  cutoffTime is some time way in the future assuming that things are going normally.  So since applying the plans is usually very quick.  All of the plans will be applied. &lt;/p&gt;

&lt;p&gt;If anything I would stopping the LoadBalancer from moving after a certain number of regions is more useful than stopping it after a number of milliseconds. It&apos;s easier to for users to know a good starting value that applies to their cluster.  There&apos;s no way I could tell you right now how long a balance on our cluster takes when a RegionServer goes down.  However I could say the max number of regions that I would want to move at a time.&lt;/p&gt;</comment>
                            <comment id="13452551" author="lhofhansl" created="Mon, 10 Sep 2012 22:56:43 +0000"  >&lt;p&gt;Hey Elliot... We had comment crossing. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Ok, so I take it, the patch is good after all, and we should apply (with the move of the constant as Stack suggests).&lt;br/&gt;
(Didn&apos;t spend much time actually looking at the code... Should probably do so).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12504819">HBASE-3803</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12506466">HBASE-3866</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12543985" name="6720-0.96-v1.txt" size="3259" author="lhofhansl" created="Thu, 6 Sep 2012 05:38:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Sep 2012 18:30:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242519</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02vf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>