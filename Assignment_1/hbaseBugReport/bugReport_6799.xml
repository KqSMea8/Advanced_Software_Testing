<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6799/HBASE-6799.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6799] Store more metadata in HFiles</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6799</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Current we store metadata in HFile:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the timerange of KVs&lt;/li&gt;
	&lt;li&gt;the earliest PUT ts&lt;/li&gt;
	&lt;li&gt;max sequence id&lt;/li&gt;
	&lt;li&gt;whether or not this file was created from a major compaction.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I would like to brainstorm what extra data we need to store to make an HFile self describing. I.e. it could be backed up to somewhere with external tools (without invoking an HBase server) can gleam enough information from it to make use of the data inside. Ideally it would also be nice to be able to recreate .META. from a bunch of HFiles to standup a temporary HBase instance to process a bunch of HFiles.&lt;/p&gt;

&lt;p&gt;What I can think of:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;min/max key&lt;/li&gt;
	&lt;li&gt;table&lt;/li&gt;
	&lt;li&gt;column family (or families to be future proof)&lt;/li&gt;
	&lt;li&gt;custom tags (set by a backup tools for example)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12607851">HBASE-6799</key>
            <summary>Store more metadata in HFiles</summary>
                <type id="13" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Brainstorming</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Sep 2012 04:38:01 +0000</created>
                <updated>Fri, 19 Apr 2013 21:01:57 +0000</updated>
                            <resolved>Fri, 19 Apr 2013 21:01:57 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13457181" author="stack" created="Mon, 17 Sep 2012 17:38:32 +0000"  >&lt;p&gt;Here is dump of hfile metadata from production:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Block index size as per heapsize: 110632
reader=/hbase/ad_campaign_monthly_stumbles/2081100778/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/77955d7c8845435dbcfe7b91a55fd1c4,
    compression=lzo,
    cacheConf=CacheConfig:enabled [cacheDataOnRead=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;] [cacheDataOnWrite=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] [cacheIndexesOnWrite=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] [cacheBloomsOnWrite=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] [cacheEvictOnClose=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] [cacheCompressed=f
    firstKey=100000:2009:06/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:organic/1264629982792/Put,
    lastKey=9:2006:03/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:paid/1260930865681/Put,
    avgKeyLen=38,
    avgValueLen=8,
    entries=1561501,
    length=19277379
Trailer:
    fileinfoOffset=19276842,
    loadOnOpenDataOffset=19248105,
    dataIndexCount=1313,
    metaIndexCount=0,
    totalUncomressedBytes=86064912,
    entryCount=1561501,
    compressionCodec=LZO,
    uncompressedDataIndexSize=67170,
    numDataIndexLevels=1,
    firstDataBlockOffset=0,
    lastDataBlockOffset=19247463,
    comparatorClassName=org.apache.hadoop.hbase.KeyValue$KeyComparator,
    majorVersion=2,
    minorVersion=1
Fileinfo:
    DATA_BLOCK_ENCODING = NONE
    DELETE_FAMILY_COUNT = \x00\x00\x00\x00\x00\x00\x00\x00
    EARLIEST_PUT_TS = \x00\x00\x01%\x95\x02\xD9\xDA
    KEY_VALUE_VERSION = \x00\x00\x00\x01
    MAJOR_COMPACTION_KEY = \xFF
    MAX_MEMSTORE_TS_KEY = \x00\x00\x00\x00\x00\x00\x00\x00
    MAX_SEQ_ID_KEY = 26057054872
    TIMERANGE = 1260925409754....1266607612712
    hfile.AVG_KEY_LEN = 38
    hfile.AVG_VALUE_LEN = 8
    hfile.LASTKEY = \x00\x099:2006:03\x07defaultpaid\x00\x00\x01%\x95V\x1A\x11\x04
Mid-key: \x00\x0D43195:2008:04\x07defaultpaid\x00\x00\x01%\x95W\x9C\x86\x04
Bloom filter:
    Not present
Delete Family Bloom filter:
    Not present
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;d have to look at the code but the above might be made of metadata and a toString on the Reader (Reader might seek the first key on open... and get last key from the hfile meta... which would not be the same as having all this data in the hfile meta).&lt;/p&gt;

&lt;p&gt;Whether its major compacted is already in there... a bunch more could be added.&lt;/p&gt;</comment>
                            <comment id="13457465" author="lhofhansl" created="Mon, 17 Sep 2012 23:23:04 +0000"  >&lt;p&gt;Hmm... That&apos;d be good enough, methinks. I had just looked at the FileInfo code that writes the metadata at the end of a write.&lt;br/&gt;
As long as all this info is available quickly without standing up an HBase instance that&apos;s perfect.&lt;/p&gt;

&lt;p&gt;Looks like I need to do a bit more research &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13459821" author="apurtell" created="Thu, 20 Sep 2012 18:15:22 +0000"  >&lt;p&gt;A generic/custom tags facility would be great, then we can try out a number of things without requiring core patching.&lt;/p&gt;

&lt;p&gt;I would like to see CF access statistics. Could do a snapshot of current CF metrics when the HFile is written. Then we would have a local memory of dynamic per-CF metrics, for such things as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6572&quot; title=&quot;Tiered HFile storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6572&quot;&gt;HBASE-6572&lt;/a&gt;. And compaction could perhaps merge such CF statistics snapshots in HFiles with time based exponential weighting. Further, we might differentiate between &quot;online&quot; measurements (&amp;lt;= 15 minutes) and a longer historical view of per-CF metrics, and initialize the latter after region migration or cold boot from the most recent HFile.&lt;/p&gt;</comment>
                            <comment id="13636880" author="lhofhansl" created="Fri, 19 Apr 2013 21:01:57 +0000"  >&lt;p&gt;Closing this as &quot;Won&apos;t fix&quot;. Can always reopen.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12603333">HBASE-6572</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Sep 2012 17:38:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241708</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02ba7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11429</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>