<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2697/HBASE-2697.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2697] Implement new open/close logic in handlers and stop using heartbeats for open/close messages</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2697</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This issue is doing the meat of what &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2485&quot; title=&quot;Persist Master in-memory state so on restart or failover, new instance can pick up where the old left off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2485&quot;&gt;&lt;del&gt;HBASE-2485&lt;/del&gt;&lt;/a&gt; is about and continues what was started in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2694&quot; title=&quot;Move RS to Master region open/close messaging into ZooKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2694&quot;&gt;&lt;del&gt;HBASE-2694&lt;/del&gt;&lt;/a&gt; after some code cleanup to make life easier.&lt;/p&gt;

&lt;p&gt;This deals with no longer piggybacking messages from Master to RegionServers on heartbeat responses and instead sending direct unsolicited messages.  This also deals with moving the open/close logic fully into handlers and removing the existing open/close code on both the RS and M sides.  There may also be some changes to the master in-memory state of regions in transition.  The new load balancer will probably be introduced with this issue but not fully integrated yet.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466488">HBASE-2697</key>
            <summary>Implement new open/close logic in handlers and stop using heartbeats for open/close messages</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12466475">HBASE-2692</parent>
                                    <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jun 2010 20:00:20 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:59 +0000</updated>
                            <resolved>Wed, 1 Sep 2010 05:05:25 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                    <component>IPC/RPC</component>
                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12881672" author="streamy" created="Wed, 23 Jun 2010 12:53:20 +0000"  >&lt;p&gt;Some first steps on this one:&lt;br/&gt;
1. M-&amp;gt;RS communication for open/close into direct RPC calls&lt;br/&gt;
2. RS-&amp;gt;ZK use a new data structure to put into unassigned nodes rather than HMsg&lt;br/&gt;
3. M: Move open/close region logic into handlers&lt;br/&gt;
4. Move META editing into RS handlers&lt;/p&gt;</comment>
                            <comment id="12881790" author="stack" created="Wed, 23 Jun 2010 17:50:52 +0000"  >&lt;p&gt;.bq 4. Move META editing into RS handlers &lt;/p&gt;

&lt;p&gt;So, now RS does all editing of .META.?  This is so RS doesn&apos;t have to report back to the master and then have master do the update?  What are the thoughts regards metascanner?  When it finds something unassigned, what happens now?  It adds something to unassigned in zk?&lt;/p&gt;
</comment>
                            <comment id="12882034" author="streamy" created="Thu, 24 Jun 2010 04:47:00 +0000"  >&lt;p&gt;Re: metascanner, the discovery of something being unassigned would no longer come for metascanner.&lt;/p&gt;

&lt;p&gt;These are the reasons a region is ever unassigned:&lt;/p&gt;

&lt;p&gt;1) Cluster Startup&lt;br/&gt;
Master knows this condition, we can do a full assignment algorithm that takes into account block locality.&lt;br/&gt;
Use metascanner to get list of all regions but don&apos;t need the metascanner-triggered/heartbeat-based assignment.&lt;br/&gt;
Master will hold the assignment &quot;plan&quot; in memory, send RPCs out to the RSs, and track the transitions regions via zk.&lt;/p&gt;

&lt;p&gt;2) Node Failure&lt;br/&gt;
Master knows this condition, generates an assignment plan for the regions on that node.&lt;br/&gt;
This could use metascanner to get list of regions on that node.&lt;br/&gt;
Another option is to have the master keep an up-to-date map of rs to all of its regions rather than &quot;most loaded&quot; as it is today (now master needs more memory?  need to see how many regions we could track)&lt;br/&gt;
Or each RS could store its hosted regions in zk, or if we ever move META itself into zk, the info would be available from zk.&lt;br/&gt;
(I lean towards using metascanner to get list of regions, we&apos;ll know if any of them were in transition from zk... can always do other stuff later but not necessary for these jiras)&lt;/p&gt;

&lt;p&gt;3) Load Balancing&lt;br/&gt;
Current plan is that this becomes a background thread rather than being calculated on heartbeats.&lt;br/&gt;
Master generates a plan for all the movement of regions, currently we have mostLoadedRegions for each server which serves as candidates, some of the stuff above would make it so we could cheaply know all the regions.  There&apos;s plenty more to do here by taking per-region load info into account but moving to a separate class and background thread makes it easier to get here eventually.&lt;/p&gt;

&lt;p&gt;4) Master Failover&lt;br/&gt;
Master knows this condition.  There&apos;s some discussion on how this would work over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2700&quot; title=&quot;Handle master failover for regions in transition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2700&quot;&gt;&lt;del&gt;HBASE-2700&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Doesn&apos;t need to use metascanner, only needs to make sure to take care of any regions that are in transition and might not get assigned out if it doesn&apos;t take action.&lt;/p&gt;


&lt;p&gt;So we&apos;ll still use the metascanner but it will be triggered as needed rather than the periodic operation it is today.&lt;/p&gt;</comment>
                            <comment id="12882039" author="streamy" created="Thu, 24 Jun 2010 04:53:21 +0000"  >&lt;p&gt;Re: RS doing editing of META, I&apos;m not totally sure yet but was thinking we&apos;d go that way.&lt;/p&gt;

&lt;p&gt;This will only really matter in the case of RS or M failure.  If the RS does it, that means that in case of RS failure the master/zk view could have a region as OPENING but the RS may or may not have edited META.  If M does it, RS could have something opened, zk would say OPENED, but if the master dies, it may or may not have edited META.  The failed-over master would pick up the OPENED node, it would do the META edit, and then delete the node.  I don&apos;t think there&apos;s actually a correctness issue here but does seem that the regions availability is faster if the RS does the edit.&lt;/p&gt;</comment>
                            <comment id="12886157" author="hbasereviewboard" created="Wed, 7 Jul 2010 23:55:45 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/282/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/282/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Just putting this up to show people.  It&apos;s not done but the balanceCluster() method &quot;works&quot; and has a bunch of test cases.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 961064 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestLoadBalancer.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/282/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/282/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added TestLoadBalancer.testLoadBalancer_balanceCluster().  If you have any good edge cases let me know!&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12891862" author="hbasereviewboard" created="Fri, 23 Jul 2010 23:34:16 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-23 16:29:43.251978)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack, Jean-Daniel Cryans, Karthik Ranganathan, and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Should I put above description into the class comment javadoc or is it too much for there?&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This method implements all the zookeeper methods needed for this last part of the doc posted in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt; (definition of valid creation/transitions for unassigned znodes):&lt;/p&gt;


&lt;p&gt;  MASTER&lt;/p&gt;

&lt;p&gt;  1. Master creates an unassigned node as OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup and table enabling.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. Master forces an existing unassigned node to OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RegionServer failure.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Allows transitions from all states to OFFLINE.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. Master deletes an unassigned node that was in a OPENED state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region transitions.  Besides cluster startup, no other deletions&lt;br/&gt;
       of unassigned nodes is allowed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. Master deletes all unassigned nodes regardless of state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup before any assignment happens.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  REGIONSERVER&lt;/p&gt;

&lt;p&gt;  1. RegionServer creates an unassigned node as CLOSING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region closes will do this in response to a CLOSE RPC from Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A node can never be transitioned to CLOSING, only created.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. RegionServer transitions an unassigned node from CLOSING to CLOSED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region closes.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. RegionServer transitions an unassigned node from OFFLINE to OPENING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region opens will do this in response to an OPEN RPC from the Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. RegionServer transitions an unassigned node from OPENING to OPENED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Should I put above into the class comment javadoc or is it too much for there?&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/382/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit test to come.  Just putting up since there have been some recent issues with multiple transitions and stuff, wanted to show what the new stuff looks like.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12891866" author="hbasereviewboard" created="Fri, 23 Jul 2010 23:38:07 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-23 16:26:26.834022)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack, Jean-Daniel Cryans, Karthik Ranganathan, and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Whitespace cleanup&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This method implements all the zookeeper methods needed for this last part of the doc posted in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt; (definition of valid creation/transitions for unassigned znodes):&lt;/p&gt;


&lt;p&gt;  MASTER&lt;/p&gt;

&lt;p&gt;  1. Master creates an unassigned node as OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup and table enabling.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. Master forces an existing unassigned node to OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RegionServer failure.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Allows transitions from all states to OFFLINE.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. Master deletes an unassigned node that was in a OPENED state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region transitions.  Besides cluster startup, no other deletions&lt;br/&gt;
       of unassigned nodes is allowed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. Master deletes all unassigned nodes regardless of state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup before any assignment happens.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  REGIONSERVER&lt;/p&gt;

&lt;p&gt;  1. RegionServer creates an unassigned node as CLOSING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region closes will do this in response to a CLOSE RPC from Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A node can never be transitioned to CLOSING, only created.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. RegionServer transitions an unassigned node from CLOSING to CLOSED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region closes.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. RegionServer transitions an unassigned node from OFFLINE to OPENING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region opens will do this in response to an OPEN RPC from the Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. RegionServer transitions an unassigned node from OPENING to OPENED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/382/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit test to come.  Just putting up since there have been some recent issues with multiple transitions and stuff, wanted to show what the new stuff looks like.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12891867" author="hbasereviewboard" created="Fri, 23 Jul 2010 23:38:26 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, stack, Jean-Daniel Cryans, Karthik Ranganathan, and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This method implements all the zookeeper methods needed for this last part of the doc posted in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt; (definition of valid creation/transitions for unassigned znodes):&lt;/p&gt;


&lt;p&gt;  MASTER&lt;/p&gt;

&lt;p&gt;  1. Master creates an unassigned node as OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup and table enabling.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. Master forces an existing unassigned node to OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RegionServer failure.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Allows transitions from all states to OFFLINE.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. Master deletes an unassigned node that was in a OPENED state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region transitions.  Besides cluster startup, no other deletions&lt;br/&gt;
       of unassigned nodes is allowed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. Master deletes all unassigned nodes regardless of state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup before any assignment happens.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  REGIONSERVER&lt;/p&gt;

&lt;p&gt;  1. RegionServer creates an unassigned node as CLOSING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region closes will do this in response to a CLOSE RPC from Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A node can never be transitioned to CLOSING, only created.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. RegionServer transitions an unassigned node from CLOSING to CLOSED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region closes.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. RegionServer transitions an unassigned node from OFFLINE to OPENING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region opens will do this in response to an OPEN RPC from the Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. RegionServer transitions an unassigned node from OPENING to OPENED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/382/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit test to come.  Just putting up since there have been some recent issues with multiple transitions and stuff, wanted to show what the new stuff looks like.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12891868" author="hbasereviewboard" created="Fri, 23 Jul 2010 23:39:13 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-23 16:28:15.057431)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack, Jean-Daniel Cryans, Karthik Ranganathan, and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Whitespace take 2&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This method implements all the zookeeper methods needed for this last part of the doc posted in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt; (definition of valid creation/transitions for unassigned znodes):&lt;/p&gt;


&lt;p&gt;  MASTER&lt;/p&gt;

&lt;p&gt;  1. Master creates an unassigned node as OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup and table enabling.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. Master forces an existing unassigned node to OFFLINE.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RegionServer failure.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Allows transitions from all states to OFFLINE.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. Master deletes an unassigned node that was in a OPENED state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region transitions.  Besides cluster startup, no other deletions&lt;br/&gt;
       of unassigned nodes is allowed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. Master deletes all unassigned nodes regardless of state.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cluster startup before any assignment happens.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  REGIONSERVER&lt;/p&gt;

&lt;p&gt;  1. RegionServer creates an unassigned node as CLOSING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region closes will do this in response to a CLOSE RPC from Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A node can never be transitioned to CLOSING, only created.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  2. RegionServer transitions an unassigned node from CLOSING to CLOSED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region closes.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3. RegionServer transitions an unassigned node from OFFLINE to OPENING.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All region opens will do this in response to an OPEN RPC from the Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  4. RegionServer transitions an unassigned node from OPENING to OPENED.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Normal region opens.  CAS operation.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/382/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit test to come.  Just putting up since there have been some recent issues with multiple transitions and stuff, wanted to show what the new stuff looks like.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12891870" author="hbasereviewboard" created="Fri, 23 Jul 2010 23:46:34 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-23 16:35:42, Jonathan Gray wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Thinking on it, I will probably need to not just blindly force something to OFFLINE in the masters force to OFFLINE.  Though any state will be able to be transitioned to OFFLINE (during recovery, we may need to restart the assignment of something, setting to OFFLINE first is what allows us to timeout if for some reason an RS doesn&apos;t respond/act on an OPEN rpc), we will want to use more of a CAS operation so we don&apos;t accidentally miss a transition on that node.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; For example, we may timeout an OFFLINE because it took too long, so we want to switch it back to a new version of OFFLINE and assign to someone else.  We&apos;ll want to ensure when setting to OFFLINE it&apos;s still in the previously seen OFFLINE version, otherwise a server may have started OPENING in between our check and set.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;(this is not totally clear to me yet, going to wait until i get a bit further in integration of this class)&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jonathan&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/#review476&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#review476&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12891871" author="hbasereviewboard" created="Fri, 23 Jul 2010 23:47:11 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/#review476&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#review476&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Thinking on it, I will probably need to not just blindly force something to OFFLINE in the masters force to OFFLINE.  Though any state will be able to be transitioned to OFFLINE (during recovery, we may need to restart the assignment of something, setting to OFFLINE first is what allows us to timeout if for some reason an RS doesn&apos;t respond/act on an OPEN rpc), we will want to use more of a CAS operation so we don&apos;t accidentally miss a transition on that node.&lt;/p&gt;

&lt;p&gt;For example, we may timeout an OFFLINE because it took too long, so we want to switch it back to a new version of OFFLINE and assign to someone else.  We&apos;ll want to ensure when setting to OFFLINE it&apos;s still in the previously seen OFFLINE version, otherwise a server may have started OPENING in between our check and set.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jonathan&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12892848" author="hbasereviewboard" created="Tue, 27 Jul 2010 16:48:25 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/382/#review498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#review498&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/382/#comment2019&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#comment2019&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Put your big doc up here in class comment?  Or you want to make a document of it?  Or you want me to do it for you?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/382/#comment2016&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#comment2016&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The way this method is named would seem to imply it does something internally that has to do w/ &apos;offlining&apos; but all I see is the createAndWatch and passing of whatever is in data.getBytes().  It makes me think this method is not properly scoped &amp;#8211; that it should be doing more?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/382/#comment2017&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#comment2017&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Great javadoc.&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/382/#comment2018&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#comment2018&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I have the same issue w/ this method.  You are passing in the &apos;generic&apos; RegionTransitionData type which seems like it could be anything?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/382/#comment2020&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#comment2020&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This method is same as createNodeOffline but for the log message.  As said above, it makes me think the method should be broader&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/382/#comment2021&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/382/#comment2021&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats in the &apos;data&apos; passed in here?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12894873" author="hbasereviewboard" created="Tue, 3 Aug 2010 12:15:46 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-03 05:02:49.124462)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is basically the master rewrite.  It&apos;s massive, I apologize.  I can start a cluster, create a table, insert a row, and get the row.  Restarting should work too.&lt;/p&gt;

&lt;p&gt;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former but there&apos;s a bit of work to fully replace the latter though I think it&apos;s a desirable direction to get rid of it.  The RSOQ stuff has been replaced with EventHandlers.  The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;/p&gt;

&lt;p&gt;All the table operations (enable/disable, create/delete, addcolumn/del/modify) have been reimplemented in handlers.&lt;/p&gt;

&lt;p&gt;All META/ROOT server access is done through the new CatalogManager.  This uses ZK and ROOT/META to keep active track of the current locations of the catalog regions.  A bit more work needs to be done on defining our retry semantics for different operations.&lt;/p&gt;

&lt;p&gt;The actual read/write operations on ROOT/META are done with new classes RootEditor, MetaEditor, and MetaReader.  A lot of this code was scattered around HMaster, RegionManager, ServerManager, HRegion, etc...&lt;/p&gt;

&lt;p&gt;Some new methods in FileSystemManager, collected from being scattered around.&lt;/p&gt;

&lt;p&gt;This also does final straw to old ZKWrapper and removes it.  All ZK stuff is going through the new stuff.&lt;/p&gt;

&lt;p&gt;Open/close is now going via RPC and ZK, no longer piggybacking any of these messages on heartbeats (and with splits not working right now, even that is gone, so there will be nothing it seems)&lt;/p&gt;

&lt;p&gt;RegionManager was completely removed and replaced with a shiny, brand new AssignmentManager.  It&apos;s already managed to get a bit hectic but is pretty straightforward.  It is the heart of zk-based region assignment and most logic is in here.  It contains regionsInTransition, the region plans, etc...&lt;/p&gt;

&lt;p&gt;I added a new /disabled node in ZK to keep track of tables that are disabled.  I think we need this to be able to reliably do disables across failures.&lt;/p&gt;

&lt;p&gt;Among other changes....&lt;/p&gt;


&lt;p&gt;Here&apos;s my rough list of things left to do (covers most but not all TODOs in the branch)&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;make final decisions on root/meta timeouts.  almost everyone is coordinating&lt;br/&gt;
  access through CatalogTracker which should make it easy to standardize.&lt;br/&gt;
  if there are operations that should just retry indefinitely, they need to&lt;br/&gt;
  resubmit themselves to their executor service.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;move splits to RS side, integrate new patch from stack on trunk&lt;br/&gt;
  might need a new CREATED unassigned now, or new rpc, but get rid of sending&lt;br/&gt;
  split notification on heartbeat?&lt;br/&gt;
  how to handle splits concurrent with disable?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review master startup order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure what to do with client table admin ops (flush, split, compact)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MasterAddressManager move to extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on region open (and wherever split children notify master) should check if&lt;br/&gt;
  if the table is disabled and should close the regions... maybe.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;regionserver exit needs to be reimplemented in servermanager&lt;br/&gt;
  also rs expiration&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add priorities and pool size to handlers (bring in from flush patch)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in RootEditor there is a race condition between delete and watch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestZKBased* tests to use new handlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;make sync calls for enable/disable (check and verify methods?)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;integrate load balancing&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on new failover path and remove old code in joinExistingCluster()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on timeout monitor in assignmentmanager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review filesystemmanager calls&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure how to handle the very rare but possible race condition where two&lt;br/&gt;
  RSs will update META and the later one can squash the valid one if there was&lt;br/&gt;
  a long gc pause&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;synchronize all access to the boolean in ActiveMasterManager&lt;br/&gt;
  (now this is probably just move it to extend ZKNodeTracker)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;there are some races with master wanting to connect for rpc&lt;br/&gt;
  to regionserver and the rs starting its rpc server, need to address&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestMasterTransitions or make new?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix or remove last couple master tests that used RSOQ&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;write new tests!!!&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/BRANCH_TODO.txt 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/Abortable.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/InvalidFamilyException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/RootEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseEventHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseExecutorService.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/RegionTransitionData.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AddColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ChangeTableState.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ColumnOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/DeleteColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/FileSystemManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyTableMeta.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RetryableMetaOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RootScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableDelete.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterCloseRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterOpenRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/RootRegionTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTableDisable.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 979909 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/484/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple cluster tests passing, need to run (and write) more tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12894874" author="hbasereviewboard" created="Tue, 3 Aug 2010 12:15:57 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, stack and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is basically the master rewrite.  It&apos;s massive, I apologize.  I can start a cluster, create a table, insert a row, and get the row.  Restarting should work too.&lt;/p&gt;

&lt;p&gt;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former but there&apos;s a bit of work to fully replace the latter though I think it&apos;s a desirable direction to get rid of it.  The RSOQ stuff has been replaced with EventHandlers.  The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;/p&gt;

&lt;p&gt;All the table operations (enable/disable, create/delete, addcolumn/del/modify) have been reimplemented in handlers.&lt;/p&gt;

&lt;p&gt;All META/ROOT server access is done through the new CatalogManager.  This uses ZK and ROOT/META to keep active track of the current locations of the catalog regions.  A bit more work needs to be done on defining our retry semantics for different operations.&lt;/p&gt;

&lt;p&gt;The actual read/write operations on ROOT/META are done with new classes RootEditor, MetaEditor, and MetaReader.  A lot of this code was scattered around HMaster, RegionManager, ServerManager, HRegion, etc...&lt;/p&gt;

&lt;p&gt;Some new methods in FileSystemManager, collected from being scattered around.&lt;/p&gt;

&lt;p&gt;This also does final straw to old ZKWrapper and removes it.  All ZK stuff is going through the new stuff.&lt;/p&gt;

&lt;p&gt;Open/close is now going via RPC and ZK, no longer piggybacking any of these messages on heartbeats (and with splits not working right now, even that is gone, so there will be nothing it seems)&lt;/p&gt;

&lt;p&gt;RegionManager was completely removed and replaced with a shiny, brand new AssignmentManager.  It&apos;s already managed to get a bit hectic but is pretty straightforward.  It is the heart of zk-based region assignment and most logic is in here.  It contains regionsInTransition, the region plans, etc...&lt;/p&gt;

&lt;p&gt;I added a new /disabled node in ZK to keep track of tables that are disabled.  I think we need this to be able to reliably do disables across failures.&lt;/p&gt;

&lt;p&gt;Among other changes....&lt;/p&gt;


&lt;p&gt;Here&apos;s my rough list of things left to do (covers most but not all TODOs in the branch)&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;make final decisions on root/meta timeouts.  almost everyone is coordinating&lt;br/&gt;
  access through CatalogTracker which should make it easy to standardize.&lt;br/&gt;
  if there are operations that should just retry indefinitely, they need to&lt;br/&gt;
  resubmit themselves to their executor service.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;move splits to RS side, integrate new patch from stack on trunk&lt;br/&gt;
  might need a new CREATED unassigned now, or new rpc, but get rid of sending&lt;br/&gt;
  split notification on heartbeat?&lt;br/&gt;
  how to handle splits concurrent with disable?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review master startup order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure what to do with client table admin ops (flush, split, compact)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MasterAddressManager move to extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on region open (and wherever split children notify master) should check if&lt;br/&gt;
  if the table is disabled and should close the regions... maybe.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;regionserver exit needs to be reimplemented in servermanager&lt;br/&gt;
  also rs expiration&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add priorities and pool size to handlers (bring in from flush patch)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in RootEditor there is a race condition between delete and watch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestZKBased* tests to use new handlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;make sync calls for enable/disable (check and verify methods?)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;integrate load balancing&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on new failover path and remove old code in joinExistingCluster()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on timeout monitor in assignmentmanager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review filesystemmanager calls&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure how to handle the very rare but possible race condition where two&lt;br/&gt;
  RSs will update META and the later one can squash the valid one if there was&lt;br/&gt;
  a long gc pause&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;synchronize all access to the boolean in ActiveMasterManager&lt;br/&gt;
  (now this is probably just move it to extend ZKNodeTracker)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;there are some races with master wanting to connect for rpc&lt;br/&gt;
  to regionserver and the rs starting its rpc server, need to address&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestMasterTransitions or make new?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix or remove last couple master tests that used RSOQ&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;write new tests!!!&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/BRANCH_TODO.txt 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/Abortable.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/InvalidFamilyException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/RootEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseEventHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseExecutorService.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/RegionTransitionData.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AddColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ChangeTableState.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ColumnOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/DeleteColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/FileSystemManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyTableMeta.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RetryableMetaOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RootScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableDelete.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterCloseRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterOpenRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/RootRegionTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTableDisable.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 979909 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/484/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple cluster tests passing, need to run (and write) more tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12895052" author="hbasereviewboard" created="Tue, 3 Aug 2010 21:46:08 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/#review636&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#review636&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;First pass, still trying to understand what&apos;s going on&lt;/p&gt;


&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2393&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2393&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    unused?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2383&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2383&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2388&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2388&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE, server can be null&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2384&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2384&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2385&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2386&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2386&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2387&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2387&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE, metaServer can be null&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2389&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2389&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2397&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2397&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    javadoc for this method and the next one&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2401&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2401&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This method and a few other ones in this class looks almost the same, I think there&apos;s a refactoring potential&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2390&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2390&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Possible NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2398&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2398&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Somehow this line looks weird to me, not sure if it&apos;s how you build the row or that you don&apos;t use a final for &quot;,,&quot;&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2391&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2391&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2392&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    NPE&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2402&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2402&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    could enclose in a ifDebugEnabled&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2404&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2404&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Javadoc looks anemic compared to the importance of that class&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2405&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2405&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Could you handle if regionState is null at this level?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2406&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2406&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this code coming back later?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2407&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2407&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Looks fishy, what happens if anyone uses that state outside of that method?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2409&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2409&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Any investigation needed?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2410&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2410&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What happens if it never returns? Also I wonder if it&apos;s feasible that the assignment somehow ends up waiting on itself because of region server failure&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2412&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2412&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I see red boxes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2413&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2413&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    red&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12895095" author="hbasereviewboard" created="Wed, 4 Aug 2010 00:06:19 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/#review646&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#review646&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I only got to first file and didn&apos;t even finish that... will do more later&lt;/p&gt;


&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2424&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2424&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why not let it be on the heartbeat? We have to have a handler for case where it does not make it across anyways?  Or is it because there is no longer a mechanism for taking action on heartbeat other than the passing of server load?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2425&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2425&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Disable/Enable has to be sloppy and allow splits to come in.  You could set a disabling flag in zk but there&apos;d be a race between the &quot;point of no return&quot;, the updating of meta that parent is offlined, and checking flag in zk.&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2426&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do the old ones works still?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2427&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2427&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Nah&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12895100" author="hbasereviewboard" created="Wed, 4 Aug 2010 00:20:16 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-03 17:13:11.559426)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;MasterAddressManager stripped down and now extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;cleaned up synchronization a bit in AssignmentManager.assign()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;added priorities and configurable thread pool sizes to EventHandlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;added priorities ROOT/META/USER to OpenRegionHandler&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fixed bug in CloseRegionHandler&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrated TestZKBasedCloseRegion to new stuff and it works (but needs cluster&lt;br/&gt;
  shutdown to be finished)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrated TestZKBasedReopenRegion but not working.  for some reason the master&lt;br/&gt;
  does not get the ZK notifications for the close of the region.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is basically the master rewrite.  It&apos;s massive, I apologize.  I can start a cluster, create a table, insert a row, and get the row.  Restarting should work too.&lt;/p&gt;

&lt;p&gt;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former but there&apos;s a bit of work to fully replace the latter though I think it&apos;s a desirable direction to get rid of it.  The RSOQ stuff has been replaced with EventHandlers.  The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;/p&gt;

&lt;p&gt;All the table operations (enable/disable, create/delete, addcolumn/del/modify) have been reimplemented in handlers.&lt;/p&gt;

&lt;p&gt;All META/ROOT server access is done through the new CatalogManager.  This uses ZK and ROOT/META to keep active track of the current locations of the catalog regions.  A bit more work needs to be done on defining our retry semantics for different operations.&lt;/p&gt;

&lt;p&gt;The actual read/write operations on ROOT/META are done with new classes RootEditor, MetaEditor, and MetaReader.  A lot of this code was scattered around HMaster, RegionManager, ServerManager, HRegion, etc...&lt;/p&gt;

&lt;p&gt;Some new methods in FileSystemManager, collected from being scattered around.&lt;/p&gt;

&lt;p&gt;This also does final straw to old ZKWrapper and removes it.  All ZK stuff is going through the new stuff.&lt;/p&gt;

&lt;p&gt;Open/close is now going via RPC and ZK, no longer piggybacking any of these messages on heartbeats (and with splits not working right now, even that is gone, so there will be nothing it seems)&lt;/p&gt;

&lt;p&gt;RegionManager was completely removed and replaced with a shiny, brand new AssignmentManager.  It&apos;s already managed to get a bit hectic but is pretty straightforward.  It is the heart of zk-based region assignment and most logic is in here.  It contains regionsInTransition, the region plans, etc...&lt;/p&gt;

&lt;p&gt;I added a new /disabled node in ZK to keep track of tables that are disabled.  I think we need this to be able to reliably do disables across failures.&lt;/p&gt;

&lt;p&gt;Among other changes....&lt;/p&gt;


&lt;p&gt;Here&apos;s my rough list of things left to do (covers most but not all TODOs in the branch)&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;make final decisions on root/meta timeouts.  almost everyone is coordinating&lt;br/&gt;
  access through CatalogTracker which should make it easy to standardize.&lt;br/&gt;
  if there are operations that should just retry indefinitely, they need to&lt;br/&gt;
  resubmit themselves to their executor service.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;move splits to RS side, integrate new patch from stack on trunk&lt;br/&gt;
  might need a new CREATED unassigned now, or new rpc, but get rid of sending&lt;br/&gt;
  split notification on heartbeat?&lt;br/&gt;
  how to handle splits concurrent with disable?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review master startup order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure what to do with client table admin ops (flush, split, compact)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MasterAddressManager move to extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on region open (and wherever split children notify master) should check if&lt;br/&gt;
  if the table is disabled and should close the regions... maybe.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;regionserver exit needs to be reimplemented in servermanager&lt;br/&gt;
  also rs expiration&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add priorities and pool size to handlers (bring in from flush patch)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in RootEditor there is a race condition between delete and watch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestZKBased* tests to use new handlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;make sync calls for enable/disable (check and verify methods?)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;integrate load balancing&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on new failover path and remove old code in joinExistingCluster()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on timeout monitor in assignmentmanager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review filesystemmanager calls&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure how to handle the very rare but possible race condition where two&lt;br/&gt;
  RSs will update META and the later one can squash the valid one if there was&lt;br/&gt;
  a long gc pause&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;synchronize all access to the boolean in ActiveMasterManager&lt;br/&gt;
  (now this is probably just move it to extend ZKNodeTracker)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;there are some races with master wanting to connect for rpc&lt;br/&gt;
  to regionserver and the rs starting its rpc server, need to address&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestMasterTransitions or make new?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix or remove last couple master tests that used RSOQ&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;write new tests!!!&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/BRANCH_TODO.txt 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/Abortable.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/InvalidFamilyException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/RootEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseEventHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseExecutorService.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/RegionTransitionData.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AddColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ChangeTableState.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ColumnOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/DeleteColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/FileSystemManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyTableMeta.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RetryableMetaOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RootScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableDelete.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterCloseRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterOpenRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ClusterStatusTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/RootRegionTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTableDisable.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedCloseRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedReopenRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java 979909 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/484/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple cluster tests passing, need to run (and write) more tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12895143" author="hbasereviewboard" created="Wed, 4 Aug 2010 04:58:44 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/#review658&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#review658&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Here&apos;s a bit more on the TODO and the comments on patch.&lt;/p&gt;


&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2443&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2443&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    First some comments on your summary:&lt;/p&gt;

&lt;p&gt;    &quot;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former ... The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;br/&gt;
    &quot;&lt;/p&gt;

&lt;p&gt;    How are splits to work then? The RS does insert into META? But if it doesn&apos;t do all inserts &amp;#8211; fails between offlining of parent and addition of daughters to meta &amp;#8211; we&apos;ll need the fixup for when a split is not fully reported.  This used to be done in basescanner.&lt;/p&gt;

&lt;p&gt;    &quot;might need a new CREATED unassigned now, or new rpc, but get rid of sending split notification on heartbeat?&quot;&lt;/p&gt;

&lt;p&gt;    Who&apos;d make the above CREATED?&lt;/p&gt;

&lt;p&gt;    &quot;figure what to do with client table admin ops (flush, split, compact)&quot;&lt;/p&gt;

&lt;p&gt;    The operations are in place, you are just asking about how to send the messages?&lt;/p&gt;






&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2444&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2444&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why would they be updating the same row?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2446&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2446&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You renamed these classes or the ZK changes are done?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/BRANCH_TODO.txt&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2447&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2447&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I like just reusing is meta idea for now&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2448&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2448&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No benefit to be got making this a NavigableMap/SortedMap?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12895144" author="hbasereviewboard" created="Wed, 4 Aug 2010 05:03:56 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-03 21:55:46.272720)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;added three new rpc methods to RS: flushRegion, splitRegion, compactRegion&lt;br/&gt;
  still needs to be changed in the client&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;implemented remaining TODOs on new failover path&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;remove old failover code&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;full renovation of HMaster.modifyTable() back to just updating table htd&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;implemented remaining TODOs on timeout monitor&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is basically the master rewrite.  It&apos;s massive, I apologize.  I can start a cluster, create a table, insert a row, and get the row.  Restarting should work too.&lt;/p&gt;

&lt;p&gt;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former but there&apos;s a bit of work to fully replace the latter though I think it&apos;s a desirable direction to get rid of it.  The RSOQ stuff has been replaced with EventHandlers.  The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;/p&gt;

&lt;p&gt;All the table operations (enable/disable, create/delete, addcolumn/del/modify) have been reimplemented in handlers.&lt;/p&gt;

&lt;p&gt;All META/ROOT server access is done through the new CatalogManager.  This uses ZK and ROOT/META to keep active track of the current locations of the catalog regions.  A bit more work needs to be done on defining our retry semantics for different operations.&lt;/p&gt;

&lt;p&gt;The actual read/write operations on ROOT/META are done with new classes RootEditor, MetaEditor, and MetaReader.  A lot of this code was scattered around HMaster, RegionManager, ServerManager, HRegion, etc...&lt;/p&gt;

&lt;p&gt;Some new methods in FileSystemManager, collected from being scattered around.&lt;/p&gt;

&lt;p&gt;This also does final straw to old ZKWrapper and removes it.  All ZK stuff is going through the new stuff.&lt;/p&gt;

&lt;p&gt;Open/close is now going via RPC and ZK, no longer piggybacking any of these messages on heartbeats (and with splits not working right now, even that is gone, so there will be nothing it seems)&lt;/p&gt;

&lt;p&gt;RegionManager was completely removed and replaced with a shiny, brand new AssignmentManager.  It&apos;s already managed to get a bit hectic but is pretty straightforward.  It is the heart of zk-based region assignment and most logic is in here.  It contains regionsInTransition, the region plans, etc...&lt;/p&gt;

&lt;p&gt;I added a new /disabled node in ZK to keep track of tables that are disabled.  I think we need this to be able to reliably do disables across failures.&lt;/p&gt;

&lt;p&gt;Among other changes....&lt;/p&gt;


&lt;p&gt;Here&apos;s my rough list of things left to do (covers most but not all TODOs in the branch)&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;make final decisions on root/meta timeouts.  almost everyone is coordinating&lt;br/&gt;
  access through CatalogTracker which should make it easy to standardize.&lt;br/&gt;
  if there are operations that should just retry indefinitely, they need to&lt;br/&gt;
  resubmit themselves to their executor service.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;move splits to RS side, integrate new patch from stack on trunk&lt;br/&gt;
  might need a new CREATED unassigned now, or new rpc, but get rid of sending&lt;br/&gt;
  split notification on heartbeat?&lt;br/&gt;
  how to handle splits concurrent with disable?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review master startup order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure what to do with client table admin ops (flush, split, compact)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MasterAddressManager move to extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on region open (and wherever split children notify master) should check if&lt;br/&gt;
  if the table is disabled and should close the regions... maybe.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;regionserver exit needs to be reimplemented in servermanager&lt;br/&gt;
  also rs expiration&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add priorities and pool size to handlers (bring in from flush patch)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in RootEditor there is a race condition between delete and watch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestZKBased* tests to use new handlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;make sync calls for enable/disable (check and verify methods?)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;integrate load balancing&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on new failover path and remove old code in joinExistingCluster()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on timeout monitor in assignmentmanager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review filesystemmanager calls&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure how to handle the very rare but possible race condition where two&lt;br/&gt;
  RSs will update META and the later one can squash the valid one if there was&lt;br/&gt;
  a long gc pause&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;synchronize all access to the boolean in ActiveMasterManager&lt;br/&gt;
  (now this is probably just move it to extend ZKNodeTracker)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;there are some races with master wanting to connect for rpc&lt;br/&gt;
  to regionserver and the rs starting its rpc server, need to address&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestMasterTransitions or make new?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix or remove last couple master tests that used RSOQ&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;write new tests!!!&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/BRANCH_TODO.txt 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/Abortable.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/InvalidFamilyException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/RootEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseEventHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseExecutorService.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/RegionTransitionData.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AddColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ChangeTableState.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ColumnOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/DeleteColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/FileSystemManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyTableMeta.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RetryableMetaOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RootScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableDelete.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterCloseRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterOpenRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ClusterStatusTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/RootRegionTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTableDisable.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedCloseRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedReopenRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java 979909 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/484/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple cluster tests passing, need to run (and write) more tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12895333" author="hbasereviewboard" created="Wed, 4 Aug 2010 17:47:24 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-04 10:37:33.110269)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Not much new, just started work on client-side new admin functions.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is basically the master rewrite.  It&apos;s massive, I apologize.  I can start a cluster, create a table, insert a row, and get the row.  Restarting should work too.&lt;/p&gt;

&lt;p&gt;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former but there&apos;s a bit of work to fully replace the latter though I think it&apos;s a desirable direction to get rid of it.  The RSOQ stuff has been replaced with EventHandlers.  The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;/p&gt;

&lt;p&gt;All the table operations (enable/disable, create/delete, addcolumn/del/modify) have been reimplemented in handlers.&lt;/p&gt;

&lt;p&gt;All META/ROOT server access is done through the new CatalogManager.  This uses ZK and ROOT/META to keep active track of the current locations of the catalog regions.  A bit more work needs to be done on defining our retry semantics for different operations.&lt;/p&gt;

&lt;p&gt;The actual read/write operations on ROOT/META are done with new classes RootEditor, MetaEditor, and MetaReader.  A lot of this code was scattered around HMaster, RegionManager, ServerManager, HRegion, etc...&lt;/p&gt;

&lt;p&gt;Some new methods in FileSystemManager, collected from being scattered around.&lt;/p&gt;

&lt;p&gt;This also does final straw to old ZKWrapper and removes it.  All ZK stuff is going through the new stuff.&lt;/p&gt;

&lt;p&gt;Open/close is now going via RPC and ZK, no longer piggybacking any of these messages on heartbeats (and with splits not working right now, even that is gone, so there will be nothing it seems)&lt;/p&gt;

&lt;p&gt;RegionManager was completely removed and replaced with a shiny, brand new AssignmentManager.  It&apos;s already managed to get a bit hectic but is pretty straightforward.  It is the heart of zk-based region assignment and most logic is in here.  It contains regionsInTransition, the region plans, etc...&lt;/p&gt;

&lt;p&gt;I added a new /disabled node in ZK to keep track of tables that are disabled.  I think we need this to be able to reliably do disables across failures.&lt;/p&gt;

&lt;p&gt;Among other changes....&lt;/p&gt;


&lt;p&gt;Here&apos;s my rough list of things left to do (covers most but not all TODOs in the branch)&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;make final decisions on root/meta timeouts.  almost everyone is coordinating&lt;br/&gt;
  access through CatalogTracker which should make it easy to standardize.&lt;br/&gt;
  if there are operations that should just retry indefinitely, they need to&lt;br/&gt;
  resubmit themselves to their executor service.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;move splits to RS side, integrate new patch from stack on trunk&lt;br/&gt;
  might need a new CREATED unassigned now, or new rpc, but get rid of sending&lt;br/&gt;
  split notification on heartbeat?&lt;br/&gt;
  how to handle splits concurrent with disable?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review master startup order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure what to do with client table admin ops (flush, split, compact)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MasterAddressManager move to extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on region open (and wherever split children notify master) should check if&lt;br/&gt;
  if the table is disabled and should close the regions... maybe.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;regionserver exit needs to be reimplemented in servermanager&lt;br/&gt;
  also rs expiration&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add priorities and pool size to handlers (bring in from flush patch)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in RootEditor there is a race condition between delete and watch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestZKBased* tests to use new handlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;make sync calls for enable/disable (check and verify methods?)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;integrate load balancing&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on new failover path and remove old code in joinExistingCluster()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on timeout monitor in assignmentmanager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review filesystemmanager calls&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure how to handle the very rare but possible race condition where two&lt;br/&gt;
  RSs will update META and the later one can squash the valid one if there was&lt;br/&gt;
  a long gc pause&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;synchronize all access to the boolean in ActiveMasterManager&lt;br/&gt;
  (now this is probably just move it to extend ZKNodeTracker)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;there are some races with master wanting to connect for rpc&lt;br/&gt;
  to regionserver and the rs starting its rpc server, need to address&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestMasterTransitions or make new?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix or remove last couple master tests that used RSOQ&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;write new tests!!!&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/BRANCH_TODO.txt 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/Abortable.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/InvalidFamilyException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/RootEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnection.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseEventHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseExecutorService.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/RegionTransitionData.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AddColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ChangeTableState.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ColumnOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/DeleteColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/FileSystemManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyTableMeta.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RetryableMetaOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RootScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableDelete.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterCloseRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterOpenRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ClusterStatusTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/RootRegionTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTableDisable.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedCloseRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedReopenRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java 979909 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/484/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple cluster tests passing, need to run (and write) more tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12895535" author="hbasereviewboard" created="Thu, 5 Aug 2010 03:47:19 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/#review676&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#review676&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I sat w/ Jon today.  We went over it.  Loads of issues still but its overwhelmed by mountains of improvements.  I&apos;m good w/ committing this massive patch on branch.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12895578" author="streamy" created="Thu, 5 Aug 2010 07:14:19 +0000"  >&lt;p&gt;This v10 is mega patch committed to the branch, all 18k lines of it.  Thanks for reviews stack, your turn. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12895580" author="streamy" created="Thu, 5 Aug 2010 07:17:56 +0000"  >&lt;p&gt;The v10 patch covers the initial implementations for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2698&quot; title=&quot;Reimplement cluster startup to use new load balancer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2698&quot;&gt;&lt;del&gt;HBASE-2698&lt;/del&gt;&lt;/a&gt;, still missing the actual thread and execution for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2699&quot; title=&quot;Reimplement load balancing to be a background process and to not use heartbeats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2699&quot;&gt;&lt;del&gt;HBASE-2699&lt;/del&gt;&lt;/a&gt; but it&apos;s there, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2700&quot; title=&quot;Handle master failover for regions in transition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2700&quot;&gt;&lt;del&gt;HBASE-2700&lt;/del&gt;&lt;/a&gt; (largely untested), and part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2701&quot; title=&quot;Move user-triggered region admin methods (compact/split/flush) to go directly to RS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2701&quot;&gt;&lt;del&gt;HBASE-2701&lt;/del&gt;&lt;/a&gt; (done on server-side, need to finish client-side, big fixes are putting CatalogTracker in client and moving flush/split/compact into handlers)&lt;/p&gt;</comment>
                            <comment id="12895581" author="hbasereviewboard" created="Thu, 5 Aug 2010 07:29:22 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-05 00:19:37.074497)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;notes from 8/4 (with what i did tonight for them, which is most of what is different in this update)&lt;br/&gt;
&amp;#8212;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in CatalogTracker need to stabilize on one getRoot and one getMeta method to&lt;br/&gt;
  use that waits and uses the default wait-for-catalogs timeout.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  We should get rid of the &apos;refresh&apos; boolean that I have in there and&lt;br/&gt;
  should always ping the server to ensure it is serving the region before we&lt;br/&gt;
  return it.  If we do eventually drop root and put the meta locations into zk&lt;br/&gt;
  we would no longer need this, so will not always have to pay this tax.&lt;/p&gt;

&lt;p&gt;  &amp;gt;&amp;gt;  This is done.  You pass default timeout in constructor.  Two methods now are:&lt;/p&gt;

&lt;p&gt;      waitForRootServerConnectionDefault()&lt;br/&gt;
      waitForMetaServerConnectionDefault()&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;ROOT changes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  RootEditor -&amp;gt; RootLocationEditor, delete -&amp;gt; unset&lt;/p&gt;

&lt;p&gt;  Change the way we unset the root location.  Set the data to null rather than&lt;br/&gt;
  deleting the node.  Requires changes to RootLocationEditor and RootRegionTracker.&lt;/p&gt;

&lt;p&gt;  &amp;gt;&amp;gt;  Thought there was a race condition here, but there is not.  In fact, we do&lt;br/&gt;
  not even need to set the watch in the delete method.  It is already properly&lt;br/&gt;
  being handled by RootRegionTracker.&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;In AssignmentManager.processFailure() need to insert RegionState into RIT map&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &amp;gt;&amp;gt;  This is done.  This needs tests but I think failover is all in place now.&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;On RS-side, make separate OpenRootHandler and OpenMetaHandler&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &amp;gt;&amp;gt;  Added four new handlers for open/close of root/meta and associated&lt;br/&gt;
      executors&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;Add priorities to Opened/Closed handlers on Master&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &amp;gt;&amp;gt;  Added ROOT, META, USER priorities&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;In RegionTransitionData, store the actual byte[] regionName rather than&lt;br/&gt;
  the encoded name&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &amp;gt;&amp;gt;  Done.  We should also get in practice of naming variables encodedName if&lt;br/&gt;
      it is that.&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;Executor services need to be using a priority queue&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &amp;gt;&amp;gt;  Done.  I think all stuff to set pool size and add priorities is in.&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;In EventType, completely remove differentiating between Master and RS.&lt;br/&gt;
  This means for a given EventType, it will map to the same handler whether it&lt;br/&gt;
  is on RS or Master.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &amp;gt;&amp;gt;  Done.&lt;/p&gt;

&lt;p&gt;  Also in EventType, remove fromByte() and use an ordinal() method&lt;/p&gt;

&lt;p&gt;  &amp;gt;&amp;gt;  Done.  Can we remove even having the (int) values for the enums now?&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is basically the master rewrite.  It&apos;s massive, I apologize.  I can start a cluster, create a table, insert a row, and get the row.  Restarting should work too.&lt;/p&gt;

&lt;p&gt;I completely ripped out BaseScanner/MetaScanner as well as the RegionServerOperationQueue stuff.  I&apos;m sold on the former but there&apos;s a bit of work to fully replace the latter though I think it&apos;s a desirable direction to get rid of it.  The RSOQ stuff has been replaced with EventHandlers.  The BaseScanner is no longer necessary because we are not utilizing META to determine when things are unassigned.&lt;/p&gt;

&lt;p&gt;All the table operations (enable/disable, create/delete, addcolumn/del/modify) have been reimplemented in handlers.&lt;/p&gt;

&lt;p&gt;All META/ROOT server access is done through the new CatalogManager.  This uses ZK and ROOT/META to keep active track of the current locations of the catalog regions.  A bit more work needs to be done on defining our retry semantics for different operations.&lt;/p&gt;

&lt;p&gt;The actual read/write operations on ROOT/META are done with new classes RootEditor, MetaEditor, and MetaReader.  A lot of this code was scattered around HMaster, RegionManager, ServerManager, HRegion, etc...&lt;/p&gt;

&lt;p&gt;Some new methods in FileSystemManager, collected from being scattered around.&lt;/p&gt;

&lt;p&gt;This also does final straw to old ZKWrapper and removes it.  All ZK stuff is going through the new stuff.&lt;/p&gt;

&lt;p&gt;Open/close is now going via RPC and ZK, no longer piggybacking any of these messages on heartbeats (and with splits not working right now, even that is gone, so there will be nothing it seems)&lt;/p&gt;

&lt;p&gt;RegionManager was completely removed and replaced with a shiny, brand new AssignmentManager.  It&apos;s already managed to get a bit hectic but is pretty straightforward.  It is the heart of zk-based region assignment and most logic is in here.  It contains regionsInTransition, the region plans, etc...&lt;/p&gt;

&lt;p&gt;I added a new /disabled node in ZK to keep track of tables that are disabled.  I think we need this to be able to reliably do disables across failures.&lt;/p&gt;

&lt;p&gt;Among other changes....&lt;/p&gt;


&lt;p&gt;Here&apos;s my rough list of things left to do (covers most but not all TODOs in the branch)&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;make final decisions on root/meta timeouts.  almost everyone is coordinating&lt;br/&gt;
  access through CatalogTracker which should make it easy to standardize.&lt;br/&gt;
  if there are operations that should just retry indefinitely, they need to&lt;br/&gt;
  resubmit themselves to their executor service.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;move splits to RS side, integrate new patch from stack on trunk&lt;br/&gt;
  might need a new CREATED unassigned now, or new rpc, but get rid of sending&lt;br/&gt;
  split notification on heartbeat?&lt;br/&gt;
  how to handle splits concurrent with disable?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review master startup order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure what to do with client table admin ops (flush, split, compact)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MasterAddressManager move to extending ZooKeeperNodeTracker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on region open (and wherever split children notify master) should check if&lt;br/&gt;
  if the table is disabled and should close the regions... maybe.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;regionserver exit needs to be reimplemented in servermanager&lt;br/&gt;
  also rs expiration&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;add priorities and pool size to handlers (bring in from flush patch)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;in RootEditor there is a race condition between delete and watch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestZKBased* tests to use new handlers&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;make sync calls for enable/disable (check and verify methods?)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;integrate load balancing&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on new failover path and remove old code in joinExistingCluster()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;finish TODOs on timeout monitor in assignmentmanager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;review filesystemmanager calls&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;figure how to handle the very rare but possible race condition where two&lt;br/&gt;
  RSs will update META and the later one can squash the valid one if there was&lt;br/&gt;
  a long gc pause&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;synchronize all access to the boolean in ActiveMasterManager&lt;br/&gt;
  (now this is probably just move it to extend ZKNodeTracker)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;there are some races with master wanting to connect for rpc&lt;br/&gt;
  to regionserver and the rs starting its rpc server, need to address&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;migrate TestMasterTransitions or make new?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;fix or remove last couple master tests that used RSOQ&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;write new tests!!!&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2697&quot; title=&quot;Implement new open/close logic in handlers and stop using heartbeats for open/close messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2697&quot;&gt;&lt;del&gt;HBASE-2697&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2697&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/BRANCH_TODO.txt 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/Abortable.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ClusterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/HServerInfo.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/InvalidFamilyOperationException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/RootLocationEditor.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnection.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseEventHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/HBaseExecutorService.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/executor/RegionTransitionData.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AddColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ChangeTableState.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ColumnOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/DeleteColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/FileSystemManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MetaScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyColumn.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ModifyTableMeta.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RetryableMetaOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/RootScanner.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableDelete.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/TableOperation.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterCloseRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/MasterOpenRegionHandler.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseMetaHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRootHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenMetaHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRootHandler.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ClusterStatusTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/RootRegionTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTableDisable.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperListener.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedCloseRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedReopenRegion.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java 979909 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/util/TestBytes.java 979909 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/484/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple cluster tests passing, need to run (and write) more tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12897516" author="hbasereviewboard" created="Wed, 11 Aug 2010 23:57:56 +0000"  >&lt;p&gt;Message from: &quot;Ted Yu&quot; &amp;lt;ted_yu@yahoo.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/#review850&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#review850&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/#comment2851&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#comment2851&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please change description to reflect what the code does - throwing NotAllMetaRegionsOnlineException&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12897621" author="hbasereviewboard" created="Thu, 12 Aug 2010 08:00:18 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-08-11 16:45:48, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java, line 123&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/484/diff/6/?file=5360#file5360line123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/diff/6/?file=5360#file5360line123&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please change description to reflect what the code does - throwing NotAllMetaRegionsOnlineException&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;@Ted I took a look at it says that it throws NotAllMetaRegionsOnlineException if if root is not available before the timeout expires... so I think the doc is &apos;correct&apos; but I think this method a little odd in that why would you have a timeout waiting on root in first place.  I&apos;ll take a look into it....&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/484/#review850&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/484/#review850&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12904906" author="stack" created="Wed, 1 Sep 2010 05:05:25 +0000"  >&lt;p&gt;Committed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt;. The new test src/test/java/org/apache/hadoop/hbase/master/TestZKBasedOpenCloseRegion.java exercises this new method of open close of regions.&lt;/p&gt;</comment>
                            <comment id="15017401" author="lars_francke" created="Fri, 20 Nov 2015 12:42:59 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12467540">HBASE-2765</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12451309" name="HBASE-2697-part1-v10.patch" size="709989" author="streamy" created="Thu, 5 Aug 2010 07:14:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Jun 2010 17:50:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hisv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100308</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>