<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:02:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9270/HBASE-9270.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9270] [0.94] FSTableDescriptors caching is racy</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9270</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;An occasionally failing test in 0.92 branch that concurrently executes master operations on a single table found this problem in FSTableDescriptors:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git src/main/java/org/apache/hadoop/hbase/util/FSTableDescriptors.java src/main/java/org/apache/hadoop/hbase/util/FSTableDescriptors.java
index e882621..b0042cd 100644
--- src/main/java/org/apache/hadoop/hbase/util/FSTableDescriptors.java
+++ src/main/java/org/apache/hadoop/hbase/util/FSTableDescriptors.java
@@ -221,8 +221,15 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class FSTableDescriptors &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; TableDescriptors {
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (HConstants.HBASE_NON_USER_TABLE_DIRS.contains(htd.getNameAsString())) {
       &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NotImplementedException();
     }
-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fsreadonly) updateHTableDescriptor(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, htd);
-    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; modtime = getTableInfoModtime(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, htd.getNameAsString());
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fsreadonly) {
+      &lt;span class=&quot;code-comment&quot;&gt;// Cannot cache here.
&lt;/span&gt;+      &lt;span class=&quot;code-comment&quot;&gt;// We can&apos;t know &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a modtime from the most recent file found in a
&lt;/span&gt;+      &lt;span class=&quot;code-comment&quot;&gt;// directory listing at some arbitrary point in time still corresponds
&lt;/span&gt;+      &lt;span class=&quot;code-comment&quot;&gt;// to the latest, nor that our htd is the latest.
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
+    }
+    &lt;span class=&quot;code-comment&quot;&gt;// Cache with the modtime of the descriptor we wrote
&lt;/span&gt;+    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; modtime = updateHTableDescriptor(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, htd).getModificationTime();
     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache.put(htd.getNameAsString(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TableDescriptorModtime(modtime, htd));
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7305&quot; title=&quot;ZK based Read/Write locks for table operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7305&quot;&gt;&lt;del&gt;HBASE-7305&lt;/del&gt;&lt;/a&gt; master operations are serialized by a write lock on the table.&lt;/p&gt;

&lt;p&gt;However, 0.94 has code with the same issue:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void add(HTableDescriptor htd) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Bytes.equals(HConstants.ROOT_TABLE_NAME, htd.getName())) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NotImplementedException();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Bytes.equals(HConstants.META_TABLE_NAME, htd.getName())) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NotImplementedException();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (HConstants.HBASE_NON_USER_TABLE_DIRS.contains(htd.getNameAsString())) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NotImplementedException();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fsreadonly) updateHTableDescriptor(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, htd);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName = htd.getNameAsString();
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; modtime = getTableInfoModtime(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, tableName);
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; dirmodtime = getTableDirModtime(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, tableName);
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache.put(tableName, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TableDescriptorModtime(modtime, dirmodtime, htd));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12664545">HBASE-9270</key>
            <summary>[0.94] FSTableDescriptors caching is racy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="rekhajoshm">Rekha Joshi</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Aug 2013 01:49:52 +0000</created>
                <updated>Mon, 12 May 2014 03:49:02 +0000</updated>
                                            <version>0.94.11</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13919277" author="rekhajoshm" created="Tue, 4 Mar 2014 11:26:56 +0000"  >&lt;p&gt;Patch has only forced return, as 0.94 has refined getTableInfoModtime(), getTableDirModtime(), and overloaded getTableInfoPath() methods.&lt;/p&gt;</comment>
                            <comment id="13919278" author="rekhajoshm" created="Tue, 4 Mar 2014 11:27:20 +0000"  >&lt;p&gt;Patch has only forced return, as 0.94 has refined getTableInfoModtime(), getTableDirModtime(), and overloaded getTableInfoPath() methods.&lt;/p&gt;</comment>
                            <comment id="13919312" author="hadoopqa" created="Tue, 4 Mar 2014 11:52:26 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12632491/HBASE-9270.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12632491/HBASE-9270.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12632491&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8878//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8878//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13994781" author="apurtell" created="Mon, 12 May 2014 03:49:02 +0000"  >&lt;p&gt;Cancelling stale patch. Is this still a problem?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12663560">HBASE-9212</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12632491" name="HBASE-9270.1.patch" size="1147" author="rekhajoshm" created="Tue, 4 Mar 2014 11:27:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 4 Mar 2014 11:26:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nenj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>