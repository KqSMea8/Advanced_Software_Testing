<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2057/HBASE-2057.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2057] Cluster won&apos;t stop</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2057</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It seems that clusters on trunk have some trouble stopping. Even manually deleting the shutdown file in ZK doesn&apos;t always help. Investigate.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12443799">HBASE-2057</key>
            <summary>Cluster won&apos;t stop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ghelmling">Gary Helmling</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Dec 2009 19:55:56 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:14 +0000</updated>
                            <resolved>Fri, 22 Jan 2010 19:26:46 +0000</resolved>
                                    <version>0.20.3</version>
                    <version>0.90.0</version>
                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12792682" author="jdcryans" created="Fri, 18 Dec 2009 22:40:07 +0000"  >&lt;p&gt;A first thing I will commit is if the shutdown znode exists then we should no print a huge exception when starting a Master.&lt;/p&gt;</comment>
                            <comment id="12794736" author="jdcryans" created="Sun, 27 Dec 2009 20:39:41 +0000"  >&lt;p&gt;I investigated the problem of our cluster and it seems to be that, since we use JMX, when the stop master process starts it fails to bind on the JMX port and then exists. One thing that would be helping is if the first master in a cluster was watching it&apos;s own cluster state znode so I&apos;m going to commit this from ZKMasterAddressWatcher.writeAddressToZooKeeper:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zookeeper.writeMasterAddress(address)) {
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zookeeper.setClusterState(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zookeeper.setClusterStateWatch(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12794904" author="jdcryans" created="Mon, 28 Dec 2009 19:58:49 +0000"  >&lt;p&gt;Searching on the intertubes, I found that Tomcat had the same problem years ago (JMX binding). They fixed it by having a special env variable for just &quot;start&quot; that isn&apos;t used on &quot;stop&quot;. See &lt;a href=&quot;http://svn.apache.org/viewvc/tomcat/tc6.0.x/trunk/bin/catalina.sh?diff_format=h&amp;amp;r1=558523&amp;amp;r2=558522&amp;amp;pathrev=558523&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tomcat/tc6.0.x/trunk/bin/catalina.sh?diff_format=h&amp;amp;r1=558523&amp;amp;r2=558522&amp;amp;pathrev=558523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We should probably do the same. Punting to 0.20.4&lt;/p&gt;</comment>
                            <comment id="12803005" author="ghelmling" created="Wed, 20 Jan 2010 21:44:10 +0000"  >&lt;p&gt;Here&apos;s a patch to the bin/hbase script, which only adds the service specific options (used for JMX among other things) when the action passed is &quot;start&quot;.&lt;/p&gt;

&lt;p&gt;This works well in my case, but would definitely appreciate more eyes.  Anyone using these env variables for other options that might be needed in the case of a &quot;stop&quot;?&lt;/p&gt;</comment>
                            <comment id="12803009" author="jdcryans" created="Wed, 20 Jan 2010 21:50:33 +0000"  >&lt;p&gt;Thanks Gary, looks good. I don&apos;t think those are used for anything else, I will wait until the release of 0.20.3 to commit.&lt;/p&gt;</comment>
                            <comment id="12803019" author="ghelmling" created="Wed, 20 Jan 2010 22:11:40 +0000"  >&lt;p&gt;Sorry, please use this version of the patch.  This changes the final &quot;exec&quot; line from:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
exec &lt;span class=&quot;code-quote&quot;&gt;&quot;$JAVA&quot;&lt;/span&gt; $JAVA_HEAP_MAX $HBASE_OPTS -classpath &lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH&quot;&lt;/span&gt; $CLASS &lt;span class=&quot;code-quote&quot;&gt;&quot;$ACTION&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;$@&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
exec &lt;span class=&quot;code-quote&quot;&gt;&quot;$JAVA&quot;&lt;/span&gt; $JAVA_HEAP_MAX $HBASE_OPTS -classpath &lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH&quot;&lt;/span&gt; $CLASS $ACTION &lt;span class=&quot;code-quote&quot;&gt;&quot;$@&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The quoting of $ACTION in the first version causes &quot;hbase shell&quot; to not work.&lt;/p&gt;</comment>
                            <comment id="12803027" author="ghelmling" created="Wed, 20 Jan 2010 22:29:28 +0000"  >&lt;p&gt;Patch for bin/hbase script against trunk.  Same as v2 of 0.20 branch patch.&lt;/p&gt;</comment>
                            <comment id="12803352" author="ghelmling" created="Thu, 21 Jan 2010 16:35:58 +0000"  >&lt;p&gt;After reading some of the dev list messages on the Thrift changes, I believe that the current patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2057&quot; title=&quot;Cluster won&amp;#39;t stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2057&quot;&gt;&lt;del&gt;HBASE-2057&lt;/del&gt;&lt;/a&gt;-2) would not work well with the current Thrift server usage.  For example, starting the Thrift with either:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/hbase thrift --port=1234
./bin/hbase thrift --port=1234 start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;would not pass the HBASE_THRIFT_OPTS env variable to the exec line.&lt;/p&gt;

&lt;p&gt;So here is a new, more conservative, patch that only excludes the service specific env variables if the &quot;stop&quot; argument is used.  This also drops the unnecessary ACTION variable and corresponding change to the final &quot;exec&quot; line.&lt;/p&gt;

&lt;p&gt;Sorry for the continuous changes.  This version should be it.  Promise.&lt;/p&gt;</comment>
                            <comment id="12803354" author="ghelmling" created="Thu, 21 Jan 2010 16:41:31 +0000"  >&lt;p&gt;Corresponding v3 of patch against trunk.&lt;/p&gt;</comment>
                            <comment id="12803355" author="ghelmling" created="Thu, 21 Jan 2010 16:45:31 +0000"  >&lt;p&gt;Please use v3 of patches:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2057&quot; title=&quot;Cluster won&amp;#39;t stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2057&quot;&gt;&lt;del&gt;HBASE-2057&lt;/del&gt;&lt;/a&gt;-3_0.20.patch&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2057&quot; title=&quot;Cluster won&amp;#39;t stop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2057&quot;&gt;&lt;del&gt;HBASE-2057&lt;/del&gt;&lt;/a&gt;-3_trunk.patch&lt;/p&gt;

&lt;p&gt;Should be safer for commands that accept extra CLI params on startup.&lt;/p&gt;</comment>
                            <comment id="12803391" author="larsgeorge" created="Thu, 21 Jan 2010 17:55:56 +0000"  >&lt;p&gt;Just looked at the v3 patch and it looks good to me.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12803434" author="stack" created="Thu, 21 Jan 2010 19:15:46 +0000"  >&lt;p&gt;Patch looks good to me. &lt;/p&gt;</comment>
                            <comment id="12803835" author="jdcryans" created="Fri, 22 Jan 2010 19:26:46 +0000"  >&lt;p&gt;Committed to branch and trunk. Thanks Gary!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12430934" name="HBASE-2057-2_0.20.patch" size="1698" author="ghelmling" created="Wed, 20 Jan 2010 22:11:40 +0000"/>
                            <attachment id="12430936" name="HBASE-2057-2_trunk.patch" size="1725" author="ghelmling" created="Wed, 20 Jan 2010 22:29:28 +0000"/>
                            <attachment id="12431039" name="HBASE-2057-3_0.20.patch" size="1367" author="ghelmling" created="Thu, 21 Jan 2010 16:35:58 +0000"/>
                            <attachment id="12431041" name="HBASE-2057-3_trunk.patch" size="1257" author="ghelmling" created="Thu, 21 Jan 2010 16:41:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Jan 2010 21:44:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26123</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08tgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49372</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>