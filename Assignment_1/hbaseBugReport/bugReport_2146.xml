<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:59:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2146/HBASE-2146.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2146] RPC related metrics are missing in 0.20.3 since recent changes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2146</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Since the recent change to the Metrics setup it seems that the RPC related stats have been completely dropped. See attached files for details.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12445928">HBASE-2146</key>
            <summary>RPC related metrics are missing in 0.20.3 since recent changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ghelmling">Gary Helmling</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Jan 2010 13:02:03 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:14 +0000</updated>
                            <resolved>Fri, 22 Jan 2010 18:13:02 +0000</resolved>
                                    <version>0.20.3</version>
                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12802308" author="larsgeorge" created="Tue, 19 Jan 2010 15:52:33 +0000"  >&lt;p&gt;Err, this is confusing. I cannot even find where these Metrics are exported in 0.20.2! Am I missing something? Do I have a special build that had those values? Why were they there and why were they removed? Bueller?&lt;/p&gt;</comment>
                            <comment id="12802391" author="stack" created="Tue, 19 Jan 2010 18:11:26 +0000"  >&lt;p&gt;@LarsG For JMX do they have to be enabled in the hadoop-metrics.properties file (Maybe not?).&lt;/p&gt;</comment>
                            <comment id="12802423" author="larsgeorge" created="Tue, 19 Jan 2010 19:24:16 +0000"  >&lt;p&gt;Hmm, I checked both cluster then they have the exact same hadoop-metrics, hbase-env and so on. All diff&quot;ed by my a few times. So why is that cluster different. What is even weirder is that these are MetricsTimeVaryingRate instances so they must be declared and put into the MetricsRegistry before createMBean() is called. And I cannot find where that is done!&lt;/p&gt;</comment>
                            <comment id="12802458" author="ghelmling" created="Tue, 19 Jan 2010 20:30:08 +0000"  >&lt;p&gt;Lars,&lt;/p&gt;

&lt;p&gt;It looks like these extra metrics are dynamically created and added to the registry via the HBaseRPCMetrics.inc() and subsequently create() and get() methods.  The org.apache.hadoop.metrics.util.MetricsDynamicMBeanBase class will update the MBean info if the underlying registry changes (see updateMbeanInfoIfMetricsListChanged()), but maybe this isn&apos;t being invoked everywhere it&apos;s needed?&lt;/p&gt;

&lt;p&gt;The .inc() method is being called in HBaseRPC.Server.call() with the call method name.  So it looks like that&apos;s how they&apos;re getting populated.  &amp;#8211; As an aside it looks like rpcQueueTIme and rpcProcessingTime are incremented twice there is debug logging is enabled&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &amp;#8211;  I&apos;ll try to test this out as well a bit later.&lt;/p&gt;</comment>
                            <comment id="12802465" author="larsgeorge" created="Tue, 19 Jan 2010 20:54:41 +0000"  >&lt;p&gt;Ah, thanks Gary, that makes sense. I guess the issue is that my second cluster is not busy and has not yet created the counters. This makes for a difficult discovery though then. Sure, you could run the discovery later, but it would be nice to get an authoritative list from somewhere. &lt;/p&gt;</comment>
                            <comment id="12802469" author="larsgeorge" created="Tue, 19 Jan 2010 21:02:01 +0000"  >&lt;p&gt;And Gary is right.&lt;/p&gt;

&lt;p&gt;There is a duplicate call in the debug!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
          LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Served: &quot;&lt;/span&gt; + call.getMethodName() +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; queueTime= &quot;&lt;/span&gt; + qTime +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; procesingTime= &quot;&lt;/span&gt; + processingTime);
          rpcMetrics.rpcQueueTime.inc(qTime);
          rpcMetrics.rpcProcessingTime.inc(processingTime);
        }
        rpcMetrics.rpcQueueTime.inc(qTime);
        rpcMetrics.rpcProcessingTime.inc(processingTime);
        rpcMetrics.inc(call.getMethodName(), processingTime);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, the last line is what I could not see (forrest for the trees kind of thing). &lt;/p&gt;

&lt;p&gt;So we make this issue to patch the above duplicate inc and close it?&lt;/p&gt;</comment>
                            <comment id="12802871" author="ghelmling" created="Wed, 20 Jan 2010 15:47:47 +0000"  >&lt;p&gt;Not having all the attributes initially available does seem a bit problematic if you have automated monitoring setup.  You&apos;re likely to get an AttributeNotFoundException if you have a process trying to retrieve it before it&apos;s there.&lt;/p&gt;

&lt;p&gt;I&apos;ll take a shot at pre-registering those metrics.  I think we can do it with the code &amp;lt;-&amp;gt; method name map in HBaseRPC.  I&apos;ll post a patch for that (and remove the duplication) shortly.&lt;/p&gt;
</comment>
                            <comment id="12802894" author="ghelmling" created="Wed, 20 Jan 2010 17:03:38 +0000"  >&lt;p&gt;Patch against 0.20 branch to pre-register per-RPC-method metrics, so that the full attribute list is initially available for JMX MBean creation.&lt;/p&gt;

&lt;p&gt;This adds a default access HBaseRPC.getMappedMethodNames() static method to retrieve the values of the HBaseRPC.Invocation.CODE_TO_METHODNAMES map, which isn&apos;t super elegant.  But it seemed like the least intrusive way to get what we need.&lt;/p&gt;</comment>
                            <comment id="12802895" author="ghelmling" created="Wed, 20 Jan 2010 17:06:14 +0000"  >&lt;p&gt;Lars, can you try this patch on your setup?  &lt;/p&gt;

&lt;p&gt;I did a quick test with jconsole and all the rpc-method metrics seemed to show up on startup for me.&lt;/p&gt;

&lt;p&gt;This patch also drops the duplicate incrementing of rpcQueueTime and rpcProcessingTime.&lt;/p&gt;</comment>
                            <comment id="12802905" author="ghelmling" created="Wed, 20 Jan 2010 17:36:23 +0000"  >&lt;p&gt;Same patch as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2146&quot; title=&quot;RPC related metrics are missing in 0.20.3 since recent changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2146&quot;&gt;&lt;del&gt;HBASE-2146&lt;/del&gt;&lt;/a&gt;_0.20.patch against trunk.&lt;/p&gt;</comment>
                            <comment id="12802928" author="larsgeorge" created="Wed, 20 Jan 2010 18:51:03 +0000"  >&lt;p&gt;Will test first thing tomorrow, I&apos;ll let you know. Thanks!&lt;/p&gt;</comment>
                            <comment id="12803011" author="larsgeorge" created="Wed, 20 Jan 2010 21:56:08 +0000"  >&lt;p&gt;Assigning to Gary who did the work.&lt;/p&gt;</comment>
                            <comment id="12803012" author="larsgeorge" created="Wed, 20 Jan 2010 21:57:00 +0000"  >&lt;p&gt;Works great, will commit to trunk and hold of with branch until after RC2 has passed.&lt;/p&gt;</comment>
                            <comment id="12803798" author="stack" created="Fri, 22 Jan 2010 18:13:02 +0000"  >&lt;p&gt;Applied branch.  Resolving.  Thanks for the patch Gary.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12430902" name="HBASE-2146_0.20.patch" size="2807" author="ghelmling" created="Wed, 20 Jan 2010 17:03:38 +0000"/>
                            <attachment id="12430904" name="HBASE-2146_trunk.patch" size="2472" author="ghelmling" created="Wed, 20 Jan 2010 17:36:23 +0000"/>
                            <attachment id="12430740" name="jconsole-hbase-rpc.png" size="150213" author="larsgeorge" created="Tue, 19 Jan 2010 13:04:07 +0000"/>
                            <attachment id="12430741" name="jmx-diffs.txt" size="33921" author="larsgeorge" created="Tue, 19 Jan 2010 13:04:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jan 2010 18:11:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26173</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08tfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>