<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2055/HBASE-2055.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2055] Serialize WAL as Avro records</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2055</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There was some advocacy of using Avro for serialization of HBase WAL records up on hbase-dev@. Idea is Hadoop core is getting away from Writables and Avro is the blessed replacement. &lt;/p&gt;

&lt;p&gt;I think we have this criteria for its use:&lt;br/&gt;
1) Performance of writing Avro records is no worse than that for writing Writables into a SequenceFile.&lt;br/&gt;
2) Space consumed by Avro serialization is no worse than that of Writables&lt;br/&gt;
3) File format is amenable to appends (cannot require valid trailers, etc.)&lt;/p&gt;

&lt;p&gt;I&apos;ll put up a patch so we can try it out. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12443789">HBASE-2055</key>
            <summary>Serialize WAL as Avro records</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Dec 2009 18:21:46 +0000</created>
                <updated>Mon, 12 May 2014 00:44:12 +0000</updated>
                            <resolved>Mon, 12 May 2014 00:44:12 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12792760" author="hammer" created="Sat, 19 Dec 2009 02:41:22 +0000"  >&lt;p&gt;Additional criteria: Avro has clients for reading and writing data files in several languages which will facilitate writing debugging and profiling utilities.&lt;/p&gt;</comment>
                            <comment id="12792901" author="apurtell" created="Sat, 19 Dec 2009 21:07:03 +0000"  >&lt;p&gt;No idea if it works yet.&lt;/p&gt;</comment>
                            <comment id="12792963" author="apurtell" created="Sun, 20 Dec 2009 04:52:15 +0000"  >&lt;p&gt;I put up a patch which implements a HLog reader and writer that uses Avro for serialization. Some basic function works but TestHLog fails all three cases with EOFExceptions, always when reading the last field of a particular (truncated?) record. Surprisingly, TestFullLogReconstruction succeeds. &lt;/p&gt;</comment>
                            <comment id="12792973" author="apurtell" created="Sun, 20 Dec 2009 08:49:24 +0000"  >&lt;p&gt;v2 patch passes all tests. Also, in this version we write the schema as a file header and use it to initialize the reader. &lt;/p&gt;

&lt;p&gt;In case anyone is curious, we are not using Avro&apos;s bundled file I/O package because the file format puts schema and metadata into a trailer so seems not suitable as a log which may be truncated as part of &quot;normal&quot; operation. &lt;/p&gt;</comment>
                            <comment id="12792974" author="ryanobjc" created="Sun, 20 Dec 2009 09:00:34 +0000"  >&lt;p&gt;i am wondering what would happen if the header was mangled? &lt;/p&gt;

&lt;p&gt;Does it make sense to put the schema in multiple places? like super blocks in ext3?&lt;/p&gt;</comment>
                            <comment id="12792978" author="apurtell" created="Sun, 20 Dec 2009 09:54:31 +0000"  >&lt;p&gt;v3 writes a sync marker every 64K which includes a copy of the schema. &lt;/p&gt;

&lt;p&gt;The file is initialized with a sync marker. The reader scans from the start of the file until it finds a valid sync marker and then reads in the schema. &lt;/p&gt;

&lt;p&gt;This is a fair amount of overhead &amp;#8211; 1 byte per record, 1K per 64K of data &amp;#8211; but does mean edits from corrupt logs can be partially recovered.&lt;/p&gt;</comment>
                            <comment id="12792979" author="larsgeorge" created="Sun, 20 Dec 2009 10:02:31 +0000"  >&lt;p&gt;Great stuff Andy, this block marker makes totally sense also in the context of log splitting, which needs blocks of the log being presorted by the RS&apos;s before they get applied. With the marker this is a natural fit. BigTable does 64k chunks too (during sorts).&lt;/p&gt;</comment>
                            <comment id="12793017" author="apurtell" created="Sun, 20 Dec 2009 19:28:24 +0000"  >&lt;p&gt;v4 should make it easier to extend the reader and writer. THBase will need to do this in order to function. &lt;/p&gt;</comment>
                            <comment id="12794181" author="hammer" created="Wed, 23 Dec 2009 19:36:37 +0000"  >&lt;p&gt;Hey Andy,&lt;/p&gt;

&lt;p&gt;Grab the latest Java patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-160--the&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AVRO-160--the&lt;/a&gt; new file format puts metadata in the header, rather than the footer. For future maintenance, it may be easier to stick with the default Avro file object container.&lt;/p&gt;

&lt;p&gt;Later,&lt;br/&gt;
Jeff&lt;/p&gt;</comment>
                            <comment id="12794209" author="apurtell" created="Wed, 23 Dec 2009 20:28:31 +0000"  >&lt;p&gt;@Jeff: When that patch is committed we can look at putting a snapshot of Avro trunk on ours. Also I see that SYNC_SIZE is a constant. Should be configurable? We want 64k, others might want different?&lt;/p&gt;
</comment>
                            <comment id="12794366" author="apurtell" created="Thu, 24 Dec 2009 09:26:41 +0000"  >&lt;p&gt;Sorry, above I meant SYNC_INTERVAL, not SYNC_SIZE. Also it looks like the DataFileWriter as implemented for &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-160&quot; title=&quot;file format should be friendly to streaming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-160&quot;&gt;&lt;del&gt;AVRO-160&lt;/del&gt;&lt;/a&gt; will hold up to SYNC_INTERVAL bytes in a buffer before writing out the block. We want to hsync after a group of related commits in the WAL whether SYNC_INTERVAL is reached or not, but also have the stream marked with a sync marker at each SYNC_INTERVAL. This is basically what my v3 or v4 patch does. It also writes a copy of the schema just after the sync marker so we have an opportunity to resynchronize a reader on each block regardless of how many previous blocks are corrupt (perhaps all). &lt;/p&gt;</comment>
                            <comment id="12794573" author="hammer" created="Fri, 25 Dec 2009 22:22:59 +0000"  >&lt;p&gt;Hey Andy,&lt;/p&gt;

&lt;p&gt;I don&apos;t think putting a snapshot of trunk into your svn would be a great idea. The 1.3 release will have a finalized design and implementation of the file object container.&lt;/p&gt;

&lt;p&gt;As for the configurable SYNC_INTERVAL: it makes sense to me to make this a configuration parameter. That said, it would be worth raising your concerns on the AVRO JIRA rather than in this issue.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Jeff&lt;/p&gt;</comment>
                            <comment id="12795440" author="cutting" created="Wed, 30 Dec 2009 20:43:32 +0000"  >&lt;p&gt;I agree that SYNC_INTERVAL should be configurable.&lt;/p&gt;

&lt;p&gt;Note that the current plan is to support appends but no longer to support changing the schema in a file.  The schema is included only once, at the start of the file.  If you have further comments, please add them to &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-160&quot; title=&quot;file format should be friendly to streaming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-160&quot;&gt;&lt;del&gt;AVRO-160&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13994728" author="apurtell" created="Mon, 12 May 2014 00:44:12 +0000"  >&lt;p&gt;Not going to happen&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12443831">HBASE-2059</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12470400">HBASE-2889</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12438617">AVRO-160</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12428564" name="HBASE-2055-v2.patch" size="18096" author="apurtell" created="Sun, 20 Dec 2009 08:49:24 +0000"/>
                            <attachment id="12428565" name="HBASE-2055-v3.patch" size="20605" author="apurtell" created="Sun, 20 Dec 2009 09:54:31 +0000"/>
                            <attachment id="12428575" name="HBASE-2055-v4.patch" size="22213" author="apurtell" created="Sun, 20 Dec 2009 19:28:24 +0000"/>
                            <attachment id="12428555" name="HBASE-2055.patch" size="17669" author="apurtell" created="Sun, 20 Dec 2009 04:48:50 +0000"/>
                            <attachment id="12428558" name="TEST-org.apache.hadoop.hbase.TestFullLogReconstruction.txt.gz" size="800805" author="apurtell" created="Sun, 20 Dec 2009 05:20:52 +0000"/>
                            <attachment id="12428557" name="TEST-org.apache.hadoop.hbase.regionserver.wal.TestHLog.txt.gz" size="5862" author="apurtell" created="Sun, 20 Dec 2009 05:20:51 +0000"/>
                            <attachment id="12428559" name="TEST-org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.txt.gz" size="13579" author="apurtell" created="Sun, 20 Dec 2009 05:20:52 +0000"/>
                            <attachment id="12428552" name="jackson-core-asl-1.0.1.jar" size="136059" author="apurtell" created="Sun, 20 Dec 2009 04:48:31 +0000"/>
                            <attachment id="12428553" name="jackson-mapper-asl-1.0.1.jar" size="270781" author="apurtell" created="Sun, 20 Dec 2009 04:48:31 +0000"/>
                            <attachment id="12428554" name="paranamer-1.5.jar" size="28415" author="apurtell" created="Sun, 20 Dec 2009 04:48:31 +0000"/>
                            <attachment id="12428556" name="test-site.patch" size="874" author="apurtell" created="Sun, 20 Dec 2009 04:48:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 19 Dec 2009 02:41:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hgaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99901</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>