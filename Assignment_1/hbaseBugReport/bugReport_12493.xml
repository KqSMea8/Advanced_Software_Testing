<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:33:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12493/HBASE-12493.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12493] User class should provide a way to re-use existing token</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12493</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8874&quot; title=&quot;Error Accessing HBase from Hive via Oozie on Kerberos 5.0.1 cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8874&quot;&gt;&lt;del&gt;HIVE-8874&lt;/del&gt;&lt;/a&gt; we had to re-use HBase classes market private to re-use using tokens.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12755841">HBASE-12493</key>
            <summary>User class should provide a way to re-use existing token</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ghelmling">Gary Helmling</assignee>
                                    <reporter username="brocknoland">Brock Noland</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Nov 2014 17:21:28 +0000</created>
                <updated>Sat, 21 Feb 2015 23:49:45 +0000</updated>
                            <resolved>Tue, 16 Dec 2014 01:27:24 +0000</resolved>
                                                    <fixVersion>1.0.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="14214876" author="stack" created="Mon, 17 Nov 2014 17:31:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt; Should we open User for HIVE (only)?  Or can we point them at an alternate to use?  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="14214959" author="apurtell" created="Mon, 17 Nov 2014 18:31:40 +0000"  >&lt;p&gt;The User API hasn&apos;t changed for a long time. Should we just make it public? Hive wouldn&apos;t be the only potential user. &lt;/p&gt;</comment>
                            <comment id="14214965" author="brocknoland" created="Mon, 17 Nov 2014 18:38:04 +0000"  >&lt;p&gt;Hey guys,&lt;/p&gt;

&lt;p&gt;Thank you for looking at this and I think it&apos;d be great if we made &lt;tt&gt;User&lt;/tt&gt; either Public or LimitedPrivate. Too be clear I think we&apos;d also need a new method on the User class as we must use some other classes such as &lt;tt&gt;AuthenticationTokenSelector&lt;/tt&gt; to implement the functionality described in the title. The Hive patch is here: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12681574/HIVE-8874.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12681574/HIVE-8874.1.patch&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14215041" author="ghelmling" created="Mon, 17 Nov 2014 19:30:34 +0000"  >&lt;p&gt;+1 to making User public.&lt;/p&gt;

&lt;p&gt;I can work up a patch and add in some convenience for access to tokens.&lt;/p&gt;</comment>
                            <comment id="14215121" author="stack" created="Mon, 17 Nov 2014 20:31:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt; Thanks boss. That&apos;d help. We can put it in 0.98+ if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; is amenable.&lt;/p&gt;</comment>
                            <comment id="14215219" author="apurtell" created="Mon, 17 Nov 2014 21:36:15 +0000"  >&lt;p&gt;+1 for 0.98. It&apos;s not an incompatible change&lt;/p&gt;</comment>
                            <comment id="14217258" author="virag" created="Wed, 19 Nov 2014 01:57:44 +0000"  >
&lt;p&gt;Oozie is a longtime user of the User API and making it public would help&lt;br/&gt;
A bit unrelated, but can we make TokenUtil public? Pig HbaseStorage seems to be using it.&lt;/p&gt;
</comment>
                            <comment id="14225353" author="ghelmling" created="Tue, 25 Nov 2014 23:03:40 +0000"  >&lt;p&gt;Linking to additional refactorings inspired by this issue.&lt;/p&gt;</comment>
                            <comment id="14225372" author="ghelmling" created="Tue, 25 Nov 2014 23:20:38 +0000"  >&lt;p&gt;Looking at this issue in more detail, there are a few things wrong with our current means of obtaining authentication tokens:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The User class winds up initiating RPCs, which it really shouldn&apos;t&lt;/li&gt;
	&lt;li&gt;There&apos;s no way to do normal connection management for the connections/resources used by those RPCs&lt;/li&gt;
	&lt;li&gt;The TokenProvider coprocessor setup on the server-side is wasteful&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve linked to a couple of issues I&apos;ve created for the related problems.  For this issue, though, we can still address the problem without changing the User API:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Make both User and TokenUtil classes public&lt;/li&gt;
	&lt;li&gt;Move TokenUtil from hbase-server to hbase-client (which seems a more natural place for it)&lt;/li&gt;
	&lt;li&gt;Add a method to TokenUtil to fetch a token for the given user if it is not already present in the user credentials&lt;/li&gt;
	&lt;li&gt;Deprecate the User.obtainAuthTokenForJob() methods in favor of the TokenUtil.obtainTokenForJob() equivalents&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Then, at some point in the future, we can remove the User.obtainAuthTokenForJob() methods entirely.&lt;/p&gt;</comment>
                            <comment id="14230725" author="ghelmling" created="Mon, 1 Dec 2014 23:59:43 +0000"  >&lt;p&gt;The attached patch covers the changes for both this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12579&quot; title=&quot;Move obtainAuthTokenForJob() methods out of User&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12579&quot;&gt;HBASE-12579&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Moves TokenUtil class to hbase-client module&lt;/li&gt;
	&lt;li&gt;Makes both User and TokenUtil classes public&lt;/li&gt;
	&lt;li&gt;Cleans up TokenUtil API, deprecating methods that take a Configuration and replacing them with versions that take Connection&lt;/li&gt;
	&lt;li&gt;Deprecates the User obtainAuthTokenForJob() methods in favor of the TokenUtil versions&lt;/li&gt;
	&lt;li&gt;Adds a new TokenUtil.addTokenIfMissing() method to support the Hive usage&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14230728" author="ghelmling" created="Tue, 2 Dec 2014 00:01:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;Brock Noland&lt;/a&gt; Can you please confirm that the new &lt;tt&gt;TokenUtil.addTokenIfMissing()&lt;/tt&gt; method in the patch would work for the Hive case?&lt;/p&gt;</comment>
                            <comment id="14230837" author="hadoopqa" created="Tue, 2 Dec 2014 02:04:12 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12684508/HBASE-12493.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12684508/HBASE-12493.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 703848ceea988795f21dadce86a86de9ecae7eaf.&lt;br/&gt;
  ATTACHMENT ID: 12684508&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 7 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3540 checkstyle errors (more than the master&apos;s current 3539 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 8 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11888//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14230851" author="brocknoland" created="Tue, 2 Dec 2014 02:19:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you please confirm that the new &lt;tt&gt;TokenUtil.addTokenIfMissing()&lt;/tt&gt; method in the patch would work for the Hive case?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will take a look unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; has a change to first.&lt;/p&gt;</comment>
                            <comment id="14231680" author="brocknoland" created="Tue, 2 Dec 2014 16:04:49 +0000"  >&lt;p&gt;The only delta I see is that in the Hive code we are adding the token to the job.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;job.getCredentials().addToken(authToken.getService(), authToken);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I assume that adding to the UGI is not equivalent? &lt;span class=&quot;error&quot;&gt;&amp;#91;~ychen&amp;#93;&lt;/span&gt;? If so would the thought be that we&apos;d get the tokens from the UGI and add then to the Job?&lt;/p&gt;</comment>
                            <comment id="14231741" author="ychena" created="Tue, 2 Dec 2014 16:57:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;Brock Noland&lt;/a&gt;, you are right, it seems that the only difference is  we need add the token to the job after call the TokenUtil.addTokenIfMissing(). It is a good idea to get the tokens from UGI and add them to the job. &lt;/p&gt;

&lt;p&gt;The changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8874&quot; title=&quot;Error Accessing HBase from Hive via Oozie on Kerberos 5.0.1 cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8874&quot;&gt;&lt;del&gt;HIVE-8874&lt;/del&gt;&lt;/a&gt; is the same change as in:&lt;br/&gt;
&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=hbase.git;a=blob;f=hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java;h=b5149415a5e6abbb9cdfaec75604bd2c6c6056b3;hb=HEAD#l492&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=hbase.git;a=blob;f=hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java;h=b5149415a5e6abbb9cdfaec75604bd2c6c6056b3;hb=HEAD#l492&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It is very hard to setup the test env in our side (only Harsh J has the the successful setup ). Is that possible to test in the hbase side for example make changes to the TableMapReduceUtil.java ?&lt;/p&gt;</comment>
                            <comment id="14232196" author="brocknoland" created="Tue, 2 Dec 2014 21:52:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;It is a good idea to get the tokens from UGI and add them to the job.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, so it looks like this API will work for us in Hive.&lt;/p&gt;

&lt;p&gt;Additionally based on Yongzhi&apos;s research, it appears this patch could do some refactoring in  &lt;tt&gt;TableMapReduceUtil&lt;/tt&gt; to use this API. Would that make sense?&lt;/p&gt;</comment>
                            <comment id="14232287" author="ghelmling" created="Tue, 2 Dec 2014 23:17:42 +0000"  >&lt;p&gt;Here&apos;s a new patch with the following changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;adds TokenUtil.addTokenForJob() methods that should directly handle the Hive case&lt;/li&gt;
	&lt;li&gt;uses UserProvider where appropriate&lt;/li&gt;
	&lt;li&gt;refactors TableMapReduceUtil classes to remove usage of deprecated methods&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14232290" author="ghelmling" created="Tue, 2 Dec 2014 23:21:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;Brock Noland&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; The updated patch adds two &lt;tt&gt;TokenUtil.addTokenForJob()&lt;/tt&gt; methods that should directly address the Hive usage &amp;#8211; if an existing token for the cluster is found in the User credentials it will be added to the job, otherwise a new token will be fetched and added to the job.&lt;/p&gt;

&lt;p&gt;This also fixes up the &lt;tt&gt;TableMapReduceUtil&lt;/tt&gt; usage of the deprecated &lt;tt&gt;User.obtainAuthTokenForJob()&lt;/tt&gt; methods.&lt;/p&gt;</comment>
                            <comment id="14232418" author="hadoopqa" created="Wed, 3 Dec 2014 01:09:08 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12684753/HBASE-12493-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12684753/HBASE-12493-v2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 54f438cee4ffb1e43739feef2397b7d1e099c892.&lt;br/&gt;
  ATTACHMENT ID: 12684753&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 9 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3552 checkstyle errors (more than the master&apos;s current 3538 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11904//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14232468" author="brocknoland" created="Wed, 3 Dec 2014 02:19:56 +0000"  >&lt;p&gt;Thanks Gary, lgtm!!&lt;/p&gt;</comment>
                            <comment id="14232481" author="stack" created="Wed, 3 Dec 2014 02:43:07 +0000"  >&lt;p&gt;Skimmed it. LGTM2&lt;/p&gt;</comment>
                            <comment id="14234584" author="ychena" created="Thu, 4 Dec 2014 20:25:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt;, the hive HBaseStorageHandler does not have the info of the hbase connection, all your TokenUtil.addTokenForJob methods need connection, is that possible you add a method with&lt;br/&gt;
addTokenForJob(Configuration conf, Job job, User user)&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14234613" author="ghelmling" created="Thu, 4 Dec 2014 20:57:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; The Hive HBaseStorageHandler should create and manage the connection, doing something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Connection conn = ConnectionFactory.createConnection(job.getConfiguration());
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  UserProvider userProvider = UserProvider.instantiate(job.getConfiguration());
  TokenUtil.addTokenForJob(conn, userProvider.getCurrent(), job);
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
  conn.close();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Creating the connection and managing it should really be done explicitly.  It&apos;s clunky and inefficient for us to do this hidden from the client code, which leads to nasty things like hidden connection caching that we&apos;ve been trying to remove from the HBase code for a long time.  It&apos;s much simpler if we just make the connection handling explicit.  This is why I&apos;ve deprecated all methods which do &lt;em&gt;not&lt;/em&gt; take a &lt;tt&gt;Connection&lt;/tt&gt; instance, and have to create one behind the scenes.&lt;/p&gt;

&lt;p&gt;Do you see any other issues?&lt;/p&gt;</comment>
                            <comment id="14234628" author="ychena" created="Thu, 4 Dec 2014 21:14:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt;, I have no other issues, thanks&lt;/p&gt;</comment>
                            <comment id="14236123" author="ghelmling" created="Fri, 5 Dec 2014 21:14:05 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; What do you think about getting this in branch-1?  It would be good to get the deprecations in place on the old methods before 1.0 is released.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; Ditto on 0.98.&lt;/p&gt;

&lt;p&gt;Summary of compatibility related changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;TokenUtil&lt;/tt&gt; class is moved from hbase-server to hbase-client.  It remains in the same package though, so should remain API compatible.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;User.obtainAuthTokenForJob()&lt;/tt&gt; methods are deprecated in favor of &lt;tt&gt;TokenUtil&lt;/tt&gt; versions that take a connection and explicit user.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;TokenUtil&lt;/tt&gt; methods taking a &lt;tt&gt;Configuration&lt;/tt&gt; instance (which create a &lt;tt&gt;Connection&lt;/tt&gt; behind the scenes) are deprecated in favor of those taking an explicit &lt;tt&gt;Connection&lt;/tt&gt; instance.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If we get this in 1.0 so the deprecations are in place, then I will do a follow up issue to remove the deprecated methods from master.&lt;/p&gt;</comment>
                            <comment id="14236285" author="hudson" created="Fri, 5 Dec 2014 23:20:50 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5874 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5874/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5874/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; Make User and TokenUtil public (garyh: rev 1ec6609b978033550d4ead35de0ab5344b789bd1)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/security/User.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14236399" author="yuzhihong@gmail.com" created="Sat, 6 Dec 2014 00:52:48 +0000"  >&lt;p&gt;Are the following javadoc warnings related to this JIRA ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:134: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:155: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:193: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:215: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:253: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:275: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:312: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:333: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java:353: warning - Tag @link: reference not found: AuthenticationProtos.AuthenticationService
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14236422" author="apurtell" created="Sat, 6 Dec 2014 01:04:17 +0000"  >&lt;p&gt;+1 seems fine Gary, thanks for the attention to compatibility issues&lt;/p&gt;

&lt;p&gt;Should just remove those @link directives from the javadoc I&apos;d say.&lt;/p&gt;</comment>
                            <comment id="14236484" author="enis" created="Sat, 6 Dec 2014 02:06:34 +0000"  >&lt;p&gt;Looks good for 1.0 as well. &lt;/p&gt;</comment>
                            <comment id="14236686" author="ghelmling" created="Sat, 6 Dec 2014 08:35:25 +0000"  >&lt;p&gt;Attaching addendum for -v2 patch, fixing javadoc warnings.  Committed to master.&lt;/p&gt;</comment>
                            <comment id="14236691" author="hadoopqa" created="Sat, 6 Dec 2014 08:42:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12685531/HBASE-12493-v2-addendum.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12685531/HBASE-12493-v2-addendum.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit b7d1790411a379a27c59514c806f48c91e7186c8.&lt;br/&gt;
  ATTACHMENT ID: 12685531&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11970//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11970//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14236717" author="hudson" created="Sat, 6 Dec 2014 10:14:45 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5878 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5878/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; Addendum - Fix javadoc warnings (garyh: rev b7d1790411a379a27c59514c806f48c91e7186c8)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14236764" author="hudson" created="Sat, 6 Dec 2014 11:58:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #548 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/548/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/548/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; Make User and TokenUtil public (garyh: rev 6c4863f355db7c46b50680f9560876d00e902fba)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/security/User.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14241557" author="apurtell" created="Wed, 10 Dec 2014 19:18:08 +0000"  >&lt;p&gt;This didn&apos;t get committed to 0.98. Any particular reason for that?&lt;br/&gt;
Edit: Or branch-1. &lt;br/&gt;
I haven&apos;t examined the patch in detail, but I thought the compat story was handled.&lt;/p&gt;</comment>
                            <comment id="14241561" author="apurtell" created="Wed, 10 Dec 2014 19:20:06 +0000"  >&lt;p&gt;I stand corrected. branch-1 has a commit at 6c4863f even though fix versions on this JIRA doesn&apos;t indicate it was committed there.&lt;/p&gt;</comment>
                            <comment id="14241564" author="apurtell" created="Wed, 10 Dec 2014 19:21:59 +0000"  >&lt;p&gt;A cherry pick to 0.98 shows conflicts in every changed file except TokenUtil. Not surprising. Let me look at putting up a 0.98 patch here.&lt;/p&gt;</comment>
                            <comment id="14241591" author="apurtell" created="Wed, 10 Dec 2014 19:40:54 +0000"  >&lt;p&gt;0.98 patch.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fixed up imports&lt;/li&gt;
	&lt;li&gt;Connection -&amp;gt; HConnection&lt;/li&gt;
	&lt;li&gt;ConnectionFactory -&amp;gt; HConnectionManager&lt;/li&gt;
	&lt;li&gt;Table -&amp;gt; HTableInterface&lt;/li&gt;
	&lt;li&gt;Refactored Java 7 try-with-resources to try-finally&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14241601" author="apurtell" created="Wed, 10 Dec 2014 19:45:39 +0000"  >&lt;p&gt;Added a fix version for 0.98.10 for the 0.98 patch. &lt;/p&gt;</comment>
                            <comment id="14244806" author="apurtell" created="Fri, 12 Dec 2014 21:32:10 +0000"  >&lt;p&gt;Any concerns about the 0.98 version of the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="14247186" author="ghelmling" created="Mon, 15 Dec 2014 20:35:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; Sorry I dropped the ball on the 0.98 update.  I ran into conflicts with the change just before leaving on vacation and didn&apos;t have time to sort it out.&lt;/p&gt;

&lt;p&gt;For 0.98, does it pose a problem that the &lt;tt&gt;HConnection&lt;/tt&gt; versions of the &lt;tt&gt;TokenUtil&lt;/tt&gt; methods will change to use &lt;tt&gt;Connection&lt;/tt&gt; in 1.0?  Since HConnection extends Connection, maybe that&apos;s sufficient to avoid API compatibility issues.  Assuming that&apos;s sufficient, then +1 on the 0.98 patch.&lt;/p&gt;</comment>
                            <comment id="14247195" author="ghelmling" created="Mon, 15 Dec 2014 20:48:42 +0000"  >&lt;p&gt;One minor comment on the 0.98 patch &amp;#8211; the &amp;#64;deprecated javadoc comments in &lt;tt&gt;TokenUtil&lt;/tt&gt; and &lt;tt&gt;User&lt;/tt&gt; should  use &lt;tt&gt;HConnection&lt;/tt&gt; in the method links instead of &lt;tt&gt;Connection&lt;/tt&gt;.  Otherwise, +1.&lt;/p&gt;</comment>
                            <comment id="14247236" author="apurtell" created="Mon, 15 Dec 2014 21:17:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;For 0.98, does it pose a problem that the HConnection versions of the TokenUtil methods will change to use Connection in 1.0?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;0.98 doesn&apos;t have Connection. This is the same as any other use of HConnection in 0.98 or earlier. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the @deprecated javadoc comments in TokenUtil and User should use HConnection in the method links instead of Connection. Otherwise, +1.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the +1. I will fix this on commit.&lt;/p&gt;</comment>
                            <comment id="14247567" author="apurtell" created="Tue, 16 Dec 2014 01:27:24 +0000"  >&lt;p&gt;Pushed to 0.98 with javadoc fixes&lt;/p&gt;</comment>
                            <comment id="14247670" author="hudson" created="Tue, 16 Dec 2014 03:20:20 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #743 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/743/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/743/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; Make User and TokenUtil public (apurtell: rev 4fcde44d223af7b7916e00ce7b779b424051d26f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/security/User.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14247690" author="hudson" created="Tue, 16 Dec 2014 03:36:48 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #710 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/710/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/710/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; Make User and TokenUtil public (apurtell: rev 4fcde44d223af7b7916e00ce7b779b424051d26f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/security/User.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14247711" author="yuzhihong@gmail.com" created="Tue, 16 Dec 2014 04:03:27 +0000"  >&lt;p&gt;UGI#addToken(Text alias, Token&amp;lt;? extends TokenIdentifier&amp;gt; token) doesn&apos;t exist in hadoop-1&lt;br/&gt;
The single parameter method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; addToken(Token&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TokenIdentifier&amp;gt; token) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (token != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) ? addToken(token.getService(), token) : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should suffice.&lt;/p&gt;</comment>
                            <comment id="14247720" author="apurtell" created="Tue, 16 Dec 2014 04:16:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14247723" author="yuzhihong@gmail.com" created="Tue, 16 Dec 2014 04:24:38 +0000"  >&lt;p&gt;TestTokenAuthentication passes.&lt;br/&gt;
Addendum integrated.&lt;/p&gt;</comment>
                            <comment id="14247738" author="apurtell" created="Tue, 16 Dec 2014 04:34:37 +0000"  >&lt;p&gt;Thanks for the addendum Ted.&lt;/p&gt;</comment>
                            <comment id="14247875" author="hudson" created="Tue, 16 Dec 2014 07:11:40 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #745 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/745/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/745/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; User class should provide a way to re-use existing token - addendum for hadoop-1 (tedyu: rev d6d22113c93d252b6b206d74e98da73273ba5a3a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14247906" author="hudson" created="Tue, 16 Dec 2014 07:50:01 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #711 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/711/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/711/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12493&quot; title=&quot;User class should provide a way to re-use existing token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12493&quot;&gt;&lt;del&gt;HBASE-12493&lt;/del&gt;&lt;/a&gt; User class should provide a way to re-use existing token - addendum for hadoop-1 (tedyu: rev d6d22113c93d252b6b206d74e98da73273ba5a3a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14331881" author="enis" created="Sat, 21 Feb 2015 23:49:45 +0000"  >&lt;p&gt;Closing this issue after 1.0.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12755843">HIVE-8898</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12755429">HIVE-8874</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12757831">HBASE-12578</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12757833">HBASE-12579</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12687394" name="12493-0.98.addendum" size="729" author="yuzhihong@gmail.com" created="Tue, 16 Dec 2014 04:03:27 +0000"/>
                            <attachment id="12686351" name="HBASE-12493-0.98.patch" size="42011" author="apurtell" created="Wed, 10 Dec 2014 19:40:54 +0000"/>
                            <attachment id="12685531" name="HBASE-12493-v2-addendum.patch" size="5629" author="ghelmling" created="Sat, 6 Dec 2014 08:35:25 +0000"/>
                            <attachment id="12684753" name="HBASE-12493-v2.patch" size="39633" author="ghelmling" created="Tue, 2 Dec 2014 23:17:42 +0000"/>
                            <attachment id="12684508" name="HBASE-12493.patch" size="29813" author="ghelmling" created="Mon, 1 Dec 2014 23:59:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Nov 2014 17:31:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22go7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>