<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5088/HBASE-5088.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5088] A concurrency issue on SoftValueSortedMap</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5088</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;SoftValueSortedMap is backed by a TreeMap. All the methods in this class are synchronized. If we use this method to add/delete elements, it&apos;s ok.&lt;br/&gt;
But in HConnectionManager#getCachedLocation, it use headMap to get a view from SoftValueSortedMap#internalMap. Once we operate &lt;br/&gt;
on this view map(like add/delete) in other threads, a concurrency issue may occur.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12536123">HBASE-5088</key>
            <summary>A concurrency issue on SoftValueSortedMap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="jeason">Jieshan Bean</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Dec 2011 04:18:21 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:54 +0000</updated>
                            <resolved>Sat, 7 Jan 2012 01:41:05 +0000</resolved>
                                    <version>0.90.4</version>
                    <version>0.94.0</version>
                                    <fixVersion>0.90.6</fixVersion>
                    <fixVersion>0.92.0</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13174606" author="jeason" created="Thu, 22 Dec 2011 04:23:34 +0000"  >&lt;p&gt;We found this issue while one thread can&apos;t get out of the loop in TreeMap#fixAfterDeletion:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Thread-923&quot; prio=10 tid=0x00007f3d40553000 nid=0x3ed6 runnable [0x00007f3d05c1a000]
   java.lang.Thread.State: RUNNABLE
	at java.util.TreeMap.fixAfterDeletion(TreeMap.java:2193)
	at java.util.TreeMap.deleteEntry(TreeMap.java:2151)
	at java.util.TreeMap.remove(TreeMap.java:585)
	at java.util.TreeMap$NavigableSubMap.remove(TreeMap.java:1395)
	at org.apache.hadoop.hbase.util.SoftValueSortedMap.get(SoftValueSortedMap.java:101)
	- locked &amp;lt;0x00007f3d94f24f70&amp;gt; (a org.apache.hadoop.hbase.util.SoftValueSortedMap)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.getCachedLocation(HConnectionManager.java:846)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegionInMeta(HConnectionManager.java:668)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegion(HConnectionManager.java:594)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegion(HConnectionManager.java:559)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.getRegionLocation(HConnectionManager.java:416)
	at org.apache.hadoop.hbase.client.ServerCallable.instantiateServer(ServerCallable.java:57)
	at org.apache.hadoop.hbase.client.ScannerCallable.instantiateServer(ScannerCallable.java:63)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.getRegionServerWithRetries(HConnectionManager.java:1018)
	at org.apache.hadoop.hbase.client.HTable$ClientScanner.nextScanner(HTable.java:1104)
	at org.apache.hadoop.hbase.client.HTable$ClientScanner.initialize(HTable.java:1027)
	at org.apache.hadoop.hbase.client.HTable.getScanner(HTable.java:535)
	at com.huawei.icbc.query.SingleTabQuery.querybatch(SingleTabQuery.java:197)
	at com.huawei.icbc.benchmark.SingleTabQueryAction.query(SingleTabQueryAction.java:181)
	at framework.QueryThread.run(QueryThread.java:47)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13174612" author="anoopsamjohn" created="Thu, 22 Dec 2011 04:45:56 +0000"  >&lt;p&gt;Good catch Jieshan&lt;/p&gt;

&lt;p&gt;SoftValueSortedMap.headMap ()  returns a new Object of SoftValueSortedMap.&lt;br/&gt;
This new object&apos;s internalMap is a view of the original internalMap which is refered by the 1st SoftValueSortedMap..  But the view always refer and operates on the actual TreeMap datastructure which is not Thread safe....&lt;br/&gt;
Now 2 threads can operate on the 2 SoftValueSortedMap objects concurrently which will result in concurrent operation on a single TreeMap object..&lt;/p&gt;</comment>
                            <comment id="13174613" author="anoopsamjohn" created="Thu, 22 Dec 2011 04:49:49 +0000"  >&lt;p&gt;Can we use a thread safe impl of the SortedMap ........ ConcurrentSkipListMap?&lt;/p&gt;</comment>
                            <comment id="13174615" author="jeason" created="Thu, 22 Dec 2011 04:56:13 +0000"  >&lt;p&gt;Good suggestion, Anoop.&lt;/p&gt;

&lt;p&gt;Actually there&apos;s 2 solutions now:&lt;br/&gt;
1. Use &quot;synchronized&quot; while we operation on the view of the original map.&lt;br/&gt;
2. Use ConcurrentSkipListMap insteadof TreeMap.&lt;/p&gt;

&lt;p&gt;Don&apos;t know which one is better.&lt;/p&gt;</comment>
                            <comment id="13174620" author="zhihyu@ebaysf.com" created="Thu, 22 Dec 2011 05:28:59 +0000"  >&lt;p&gt;I was looking at &lt;a href=&quot;http://fuseyism.com/classpath/doc/java/util/concurrent/ConcurrentSkipListMap-source.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fuseyism.com/classpath/doc/java/util/concurrent/ConcurrentSkipListMap-source.html&lt;/a&gt; and trying to see whether its headMap() implementation is different from that of SoftValueSortedMap.&lt;/p&gt;

&lt;p&gt;I suggest trying option #1 above first.&lt;/p&gt;</comment>
                            <comment id="13174623" author="ram_krish" created="Thu, 22 Dec 2011 05:39:23 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;WriterThread-2&quot;&lt;/span&gt; prio=10 tid=0x00000000405cb000 nid=0x6a98 runnable [0x00007fd0c18cf000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	at org.apache.hadoop.hbase.util.Bytes.compareTo(Bytes.java:916)
	at org.apache.hadoop.hbase.util.Bytes$ByteArrayComparator.compare(Bytes.java:109)
	at org.apache.hadoop.hbase.util.Bytes$ByteArrayComparator.compare(Bytes.java:101)
	at java.util.TreeMap.getEntryUsingComparator(TreeMap.java:351)
	at java.util.TreeMap.getEntry(TreeMap.java:322)
	at java.util.TreeMap.remove(TreeMap.java:580)
	at org.apache.hadoop.hbase.util.SoftValueSortedMap.checkReferences(SoftValueSortedMap.java:76)
	at org.apache.hadoop.hbase.util.SoftValueSortedMap.isEmpty(SoftValueSortedMap.java:150)
	- locked &amp;lt;0x00007fd106cd6870&amp;gt; (a org.apache.hadoop.hbase.util.SoftValueSortedMap)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.getCachedLocation(HConnectionManager.java:826)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegionInMeta(HConnectionManager.java:668)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegion(HConnectionManager.java:594)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatch(HConnectionManager.java:1133)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatchOfPuts(HConnectionManager.java:1253)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:828)
	at org.apache.hadoop.hbase.client.HTable.doPut(HTable.java:684)
	at org.apache.hadoop.hbase.client.HTable.put(HTable.java:674)
	at PerRegionLoadData$WriterThread.writeBuffer(PerRegionLoadData.java:350)
	at PerRegionLoadData$WriterThread.doRun(PerRegionLoadData.java:314)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Once we got the above stack trace.. did not dig in much that time.. good finding&lt;/p&gt;</comment>
                            <comment id="13174646" author="lhofhansl" created="Thu, 22 Dec 2011 06:34:59 +0000"  >&lt;p&gt;ConcurrentSkipListMap does not appear to have this problem as a &lt;/p&gt;
{head|tail}
&lt;p&gt;Map just maps put/get operations back to the original map. Maybe we can do the same approach here.&lt;/p&gt;

&lt;p&gt;Cannot use ConcurrentSkipListMap directly as SoftValueSortedMap specifically stores SoftReferences to the values... Although I am personally not a big fan of this. Either we cache stuff or not. If there is memory pressure and the JVM removes the object referred to by the soft references, we generate even more new garbage when we miss the cache and have to reacquire the object.&lt;/p&gt;

&lt;p&gt;Looks like SoftValueSortedMap.headMap() is buggy, we should throw UnsupportedOperation or fix it. Fixing it would mean to keep a reference to the original map and use that synchronize in the headMap (which means we need to return a special inner class), or to materialize the headmap in a copy, or do what ConcurrentSkipListMap does and map the API operations back to the original map.&lt;/p&gt;</comment>
                            <comment id="13174652" author="lhofhansl" created="Thu, 22 Dec 2011 06:39:47 +0000"  >&lt;p&gt;Or maybe I misunderstood and you want just replace the TreeMap in SoftValueSortedMap with ConcurrentSkipListMap... That would work too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13174653" author="anoopsamjohn" created="Thu, 22 Dec 2011 06:45:06 +0000"  >&lt;p&gt;@Lars  I mean replace the TreeMap in SoftValueSortedMap with ConcurrentSkipListMap.&lt;br/&gt;
Yes we need the SoftValueSortedMap as it maintains Soft refs...&lt;/p&gt;
</comment>
                            <comment id="13174659" author="lhofhansl" created="Thu, 22 Dec 2011 06:55:43 +0000"  >&lt;p&gt;SoftValueSortedMap is (currently) only used in HConnectionImplementation, so that should be OK.&lt;br/&gt;
It seems that ReferenceQueue is thread safe and hence we won&apos;t need to synchronize any of the methods in SoftValueSortedMap.&lt;/p&gt;</comment>
                            <comment id="13175142" author="lhofhansl" created="Thu, 22 Dec 2011 23:22:46 +0000"  >&lt;p&gt;If the observed behavior is for the calling thread to enter an infinite loop (as Jieshan seems to suggest) I&apos;d say this is a critical issue. (imagine this happening in a long lived application server)&lt;br/&gt;
Jieshan, can confirm that what you saw was a thread entering looping indefinitely?&lt;/p&gt;

&lt;p&gt;As I said above, I think using SoftReferences for caching is generally misguided.&lt;br/&gt;
As far as I am concerned we can just replace SoftValueSortedMap with ConcurrentSkipListMap.&lt;/p&gt;</comment>
                            <comment id="13175253" author="jeason" created="Fri, 23 Dec 2011 03:49:53 +0000"  >&lt;p&gt;Loop into the mothod of TreeMap#fixAfterDeletion(Entry&amp;lt;K,V&amp;gt; x), once the x is null(It may caused by a concurrency issue), it can&apos;t come out of that loop. At that time, CPU usage is high. &lt;br/&gt;
That&apos;s what we saw. All the time, the thread was blocked in that method.&lt;br/&gt;
Currently, the patch is made just replace TreeMap with ConcurrentSkipListMap as Anoop and Lars&apos;s suggestion. We&apos;re verifying the patch.&lt;br/&gt;
@Ted, actually, the heapmap method of ConcurrentSkipListMap is different from TreeMap, it is also backed by the original thread-safe map. what do you think?&lt;/p&gt;</comment>
                            <comment id="13175256" author="zhihyu@ebaysf.com" created="Fri, 23 Dec 2011 03:57:35 +0000"  >&lt;p&gt;I think Anoop and Lars&apos; suggestion is good.&lt;/p&gt;

&lt;p&gt;Let us know the result of your tests.&lt;/p&gt;</comment>
                            <comment id="13175257" author="lhofhansl" created="Fri, 23 Dec 2011 03:57:44 +0000"  >&lt;p&gt;@Stack... Do you think this is critical? (it has been like this forever, so maybe it&apos;s not, seems bad enough, though)&lt;/p&gt;</comment>
                            <comment id="13175270" author="stack" created="Fri, 23 Dec 2011 04:19:57 +0000"  >&lt;p&gt;@Lars Sounds bad. Not enough to kill RC IMO since its been this way so long but should make next RC if one and backport to 0.90.6 I&apos;d say.&lt;/p&gt;</comment>
                            <comment id="13175274" author="lhofhansl" created="Fri, 23 Dec 2011 04:42:26 +0000"  >&lt;p&gt;Agree... Shouldn&apos;t kill the RC.&lt;/p&gt;

&lt;p&gt;One thing I noticed in the code, we always use the concrete Map type everywhere. This is in general bad design. Should only the interface that is needed.&lt;br/&gt;
Most methods only use the Map interface. Shouldn&apos;t be passed anything more then.&lt;/p&gt;

&lt;p&gt;I can attach a patch the reduces the Map interface used to what is actually needed (that may or may not make this problem simpler, but it&apos;ll be nicer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;</comment>
                            <comment id="13175283" author="jeason" created="Fri, 23 Dec 2011 05:12:47 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Use the concrete Map type is always not recommended. &lt;/p&gt;</comment>
                            <comment id="13175300" author="lhofhansl" created="Fri, 23 Dec 2011 06:08:29 +0000"  >&lt;p&gt;Trivial patch to use the least specific Map interface possible in HConnectionManager.&lt;/p&gt;</comment>
                            <comment id="13175303" author="lhofhansl" created="Fri, 23 Dec 2011 06:12:34 +0000"  >&lt;p&gt;I also have a version that replaces SoftValueSortedMap with ConcurrentSkipListMap.&lt;/p&gt;</comment>
                            <comment id="13175306" author="jeason" created="Fri, 23 Dec 2011 06:22:27 +0000"  >&lt;p&gt;I have made a patch replace the TreeMap with ConcurrentSplitListMap in SoftValueSortedMap, but not replace SoftValueSortedMap. I&apos;m running the test on that patch. once finished, I&apos;ll submit the patch.&lt;/p&gt;</comment>
                            <comment id="13175309" author="jeason" created="Fri, 23 Dec 2011 06:31:08 +0000"  >&lt;p&gt;Thanks Lars, I will modify the patch under your suggestion, to use the interface replace the concrete type&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;...Will submit it later.&lt;/p&gt;</comment>
                            <comment id="13175397" author="jeason" created="Fri, 23 Dec 2011 12:25:00 +0000"  >&lt;p&gt;This problem can&apos;t be easily reproduced in the cluster. So I just mocked it by write some test code to reproduce this same concurrency issue. See HBase5088Reproduce.java, it can be reproduced with a high probability. Change the TreeMap to ConcurrentSkipListMap can solve the problem.&lt;/p&gt;

&lt;p&gt;The patches, I have tested them. All the unit tests passed. In cluster, the performance seems a slighly coming down:&lt;/p&gt;

&lt;p&gt;38764-without patch and 37080-with patch &lt;/p&gt;</comment>
                            <comment id="13175412" author="ram_krish" created="Fri, 23 Dec 2011 12:58:51 +0000"  >&lt;p&gt;+1 on patch.. &lt;/p&gt;</comment>
                            <comment id="13175488" author="zhihyu@ebaysf.com" created="Fri, 23 Dec 2011 16:24:36 +0000"  >&lt;p&gt;@Jieshan:&lt;br/&gt;
What is the unit of comparison you gave @ 23/Dec/11 12:25 ?&lt;br/&gt;
If possible, can you get numbers for read and write, respectively.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; V put(K key, V value) {
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; V put(K key, V value) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One might think higher concurrency should be achived by removing synchronized keyword.&lt;/p&gt;</comment>
                            <comment id="13175492" author="lhofhansl" created="Fri, 23 Dec 2011 16:34:30 +0000"  >&lt;p&gt;probably because of ConcurrenSkiplistMap... it is definitely slower than a plain TreeMap.&lt;/p&gt;

</comment>
                            <comment id="13175498" author="zhihyu@ebaysf.com" created="Fri, 23 Dec 2011 17:00:34 +0000"  >&lt;p&gt;First, I wonder why this problem wasn&apos;t discovered earlier.&lt;/p&gt;

&lt;p&gt;@Jieshan:&lt;br/&gt;
What JDK version is used ? Please also give us the information on OS as well.&lt;/p&gt;

&lt;p&gt;Second I want to see the breakdown of slowdown across reads vs writes.&lt;/p&gt;</comment>
                            <comment id="13175554" author="lhofhansl" created="Fri, 23 Dec 2011 19:42:30 +0000"  >&lt;p&gt;I was worrying too why have not discovered that sooner. I assume it just happens rarely and since it leads to an infinite loop rather than an exception people might just miss it.&lt;/p&gt;

&lt;p&gt;Jieshan, I was wondering whether you do another comparison with SoftvalueSortedMap replaced by ConcurrentSkiplistMap.&lt;/p&gt;



</comment>
                            <comment id="13175565" author="lhofhansl" created="Fri, 23 Dec 2011 20:11:31 +0000"  >&lt;p&gt;Looking at trunk patch... Looks good.&lt;/p&gt;

&lt;p&gt;Since the internalMap (which should really be called delegate, but that is a different story) is now a ConcurrentNavigableMap, SoftValueSortedMap could implement ConcurrentNavigableMap and delegate all extra methods to the internalMap. If that is done then more concrete Map usages in HConnectionManager could be replaced by interfaces.&lt;/p&gt;</comment>
                            <comment id="13175632" author="lhofhansl" created="Sat, 24 Dec 2011 00:57:42 +0000"  >&lt;p&gt;Here&apos;s a version that does that.&lt;br/&gt;
o SoftValueSortedMap implements NavigableMap&lt;br/&gt;
o All extra NavigableMap methods are delegated to internalMap&lt;br/&gt;
o None of its methods are synchronized&lt;br/&gt;
o All generics warnings are fixed.&lt;/p&gt;

&lt;p&gt;Please have a look.&lt;/p&gt;</comment>
                            <comment id="13175640" author="ram_krish" created="Sat, 24 Dec 2011 01:56:31 +0000"  >&lt;p&gt;@Lars &lt;/p&gt;

&lt;p&gt;Had a look at the patch. The intention is good.  &lt;/p&gt;</comment>
                            <comment id="13175887" author="jeason" created="Mon, 26 Dec 2011 04:59:50 +0000"  >&lt;p&gt;@Ted,&lt;br/&gt;
At first, I also thought we would get a higher performance with this patch, because all the keywords of &quot;synchronized&quot; removed. But it slowdown.&lt;br/&gt;
I agree with the explaination from Lars.&lt;br/&gt;
Our JDK version is 1.6.0_22. And the below is our OS information:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;C3S3:~ # cat /proc/version
Linux version 2.6.32.12-0.7-default (geeko@buildhost) (gcc version 4.3.4 [gcc-4_                                             3-branch revision 152973] (SUSE Linux) ) #1 SMP 2010-05-20 11:14:20 +0200
C3S3:/proc # lsb_release -a
LSB Version:    core-2.0-noarch:core-3.2-noarch:core-4.0-noarch:core-2.0-x86_64:core-3.2-x86_64:core-4.0-x86_64:desktop-4.0-amd64:desktop-4.0-noarch:graphics-2.0-amd64:graphics-2.0-noarch:graphics-3.2-amd64:graphics-3.2-noarch:graphics-4.0-amd64:graphics-4.0-noarch
Distributor ID: SUSE LINUX
Description:    SUSE Linux Enterprise Server 11 (x86_64)
Release:        11
Codename:       n/a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ll take more tests accross the read vs write and give out the results.&lt;/p&gt;

&lt;p&gt;@Lars,&lt;br/&gt;
Sorry, I didn&apos;t do another comparison with SoftvalueSortedMap replaced by ConcurrentSkiplistMap.And am planning to do it. Including the functional test and the performance test. And then, we can choose a better one.&lt;/p&gt;</comment>
                            <comment id="13175975" author="zhihyu@ebaysf.com" created="Mon, 26 Dec 2011 17:25:59 +0000"  >&lt;p&gt;@Jieshan:&lt;br/&gt;
Can you use a more recent JVM when performing future performance evaluation ?&lt;br/&gt;
Such as:&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_29&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_29-b11-402-10M3527)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 20.4-b02-402, mixed mode)&lt;/p&gt;</comment>
                            <comment id="13176074" author="jeason" created="Tue, 27 Dec 2011 03:53:34 +0000"  >&lt;p&gt;@Ted:&lt;br/&gt;
Upgrate the jdk version seems very difficult to us, because all the applications base on that version. I remember the 1.6.0_22 is the recommanded version from community before. Can you tell me why should I use &quot;1.6.0_29&quot;? thanks.&lt;/p&gt;</comment>
                            <comment id="13176075" author="zhihyu@ebaysf.com" created="Tue, 27 Dec 2011 04:01:20 +0000"  >&lt;p&gt;There was no particular reason.&lt;/p&gt;

&lt;p&gt;Please go ahead with planned comparison.&lt;/p&gt;

&lt;p&gt;At the same time, I am polling concurrency user group for experts&apos; comments.&lt;/p&gt;</comment>
                            <comment id="13176078" author="jeason" created="Tue, 27 Dec 2011 04:20:07 +0000"  >&lt;p&gt;ok..Thanks...We&apos;re doing the performance tests accross reads vs writes with two different patches according to your suggestion&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13176083" author="lhofhansl" created="Tue, 27 Dec 2011 04:57:32 +0000"  >&lt;p&gt;Thanks for your time on this Jieshan!&lt;/p&gt;</comment>
                            <comment id="13178295" author="lhofhansl" created="Mon, 2 Jan 2012 06:04:24 +0000"  >&lt;p&gt;@Jieshan: What do you think of my attached 5088.generics.txt patch?&lt;/p&gt;

&lt;p&gt;It switches TreeMap with ConcurrentSkipListMap and also:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;fixes all generics warnings&lt;/li&gt;
	&lt;li&gt;uses proper interfaces instead of concrete classes&lt;/li&gt;
	&lt;li&gt;removes all synchronization (should not be necessary with the inner map being a ConcurrentSkipListMap).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178362" author="jeason" created="Mon, 2 Jan 2012 11:51:49 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
It makes sense to me. I also made plan to test this patch, but the tests haven&apos;t finished yet(Encountered some problems during the tests). &lt;br/&gt;
Thank you for your attention on this issue, Lars&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="13179843" author="stack" created="Wed, 4 Jan 2012 20:36:53 +0000"  >&lt;p&gt;+1 on last patch posted by Lars.&lt;/p&gt;</comment>
                            <comment id="13180203" author="lhofhansl" created="Thu, 5 Jan 2012 05:57:40 +0000"  >&lt;p&gt;Getting a test run in.&lt;br/&gt;
Jieshan, I will wait for your OK/testresults on the patch before committing.&lt;/p&gt;</comment>
                            <comment id="13180223" author="hadoopqa" created="Thu, 5 Jan 2012 06:43:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508581/5088.generics.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508581/5088.generics.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestSplitLogManager&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/671//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/671//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/671//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/671//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/671//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/671//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13180225" author="lhofhansl" created="Thu, 5 Jan 2012 06:54:06 +0000"  >&lt;p&gt;These four test frequently (always?) fail.&lt;br/&gt;
Would be nice to get this in before 0.92.&lt;/p&gt;

&lt;p&gt;Since this ends up in an infinite loop, it is hard to replicate in a test.&lt;/p&gt;</comment>
                            <comment id="13180256" author="jeason" created="Thu, 5 Jan 2012 09:40:12 +0000"  >&lt;p&gt;We can finish the tests tommorow,then i&apos;ll give the results. Thank you, Lars&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13181156" author="jeason" created="Fri, 6 Jan 2012 06:23:52 +0000"  >&lt;p&gt;Either the patch of replace TreeMap with ConcurrentSkipListMap, or the patch of replace SoftValueSortedMap with ConcurrentSkipListMap, the performance slightly degraded. The latter one seems better. Please find the test results from the attachment &quot;PerformanceTestResults.png&quot;.&lt;/p&gt;</comment>
                            <comment id="13181159" author="lhofhansl" created="Fri, 6 Jan 2012 06:31:13 +0000"  >&lt;p&gt;I assume that &quot;patch of replace TreeMap with ConcurrentSkipListMap&quot; is the version that removed all synchronization from SoftValueSortedMap?&lt;/p&gt;</comment>
                            <comment id="13181161" author="jeason" created="Fri, 6 Jan 2012 06:34:13 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
&quot;patch of replace TreeMap with ConcurrentSkipListMap&quot; is same with the patch you attached named &quot;5088.generics.txt&quot;.&lt;/p&gt;</comment>
                            <comment id="13181164" author="lhofhansl" created="Fri, 6 Jan 2012 06:53:04 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Some performance hit was expected, as we didn&apos;t handle concurrency correctly before.&lt;br/&gt;
But, wow 10% degradation, didn&apos;t expect ConcurrentSkipListMap to have such an effect.&lt;/p&gt;

&lt;p&gt;Hmm... Curious, since this is a client only change, did you happen to notice higher (or lower) CPU usage on the client?&lt;/p&gt;

&lt;p&gt;The current code is clearly not correct. Now I am wondering whether instances of SoftValueSortedMap should be passed an optional &quot;synchronizer object&quot;. By default it would be &quot;this&quot;, but for instances created from headMap, etc, it would be the &quot;synchronizer object&quot; of the parent. Then instead of all methods marked as synchronized they&apos;d all synchronize on the &quot;synchronizer object&quot;.&lt;/p&gt;

&lt;p&gt;Do folks think this would be reasonable approach to validate?&lt;/p&gt;

&lt;p&gt;I also would like to get opinions about doing away with SoftValueSortedMap and using ConcurrentSkipListMap directly (~5% performance hit, and it would no longer allow the JVM to remove the cached values under memory pressure - which I think never works correctly anyway).&lt;/p&gt;</comment>
                            <comment id="13181175" author="hadoopqa" created="Fri, 6 Jan 2012 07:06:46 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509670/HBase5088-trunk-replaceTreeMap.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509670/HBase5088-trunk-replaceTreeMap.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/683//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/683//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/683//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/683//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/683//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/683//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181178" author="lhofhansl" created="Fri, 6 Jan 2012 07:23:30 +0000"  >&lt;p&gt;Here&apos;s a patch for sync object approach. It uses the internalMap itself to synchronize. When a new SoftValueSortedMap is created via &lt;/p&gt;
{head|tail|sub}Map the parent&apos;s sync object is passed to the newly created map.&lt;br/&gt;
This way no memory is wasted as the {head|tail|sub}
&lt;p&gt;map hold a reference to their parents anyway.&lt;/p&gt;</comment>
                            <comment id="13181192" author="hadoopqa" created="Fri, 6 Jan 2012 08:07:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509671/5088-syncObj.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509671/5088-syncObj.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/684//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/684//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/684//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/684//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/684//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/684//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181217" author="jeason" created="Fri, 6 Jan 2012 09:44:15 +0000"  >&lt;p&gt;If the new instance of SoftValueSortedMap hold a reference of &quot;sync&quot;, then the problem can also be solved. It&apos;s a good approach&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13181465" author="lhofhansl" created="Fri, 6 Jan 2012 17:40:22 +0000"  >&lt;p&gt;Do you think you can run your test with this again for comparison?&lt;/p&gt;</comment>
                            <comment id="13181515" author="lhofhansl" created="Fri, 6 Jan 2012 18:56:35 +0000"  >&lt;p&gt;I think we should check in the latest change. Since we cannot reliably reproduce the issue, we have to verify by inspection. The latest change (5088-syncObject.txt) will be least amount of change from the original code and adds the least extra synchronization needed.&lt;/p&gt;

&lt;p&gt;I&apos;ll fix up the patch slightly (pull in the interface cleanups from my other patch).&lt;/p&gt;

&lt;p&gt;Ted, Stack, etc, please weigh in.&lt;/p&gt;</comment>
                            <comment id="13181524" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 19:08:30 +0000"  >&lt;p&gt;I think we&apos;d better verify the performance first.&lt;/p&gt;

&lt;p&gt;This issue is not so critical that 0.92 RC3 should be blocked since it is not easily reproducible.&lt;/p&gt;</comment>
                            <comment id="13181526" author="lhofhansl" created="Fri, 6 Jan 2012 19:08:45 +0000"  >&lt;p&gt;Here&apos;s a proposal for a final patch.&lt;/p&gt;</comment>
                            <comment id="13181529" author="lhofhansl" created="Fri, 6 Jan 2012 19:09:53 +0000"  >&lt;p&gt;@Ted: This change is the minimum we &lt;b&gt;must&lt;/b&gt; do (in the sense that it is the minimum extra synchronization to make it correct), even it takes a perf hit.&lt;/p&gt;</comment>
                            <comment id="13181558" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 19:47:20 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Agreed.&lt;/p&gt;</comment>
                            <comment id="13181602" author="lhofhansl" created="Fri, 6 Jan 2012 21:05:55 +0000"  >&lt;p&gt;So I take this as a +1?&lt;/p&gt;</comment>
                            <comment id="13181608" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 21:09:52 +0000"  >&lt;p&gt;I haven&apos;t looked at the final patch yet - can do that later.&lt;br/&gt;
So consider my vote +0.&lt;/p&gt;

&lt;p&gt;Please run the patch through Hadoop QA.&lt;/p&gt;</comment>
                            <comment id="13181632" author="hadoopqa" created="Fri, 6 Jan 2012 21:58:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509707/5088-final.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509707/5088-final.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/690//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/690//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/690//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/690//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/690//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/690//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181637" author="lhofhansl" created="Fri, 6 Jan 2012 21:59:33 +0000"  >&lt;p&gt;In a quick local test (on pseudo distributed mode) I was able to reproduce the slow down with ConcurrentSkipListMap that Jieshan has reported, in my case the slowdown was even worse (runtime went up from ~12.5s to ~17.5 - everything is faster in local mode, so a constant slowdown will have a larger proportional impact).&lt;/p&gt;

&lt;p&gt;With the last patch (sync Object) I have not seen any slowdown using the same test. So I think this is good to go a soon as HadoopQA confirms.&lt;/p&gt;</comment>
                            <comment id="13181647" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 22:23:32 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SoftValueSortedMap(SortedMap&amp;lt;K,SoftValue&amp;lt;K,V&amp;gt;&amp;gt; original, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; sync) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The new ctor is private. Meaning, sync would always be the same as original. I wonder if introducing the sync field is necessary.&lt;br/&gt;
Can this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(sync) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;be replaced by the following ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13181656" author="lhofhansl" created="Fri, 6 Jan 2012 22:35:59 +0000"  >&lt;p&gt;Look at the &lt;/p&gt;
{head|tail|sub}
&lt;p&gt;Map methods, that&apos;s where it gets interesting and is exactly the reason why there is an extra object to synchronize on.&lt;/p&gt;</comment>
                            <comment id="13181657" author="lhofhansl" created="Fri, 6 Jan 2012 22:39:17 +0000"  >&lt;p&gt;But I see how this is easy to miss, maybe some comments on that constructor would be in order.&lt;/p&gt;</comment>
                            <comment id="13181663" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 22:46:22 +0000"  >&lt;p&gt;That makes sense.&lt;br/&gt;
Some lines are too wide:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SoftValueSortedMap&amp;lt;K,V&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.subMap(fromKey, toKey), sync);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        SoftValueSortedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], HRegionLocation&amp;gt; tableLocs =
-          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cachedRegionLocations.get(key);
+        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], HRegionLocation&amp;gt; tableLocs = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cachedRegionLocations
+            .get(key);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Did you get the above through auto-formatting ? I think keeping this.cachedRegionLocations.get(key) on one line is better.&lt;/p&gt;</comment>
                            <comment id="13181681" author="lhofhansl" created="Fri, 6 Jan 2012 23:19:14 +0000"  >&lt;p&gt;How about this one.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Undid the auto-format that put .get in a separate line.&lt;/li&gt;
	&lt;li&gt;broke up line that is too long&lt;/li&gt;
	&lt;li&gt;added java doc to new constructor&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13181693" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 23:38:24 +0000"  >&lt;p&gt;final2 ? That&apos;s funny &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
This looks good.&lt;br/&gt;
+1&lt;/p&gt;

&lt;p&gt;Minor: long line still:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], HRegionLocation&amp;gt; tableLocations = getTableLocations(tableName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13181695" author="lhofhansl" created="Fri, 6 Jan 2012 23:41:47 +0000"  >&lt;p&gt;I thought so too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
That line went through the formatter (just checked again) (84 chars)&lt;br/&gt;
I can break it up anyway, will do at commit.&lt;/p&gt;</comment>
                            <comment id="13181704" author="lhofhansl" created="Fri, 6 Jan 2012 23:52:15 +0000"  >&lt;p&gt;I assume this should go into 0.90 as well.&lt;/p&gt;</comment>
                            <comment id="13181712" author="hadoopqa" created="Sat, 7 Jan 2012 00:02:24 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509738/5088-final2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509738/5088-final2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/691//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/691//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/691//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/691//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/691//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/691//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181769" author="lhofhansl" created="Sat, 7 Jan 2012 01:41:05 +0000"  >&lt;p&gt;Committed to 0.92 and trunk.&lt;br/&gt;
Not entirely convinced we should make this change in 0.90&lt;/p&gt;</comment>
                            <comment id="13181864" author="lhofhansl" created="Sat, 7 Jan 2012 05:04:57 +0000"  >&lt;p&gt;I made an 0.90 patch, in case somebody wants this in 0.90 as well.&lt;/p&gt;</comment>
                            <comment id="13181870" author="hudson" created="Sat, 7 Jan 2012 05:22:12 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #229 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/229/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/229/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt; A concurrency issue on SoftValueSortedMap (Jieshan Bean and Lars H)&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13181884" author="hudson" created="Sat, 7 Jan 2012 06:21:29 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #66 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/66/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/66/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt; A concurrency issue on SoftValueSortedMap (Jieshan Bean and Lars H)&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13181900" author="jeason" created="Sat, 7 Jan 2012 09:08:09 +0000"  >&lt;p&gt;It seems my reply is too late. Thank you all&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I suggest backport this patch to 0.90.6.&lt;/p&gt;</comment>
                            <comment id="13181911" author="hudson" created="Sat, 7 Jan 2012 11:47:59 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #65 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/65/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/65/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt; A concurrency issue on SoftValueSortedMap (Jieshan Bean and Lars H)&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13181915" author="ram_krish" created="Sat, 7 Jan 2012 12:11:04 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
I too feel we can backport to 0.90? &lt;/p&gt;</comment>
                            <comment id="13182046" author="lhofhansl" created="Sat, 7 Jan 2012 18:07:38 +0000"  >&lt;p&gt;OK. Sorry for presuming. I&apos;ll commit to 0.90 later today.&lt;/p&gt;

</comment>
                            <comment id="13182172" author="lhofhansl" created="Sun, 8 Jan 2012 01:15:29 +0000"  >&lt;p&gt;This is what I committed to 0.90.&lt;/p&gt;

&lt;p&gt;While I worked on that I noticed that I can get rid more concrete uses of SoftvalueSortedMap in HConnectionManager (in fact all uses except creation, which is nice). I&apos;ll do an addendum for this in 0.92 and trunk.&lt;/p&gt;</comment>
                            <comment id="13182173" author="lhofhansl" created="Sun, 8 Jan 2012 01:21:18 +0000"  >&lt;p&gt;This is the addendum. Now the code is pretty clean w.r.t. using Map interfaces.&lt;/p&gt;</comment>
                            <comment id="13182175" author="lhofhansl" created="Sun, 8 Jan 2012 01:24:02 +0000"  >&lt;p&gt;Removed some of the attachment that are just confusing. The addendum also fixes minor formatting inconsistencies that I had introduced. All is good now.&lt;/p&gt;</comment>
                            <comment id="13182192" author="hudson" created="Sun, 8 Jan 2012 04:24:55 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #235 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/235/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/235/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt;  addendum&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13182199" author="ram_krish" created="Sun, 8 Jan 2012 06:09:57 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
Good on you for committing it to 0.90 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;..&lt;/p&gt;</comment>
                            <comment id="13182204" author="hudson" created="Sun, 8 Jan 2012 06:30:36 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #67 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/67/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/67/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt;  addendum&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13182217" author="hudson" created="Sun, 8 Jan 2012 08:28:03 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #67 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/67/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/67/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt;  addendum&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13183980" author="hudson" created="Wed, 11 Jan 2012 10:31:02 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2617 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2617/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2617/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt;  addendum&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5088&quot; title=&quot;A concurrency issue on SoftValueSortedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5088&quot;&gt;&lt;del&gt;HBASE-5088&lt;/del&gt;&lt;/a&gt; A concurrency issue on SoftValueSortedMap (Jieshan Bean and Lars H)&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13185112" author="lhofhansl" created="Thu, 12 Jan 2012 18:05:05 +0000"  >&lt;p&gt;Thanks for tracking down the problem Jieshan.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509819" name="5088-0.90.txt" size="12600" author="lhofhansl" created="Sun, 8 Jan 2012 01:15:29 +0000"/>
                            <attachment id="12509820" name="5088-0.92-trunk-addendum.txt" size="3418" author="lhofhansl" created="Sun, 8 Jan 2012 01:21:18 +0000"/>
                            <attachment id="12509747" name="5088-final3.txt" size="12134" author="lhofhansl" created="Fri, 6 Jan 2012 23:56:02 +0000"/>
                            <attachment id="12508538" name="HBase-5088-90.patch" size="7867" author="jeason" created="Fri, 23 Dec 2011 13:35:35 +0000"/>
                            <attachment id="12508539" name="HBase-5088-trunk.patch" size="6591" author="jeason" created="Fri, 23 Dec 2011 13:35:35 +0000"/>
                            <attachment id="12509668" name="HBase5088-90-replaceSoftValueSortedMap.patch" size="5085" author="jeason" created="Fri, 6 Jan 2012 06:26:25 +0000"/>
                            <attachment id="12509669" name="HBase5088-90-replaceTreeMap.patch" size="13025" author="jeason" created="Fri, 6 Jan 2012 06:26:25 +0000"/>
                            <attachment id="12509670" name="HBase5088-trunk-replaceTreeMap.patch" size="13507" author="jeason" created="Fri, 6 Jan 2012 06:26:25 +0000"/>
                            <attachment id="12508521" name="HBase5088Reproduce.java" size="5813" author="jeason" created="Fri, 23 Dec 2011 12:25:00 +0000"/>
                            <attachment id="12509666" name="PerformanceTestResults.png" size="28764" author="jeason" created="Fri, 6 Jan 2012 06:24:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Dec 2011 04:45:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i069u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>