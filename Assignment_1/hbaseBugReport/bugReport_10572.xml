<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:15:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10572/HBASE-10572.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10572] Create an IntegrationTest for region replicas</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10572</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We should add an integration test for testing reads from replicas with chaos monkey. &lt;/p&gt;

&lt;p&gt;I am thinking of a test which: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Creates a table with region replication&lt;/li&gt;
	&lt;li&gt;Writes some data to a table with many regions per server. Ensures that the replicas sees the data.&lt;/li&gt;
	&lt;li&gt;Does time bounded gets (5 sec, etc) with timeline consistency. Failing to complete the reads with a smaller latency will fail the test&lt;/li&gt;
	&lt;li&gt;Runs Chaos Monkey to kill the region servers, master and runs balance. We do not want other CM actions (flush, snapshot, etc)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12696125">HBASE-10572</key>
            <summary>Create an IntegrationTest for region replicas</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12682280">HBASE-10070</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Feb 2014 01:00:46 +0000</created>
                <updated>Sat, 21 Feb 2015 23:33:37 +0000</updated>
                            <resolved>Tue, 11 Mar 2014 18:41:58 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>hbase-10070</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13906418" author="enis" created="Thu, 20 Feb 2014 01:09:58 +0000"  >&lt;p&gt;Here is a patch which adds the integration test using LoadTestTool. &lt;br/&gt;
Can be used like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase org.apache.hadoop.hbase.test.IntegrationTestTimeBoundedRequestsWithRegionReplicas -Dhbase.IntegrationTestTimeBoundedRequestsWithRegionReplicas.runtime=1800000 -DIntegrationTestTimeBoundedRequestsWithRegionReplicas.num_write_threads=40 -DIntegrationTestTimeBoundedRequestsWithRegionReplicas.num_read_threads=40 --monkey destructive
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;v0 need some polishing, and I am still testing it on the cluster, but this version already proved to be useful in debugging and testing. &lt;/p&gt;</comment>
                            <comment id="13924304" author="enis" created="Fri, 7 Mar 2014 20:36:28 +0000"  >&lt;p&gt;Here is a more complete patch. From the javadoc: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
* An IntegrationTest &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; doing reads with a timeout, to a read-only table with region
 * replicas. ChaosMonkey is run which kills the region servers and master, but ensures
 * that meta region server is not killed, and at most 2 region servers are dead at any point
 * in time. The expected behavior is that all reads with stale mode &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; will &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
 * before the timeout (5 sec by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;). The test fails &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the read requests does not finish
 * in time.
 *
 * &amp;lt;p&amp;gt; This test uses LoadTestTool to read and write the data from a single client but
 * multiple threads. The data is written first, then we allow the region replicas to &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;
 * up. Then we start the reader threads doing get requests with stale mode &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;. Chaos Monkey is
 * started after some delay (20 sec by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) after the reader threads are started so that
 * there is enough time to fully cache meta.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am using this to test &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10355&quot; title=&quot;Failover RPC&amp;#39;s from client using region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10355&quot;&gt;&lt;del&gt;HBASE-10355&lt;/del&gt;&lt;/a&gt;, and the server side patches.&lt;/p&gt;</comment>
                            <comment id="13924315" author="stack" created="Fri, 7 Mar 2014 20:44:52 +0000"  >&lt;p&gt;Skimmed.  Looks great.  Put how to use in the release note.&lt;/p&gt;</comment>
                            <comment id="13925925" author="devaraj" created="Mon, 10 Mar 2014 17:35:20 +0000"  >&lt;p&gt;Not sure if I missed something but passing the argument &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-DIntegrationTestTimeBoundedRequestsWithRegionReplicas.region_replication&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; didn&apos;t reflect in the #replicas for the test table. The test table always gets created with 1 replica.&lt;/p&gt;

&lt;p&gt;I had to make the one line change as in the patch attached for the argument to have an effect (in the earlier patch, hbase-10572_v0.patch, the region_replication would be set in a different place via modifyTable).&lt;/p&gt;

&lt;p&gt;Also, should we fail the test after &quot;READ FAILURE&quot; is &amp;gt; 0?&lt;/p&gt;</comment>
                            <comment id="13930738" author="enis" created="Tue, 11 Mar 2014 18:36:44 +0000"  >&lt;p&gt;Thanks Stack and Devaraj. v2 is v1 + addendum + trivial changes. Will commit this shortly. &lt;/p&gt;</comment>
                            <comment id="13930744" author="enis" created="Tue, 11 Mar 2014 18:39:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also, should we fail the test after &quot;READ FAILURE&quot; is &amp;gt; 0?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There is some logic to abort the test if the number of failures goes beyond 10 (MultiThreadedReader.maxErrors)&lt;/p&gt;</comment>
                            <comment id="13930752" author="enis" created="Tue, 11 Mar 2014 18:41:58 +0000"  >&lt;p&gt;Committed to hbase-10070. &lt;/p&gt;</comment>
                            <comment id="14046618" author="enis" created="Sat, 28 Jun 2014 01:47:22 +0000"  >&lt;p&gt;Attaching rebased patch for master that is committed&lt;/p&gt;</comment>
                            <comment id="14046667" author="enis" created="Sat, 28 Jun 2014 02:08:16 +0000"  >&lt;p&gt;Committed to master as part of hbase-10070 branch merge&lt;/p&gt;</comment>
                            <comment id="14046760" author="hudson" created="Sat, 28 Jun 2014 06:14:01 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5245 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5245/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5245/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10572&quot; title=&quot;Create an IntegrationTest for region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10572&quot;&gt;&lt;del&gt;HBASE-10572&lt;/del&gt;&lt;/a&gt; Create an IntegrationTest for region replicas (enis: rev 759cfb83af84e97a6ad30aad811c03b42f99e233)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestTimeBoundedRequestsWithRegionReplicas.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestIngest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReaderWithACL.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/ServerKillingMonkeyFactory.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReader.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchRestartRsAction.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestBase.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/LoadTestTool.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RestartRandomRsExceptMetaAction.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/MonkeyFactory.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchRestartRsExceptMetaAction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14189686" author="hudson" created="Thu, 30 Oct 2014 06:16:10 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #639 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/639/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/639/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12370&quot; title=&quot;Backport IT changes from HBASE-10572 to 0.98&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12370&quot;&gt;&lt;del&gt;HBASE-12370&lt;/del&gt;&lt;/a&gt; Backport IT changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10572&quot; title=&quot;Create an IntegrationTest for region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10572&quot;&gt;&lt;del&gt;HBASE-10572&lt;/del&gt;&lt;/a&gt; to 0.98 (apurtell: rev f0d52fbe12fded158f761f615f52d4fd8b90ed31)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchRestartRsExceptMetaAction.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchRestartRsAction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestBase.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/MonkeyFactory.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestIngest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/LoadTestTool.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RestartRandomRsExceptMetaAction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReaderWithACL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReader.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/ServerKillingMonkeyFactory.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14189711" author="hudson" created="Thu, 30 Oct 2014 06:40:58 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #608 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/608/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/608/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12370&quot; title=&quot;Backport IT changes from HBASE-10572 to 0.98&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12370&quot;&gt;&lt;del&gt;HBASE-12370&lt;/del&gt;&lt;/a&gt; Backport IT changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10572&quot; title=&quot;Create an IntegrationTest for region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10572&quot;&gt;&lt;del&gt;HBASE-10572&lt;/del&gt;&lt;/a&gt; to 0.98 (apurtell: rev f0d52fbe12fded158f761f615f52d4fd8b90ed31)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchRestartRsExceptMetaAction.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestBase.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/LoadTestTool.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReaderWithACL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReader.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RestartRandomRsExceptMetaAction.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/IntegrationTestIngest.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/MonkeyFactory.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/actions/RollingBatchRestartRsAction.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/chaos/factories/ServerKillingMonkeyFactory.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14331119" author="enis" created="Sat, 21 Feb 2015 23:33:37 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12652957" name="0019-HBASE-10572-Create-an-IntegrationTest-for-region-rep.patch" size="55808" author="enis" created="Sat, 28 Jun 2014 01:47:22 +0000"/>
                            <attachment id="12633736" name="10572-add.txt" size="847" author="devaraj" created="Mon, 10 Mar 2014 17:35:20 +0000"/>
                            <attachment id="12629955" name="hbase-10572_v0.patch" size="45123" author="enis" created="Thu, 20 Feb 2014 01:09:58 +0000"/>
                            <attachment id="12633451" name="hbase-10572_v1.patch" size="52872" author="enis" created="Fri, 7 Mar 2014 20:36:28 +0000"/>
                            <attachment id="12633970" name="hbase-10572_v2.patch" size="50884" author="enis" created="Tue, 11 Mar 2014 18:36:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Mar 2014 20:44:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374602</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sjy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374902</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Adds an integration test for testing multi threaded gets with stale mode set in a table with replicated regions. Chaos Monkey can be run to test the behavior where region servers and masters are killed. &lt;br/&gt;
&lt;br/&gt;
Check the javadoc for IntegrationTestTimeBoundedRequestsWithRegionReplicas for how to run the test. </customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>