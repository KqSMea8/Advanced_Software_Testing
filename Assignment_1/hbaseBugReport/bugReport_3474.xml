<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3474/HBASE-3474.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3474] HFileOutputFormat to use column family&apos;s compression algorithm</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3474</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HFileOutputFormat  currently creates HFile writer&apos;s using a compression algorithm set as configuration &quot;hbase.hregion.max.filesize&quot; with default as no compression. The code does not take into account the compression algorithm configured for the table&apos;s column family.  As a result bulk uploaded tables are not compressed until a major compaction is run on them. This could be fixed by using the column family descriptors while creating HFile writers.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12496631">HBASE-3474</key>
            <summary>HFileOutputFormat to use column family&apos;s compression algorithm</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ashishs">Ashish Shinde</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jan 2011 04:46:29 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:04 +0000</updated>
                            <resolved>Thu, 24 Mar 2011 23:00:11 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>mapreduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="12987539" author="ashishs" created="Thu, 27 Jan 2011 13:03:08 +0000"  >&lt;p&gt;HFileOutputFormat uses HColumnDescriptor&apos;s of column families in the HTable and creates writers with corresponding compression algorithms.&lt;/p&gt;</comment>
                            <comment id="12987541" author="ashishs" created="Thu, 27 Jan 2011 13:05:13 +0000"  >&lt;p&gt;Patch that uses the column descriptors for setting compression.&lt;/p&gt;</comment>
                            <comment id="12987554" author="ashishs" created="Thu, 27 Jan 2011 13:36:47 +0000"  >&lt;p&gt;Removed stray prints from the patch&lt;/p&gt;</comment>
                            <comment id="12987693" author="tlipcon" created="Thu, 27 Jan 2011 18:25:04 +0000"  >&lt;p&gt;Thanks for taking this on, Ashish. A few comments on the patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for createFamilyCompressionMap, specify in the javadoc that this is run inside the task to deserialize the map back out of the Configuration&lt;/li&gt;
	&lt;li&gt;In javadoc for configureCompression, I don&apos;t think there&apos;s any reason to include the @param table and @param conf since they&apos;re kind of obvious&lt;/li&gt;
	&lt;li&gt;in createFamilyCompressionMap, &apos;compression&apos; is misspelled in one var name&lt;/li&gt;
	&lt;li&gt;The encoding you&apos;ve chosen for this config value isn&apos;t the best, since we currently do support &apos;,&apos; in a column family name. What about encoding the map like a query string in a URL? foo=bar&amp;amp;baz=blah - and using URLEncoder/URLDecoder to escape the =s and &amp;amp;s that might be in there.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12987954" author="ashishs" created="Fri, 28 Jan 2011 06:11:45 +0000"  >&lt;p&gt;Incorporated Todd&apos;s comments on javadoc and use of URL encoder for serializing family compression map.&lt;/p&gt;</comment>
                            <comment id="12989061" author="tlipcon" created="Tue, 1 Feb 2011 06:30:23 +0000"  >&lt;p&gt;Hey Ashish. This is looking good. A few more comments before I think it&apos;s ready to commit:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If you make configureCompression and createFamilyCompressionMap package-private instead of private, you could add a nice unit test for them. You can use Mockito to make a mock HTable that returns the HColumnDescriptors you want for the sake of the test - if you need a hand with this you can catch me on #hbase IRC&lt;/li&gt;
	&lt;li&gt;Probably a good idea to put &quot;families.compression&quot; in a constant, and maybe change it to be more obviously scoped - ie something like &quot;hbase.hfileoutputformat.families.compression&quot;&lt;/li&gt;
	&lt;li&gt;When you upload a patch, you should take the diff from the root of the SVN trunk/ - so that it applies with &quot;patch -p0&quot; from inside trunk/.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="12990139" author="ashishs" created="Thu, 3 Feb 2011 15:48:27 +0000"  >&lt;p&gt;Will use a constant for the config key. The test will take me some time because I am not familiar with mockito. Will put out a patch as soon as I get my head around creating the unit test.&lt;/p&gt;</comment>
                            <comment id="12990694" author="tlipcon" created="Fri, 4 Feb 2011 19:39:24 +0000"  >&lt;p&gt;Let me know if you need a hand with the test, happy to help. Mockito is strange at first but once you get the hang of it, it&apos;s pretty nice&lt;/p&gt;</comment>
                            <comment id="13008334" author="ashishs" created="Fri, 18 Mar 2011 05:29:54 +0000"  >&lt;p&gt;Added unit tests for &lt;br/&gt;
1. compression serialization deserialization to job config&lt;br/&gt;
2. testing that the hfile writers use the config correctly.&lt;/p&gt;

&lt;p&gt;Minor issues&lt;br/&gt;
-------------&lt;/p&gt;

&lt;p&gt;1. The test parses out HFile.Reader.toString() to retrieve the compression algorithm used on an HFile. One alternative is to add getCompressionAlgo() to HFile.Reader. &lt;br/&gt;
2. The testColumnFamilyCompression create a mapred job just to get hold of an usable writer. Not sure if this is the best thing to do.&lt;/p&gt;</comment>
                            <comment id="13009360" author="tlipcon" created="Mon, 21 Mar 2011 20:41:16 +0000"  >&lt;p&gt;Hi Ashish. I took your patch and cleaned up the unit tests a bit to share some of the mocking code. I also added a &lt;tt&gt;getCompressionAlgorithm&lt;/tt&gt; call to &lt;tt&gt;HFile.Reader&lt;/tt&gt; as you suggested.&lt;/p&gt;

&lt;p&gt;I removed one of the unit tests since it seemed to be entirely subsumed by the other one. Also updated the unit tests to check cases like 0-CF and 1-CF.&lt;/p&gt;

&lt;p&gt;Can you check over this updated patch and make sure it looks good to you?&lt;/p&gt;</comment>
                            <comment id="13009556" author="ashishs" created="Tue, 22 Mar 2011 05:33:29 +0000"  >&lt;p&gt;Hi Todd, Thanks for re-factoring the tests. They look better now. Will try to be more careful in looking for code reuse opportunities. I just removed some unused imports from the test file. My IDE marks unused imports as warnings &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;   &lt;/p&gt;</comment>
                            <comment id="13009729" author="stack" created="Tue, 22 Mar 2011 17:29:48 +0000"  >&lt;p&gt;@Ashish So, are you +1 on committing your patch (w/ Todd cleanup)?&lt;/p&gt;</comment>
                            <comment id="13009999" author="ashishs" created="Wed, 23 Mar 2011 05:07:36 +0000"  >&lt;p&gt;+1 on committing the patch with Todd&apos;s cleanup.&lt;/p&gt;</comment>
                            <comment id="13010987" author="stack" created="Thu, 24 Mar 2011 23:00:11 +0000"  >&lt;p&gt;Committed Todds fixup of Ashish&apos;s patch.  Thank you for the patch Ashish.&lt;/p&gt;</comment>
                            <comment id="13011479" author="hudson" created="Fri, 25 Mar 2011 23:10:28 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1814 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1814/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1814/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="15017423" author="lars_francke" created="Fri, 20 Nov 2015 12:43:04 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474271" name="hbase-3474.txt" size="16632" author="ashishs" created="Tue, 22 Mar 2011 05:33:29 +0000"/>
                            <attachment id="12474224" name="hbase-3474.txt" size="17207" author="tlipcon" created="Mon, 21 Mar 2011 20:41:16 +0000"/>
                            <attachment id="12473973" name="patch3474.txt" size="16853" author="ashishs" created="Fri, 18 Mar 2011 05:29:54 +0000"/>
                            <attachment id="12469636" name="patch3474.txt" size="4534" author="ashishs" created="Fri, 28 Jan 2011 06:11:44 +0000"/>
                            <attachment id="12469544" name="patch3474.txt" size="4166" author="ashishs" created="Thu, 27 Jan 2011 13:36:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Jan 2011 18:25:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33046</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05idb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>HFileOutputFormat to use column family&amp;#39;s compression algorithm instead of a blanket all column family wide </customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>