<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:52:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1264/HBASE-1264.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1264] Wrong return values of comparators for ColumnValueFilter</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1264</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The return values of the compareTo() method have to be changed against each other. The method has to return 0 if the regex matches and 1 if it does not.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 8.04 (64 Bit), JDK 1.6&lt;/p&gt;</environment>
        <key id="12416979">HBASE-1264</key>
            <summary>Wrong return values of comparators for ColumnValueFilter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clint.morgan">Clint Morgan</assignee>
                                    <reporter username="schneidexe">Thomas Schneider</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Mar 2009 15:45:41 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:28 +0000</updated>
                            <resolved>Wed, 13 May 2009 17:04:09 +0000</resolved>
                                    <version>0.19.1</version>
                                    <fixVersion>0.19.2</fixVersion>
                    <fixVersion>0.20.0</fixVersion>
                                    <component>Filters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="12683202" author="stack" created="Wed, 18 Mar 2009 22:08:02 +0000"  >&lt;p&gt;Do you have a patch for this Thomas?&lt;/p&gt;</comment>
                            <comment id="12683213" author="schneidexe" created="Wed, 18 Mar 2009 22:31:53 +0000"  >&lt;p&gt;Not yet. Because this is my first submission to JIRA, I am not exactly sure how to create one. I tried it with linux&apos; diff but it only gives me the output of the patch file appended which is not much.&lt;/p&gt;</comment>
                            <comment id="12683377" author="stack" created="Thu, 19 Mar 2009 09:11:53 +0000"  >&lt;p&gt;This is how it is in the file currently:&lt;/p&gt;

&lt;p&gt; 71     return pattern.matcher(Bytes.toString(value)).find() ? 1 : 0;&lt;/p&gt;

&lt;p&gt;Do you want the 0 and the 1 flipped?  So its:&lt;/p&gt;

&lt;p&gt;&amp;lt;     return pattern.matcher(Bytes.toString(value)).find() ? 0 : 1;&lt;/p&gt;

&lt;p&gt;Your patch is a bit odd in that it would seem to make the file into what it already has.&lt;/p&gt;

&lt;p&gt;You might try &apos;diff -u FILENAME&apos;.  Do the diff from $HBASE_HOME.  Thats how we apply them, at that location.  Otherwise, checkout hbase and do svn diff FILENAME.&lt;/p&gt;

&lt;p&gt;Thanks Thomas.&lt;/p&gt;</comment>
                            <comment id="12689245" author="schneidexe" created="Wed, 25 Mar 2009 21:25:34 +0000"  >&lt;p&gt;I recreated the patch usinf diff -u form $HBASE_HOME. Hope it&apos;s ok now?&lt;/p&gt;</comment>
                            <comment id="12689338" author="apurtell" created="Thu, 26 Mar 2009 02:42:07 +0000"  >&lt;p&gt;Hi Thomas. Why do you think the return of compareTo() is wrong? Your change causes the unit test for this class to fail. &lt;/p&gt;</comment>
                            <comment id="12689409" author="schneidexe" created="Thu, 26 Mar 2009 09:24:58 +0000"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;as in &lt;a href=&quot;http://java.sun.com/javase/6/docs/api/java/lang/Comparable.html#compareTo(T)&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Comparable.compareTo()&lt;/a&gt; defined, the return values should be 0 if the compared objects equal. In the RegexStringComparator it is the case if the comaperd String matches the pattern. Then the method should return 0. If the String does not match, it should return 1.&lt;/p&gt;

&lt;p&gt;I found this bug, when is used the RegexStringComparator as Comparator in a &lt;a href=&quot;http://hadoop.apache.org/hbase/docs/current/api/org/apache/hadoop/hbase/filter/ColumnValueFilter.html#constructor_detail&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;ColumnValueFilter&lt;/a&gt; like &lt;tt&gt;ColumnValueFilter(byte[], ColumnValueFilter.CompareOp, WritableByteArrayComparable)&lt;/tt&gt;. It filtered exactly the opposite values, those who did not match the given regex. But ColumnValueFilter is implemented as positive filter, meaning it returns the values who match the filter (other negative implementations elimate the values matching the filter and return the rest). I tested this behaviour by using the ColumnValueFilter with a simple value comparison like &lt;tt&gt;ColumnValueFilter(byte[], ColumnValueFilter.CompareOp, byte[])&lt;/tt&gt;. After that I found the non-default return behaviour of the compareTo() method in RegexStringcomparator as cause for the wrong filtering.&lt;/p&gt;
</comment>
                            <comment id="12705460" author="stack" created="Sun, 3 May 2009 22:13:04 +0000"  >&lt;p&gt;Moving to 0.20.0.&lt;/p&gt;</comment>
                            <comment id="12705771" author="apurtell" created="Mon, 4 May 2009 21:49:09 +0000"  >&lt;p&gt;There was slightly more to this issue than the contributed patch, added patch -2. &lt;/p&gt;</comment>
                            <comment id="12705774" author="apurtell" created="Mon, 4 May 2009 21:53:15 +0000"  >&lt;p&gt;Commited to trunk and 0.19 branch. Passes all local tests. &lt;/p&gt;</comment>
                            <comment id="12708567" author="clint.morgan" created="Tue, 12 May 2009 18:57:30 +0000"  >&lt;p&gt;I found that this patch broke all my uses of ColumnValueFilter with the EQUAL and NOT_EQUAL operator.&lt;/p&gt;

&lt;p&gt;It is now the case that a new ColumnFilter(&quot;A:B&quot;, EQUAL, &quot;FOO&quot;) will filter out rows where column A:B has value of FOO. Whereas the past (and expected?) behavior is to filter out rows whose value is &lt;b&gt;not&lt;/b&gt; &quot;FOO&quot; IE match rows where &quot;A:B&quot;=&quot;FOO&quot;.&lt;/p&gt;

&lt;p&gt;The relevant part of the patch is:&lt;/p&gt;

&lt;p&gt;Index: src/java/org/apache/hadoop/hbase/filter/ColumnValueFilter.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/hadoop/hbase/filter/ColumnValueFilter.java	(revision 771453)&lt;br/&gt;
+++ src/java/org/apache/hadoop/hbase/filter/ColumnValueFilter.java	(working copy)&lt;br/&gt;
@@ -172,9 +172,9 @@&lt;br/&gt;
     case LESS_OR_EQUAL:&lt;br/&gt;
       return compareResult &amp;lt; 0;&lt;br/&gt;
     case EQUAL:&lt;br/&gt;
+      return compareResult == 0;&lt;br/&gt;
+    case NOT_EQUAL:&lt;br/&gt;
       return compareResult != 0;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case NOT_EQUAL:&lt;/li&gt;
	&lt;li&gt;return compareResult == 0;&lt;br/&gt;
     case GREATER_OR_EQUAL:&lt;br/&gt;
       return compareResult &amp;gt; 0;&lt;br/&gt;
     case GREATER:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;which I think should be reverted.&lt;/p&gt;</comment>
                            <comment id="12708607" author="clint.morgan" created="Tue, 12 May 2009 20:30:01 +0000"  >&lt;p&gt;Reopening as I think the above part of the patch should not have made it in&lt;/p&gt;</comment>
                            <comment id="12708763" author="stack" created="Wed, 13 May 2009 05:37:59 +0000"  >&lt;p&gt;Please add a patch to the issue Clint and we&apos;ll commit it.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12708996" author="clint.morgan" created="Wed, 13 May 2009 16:32:39 +0000"  >&lt;p&gt;Revert ColumnValueFilter to previous behavior, and fix the tests&lt;/p&gt;</comment>
                            <comment id="12709008" author="stack" created="Wed, 13 May 2009 17:04:09 +0000"  >&lt;p&gt;Committed trunk and branch.  Thanks for the patch Clint (FYI, the filter interface has change in that now it takes byte array, offset, and length.  Old byte array only has been deprecated in 0.20.0).&lt;/p&gt;</comment>
                            <comment id="12709082" author="apurtell" created="Wed, 13 May 2009 19:22:15 +0000"  >&lt;p&gt;Reassign to Clint for credit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12408008" name="1264-v3.patch" size="2064" author="clint.morgan" created="Wed, 13 May 2009 16:32:39 +0000"/>
                            <attachment id="12407185" name="hbase-1264-2.patch" size="2649" author="apurtell" created="Mon, 4 May 2009 21:49:09 +0000"/>
                            <attachment id="12403641" name="hbase-1264.patch" size="612" author="schneidexe" created="Wed, 25 Mar 2009 21:25:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Mar 2009 22:08:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25653</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hca7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Patch fixes the return values of org.apache.hadoop.hbase.filter.RegexStringComparator.compareTo() </customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>