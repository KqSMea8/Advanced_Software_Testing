<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:01:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2365/HBASE-2365.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2365] Double-assignment around split</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2365</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Its looking like we have a split updating .META. with daughter regions and then before we process the split in master, one of the daughters has already been assigned.  On processing of the split, we assign daughter again.&lt;/p&gt;

&lt;p&gt;I thought this had been fixed previously?  Doesn&apos;t seem so.  Need to look again.&lt;/p&gt;

&lt;p&gt;Here is evidence for region named:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First master-side:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-03-15 16:06:52,153 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017 to cactus208,60020,12686305486412010-03-15 16:06:52,156 INFO org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner scan of 245 row(s) of meta region {server: 172.16.1.209:60020, regionname: .META.,,1, startKey: &amp;lt;&amp;gt;} complete2010-03-15 16:06:52,156 INFO org.apache.hadoop.hbase.master.BaseScanner: All 1 .META. region(s) scanned2010-03-15 16:06:52,841 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E5\x25A4\x25A7\x25E8\x25BF\x259E\x25E5\x2588\x2598\x25E5\x25B8\x2588\x25E5\x2582\x2585\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E5\x2587\x25B9\x25E9\x2599\x25B7\x25E4\x25BF\x25AE\x25E5\x25A4\x258D\x25E6\x2596\x25BD\x25E5\x25B7\x25A5\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E7\x2594\x25A8\x25E5\x2593\x2581\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017 to cactus210,60020,12686305508862010-03-15 16:06:54,377 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_SPLIT: summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E5\x25A4\x25A7\x25E8\x25BF\x259E\x25E5\x2588\x2598\x25E5\x25B8\x2588\x25E5\x2582\x2585\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E5\x2587\x25B9\x25E9\x2599\x25B7\x25E4\x25BF\x25AE\x25E5\x25A4\x258D\x25E6\x2596\x25BD\x25E5\x25B7\x25A5\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E7\x2594\x25A8\x25E5\x2593\x2581\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268611349836: Daughters; summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E5\x25A4\x25A7\x25E8\x25BF\x259E\x25E5\x2588\x2598\x25E5\x25B8\x2588\x25E5\x2582\x2585\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E5\x2587\x25B9\x25E9\x2599\x25B7\x25E4\x25BF\x25AE\x25E5\x25A4\x258D\x25E6\x2596\x25BD\x25E5\x25B7\x25A5\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E7\x2594\x25A8\x25E5\x2593\x2581\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017, summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017 from cactus209,60020,1268630548451; 1 of 32010-03-15 16:06:54,388 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017 to cactus209,60020,1268630548451
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its hard to read but above is an assignment, the split message, then what seems to be same region being assigned again.&lt;/p&gt;

&lt;p&gt;Here is RS side on 209 server:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-03-15 16:06:29,727 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Worker: MSG_REGION_OPEN: summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017
2010-03-15 16:06:29,792 INFO org.apache.hadoop.hbase.regionserver.HRegion: region summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017/1011052036 available; sequence id is 199443346
2010-03-15 16:06:29,792 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Worker: MSG_REGION_OPEN: summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E5\x25A4\x25A7\x25E8\x25BF\x259E\x25E5\x2588\x2598\x25E5\x25B8\x2588\x25E5\x2582\x2585\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E5\x2587\x25B9\x25E9\x2599\x25B7\x25E4\x25BF\x25AE\x25E5\x25A4\x258D\x25E6\x2596\x25BD\x25E5\x25B7\x25A5\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E7\x2594\x25A8\x25E5\x2593\x2581\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017
2010-03-15 16:06:29,793 INFO org.apache.hadoop.hbase.regionserver.HRegion: Starting compaction on region summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017
2010-03-15 16:06:29,944 INFO org.apache.hadoop.hbase.regionserver.HRegion: region summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E5\x25A4\x25A7\x25E8\x25BF\x259E\x25E5\x2588\x2598\x25E5\x25B8\x2588\x25E5\x2582\x2585\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E5\x2587\x25B9\x25E9\x2599\x25B7\x25E4\x25BF\x25AE\x25E5\x25A4\x258D\x25E6\x2596\x25BD\x25E5\x25B7\x25A5\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E7\x2594\x25A8\x25E5\x2593\x2581\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017/1971466363 available; sequence id is 199443345
2010-03-15 16:06:32,750 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: MSG_REGION_CLOSE_WITHOUT_REPORT: summary,SITE_0000000032\x01pt\x0120100314000000\x01\x25E7\x258C\x25AE\x25E5\x258E\x25BF\x25E5\x2586\x2580\x25E9\x25B9\x25B0\x25E6\x2591\x25A9\x25E6\x2593\x25A6\x25E6\x259D\x2590\x25E6\x2596\x2599\x25E5\x258E\x2582\x2B\x25E6\x25B1\x25BD\x25E8\x25BD\x25A6\x25E9\x2585\x258D\x25E4\x25BB\x25B6\x25EF\x25BC\x258C\x25E5\x2598\x2580\x25E9\x2593\x2583\x25E9\x2593\x2583--\x25E7\x259C\x259F\x25E5\x25AE\x259E\x25E5\x25AE\x2589\x25E5\x2585\x25A8\x25E7\x259A\x2584\x25E7\x2594\x25B5\x25E8\x25AF\x259D\x25E3\x2580\x2581\x25E7\x25BD\x2591\x25E7\x25BB\x259C\x25E4\x25BA\x2592\x25E5\x258A\x25A8\x25E4\x25BA\x25A4\x25E5\x258F\x258B\x25E7\x25A4\x25BE\x25E5\x258C\x25BA\x25EF\x25BC\x2581,1268640385017: Duplicate assignment
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See how we end with &apos;Duplicate assignment&apos; message?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12459959">HBASE-2365</key>
            <summary>Double-assignment around split</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Mar 2010 07:39:06 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:00 +0000</updated>
                            <resolved>Thu, 1 Apr 2010 06:19:48 +0000</resolved>
                                                    <fixVersion>0.20.4</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12848600" author="stack" created="Tue, 23 Mar 2010 07:43:39 +0000"  >&lt;p&gt;Marking blocker.&lt;/p&gt;</comment>
                            <comment id="12848601" author="stack" created="Tue, 23 Mar 2010 07:44:22 +0000"  >&lt;p&gt;Zheng&apos;s logs from around time of error.&lt;/p&gt;</comment>
                            <comment id="12849537" author="jdcryans" created="Wed, 24 Mar 2010 23:59:22 +0000"  >&lt;p&gt;mudphone on IRC got the same problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-03-24 07:04:39,139 DEBUG org.apache.hadoop.hbase.master.BaseScanner: Current assignment of furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 is not valid;  serverAddress=, startCode=0 unknown.
2010-03-24 07:04:39,141 DEBUG org.apache.hadoop.hbase.master.BaseScanner: Current assignment of furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 is not valid;  serverAddress=, startCode=0 unknown.
2010-03-24 07:04:39,198 DEBUG org.apache.hadoop.hbase.master.RegionManager: Assigning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; address: 10.194.146.47:60020, startcode: 1269312324850, load: (requests=277, regions=74, usedHeap=977, maxHeap=1993): total nregions to assign=2, nregions to reach balance=0, isMetaAssign=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2010-03-24 07:04:39,198 DEBUG org.apache.hadoop.hbase.master.RegionManager: Doing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; address: 10.194.146.47:60020, startcode: 1269312324850, load: (requests=277, regions=74, usedHeap=977, maxHeap=1993) nregions: 2 and nRegionsToAssign: 2
2010-03-24 07:04:39,198 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 to ip-10-194-146-47.ec2.internal,60020,1269312324850
2010-03-24 07:04:39,198 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 to ip-10-194-146-47.ec2.internal,60020,1269312324850
2010-03-24 07:04:39,469 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_SPLIT: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269198117631: Daughters; furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319, furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 from ip-10-243-63-175.ec2.internal,60020,1269312324858; 1 of 3
2010-03-24 07:04:39,474 DEBUG org.apache.hadoop.hbase.master.RegionManager: Assigning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; address: 10.243.63.175:60020, startcode: 1269312324858, load: (requests=16, regions=76, usedHeap=1280, maxHeap=1993): total nregions to assign=2, nregions to reach balance=2, isMetaAssign=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2010-03-24 07:04:39,474 DEBUG org.apache.hadoop.hbase.master.RegionManager: Assigning one region only (playing it safe..)
2010-03-24 07:04:39,474 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 to ip-10-243-63-175.ec2.internal,60020,1269312324858
2010-03-24 07:04:39,559 DEBUG org.apache.hadoop.hbase.master.RegionManager: Assigning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; address: 10.194.95.159:60020, startcode: 1269312324900, load: (requests=183, regions=75, usedHeap=1268, maxHeap=1993): total nregions to assign=1, nregions to reach balance=1, isMetaAssign=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2010-03-24 07:04:39,561 DEBUG org.apache.hadoop.hbase.master.RegionManager: Assigning one region only (playing it safe..)
2010-03-24 07:04:39,561 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 to ip-10-194-95-159.ec2.internal,60020,1269312324900
2010-03-24 07:04:39,731 INFO org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner scan of 454 row(s) of meta region {server: 10.195.9.219:60020, regionname: .META.,,1, startKey: &amp;lt;&amp;gt;} complete
2010-03-24 07:04:39,732 INFO org.apache.hadoop.hbase.master.BaseScanner: All 1 .META. region(s) scanned
2010-03-24 07:04:40,253 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_PROCESS_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 from ip-10-194-146-47.ec2.internal,60020,1269312324850; 1 of 3
2010-03-24 07:04:40,253 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 from ip-10-194-146-47.ec2.internal,60020,1269312324850; 2 of 3
2010-03-24 07:04:40,253 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 from ip-10-194-146-47.ec2.internal,60020,1269312324850; 3 of 3
2010-03-24 07:04:40,253 DEBUG org.apache.hadoop.hbase.master.HMaster: Processing todo: PendingOpenOperation from ip-10-194-146-47.ec2.internal,60020,1269312324850
2010-03-24 07:04:40,253 INFO org.apache.hadoop.hbase.master.RegionServerOperation: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 open on 10.194.146.47:60020
2010-03-24 07:04:40,254 INFO org.apache.hadoop.hbase.master.RegionServerOperation: Updated row furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 in region .META.,,1 with startcode=1269312324850, server=10.194.146.47:60020
2010-03-24 07:04:40,254 DEBUG org.apache.hadoop.hbase.master.HMaster: Processing todo: PendingOpenOperation from ip-10-194-146-47.ec2.internal,60020,1269312324850
2010-03-24 07:04:40,254 INFO org.apache.hadoop.hbase.master.RegionServerOperation: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 open on 10.194.146.47:60020
2010-03-24 07:04:40,255 INFO org.apache.hadoop.hbase.master.RegionServerOperation: Updated row furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 in region .META.,,1 with startcode=1269312324850, server=10.194.146.47:60020
2010-03-24 07:04:40,496 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_PROCESS_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 from ip-10-243-63-175.ec2.internal,60020,1269312324858; 1 of 2
2010-03-24 07:04:40,496 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319 from ip-10-243-63-175.ec2.internal,60020,1269312324858; 2 of 2
2010-03-24 07:04:40,496 DEBUG org.apache.hadoop.hbase.master.ServerManager: region server 10.243.63.175:60020 should not have opened region furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256810375918:53ba3cc0-cf02-1c15-3733-0ff8455ed5ad,1269414278319
2010-03-24 07:04:40,582 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_PROCESS_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 from ip-10-194-95-159.ec2.internal,60020,1269312324900; 1 of 2
2010-03-24 07:04:40,582 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_OPEN: furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319 from ip-10-194-95-159.ec2.internal,60020,1269312324900; 2 of 2
2010-03-24 07:04:40,582 DEBUG org.apache.hadoop.hbase.master.ServerManager: region server 10.194.95.159:60020 should not have opened region furtive_production_consumer_events_d4a03af6-1d95-4b77-9aac-22389852d901,1256383584000:4923724a-d6ee-6d96-25cf-215b3201b5f6,1269414278319
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the problem is that in this case the master was able to assign, but the split report came in just before the the first batch of assignments were reported and since we only do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void doRegionAssignment(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RegionState rs,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HServerInfo sinfo, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ArrayList&amp;lt;HMsg&amp;gt; returnMsgs) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; regionName = rs.getRegionInfo().getRegionNameAsString();
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Assigning region &quot;&lt;/span&gt; + regionName +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; to &quot;&lt;/span&gt; + sinfo.getServerName());
    rs.setPendingOpen(sinfo.getServerName());
    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionsInTransition) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionsInTransition.put(regionName, rs);
    }

    returnMsgs.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HMsg(HMsg.Type.MSG_REGION_OPEN, rs.getRegionInfo()));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then we don&apos;t have the 3 fields in the .META. entry as our check expects.&lt;/p&gt;</comment>
                            <comment id="12849810" author="jdcryans" created="Thu, 25 Mar 2010 18:10:29 +0000"  >&lt;p&gt;Diving a bit more, RegionManager.doRegionAssignment doesn&apos;t change the .META. entry and this is why we don&apos;t see it in ServerManager.assignSplitDaughter, it only setPendingOpen.&lt;/p&gt;

&lt;p&gt;So one more thing we could check in assignSplitDaughter is if the region is pendingOpen or assigned (doing the call to .META.). Or instead we could add a new &lt;br/&gt;
method called &quot;isOpened&apos; to RegionManager and not have to do the check on .META. directly?&lt;/p&gt;</comment>
                            <comment id="12849895" author="kannanm" created="Thu, 25 Mar 2010 20:46:43 +0000"  >&lt;p&gt;BaseScanner.java:checkAssigned() has some comments related to double-assignment:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-comment&quot;&gt;// Scans are sloppy. They don&apos;t respect row locks and they get and
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// cache a row internally so may have data that is stale. Make sure that &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// sure we have the right server and servercode. We are trying to avoid
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;-assignments. See hbase-1784. Will have to wait till 0.21 hbase
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// where we use zk to mediate state transitions to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; better.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And it seems to deal with the staleness of the scanner by doing a GET for the relevant key. But the following line:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &lt;span class=&quot;code-comment&quot;&gt;// Now get the region assigned
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.regionManager.setUnassigned(info, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;uses the potentially stale &quot;info&quot; passed as an argument to checkAssigned(). Should this instead &lt;br/&gt;
retrieve the HRegionInfo from the result of the GET?&lt;/p&gt;</comment>
                            <comment id="12849905" author="stack" created="Thu, 25 Mar 2010 21:20:40 +0000"  >&lt;p&gt;.bq &quot;...uses the potentially stale &quot;info&quot; passed as an argument to checkAssigned(). Should this instead retrieve the HRegionInfo from the result of the GET?&quot;&lt;/p&gt;

&lt;p&gt;It should though our having a problem because of regioninfo is stale is likely rare (the Get was added to find new server or startcode info that was added between scanner#next and our acting on info found.&lt;/p&gt;

&lt;p&gt;@J-D The check for info:regioninfo + info:server + info:startcode being present was for the case where assignment had happened before master got split message AND the region had been opened too before the split message came in.  The problem seen by Zheng and by mudphone above is that the region is assigned (opening) but not yet opened.  During this time the message comes in and we blindly reassign it seems.  It looks like we can just check regionsInTransition or if we want to be more precise, regionsInTransition and that the state is &apos;opening&apos;.  Let me study some more.  Will put up a patch.&lt;/p&gt;
</comment>
                            <comment id="12849918" author="stack" created="Thu, 25 Mar 2010 21:49:06 +0000"  >&lt;p&gt;@J-D Pardon me, we are saying effectively same soln. when you say &quot;...if the region is pendingOpen...&quot;&lt;/p&gt;</comment>
                            <comment id="12851683" author="stack" created="Wed, 31 Mar 2010 01:21:18 +0000"  >&lt;p&gt;Issue was something else:&lt;/p&gt;

&lt;p&gt;Code was changed.  Oriinally it was this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
732908       jimk       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (force || (!s.isPendingOpen() &amp;amp;&amp;amp; !s.isOpen())) {
732908       jimk         s.setUnassigned();
732908       jimk       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It got changed to this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
stack:0.20 Stack$ svn diff -rr892983:893381  src/java/org/apache/hadoop/hbase/master/RegionManager.java 
Index: src/java/org/apache/hadoop/hbase/master/RegionManager.java
===================================================================
--- src/java/org/apache/hadoop/hbase/master/RegionManager.java  (revision 892983)
+++ src/java/org/apache/hadoop/hbase/master/RegionManager.java  (revision 893381)
@@ -957,7 +957,7 @@
         s = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RegionState(info);
         regionsInTransition.put(info.getRegionNameAsString(), s);
       }
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (force || (!s.isPendingOpen() &amp;amp;&amp;amp; !s.isOpen())) {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (force || (!s.isPendingOpen() || !s.isOpen())) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;J-D spotted it.&lt;/p&gt;

&lt;p&gt;Looking into it more.&lt;/p&gt;</comment>
                            <comment id="12851745" author="stack" created="Wed, 31 Mar 2010 06:38:48 +0000"  >&lt;p&gt;This patch restores the test to how it used to be.  All tests but the deletes failure in TestClient pass.  I grepped the test output for case-insenstive &apos;double&apos; and &apos;assignment&apos; but found nothing.  What you think J-D?  Can I commit?&lt;/p&gt;</comment>
                            <comment id="12852011" author="jdcryans" created="Wed, 31 Mar 2010 18:15:17 +0000"  >&lt;p&gt;I ran the test 10 times with the patch, looks ok... it&apos;s a shame I didn&apos;t document that change back in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2065&quot; title=&quot;Cannot disable a table if any of its region is opening at the same time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2065&quot;&gt;&lt;del&gt;HBASE-2065&lt;/del&gt;&lt;/a&gt;. So +1 since for this case it does what we want.&lt;/p&gt;</comment>
                            <comment id="12852262" author="stack" created="Thu, 1 Apr 2010 06:19:48 +0000"  >&lt;p&gt;Committed branch and trunk.  Thanks for reviewing and testing J-D (Though, I&apos;m sure this change will come back to bite us).&lt;/p&gt;</comment>
                            <comment id="12852920" author="stack" created="Fri, 2 Apr 2010 19:03:28 +0000"  >&lt;p&gt;The above &apos;xtra&apos; was committed (mistakenly) as part of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1537&quot; title=&quot;Intra-row scanning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1537&quot;&gt;&lt;del&gt;HBASE-1537&lt;/del&gt;&lt;/a&gt; Intra-row scanning&quot;.  The xtra addresses the commment made by Kannan that would be using a stale HRegionInfo checking assignments.  The &apos;xtra&apos; uses what we got in the GET.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12440642" name="2365-xtra.patch" size="3119" author="stack" created="Fri, 2 Apr 2010 19:03:28 +0000"/>
                            <attachment id="12440309" name="2365.patch" size="548" author="stack" created="Wed, 31 Mar 2010 06:38:48 +0000"/>
                            <attachment id="12439553" name="zheng.tgz" size="181539" author="stack" created="Tue, 23 Mar 2010 07:44:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Mar 2010 23:59:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26275</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08snz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49244</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>