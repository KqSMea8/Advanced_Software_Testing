<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:09:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10003/HBASE-10003.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10003] OnlineMerge should be extended to allow bulk merging</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10003</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Now that we have Online Merge capabilities, the function of that tool should be extended to make it much easier for HBase operations folks to use.  Currently it is a very manual process (one fraught with confusion) to hand pick two regions that are contiguous to each other in the META table such that the admin can manually request those two regions to be merged.&lt;/p&gt;

&lt;p&gt;In the real world, when admins find themselves wanting to merge regions, it&apos;s usually because they&apos;ve greatly increased their hbase.hregion.max.filesize property and they have way too many regions on a table and want to reduce the region count for that entire table quickly and easily.&lt;/p&gt;

&lt;p&gt;Why can&apos;t the OnlineMerge command just take a &quot;-max&quot; argument along with a table name which tells it to go ahead and merge all regions of said table until the resulting regions are all of max size?  This takes the voodoo out of the process and quickly gets the admin what they&apos;re looking for.&lt;/p&gt;

&lt;p&gt;As part of this improvement, I also suggest a &quot;-regioncount&quot; argument for OnlineMerge, which will attempt to reduce the table&apos;s region count down to the specified #.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12679996">HBASE-10003</key>
            <summary>OnlineMerge should be extended to allow bulk merging</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="takeshi.miao">takeshi.miao</assignee>
                                    <reporter username="heathcd">Clint Heath</reporter>
                        <labels>
                            <label>beginner</label>
                    </labels>
                <created>Tue, 19 Nov 2013 17:12:54 +0000</created>
                <updated>Mon, 31 Aug 2015 09:02:34 +0000</updated>
                                            <version>0.98.0</version>
                    <version>0.94.6</version>
                                                    <component>Admin</component>
                    <component>Usability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>14</watches>
                                                                <comments>
                            <comment id="13826909" author="heathcd" created="Tue, 19 Nov 2013 20:33:02 +0000"  >&lt;p&gt;Just to clarify, I think the preferred mechanism to deliver this functionality would be through the HBase shell, but if it&apos;s easier through the Java command-line tool, I&apos;m sure that would work too.&lt;/p&gt;</comment>
                            <comment id="13831830" author="stack" created="Mon, 25 Nov 2013 19:40:18 +0000"  >&lt;p&gt;Making critical usability issue.  Tagged it noob.  Would be a nice one for someone to get started on.&lt;/p&gt;</comment>
                            <comment id="13866327" author="webster" created="Thu, 9 Jan 2014 05:19:14 +0000"  >&lt;p&gt;I have a thought on how to do this, although I am unfamiliar with the merge internals.  It seems like you could just start merging the first and second regions, then merge region 3 if the combined region sizes are below the value of the &apos;-max&apos; parameter.  Once adding a region would put the new region size over &apos;-max&apos;, start the process again.&lt;br/&gt;
Basically the rule would look like this:&lt;br/&gt;
merge(R1,R2) into R1`  &lt;br/&gt;
  If the R1`.size + R3.size &amp;lt; MAX&lt;br/&gt;
     merge(R1`,R3)&lt;/p&gt;

&lt;p&gt;I guess this could also be done asynchronously.  Instead of immediately merging the regions, add them to a &quot;todo&quot; list, once you hit the size limit, you send the todo list off to an executor to do the recursive merge.  Being unfamiliar with merge internals though, I don&apos;t know if asynchronous merges can/should be done.  I can imagine that causing some issues with holes in the region chain in .META.&lt;/p&gt;

&lt;p&gt;Any feedback is welcome.&lt;/p&gt;</comment>
                            <comment id="13903836" author="takeshi.miao" created="Tue, 18 Feb 2014 06:52:27 +0000"  >&lt;p&gt;Hi all,&lt;br/&gt;
I think this is a good chance to help me to familiar with online merge internals, can I help on this ticket ?&lt;/p&gt;</comment>
                            <comment id="13904040" author="heathcd" created="Tue, 18 Feb 2014 13:37:16 +0000"  >&lt;p&gt;Thank you for the feedback, Michael, and for volunteering to help Takeshi.  Just to be clear about how I pictured the &quot;-max&quot; command-line parameter working, I was thinking it would not take any arguments.  It would simply max out the size of all regions in the table to whatever the value of hbase.hregion.max.filesize is set to.&lt;/p&gt;</comment>
                            <comment id="13904822" author="takeshi.miao" created="Tue, 18 Feb 2014 23:42:15 +0000"  >&lt;p&gt;Tks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=heathcd&quot; class=&quot;user-hover&quot; rel=&quot;heathcd&quot;&gt;Clint Heath&lt;/a&gt; , I will take the previous suggestions into account, and to study the bulk online merge feature &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13911288" author="takeshi.miao" created="Tue, 25 Feb 2014 06:15:29 +0000"  >&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;After some code studies, I have some questions needed to come out for your opinions...&lt;br/&gt;
1. The logic of merging two regions is self-contained and clear in the &lt;em&gt;&lt;a href=&quot;https://github.com/apache/hbase/blob/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/DispatchMergingRegionHandler.java#L73&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;o.a.h.hbase.master.handler.DispatchMergineRegionHandler#process()&lt;/a&gt;&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;So I am considering to write two more handlers to deal with &apos;-max&apos; and &apos;-regioncount&apos; options. They would extend from the &lt;em&gt;DispatchMergingRegionHandler&lt;/em&gt; class (with minimal revised for easy to extend).&lt;/p&gt;

&lt;p&gt;2. Due to #1, so there will be a new question is... Where would these three type of Handlers be selected ? Currently, I am considering to do the selection in the code &lt;em&gt;&lt;a href=&quot;https://github.com/apache/hbase/blob/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java#L1658&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;o.a.h.hbase.master.HMaster#dispatchMergingRegions&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;3. And I am also considering about the spec. of ruby shell command, according to the descriptions and comments previously. I think the spec would become...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;old spec&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
merge_region &apos;ENCODED_REGIONNAME&apos;, &apos;ENCODED_REGIONNAME&apos; [, forcible]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;new spec&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
merge_region [-max | -regioncount &amp;lt;num&amp;gt;] | &apos;ENCODED_REGIONNAME&apos;, &apos;ENCODED_REGIONNAME&apos; [, forcible]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is this a reasonable spec for this requirement ? especially the forcible for me is dangerous for batch mode, so I still put it with the only two regions merging version.&lt;/p&gt;

&lt;p&gt;4. according to the spec defined in the #3, I could not found the similar case in current ruby shell impl., so I am wandering this kind of spec whether could be supported by the both current ruby and protobuf impl. ? I am still not familiar with the ruby &amp;amp; protobuf, so there may be an answer already somewhere I did not noticed...&lt;/p&gt;


&lt;p&gt;Sorry these maybe too many questions here, due to I need to get some more info. and direction from you guys to help me impl. it more smoothly, tks a lot~&lt;/p&gt;</comment>
                            <comment id="13913716" author="stack" created="Wed, 26 Feb 2014 23:20:10 +0000"  >&lt;p&gt;On 1., we need to add two handlers?  We cannot just extend the current one to handle the new options?&lt;br/&gt;
On 3., give yourself some space and add a new command: merge_regions (as opposed to merge_region).  Then you won&apos;t have to have this awkward &apos;|&apos; in there (and you can leave aside the forcible).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Sorry these maybe too many questions here, due to I need to get some more info. and direction from you guys to help me impl. it more smoothly, tks a lot~&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Keep asking questions.  Thanks for working on this.&lt;/p&gt;

</comment>
                            <comment id="13913983" author="takeshi.miao" created="Thu, 27 Feb 2014 02:54:47 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;br/&gt;
I think I got my answers, will update this ticket if any progress. tks for your reply.&lt;/p&gt;</comment>
                            <comment id="14000684" author="esteban" created="Sat, 17 May 2014 05:49:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=takeshi.miao&quot; class=&quot;user-hover&quot; rel=&quot;takeshi.miao&quot;&gt;takeshi.miao&lt;/a&gt; any progress on this? I think this is a really good improvement to have.&lt;/p&gt;</comment>
                            <comment id="14001117" author="takeshi.miao" created="Sun, 18 May 2014 16:21:02 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=esteban&quot; class=&quot;user-hover&quot; rel=&quot;esteban&quot;&gt;Esteban Gutierrez&lt;/a&gt;&lt;br/&gt;
Tks for your follow-up, actually I have not much progress about this ticket, and plan to finish it in following two month with my available time. But I afraid this may impact community release plan or something. If it is, I think maybe some one can take care of this ticket...Sorry for this bad news, due to I have my schedule totally full recently for dealing with company&apos;s requirements...&lt;br/&gt;
Tks for your understanding.&lt;/p&gt;
</comment>
                            <comment id="14723238" author="larsgeorge" created="Mon, 31 Aug 2015 09:02:34 +0000"  >&lt;p&gt;Would &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13103&quot; title=&quot;[ergonomics] add region size balancing as a feature of master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13103&quot;&gt;&lt;del&gt;HBASE-13103&lt;/del&gt;&lt;/a&gt; supersede this issue? &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Nov 2013 19:40:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1py6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359652</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>beginner</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>