<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:53:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1480/HBASE-1480.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1480] compaction file not cleaned up after a crash/OOME server</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1480</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We do not clean up compaction files after a crash/OOME of a region server.&lt;/p&gt;

&lt;p&gt;I am not sure how the compaction file naming is anymore if its not reproducable some how we &lt;br/&gt;
should let the master or the server with the root region check every so often and delete old files say &lt;br/&gt;
older then 24 hours in the compaction dir&apos;s of the tables&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12427135">HBASE-1480</key>
            <summary>compaction file not cleaned up after a crash/OOME server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apparition">Evgeny Ryabitskiy</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2009 17:45:18 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:41 +0000</updated>
                            <resolved>Mon, 15 Jun 2009 22:31:14 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12716468" author="apurtell" created="Fri, 5 Jun 2009 00:39:58 +0000"  >&lt;p&gt;Unless we&apos;re going to move to a master-less architecture, I think the master is a good place for this kind of housekeeping. It&apos;s the only entity allowed to delete dirs in HDFS already. &lt;/p&gt;</comment>
                            <comment id="12718295" author="apparition" created="Thu, 11 Jun 2009 04:32:26 +0000"  >&lt;p&gt;Same problem can be with split dir.&lt;/p&gt;

&lt;p&gt;Not sure about master as an only entity to del dirs in HDFS. Region deletes its compaction dir every time it starts compaction and after successfully finishes it (2 times).&lt;/p&gt;

&lt;p&gt;Master is a good place, I will also look if new HRS that got Region can do this clean up.&lt;/p&gt;</comment>
                            <comment id="12718735" author="apparition" created="Fri, 12 Jun 2009 06:29:20 +0000"  >&lt;p&gt;There was a bug in Cleaning up for HRegions.&lt;br/&gt;
Each time at beginning and end of Compaction HRegion deletes regionCompactionDir in FS for clean up.&lt;/p&gt;

&lt;p&gt;Name of regionCompactionDir is computed this way :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionCompactionDir =  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(getCompactionDir(basedir), encodedNameStr);

Ex.:  hbase/myTable/compaction.dir/23143254
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But! Stores for this HRegion create and use compactionDir, with name computed this way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compactionDir = getCompactionDir(basedir);

Ex.:  hbase/myTable/compaction.dir
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Diff in sub dir for each HRegion with encodedNameStr&lt;/p&gt;

&lt;p&gt;So I changed dir where Stores put compaction files. Now compactions for Each Stores are stored separately in FS and clean up performed each time compaction starts and ends.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Last one note about migration:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;No one file should be stored in upper compactionDir (they should be stored in subdirs, regionCompactionDirs). So we need to clean up all compactionDirs for all Table dirs in FS during migration&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="12718737" author="apparition" created="Fri, 12 Jun 2009 06:33:47 +0000"  >&lt;p&gt;So this patch should solve problem and there is no need for master to parse compaction dirs.&lt;/p&gt;

&lt;p&gt;Also I improved Junit to ensure that regionCompactionDir is really cleaned up each time after compaction&lt;/p&gt;</comment>
                            <comment id="12719827" author="stack" created="Mon, 15 Jun 2009 22:31:14 +0000"  >&lt;p&gt;I committed Evgeny&apos;s patch after watching it in action up on an running test (we make the compactions into a subdir of compaction.dir with this patch rather than at top-level).&lt;/p&gt;

&lt;p&gt;The original issue was about clean up after a crash.  With this patch, should be clean up when Region is opened again.&lt;/p&gt;

&lt;p&gt;I presume that good enough.  Lets open new issue if not.  Resolving this one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12410457" name="HBASE-1480.patch" size="4550" author="apparition" created="Fri, 12 Jun 2009 06:29:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Jun 2009 00:39:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>