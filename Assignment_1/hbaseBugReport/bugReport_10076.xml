<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:10:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10076/HBASE-10076.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10076] Backport MapReduce over snapshot files [0.94]</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10076</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;MapReduce over Snapshots would be valuable on 0.94.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12682613">HBASE-10076</key>
            <summary>Backport MapReduce over snapshot files [0.94]</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="jesse_yates">Jesse Yates</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Dec 2013 04:47:03 +0000</created>
                <updated>Tue, 13 May 2014 23:31:21 +0000</updated>
                            <resolved>Tue, 17 Dec 2013 01:11:17 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13838586" author="lhofhansl" created="Wed, 4 Dec 2013 04:47:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt;, FYI.&lt;/p&gt;</comment>
                            <comment id="13843727" author="jesse_yates" created="Mon, 9 Dec 2013 23:59:04 +0000"  >&lt;p&gt;First cut patch. &lt;/p&gt;

&lt;p&gt;Unit tests (all the &lt;b&gt;Snapshot&lt;/b&gt; ones) pass, but haven&apos;t had a chance to try the integration test yet - waiting until everyone is happy with the rest of the code (should be simple, just a minimal amount of setup and then uses the rest of the test code).&lt;/p&gt;</comment>
                            <comment id="13846786" author="lhofhansl" created="Thu, 12 Dec 2013 21:51:59 +0000"  >&lt;p&gt;Looks good upon first inspection.&lt;/p&gt;</comment>
                            <comment id="13846900" author="enis" created="Thu, 12 Dec 2013 23:20:06 +0000"  >&lt;p&gt;Looks all the pieces are here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;remove  System.out.println(&quot;In restore!&quot;);&lt;/li&gt;
	&lt;li&gt;we should remove the scanMetrics from ClientScanner from the original patch:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 - &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; ScanMetrics scanMetrics = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Any interest in bringing in the new test TestCellUtil. testOverlappingKeys() ? Not needed that much, just checking&lt;/li&gt;
	&lt;li&gt;It would be good to have IntegrationTestTableSnapshotInputFormat in the same package (mapreduce)&lt;/li&gt;
	&lt;li&gt;Not sure about the chang in TableInputFormatBase. Is this needed? Let&apos;s leave this out otherwise.&lt;/li&gt;
	&lt;li&gt;In the original patch, TableMapReduceUtil. initTableMapperJob() now accepts an initCredentials param, because we do not want to get tokens from HBase at all. Otherwise, if hbase is used with security, offline clusters won&apos;t work.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13846960" author="apurtell" created="Fri, 13 Dec 2013 00:17:48 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8369?focusedCommentId=13846957&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-8369?focusedCommentId=13846957&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846957&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13846971" author="jesse_yates" created="Fri, 13 Dec 2013 00:36:34 +0000"  >&lt;p&gt;thanks for the feedback Enis! I&apos;ll update the patch, in the event that someone wants it for their installation, or have it ready if we can get it into 0.96 (as per discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8369&quot; title=&quot;MapReduce over snapshot files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8369&quot;&gt;&lt;del&gt;HBASE-8369&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13847017" author="jesse_yates" created="Fri, 13 Dec 2013 01:21:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Any interest in bringing in the new test TestCellUtil. testOverlappingKeys() ? Not needed that much, just checking&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done - good call.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not sure about the change in TableInputFormatBase. Is this needed? Let&apos;s leave this out otherwise.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not needed, but this is a cleaner, better implementation and good to reuse the util, now that we have it. Agree its a little extra and a bit unneccessary, but trivially so.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In the original patch, TableMapReduceUtil. initTableMapperJob() now accepts an initCredentials param, because we do not want to get tokens from HBase at all. Otherwise, if hbase is used with security, offline clusters won&apos;t work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looks like in 0.94 its just added based on the config. In trunk, looks like TableMapReduceUtil.initTableSnapshotMapperJob just calls initTableMapperJob without any parameter, which always initializes the credentials. Maybe a bug in trunk? Seems like you would need a more sweeping change to make it configurable as well.&lt;/p&gt;</comment>
                            <comment id="13847018" author="jesse_yates" created="Fri, 13 Dec 2013 01:22:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; other questions Lars and I had offline - how can we test that the locality selection is correct? Its not really covered anywhere in this patch or the original&lt;/p&gt;</comment>
                            <comment id="13847210" author="enis" created="Fri, 13 Dec 2013 06:41:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;Looks like in 0.94 its just added based on the config&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In trunk, initTableSnapshotMapper() calls: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
initTableMapperJob(snapshotName, scan, mapper, outputKeyClass,
        outputValueClass, job, addDependencyJars, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TableSnapshotInputFormat.class);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the false is initCredentials to the overloaded function, no? I don&apos;t have eclipse open, I cannot check : ) &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;how can we test that the locality selection is correct? Its not really covered anywhere in this patch or the original&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It is using the HDFSBlocksDistribution, which I though is tested on it&apos;s own. Did not check whether there is actual coverage though. It should be possible to mock that up I guess. &lt;/p&gt;</comment>
                            <comment id="13847935" author="lhofhansl" created="Fri, 13 Dec 2013 21:44:33 +0000"  >&lt;p&gt;Based on recent discussion we might just add the necessary hooks to 0.94, in order to allow implementing the M/R outside of HBase.&lt;/p&gt;</comment>
                            <comment id="13848276" author="lhofhansl" created="Sat, 14 Dec 2013 07:41:08 +0000"  >&lt;p&gt;With a little bit of cut&apos;n&apos;paste (TableMapReduceUtil&apos;s convertScanToString, convertStringToScan)  this can indeed be done with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanck&quot; class=&quot;user-hover&quot; rel=&quot;bryanck&quot;&gt;Bryan Keller&lt;/a&gt;&apos;s latest 0.94 on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8369&quot; title=&quot;MapReduce over snapshot files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8369&quot;&gt;&lt;del&gt;HBASE-8369&lt;/del&gt;&lt;/a&gt; without any additional code in HBase.&lt;/p&gt;</comment>
                            <comment id="13848404" author="bryanck" created="Sat, 14 Dec 2013 17:00:37 +0000"  >&lt;p&gt;Yes, there is some minor cut-n-pasting involved. We could easily package this to be available outside of the distribution if that is deemed necessary.&lt;/p&gt;</comment>
                            <comment id="13848405" author="bryanck" created="Sat, 14 Dec 2013 17:04:36 +0000"  >&lt;p&gt;BTW I have made a few minor enhancements since submitting that patch. I&apos;ll check this weekend to see if it is anything worthwhile.&lt;/p&gt;</comment>
                            <comment id="13848455" author="lhofhansl" created="Sat, 14 Dec 2013 21:09:32 +0000"  >&lt;p&gt;Thanks Bryan. Much appreciated!&lt;/p&gt;</comment>
                            <comment id="13849848" author="lhofhansl" created="Mon, 16 Dec 2013 23:10:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanck&quot; class=&quot;user-hover&quot; rel=&quot;bryanck&quot;&gt;Bryan Keller&lt;/a&gt;, did you find anything worthwhile to include?&lt;/p&gt;</comment>
                            <comment id="13849880" author="bryanck" created="Mon, 16 Dec 2013 23:51:21 +0000"  >&lt;p&gt;No, the map-reduce code from the v5 patch is the same as I&apos;m using now in our production servers. I created some utilities for creating and cleaning up snapshots seamlessly, but it is orthogonal to this.&lt;/p&gt;

&lt;p&gt;I&apos;m curious what kind of performance improvement you are seeing with the snapshot scan (if you have tested it)?&lt;/p&gt;</comment>
                            <comment id="13849882" author="bryanck" created="Mon, 16 Dec 2013 23:53:24 +0000"  >&lt;p&gt;I should say the code is the same, except for the TableMapReduceUtil code I needed to cut-n-paste...&lt;/p&gt;</comment>
                            <comment id="13849932" author="enis" created="Tue, 17 Dec 2013 00:37:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m curious what kind of performance improvement you are seeing with the snapshot scan&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In my tests, I was able to get 50-60 MB/s per region, versus 10-11 MB/s for regular scans (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8369?focusedCommentId=13805748&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13805748&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-8369?focusedCommentId=13805748&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13805748&lt;/a&gt;). &lt;br/&gt;
Bryan, can you also share your performance numbers if you can quantify? &lt;/p&gt;</comment>
                            <comment id="13849965" author="lhofhansl" created="Tue, 17 Dec 2013 01:11:17 +0000"  >&lt;p&gt;We&apos;re just taking a slightly modified version of Bryan&apos;s change along with some cut&apos;n&apos;pasted code from HBase.&lt;/p&gt;</comment>
                            <comment id="13850710" author="bryanck" created="Tue, 17 Dec 2013 17:40:16 +0000"  >&lt;p&gt;In some simple tests, I saw a 4-5x speed improvement, which is similar to what you are seeing. In production, we saw a lower 3x improvement in our main jobs, but that is because we are more bound by CPU now than before. I did some quick profiling and it appears there is room for some optimization in HRegion to reduce CPU usage, which would further improve performance for more CPU intensive jobs.&lt;/p&gt;</comment>
                            <comment id="13997041" author="ianfriedman" created="Tue, 13 May 2014 23:30:11 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanck&quot; class=&quot;user-hover&quot; rel=&quot;bryanck&quot;&gt;Bryan Keller&lt;/a&gt;, is this the latest version of the patch for 94? If not, anyone know where I can get the latest version?&lt;/p&gt;</comment>
                            <comment id="13997042" author="ianfriedman" created="Tue, 13 May 2014 23:31:21 +0000"  >&lt;p&gt;never mind, I see it was in the parent ticket, I should probably read before I comment&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12643055">HBASE-8369</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12617930" name="hbase-10076-v0.patch" size="78864" author="jesse_yates" created="Mon, 9 Dec 2013 23:59:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Dec 2013 23:59:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361870</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qdmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362165</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>