<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:31:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12320/HBASE-12320.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12320] hfile index can&apos;t flush to disk in memstore when key portion of kv is larger than 128kb and hfile generated two level index above</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12320</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;when you make a big key portion of a keyvalue, for example, a big rowkey or a big family or a big qualifer. all in words, once the kv.getkeylength of kv that you put is larger than 128kb and it is the first kv of the datablock. And you go on writing a new datablock so as to make two-level index in the hfile. You couldn&apos;t flush the data in memstore. The rs that corresponding region lies in will keep flushing state and the new hfile in .tmp of the region is writing forever. You can&apos;t stop it unless kill the rs.&lt;/p&gt;

&lt;p&gt;From my point, the index generation logic of hifle result in the bug, when the intermediate index is larger  than 128kb, it will generate next level index, but the first key above 128kb will cause an endless loop to generate next level index.&lt;/p&gt;

&lt;p&gt;attached my test code, you can try it in an empty table in your test cluster&lt;/p&gt;</description>
                <environment>&lt;p&gt;cdh4.5.0&lt;br/&gt;
cdh5.1.0&lt;/p&gt;</environment>
        <key id="12749753">HBASE-12320</key>
            <summary>hfile index can&apos;t flush to disk in memstore when key portion of kv is larger than 128kb and hfile generated two level index above</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="qian wang">qian wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Oct 2014 11:08:34 +0000</created>
                <updated>Thu, 23 Oct 2014 00:22:00 +0000</updated>
                                            <version>0.94.6</version>
                    <version>0.98.1</version>
                                                    <component>HFile</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14179854" author="anoop.hbase" created="Wed, 22 Oct 2014 12:37:31 +0000"  >&lt;p&gt;You have so lengthy Qualifier name !&lt;/p&gt;</comment>
                            <comment id="14179897" author="qian wang" created="Wed, 22 Oct 2014 13:34:42 +0000"  >&lt;p&gt;but hbase did not forbid me to do that&lt;/p&gt;</comment>
                            <comment id="14179925" author="anoop.hbase" created="Wed, 22 Oct 2014 14:00:00 +0000"  >&lt;p&gt;Agree.. Do u have a patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qian+wang&quot; class=&quot;user-hover&quot; rel=&quot;qian wang&quot;&gt;qian wang&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14179973" author="qian wang" created="Wed, 22 Oct 2014 14:45:23 +0000"  >&lt;p&gt;no idea,maybe we can adjust the order of index to avoid the long key first in the index block&lt;/p&gt;</comment>
                            <comment id="14180596" author="lhofhansl" created="Wed, 22 Oct 2014 21:51:59 +0000"  >&lt;p&gt;Interesting. I assume the same happens with a large row-key...?&lt;br/&gt;
128k column names are unlikely, 128k row keys can happen. In either case, this would be a bad problem.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qian+wang&quot; class=&quot;user-hover&quot; rel=&quot;qian wang&quot;&gt;qian wang&lt;/a&gt; any chance to formulate this as a unittest? Maybe it&apos;s possible to add this to TestHRegion.&lt;br/&gt;
If not, I can spend some time on this this week.&lt;/p&gt;</comment>
                            <comment id="14180790" author="qian wang" created="Thu, 23 Oct 2014 00:22:00 +0000"  >&lt;p&gt;yes i think the big rowkey would meet that problem&lt;br/&gt;
in fact this case is my work experience that some dirty data with big size columns unexpectedly were written to hbase&lt;br/&gt;
it is rather tricky to handle it&lt;/p&gt;

&lt;p&gt;it&apos;s a pleasure that you are willing to spend time formulating the case, Lars &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12676304" name="TestLongIndex.java" size="1157" author="qian wang" created="Wed, 22 Oct 2014 11:19:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 22 Oct 2014 12:37:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21fzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>