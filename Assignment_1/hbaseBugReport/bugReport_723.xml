<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:46:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-723/HBASE-723.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-723] TableServers&apos;s cachedRegionLocation doesn&apos;t have size limit.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-723</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;cachedRegionLocation stores region locations of tables whenever new region is looked up. However, the enties are deleted only when TableServers object is closed or locateRegion is called with false useCache argument. Therefore, it seems to grow without limit and cause out of memory exception. &lt;/p&gt;
</description>
                <environment>&lt;p&gt;hbase 0.3.0&lt;/p&gt;</environment>
        <key id="12399683">HBASE-723</key>
            <summary>TableServers&apos;s cachedRegionLocation doesn&apos;t have size limit.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="apurtell">Andrew Purtell</assignee>
                                    <reporter username="jblee">Jb Lee</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Jul 2008 02:17:58 +0000</created>
                <updated>Fri, 22 Aug 2008 21:35:05 +0000</updated>
                            <resolved>Tue, 12 Aug 2008 00:45:49 +0000</resolved>
                                    <version>0.1.3</version>
                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12610879" author="apurtell" created="Mon, 7 Jul 2008 02:39:05 +0000"  >&lt;p&gt;Also while on the subject, there is no means for other parts of the client API to invalidate cache entries on demand. While writing a testcase for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-62&quot; title=&quot;[hbase] Allow user add arbitrary key/value pairs to table and column descriptors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-62&quot;&gt;&lt;del&gt;HBASE-62&lt;/del&gt;&lt;/a&gt;, I observed that table metadata is cached as part of the cached region information and this is not invalidated by disable/enable table, so to get up to date metadata the client has to use a scanner over .META. directly using the meta visitor. Ideally my client-side support for metadata updates (HBaseAdmin.updateTableMeta(byte[] table, HTableDescriptor htd)) could call into this cache to invalidate entries related to the table, so then the next HTable.getTableDescriptor() would go to meta to return up to date information. &lt;/p&gt;</comment>
                            <comment id="12611365" author="stack" created="Mon, 7 Jul 2008 21:42:11 +0000"  >&lt;p&gt;Jb Lee:&lt;/p&gt;

&lt;p&gt;Thanks for filing the issue.&lt;/p&gt;

&lt;p&gt;Its correct to mark it minor I think.  Here&apos;s why.  This is the declaration for cachedRegionLocation:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, SoftSortedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [], HRegionLocation&amp;gt;&amp;gt; 
      cachedRegionLocations = ....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its a map of integer keys to a value that is a map of soft references.  If pressure on memory in the client, while the keys are hard references, the map of the much bigger soft references will release its hold on region locations.&lt;/p&gt;

&lt;p&gt;It could be a problem when we hit extremely large tables.&lt;/p&gt;

&lt;p&gt;Andrew: Good find.  Make another issue for it?&lt;/p&gt;</comment>
                            <comment id="12611494" author="apurtell" created="Tue, 8 Jul 2008 09:38:20 +0000"  >&lt;p&gt;Opened new JIRA as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-729&quot; title=&quot;client region/metadata cache should have a public method for invalidating entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-729&quot;&gt;&lt;del&gt;HBASE-729&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Regarding this issue, JB &amp;#8211; Did your client actually die with an OOME, or were you speaking hypothetically?&lt;/p&gt;</comment>
                            <comment id="12611553" author="jblee" created="Tue, 8 Jul 2008 12:33:58 +0000"  >&lt;p&gt;stack:&lt;br/&gt;
 I confused with old source file (0.1.3?), where the cachedRegionLocations are declared as  Map&amp;lt;Text, SortedMap&amp;lt;Text, HRegionLocation&amp;gt;&amp;gt;. Sorry.&lt;br/&gt;
 I agree with you. With soft references, it may not be the problem.  &lt;/p&gt;

&lt;p&gt; I checked another cache in hbase. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-288&quot; title=&quot;Add in-memory caching of data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-288&quot;&gt;&lt;del&gt;HBASE-288&lt;/del&gt;&lt;/a&gt; added block cache implementation in HStoreFile using BlockFSInputStream.  &lt;br/&gt;
 &quot;Map&amp;lt;Long, byte[]&amp;gt; blocks&quot; stores blocks, but I can&apos;t find the part that remove it before the BlockFSInputStream object is GCed. &lt;br/&gt;
 I think it can be significant problem if we use block cached table because the block cache is in regionserver and block data is not so small.&lt;br/&gt;
 Do we need to fix it?&lt;/p&gt;

&lt;p&gt;Andrew Purtell:&lt;br/&gt;
 Hypothetically. Sorry again. &lt;/p&gt;
</comment>
                            <comment id="12621661" author="apurtell" created="Tue, 12 Aug 2008 00:45:49 +0000"  >&lt;p&gt;For this specific issue a limit on TableServers cachedRegionLocation as stack says is probably not necessary because a soft map is used.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Jul 2008 02:39:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25361</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h91z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>