<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:31:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12245/HBASE-12245.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12245] Snapshots going corrupt after creation</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12245</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Took a snapshot Fri Oct 10 12:59:35 PDT 2014. Everything reported good and all files were there.&lt;/p&gt;

&lt;p&gt;Ran an export snapshot job over the weekend.&lt;/p&gt;

&lt;p&gt;Came back this morning and all the jobs had failed and now the snapshot is corrupt.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12747805">HBASE-12245</key>
            <summary>Snapshots going corrupt after creation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="eclark">Elliott Clark</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Oct 2014 18:41:40 +0000</created>
                <updated>Mon, 13 Oct 2014 21:31:58 +0000</updated>
                                            <version>0.98.7</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14169743" author="mbertozzi" created="Mon, 13 Oct 2014 18:48:08 +0000"  >&lt;p&gt;the SnapshotInfo tool will give you info of which files are missing.&lt;br/&gt;
It is probably some time race condition with the cleaner.&lt;br/&gt;
(are you using format v1 or v2?)&lt;/p&gt;</comment>
                            <comment id="14169756" author="eclark" created="Mon, 13 Oct 2014 18:52:42 +0000"  >&lt;p&gt;They are format version v2. I haven&apos;t changed any defaults for 0.98.7 about the cleaner.&lt;/p&gt;</comment>
                            <comment id="14169770" author="mbertozzi" created="Mon, 13 Oct 2014 19:04:35 +0000"  >&lt;p&gt;can you give us more info/log/stats?&lt;br/&gt;
the output from SnapshotInfo -files will be useful, and export/master logs will be nice&lt;/p&gt;</comment>
                            <comment id="14169924" author="eclark" created="Mon, 13 Oct 2014 20:45:32 +0000"  >&lt;p&gt;Sorry can&apos;t post everything. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase org.apache.hadoop.hbase.snapshot.SnapshotInfo -stats -files -snapshot MailBox_cell16_v1_2014-10-10-125917 | grep NOT
       - TABLE/7f4112f68d74c6de31aae30a2373b714/M/a9a75914e357495a90e2e93c88d5db0e (NOT FOUND)
       - TABLE/c0423bdc4b87d3b33be3c91f2452dabd/K/cb557271f69442e89caf1982c0f61cd5 (NOT FOUND)
       - TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b (NOT FOUND)
       - TABLE/f3948c1d081a2740fb74976b8653e053/D/160f562d2a9a4c9388a305fd054c8ac1 (NOT FOUND)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;All of the files are from different regions. All of them are from different stores. None of the tables have recently had their schema changed.&lt;br/&gt;
None of those files are mentioned in the master logs.&lt;br/&gt;
I&apos;m starting to search the region server logs now.&lt;/p&gt;</comment>
                            <comment id="14169965" author="mbertozzi" created="Mon, 13 Oct 2014 21:00:13 +0000"  >&lt;p&gt;if you have hdfs audit, you should see that the master deleted the files. otherwise it is a problem...&lt;/p&gt;

&lt;p&gt;also, do you know if the removed files are &quot;splits&quot; (hfiles referenced by the two reference files)?&lt;br/&gt;
can you post the ls -R of the /hbase/.hbase-snapshot/SNAPSHOT_NAME dir? I&apos;m looking for the timestamps and sizes of dir and manifests&lt;/p&gt;</comment>
                            <comment id="14170021" author="eclark" created="Mon, 13 Oct 2014 21:31:58 +0000"  >&lt;p&gt;Of course the audit logs don&apos;t go back that far on this test cluster..... I&apos;ll be looking at that.&lt;/p&gt;

&lt;p&gt;Here&apos;s what I&apos;m seeing on the region server. So it looks like the file was created, compacted, added to a snapshot, and then archived fine.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 2014-10-10 12:52:53,628 DEBUG org.apache.hadoop.hbase.regionserver.HRegionFileSystem: Committing store file hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/.tmp/31c3d53620ad402cbf44232013834f7b as hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b
&lt;/span&gt;2014-10-10 12:59:37,709 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding snapshot references &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/80231f01c5d14d8c84f75bea293af26c, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/303bfa9fcd3649b18605627503d12296, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/1ca21e865db049aea1d5538aaee7940a, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b] hfiles
&lt;/span&gt;2014-10-10 12:59:37,709 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding reference &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file (4/4): hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b
&lt;/span&gt;2014-10-10 13:26:53,310 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding snapshot references &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/80231f01c5d14d8c84f75bea293af26c, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/303bfa9fcd3649b18605627503d12296, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/1ca21e865db049aea1d5538aaee7940a, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/64dce75224c74da48f2dfd23580eb350] hfiles
&lt;/span&gt;2014-10-10 13:26:53,310 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding reference &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file (4/5): hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b
&lt;/span&gt;2014-10-10 13:31:10,991 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding snapshot references &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/80231f01c5d14d8c84f75bea293af26c, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/303bfa9fcd3649b18605627503d12296, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/1ca21e865db049aea1d5538aaee7940a, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/64dce75224c74da48f2dfd23580eb350] hfiles
&lt;/span&gt;2014-10-10 13:31:10,992 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding reference &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file (4/5): hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b
&lt;/span&gt;2014-10-10 13:36:05,742 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding snapshot references &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/80231f01c5d14d8c84f75bea293af26c, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/303bfa9fcd3649b18605627503d12296, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/1ca21e865db049aea1d5538aaee7940a, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b, hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/64dce75224c74da48f2dfd23580eb350] hfiles
&lt;/span&gt;2014-10-10 13:36:05,742 DEBUG org.apache.hadoop.hbase.snapshot.SnapshotManifest: Adding reference &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file (4/5): hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b
&lt;/span&gt;2014-10-10 15:25:45,114 DEBUG org.apache.hadoop.hbase.regionserver.compactions.Compactor: Compacting hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b, keycount=11797, bloomtype=ROW, size=2.7 MB, encoding=NONE, seqNum=30762619024
&lt;/span&gt;2014-10-10 15:25:45,926 DEBUG org.apache.hadoop.hbase.backup.HFileArchiver: Finished archiving from class org.apache.hadoop.hbase.backup.HFileArchiver$FileableStoreFile, file:hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-dfs.data.facebook.com:9000/hbase-HBASE/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b, to hdfs://hbase-dfs.data.facebook.com:9000/hbase-HBASE/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/TABLE/d437461577613a475160ee579ea1e203/S/31c3d53620ad402cbf44232013834f7b&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then there is no mention of that file in the master at all.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Oct 2014 18:48:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21493:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>