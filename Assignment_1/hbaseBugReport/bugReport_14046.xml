<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:49:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14046/HBASE-14046.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14046] IllegalArgumentException: Negative position from hfile.bucket.FileIOEngine.read</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14046</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When I scan a table using hbase shell, got the following message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: bash.&lt;/span&gt; Available languages are: actionscript, html, java, javascript, none, sql, xhtml, xml&lt;/div&gt;&lt;pre&gt;
hbase(main):001:0&amp;gt; scan &apos;atpco:ttf_record6&apos;
ROW                                              COLUMN+CELL

ERROR: org.apache.hadoop.hbase.exceptions.OutOfOrderScannerNextException: Expected nextCallSeq: 1 But the nextCallSeq got from client: 0; request=scanner_id: 201542113 number_of_rows: 100 close_scanner: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; next_call_seq: 0
	at org.apache.hadoop.hbase.regionserver.HRegionServer.scan(HRegionServer.java:3193)
	at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:29587)
	at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2031)
	at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:108)
	at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:114)
	at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:94)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the region server got the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-30 11:08:11,877 ERROR [B.defaultRpcServer.handler=27,queue=0,port=60020] ipc.RpcServer: Unexpected throwable object
java.lang.IllegalArgumentException: Negative position
        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:675)
        at org.apache.hadoop.hbase.io.hfile.bucket.FileIOEngine.read(FileIOEngine.java:87)
        at org.apache.hadoop.hbase.io.hfile.bucket.BucketCache.getBlock(BucketCache.java:406)
        at org.apache.hadoop.hbase.io.hfile.LruBlockCache.getBlock(LruBlockCache.java:389)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2.readBlock(HFileReaderV2.java:359)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.readNextDataBlock(HFileReaderV2.java:635)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$ScannerV2.next(HFileReaderV2.java:749)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.next(StoreFileScanner.java:136)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:108)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:507)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:140)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.populateResult(HRegion.java:3900)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextInternal(HRegion.java:3980)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextRaw(HRegion.java:3858)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextRaw(HRegion.java:3849)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.scan(HRegionServer.java:3245)
        at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:29587)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2031)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:108)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems something wrong with the BucketCache.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS release 6.4 X86_64&lt;/p&gt;</environment>
        <key id="12843804">HBASE-14046</key>
            <summary>IllegalArgumentException: Negative position from hfile.bucket.FileIOEngine.read</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="louis.hust">louis hust</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2015 08:35:57 +0000</created>
                <updated>Mon, 22 Feb 2016 09:49:38 +0000</updated>
                                            <version>0.98.6</version>
                                                    <component>BucketCache</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14679526" author="liushaohui" created="Mon, 10 Aug 2015 03:51:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=louis.hust&quot; class=&quot;user-hover&quot; rel=&quot;louis.hust&quot;&gt;louis hust&lt;/a&gt;&lt;br/&gt;
Do you enable the caching blocks on write? &lt;br/&gt;
May be it&apos;s same problem as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12270&quot; title=&quot;A bug in the bucket cache, with cache blocks on write enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12270&quot;&gt;&lt;del&gt;HBASE-12270&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14985565" author="ram_krish" created="Mon, 2 Nov 2015 17:19:10 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-11-02 22:39:06,666 ERROR [B.DefaultRpcServer.handler=31,queue=1,port=16040] ipc.RpcServer: Unexpected throwable object
java.lang.IllegalArgumentException: Negative position
        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:685)
        at org.apache.hadoop.hbase.io.hfile.bucket.FileIOEngine.read(FileIOEngine.java:87)
        at org.apache.hadoop.hbase.io.hfile.bucket.BucketCache.getBlock(BucketCache.java:417)
        at org.apache.hadoop.hbase.io.hfile.CombinedBlockCache.getBlock(CombinedBlockCache.java:77)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2.readBlock(HFileReaderV2.java:360)
        at org.apache.hadoop.hbase.io.hfile.HFileBlockIndex$BlockIndexReader.loadDataBlockWithScanInfo(HFileBlockIndex.java:253)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.seekTo(HFileReaderV2.java:539)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.seekTo(HFileReaderV2.java:560)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seekAtOrAfter(StoreFileScanner.java:237)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seek(StoreFileScanner.java:152)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.seekScanners(StoreScanner.java:329)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.&amp;lt;init&amp;gt;(StoreScanner.java:188)
        at org.apache.hadoop.hbase.regionserver.HStore.getScanner(HStore.java:1866)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.&amp;lt;init&amp;gt;(HRegion.java:3968)
        at org.apache.hadoop.hbase.regionserver.HRegion.instantiateRegionScanner(HRegion.java:1988)
        at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:1974)
        at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:1951)
        at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:5009)
        at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:4984)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.get(HRegionServer.java:2970)
        at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:30942)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2093)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I got this bug with 0.98.12 with bucket cache file mode. &lt;/p&gt;</comment>
                            <comment id="14988944" author="ram_krish" created="Wed, 4 Nov 2015 05:54:50 +0000"  >&lt;p&gt;Though not able to find the root cause - in the case I got this bug it was like all my data were major compacted. One of the Hfile root index offset either should be corrupted while writing or may be there is an issue in some specific case while reading and filling up the index offsets. But this bug is surely lurking some where in the code. Was just analysing the code to see if there could be a int overflow or something to happen and that we try to use in the read path, seems that is clear. &lt;/p&gt;</comment>
                            <comment id="15147038" author="anoop.hbase" created="Mon, 15 Feb 2016 08:07:02 +0000"  >&lt;p&gt;When this issue came, configured hbase.bucketcache.bucket.sizes to non default values?  Seeing the code in converting long offset into an int baseOffset and one byte value, we have expectation on the bucket sizes.  It has to multiple of 1024..  For other values seems we will get incorrect results..   Did not try to reproduce a -ve case.&lt;/p&gt;</comment>
                            <comment id="15156697" author="ram_krish" created="Mon, 22 Feb 2016 09:49:38 +0000"  >&lt;p&gt;. Just seeing this comment.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;When this issue came, configured hbase.bucketcache.bucket.sizes to non default values?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No this value was the default one. Only the param &apos;hbase.bucketcache.size&apos; used to be changed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Aug 2015 03:51:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h1iv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>