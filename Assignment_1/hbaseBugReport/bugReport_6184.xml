<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:34:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6184/HBASE-6184.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6184] HRegionInfo was null or empty in Meta </title>
                <link>https://issues.apache.org/jira/browse/HBASE-6184</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;insert data&lt;/p&gt;

&lt;p&gt;hadoop-0.23.2 + hbase-0.94.0&lt;/p&gt;

&lt;p&gt;2012-06-07 13:09:38,573 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation&amp;#93;&lt;/span&gt; Encountered problems when prefetch META table: &lt;br/&gt;
java.io.IOException: HRegionInfo was null or empty in Meta for hbase_one_col, row=hbase_one_col,09115303780247449149,99999999999999&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:160)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner.access$000(MetaScanner.java:48)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner$1.connect(MetaScanner.java:126)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner$1.connect(MetaScanner.java:123)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager.execute(HConnectionManager.java:359)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:123)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:99)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.prefetchRegionCache(HConnectionManager.java:894)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegionInMeta(HConnectionManager.java:948)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegion(HConnectionManager.java:836)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatchCallback(HConnectionManager.java:1482)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatch(HConnectionManager.java:1367)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:945)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.doPut(HTable.java:801)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.put(HTable.java:776)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTablePool$PooledHTable.put(HTablePool.java:397)&lt;br/&gt;
        at com.dinglicom.hbase.HbaseImport.insertData(HbaseImport.java:177)&lt;br/&gt;
        at com.dinglicom.hbase.HbaseImport.run(HbaseImport.java:210)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12559638">HBASE-6184</key>
            <summary>HRegionInfo was null or empty in Meta </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zhangjf1@gmail.com">jiafeng.zhang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jun 2012 05:21:15 +0000</created>
                <updated>Tue, 12 Aug 2014 09:28:36 +0000</updated>
                                            <version>0.94.0</version>
                                                    <component>Client</component>
                    <component>io</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13293487" author="anoopsamjohn" created="Tue, 12 Jun 2012 10:04:56 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] searchRow =
         HRegionInfo.createRegionName(tableName, row, HConstants.NINES,
-          &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
+          &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This change will affect the look up in the META table?&lt;br/&gt;
When searchRow is created with passing newformat=true, it will add the encoded name also at the end&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;lt;tableName&amp;gt;,&amp;lt;row&amp;gt;,&amp;lt;regionid&amp;gt;.&amp;lt;encodedname&amp;gt;.&amp;#93;&lt;/span&gt;. But the searchRow is used to do metaTable.getRowOrBefore(). Any way after the row we add HConstants.NINES using which we need to get correct row from META table.  I mean adding this encodedname might not be needed for this lookup&lt;/p&gt;

&lt;p&gt;In your issue you are getting the result but in that result the HRegionInfo seems coming as null only?  Do this above change really fix your issue? Do u facing some other issues?&lt;/p&gt;</comment>
                            <comment id="13293493" author="ram_krish" created="Tue, 12 Jun 2012 10:15:51 +0000"  >&lt;p&gt;Can you may be check what was the scenario that happened before this? May be that will give us a clue.  &lt;/p&gt;</comment>
                            <comment id="13294051" author="zhangjf1@gmail.com" created="Wed, 13 Jun 2012 01:30:58 +0000"  >&lt;p&gt;  public HRegionInfo(final byte[] tableName, final byte[] startKey,&lt;br/&gt;
                     final byte[] endKey, final boolean split, final long regionid)&lt;br/&gt;
  throws IllegalArgumentException {&lt;/p&gt;

&lt;p&gt;    super();&lt;br/&gt;
    if (tableName == null) &lt;/p&gt;
{
      throw new IllegalArgumentException(&quot;tableName cannot be null&quot;);
    }
&lt;p&gt;    this.tableName = tableName.clone();&lt;br/&gt;
    this.offLine = false;&lt;br/&gt;
    this.regionId = regionid;&lt;/p&gt;

&lt;p&gt;    this.regionName = createRegionName(this.tableName, startKey, regionId, true);&lt;/p&gt;

&lt;p&gt;    this.regionNameStr = Bytes.toStringBinary(this.regionName);&lt;br/&gt;
    this.split = split;&lt;br/&gt;
    this.endKey = endKey == null? HConstants.EMPTY_END_ROW: endKey.clone();&lt;br/&gt;
    this.startKey = startKey == null?&lt;br/&gt;
      HConstants.EMPTY_START_ROW: startKey.clone();&lt;br/&gt;
    this.tableName = tableName.clone();&lt;br/&gt;
    setHashCode();&lt;br/&gt;
  }&lt;/p&gt;</comment>
                            <comment id="13294055" author="zhangjf1@gmail.com" created="Wed, 13 Jun 2012 01:42:40 +0000"  >&lt;p&gt;This change, my program is no problem&lt;/p&gt;</comment>
                            <comment id="13294780" author="jxiang" created="Thu, 14 Jun 2012 02:42:25 +0000"  >&lt;p&gt;How will this fix the issue?  Have you checked the data in the meta table?  Does that row have region info?&lt;br/&gt;
I think this most likely is a meta table data issue.&lt;/p&gt;</comment>
                            <comment id="13407452" author="lhofhansl" created="Thu, 5 Jul 2012 20:24:11 +0000"  >&lt;p&gt;Moving to 0.94.2 for now.&lt;/p&gt;</comment>
                            <comment id="13441661" author="lhofhansl" created="Sat, 25 Aug 2012 00:15:33 +0000"  >&lt;p&gt;And on to 0.94.3&lt;/p&gt;</comment>
                            <comment id="13482965" author="lhofhansl" created="Wed, 24 Oct 2012 05:01:19 +0000"  >&lt;p&gt;I don&apos;t quite grok the change. @jiafeng: Could explain again why this fix the issue? (sorry for us being slow on this)... Thanks.&lt;/p&gt;</comment>
                            <comment id="13483122" author="aoxiang" created="Wed, 24 Oct 2012 10:28:04 +0000"  >&lt;p&gt;This can be happened when region split.&lt;br/&gt;
0.94.x version: write memstore, write hlog, update mvcc.&lt;/p&gt;

&lt;p&gt;Client:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        metaTable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(configuration, HConstants.META_TABLE_NAME);
        Result startRowResult = metaTable.getRowOrBefore(searchRow,
            HConstants.CATALOG_FAMILY); 
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (startRowResult == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TableNotFoundException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot find row in .META. &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table: &quot;&lt;/span&gt;
              + Bytes.toString(tableName) + &lt;span class=&quot;code-quote&quot;&gt;&quot;, row=&quot;&lt;/span&gt; + Bytes.toStringBinary(searchRow));
        }
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] value = startRowResult.getValue(HConstants.CATALOG_FAMILY,
            HConstants.REGIONINFO_QUALIFIER);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || value.length == 0) {
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;HRegionInfo was &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; or empty in Meta &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
            Bytes.toString(tableName) + &lt;span class=&quot;code-quote&quot;&gt;&quot;, row=&quot;&lt;/span&gt; + Bytes.toStringBinary(searchRow));
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Server :&lt;br/&gt;
HRegion.getClosestRowBefore&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      Store store = getStore(family);
      &lt;span class=&quot;code-comment&quot;&gt;// get the closest key. (HStore.getRowKeyAtOrBefore can &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/span&gt;      KeyValue key = store.getRowKeyAtOrBefore(row);
      Result result = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        Get get = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Get(key.getRow());
        get.addFamily(family);
        result = get(get, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
      }
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;store.getRowKeyAtOrBefore(row); doesn&apos;t consider the readPoint, but the get will, so some value doesn&apos;t have commit, getRowKeyAtOrBefore see it, but get will ignore it, so there is possiable that will return null result. &lt;/p&gt;</comment>
                            <comment id="13483123" author="aoxiang" created="Wed, 24 Oct 2012 10:36:51 +0000"  >&lt;p&gt;0.94 &lt;br/&gt;
write memstore &lt;br/&gt;
write hlog // last a few ms.. &lt;br/&gt;
update mvcc&lt;/p&gt;

&lt;p&gt;Current readPoint = 9;, and the new KeyValue memstoreTS = 10, then the HRegion.getClosestRowBefore is called.&lt;br/&gt;
 KeyValue key = store.getRowKeyAtOrBefore(row);  will see the new KeyValue, &lt;br/&gt;
but &lt;br/&gt;
        Get get = new Get(key.getRow());&lt;br/&gt;
        get.addFamily(family);&lt;br/&gt;
        result = get(get, null);&lt;br/&gt;
will not see the new KeyValue.&lt;/p&gt;</comment>
                            <comment id="13483901" author="ram_krish" created="Thu, 25 Oct 2012 05:04:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt;&lt;br/&gt;
Thanks for your update.  So do you think your patch will address this problem? Your explanation seems to be wrt MVCC right?&lt;/p&gt;</comment>
                            <comment id="13484010" author="aoxiang" created="Thu, 25 Oct 2012 09:55:50 +0000"  >&lt;p&gt;@ramkrishna.s.vasudevan  this is not my patch, and i think this is not a serious problem, doesn&apos;t solved this problem...&lt;/p&gt;</comment>
                            <comment id="13484026" author="ram_krish" created="Thu, 25 Oct 2012 10:37:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt;&lt;br/&gt;
Oh...Am sorry i thought the patch also was yours.  Thanks anyway !!.&lt;/p&gt;</comment>
                            <comment id="13484214" author="lhofhansl" created="Thu, 25 Oct 2012 15:58:04 +0000"  >&lt;p&gt;Removing from 0.94&lt;/p&gt;</comment>
                            <comment id="14093922" author="rguo" created="Tue, 12 Aug 2014 09:28:36 +0000"  >&lt;p&gt;The issue also happened in hadoop-2.0.5_alpha + hbase-0.94.8 as:&lt;/p&gt;

&lt;p&gt;java.io.IOException: HRegionInfo was null or empty in Meta for hbase:namespace, row=hbase:namespace,,99999999999999&lt;br/&gt;
        at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:152)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.prefetchRegionCache(HConnectionManager.java:1095)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegionInMeta(HConnectionManager.java:1155)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegion(HConnectionManager.java:1047)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.locateRegion(HConnectionManager.java:1004)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.finishSetup(HTable.java:325)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.&amp;lt;init&amp;gt;(HTable.java:191)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.TableNamespaceManager.isTableAvailableAndInitialized(TableNamespaceManager.java:260)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.TableNamespaceManager.start(TableNamespaceManager.java:106)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.initNamespace(HMaster.java:1044)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:916)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:744)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12532033" name="HBASE-6184.patch" size="1207" author="zhangjf1@gmail.com" created="Thu, 14 Jun 2012 02:22:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Jun 2012 10:04:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241715</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>