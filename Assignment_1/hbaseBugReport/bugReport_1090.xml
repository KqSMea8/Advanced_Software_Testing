<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:50:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1090/HBASE-1090.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1090] Atomic Check And Save in HTable</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1090</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Check And Save is a simple operation where one gives both a BatchUpdate with updates and a Map mapping columns to expected values (byte[] -&amp;gt; byte[]). The operation works as follows:&lt;/p&gt;

&lt;p&gt;1. Server gets locks on row.&lt;br/&gt;
2. Server checks that the actual values of the specified columns match the given expected values&lt;br/&gt;
3. If False, return False, if True update the row&lt;br/&gt;
4. Unlock row.&lt;/p&gt;

&lt;p&gt;Pretty simple... but useful.&lt;/p&gt;

&lt;p&gt;Included in the attached patch are the necessary updates for HTable, HRegionServer, RegionServerInterface, and HRegion. I also added a small unit test to HTable where the test checks that checkAndSave succeeds when the expected values line up and fail when the values are different.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411356">HBASE-1090</key>
            <summary>Atomic Check And Save in HTable</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gottesmm">Michael Gottesman</assignee>
                                    <reporter username="gottesmm">Michael Gottesman</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Dec 2008 04:38:31 +0000</created>
                <updated>Sun, 13 Sep 2009 22:26:36 +0000</updated>
                            <resolved>Tue, 6 Jan 2009 20:21:42 +0000</resolved>
                                                    <fixVersion>0.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12659307" author="gottesmm" created="Sat, 27 Dec 2008 04:50:40 +0000"  >&lt;p&gt;also, before I forget, I have not had a chance to run the unit test. I am using new computers and for some reason the tests are failing (aka a bunch of tests that I did not touch), and I am pretty sure it is due to problems I have had before (this seems eerily familiar ; p). I can test it in a few days (I am traveling tonight) or if someone else could apply the patch and run the tests, it would be great.&lt;/p&gt;</comment>
                            <comment id="12659904" author="stack" created="Tue, 30 Dec 2008 19:35:42 +0000"  >&lt;p&gt;Looks great Michael.&lt;/p&gt;

&lt;p&gt;Couple of comments:&lt;/p&gt;

&lt;p&gt;+ In hadoop/hbase, lines are 80 characters max.  Get your line-wrapper out.&lt;br/&gt;
+ You don&apos;t need to do the try/catch in test... just let the exception out.  JUnit will report exception as test failure.  I&apos;m talking about this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+      e.printStackTrace();
+      fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Should not have any exception &quot;&lt;/span&gt; +
+        e.getClass());
+    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;+ Why not have checkAndSave on HRS return a boolean rather than a Boolean?&lt;br/&gt;
+ I think this map has to be a Writable Michael: final Map&amp;lt;byte[],byte[]&amp;gt; expectedValues.  See HBaseMapWritable if you are looking for one.&lt;br/&gt;
+ I think the javadoc on HTable checkAndSave will generate warnings because it does not make mention of the method&apos;s parameters (try &apos;ant javadoc&apos;).&lt;/p&gt;

&lt;p&gt;Otherwise, it looks great.&lt;/p&gt;

&lt;p&gt;I thought we already had an issue asking for this functionality but can&apos;t find it.&lt;/p&gt;</comment>
                            <comment id="12659913" author="apurtell" created="Tue, 30 Dec 2008 19:52:16 +0000"  >&lt;p&gt;Stack, I think you are thinking of the atomic increment and decrement stuff that jgray contributed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-803&quot; title=&quot;Atomic increment operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-803&quot;&gt;&lt;del&gt;HBASE-803&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="12659946" author="stack" created="Tue, 30 Dec 2008 21:29:32 +0000"  >&lt;p&gt;yes&lt;/p&gt;</comment>
                            <comment id="12659962" author="gottesmm" created="Tue, 30 Dec 2008 22:01:07 +0000"  >&lt;p&gt;version 2&lt;/p&gt;</comment>
                            <comment id="12660539" author="stack" created="Sun, 4 Jan 2009 07:22:52 +0000"  >&lt;p&gt;Michael, the test fails for me.  It seems as though it has to do with your returning a Boolean from checkAndSave.  I think if you change it to return the primitive boolean type, it should work.  The attached patch applies (v2 doesn&apos;t apply since I added your other patch).  You might move the testCheckAndSave up in TestHTable so its first and runs first before all others while your debugging to save yourself some time.&lt;/p&gt;

&lt;p&gt;Good stuff (otherwise patch looks good to me).&lt;/p&gt;</comment>
                            <comment id="12660641" author="stack" created="Sun, 4 Jan 2009 22:32:41 +0000"  >&lt;p&gt;Michael, this patch changes the Boolean returns to boolean.  It gets further but still not right.  The assertions at end of your test keep coming back true regardless.&lt;/p&gt;</comment>
                            <comment id="12661084" author="gottesmm" created="Tue, 6 Jan 2009 09:14:56 +0000"  >&lt;p&gt;So I went through it and found the issue. The problem that seemed to be happening had to do with me returning false in the middle of the checkAndSave in HRegion/releasing locks in the middle of the checkAndSave in HRegion. Instead of doing that, I created a variable that just said whether or not the expected values matched up and then if it doesn&apos;t skips the save part of check and save. Then in the typical HBase fashion the locks are released and a value is returned after all of the try blocks have closed.&lt;/p&gt;

&lt;p&gt;Attached is the new patch.&lt;/p&gt;</comment>
                            <comment id="12661296" author="stack" created="Tue, 6 Jan 2009 20:21:42 +0000"  >&lt;p&gt;Committed (after removing debug).  Thanks for the patch Michael.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12397064" name="1090v3.patch" size="9740" author="stack" created="Sun, 4 Jan 2009 07:22:52 +0000"/>
                            <attachment id="12397089" name="1090v4.patch" size="9663" author="stack" created="Sun, 4 Jan 2009 22:32:41 +0000"/>
                            <attachment id="12397187" name="1090v5.patch" size="11431" author="gottesmm" created="Tue, 6 Jan 2009 09:16:13 +0000"/>
                            <attachment id="12396790" name="hbase-1090.patch" size="8880" author="gottesmm" created="Sat, 27 Dec 2008 04:47:27 +0000"/>
                            <attachment id="12396936" name="hbase-1090v2.patch" size="9624" author="gottesmm" created="Tue, 30 Dec 2008 22:01:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Dec 2008 19:35:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31985</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hb9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>