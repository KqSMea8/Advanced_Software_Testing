<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:42:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13400/HBASE-13400.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13400] HBase Snapshot export to S3 fails with Content-MD5 errors.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13400</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We&apos;re running into issues exporting snapshots of large tables to Amazon S3.&lt;/p&gt;

&lt;p&gt;The snapshot completes successfully, but the snapshot export job runs into errors with jets3t when we attempt to export to S3.  &lt;/p&gt;

&lt;p&gt;Error snippet, from job log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-04-03 16:59:16,425 INFO  [main] mapreduce.Job: Task Id : attempt_1426532296228_55454_m_000008_1, Status : FAILED
Error: org.apache.hadoop.fs.s3.S3Exception: org.jets3t.service.S3ServiceException: S3 Error Message. -- ResponseCode: 400, ResponseStatus: Bad Request, XML Error Message: &amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&amp;lt;Error&amp;gt;&amp;lt;Code&amp;gt;BadDigest&amp;lt;/Code&amp;gt;&amp;lt;Message&amp;gt;The Content-MD5 you specified did not match what we received.&amp;lt;/Message&amp;gt;&amp;lt;ExpectedDigest&amp;gt;CWiSsgzVAJyzPy2oT8u4Ag==&amp;lt;/ExpectedDigest&amp;gt;&amp;lt;CalculatedDigest&amp;gt;2DIsv6jZJ8FuGtalOO8SPA==&amp;lt;/CalculatedDigest&amp;gt;&amp;lt;RequestId&amp;gt;CA325C738970C313&amp;lt;/RequestId&amp;gt;&amp;lt;HostId&amp;gt;tnE+O1zPZovaQWMhCuM4lkX0h/wN9173FQ7omxZzLb6eH0OCHASyan+mb8WBJkNn&amp;lt;/HostId&amp;gt;&amp;lt;/Error&amp;gt;
	at org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.handleS3ServiceException(Jets3tNativeFileSystemStore.java:405)
	at org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.storeFile(Jets3tNativeFileSystemStore.java:115)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:190)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:103)
	at org.apache.hadoop.fs.s3native.$Proxy19.storeFile(Unknown Source)
	at org.apache.hadoop.fs.s3native.NativeS3FileSystem$NativeS3FsOutputStream.close(NativeS3FileSystem.java:221)
	at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.close(FSDataOutputStream.java:70)
	at org.apache.hadoop.fs.FSDataOutputStream.close(FSDataOutputStream.java:103)
	at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.copyFile(ExportSnapshot.java:200)
	at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:140)
	at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:89)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:340)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1557)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:162)
Caused by: org.jets3t.service.S3ServiceException: S3 Error Message. -- ResponseCode: 400, ResponseStatus: Bad Request, XML Error Message: &amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&amp;lt;Error&amp;gt;&amp;lt;Code&amp;gt;BadDigest&amp;lt;/Code&amp;gt;&amp;lt;Message&amp;gt;The Content-MD5 you specified did not match what we received.&amp;lt;/Message&amp;gt;&amp;lt;ExpectedDigest&amp;gt;CWiSsgzVAJyzPy2oT8u4Ag==&amp;lt;/ExpectedDigest&amp;gt;&amp;lt;CalculatedDigest&amp;gt;2DIsv6jZJ8FuGtalOO8SPA==&amp;lt;/CalculatedDigest&amp;gt;&amp;lt;RequestId&amp;gt;CA325C738970C313&amp;lt;/RequestId&amp;gt;&amp;lt;HostId&amp;gt;tnE+O1zPZovaQWMhCuM4lkX0h/wN9173FQ7omxZzLb6eH0OCHASyan+mb8WBJkNn&amp;lt;/HostId&amp;gt;&amp;lt;/Error&amp;gt;
	at org.jets3t.service.S3Service.putObject(S3Service.java:2267)
	at org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.storeFile(Jets3tNativeFileSystemStore.java:113)
	... 21 more

2015-04-03 17:03:50,613 INFO  [main] mapreduce.Job: Task Id : attempt_1426532296228_55454_m_000010_1, Status : FAILED
AttemptID:attempt_1426532296228_55454_m_000010_1 Timed out after 300 secs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ve verified that exports to other clusters from these same snapshots work fine.  Thus the issue appears to lie within the snapshot export utility, jets3t, and S3.&lt;/p&gt;

&lt;p&gt;&quot;The Content-MD5 you specified did not match what we received&quot; seems to indicate that the snapshot changed between when the upload started and the error.   Can that be?  &lt;/p&gt;

&lt;p&gt;Related to:&lt;br/&gt;
&lt;a href=&quot;https://groups.google.com/forum/#!topic/jets3t-users/Bg2qh7OdE2U&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Discussion on jets3t user group,.&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 6.5, Hortonworks Data Platform 2.1.2, Hadoop 2.4.0&lt;/p&gt;</environment>
        <key id="12788052">HBASE-13400</key>
            <summary>HBase Snapshot export to S3 fails with Content-MD5 errors.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="JReid">Joseph Reid</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Apr 2015 17:40:48 +0000</created>
                <updated>Fri, 3 Apr 2015 18:45:15 +0000</updated>
                                            <version>0.98.0</version>
                                                    <component>Filesystem Integration</component>
                    <component>hadoop2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14394784" author="esteban" created="Fri, 3 Apr 2015 18:00:47 +0000"  >&lt;p&gt;This should&apos;t be a problem in recent releases after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10601&quot; title=&quot;Upgrade hadoop dependency to 2.3.0 release&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10601&quot;&gt;&lt;del&gt;HBASE-10601&lt;/del&gt;&lt;/a&gt; since it will pull the right jets3 artifact from Hadoop 2.3 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9623&quot; title=&quot;Update jets3t dependency to  0.9.0 &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9623&quot;&gt;&lt;del&gt;HADOOP-9623&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14394825" author="apurtell" created="Fri, 3 Apr 2015 18:16:48 +0000"  >&lt;p&gt;We don&apos;t manage the jets3t dependency as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=esteban&quot; class=&quot;user-hover&quot; rel=&quot;esteban&quot;&gt;Esteban Gutierrez&lt;/a&gt; mentions.&lt;/p&gt;

&lt;p&gt;As described this would be an issue with the Hadoop S3 filesystem implemention, so you may want to file a JIRA on the Hadoop common project (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HADOOP&lt;/a&gt;), or an issue with the particular version of jets3t included with HDP 2.1.2, in which case you should follow up with the vendor. &lt;/p&gt;</comment>
                            <comment id="14394845" author="esteban" created="Fri, 3 Apr 2015 18:25:51 +0000"  >&lt;p&gt;We do pack jets3t from Hadoop when we generate the HBase 1.0 package &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ md5sum hbase-1.0.0-bin.tar.gz 
4289870a14996c875a3ea93b7e690ea6  hbase-1.0.0-bin.tar.gz
$ tar ztvf hbase-1.0.0-bin.tar.gz | grep jets
-rw-r--r--  0 enis   staff  539735 Nov 12  2013 hbase-1.0.0/lib/jets3t-0.9.0.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14394846" author="apurtell" created="Fri, 3 Apr 2015 18:27:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;We do pack jets3t from Hadoop when we generate the HBase 1.0 package Andrew Purtell:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Again, like with the discussion on Jackson, just because we have a dependency that gets packaged doesn&apos;t make it part of our API nor our problem to solve, especially if we don&apos;t have any S3 code &lt;em&gt;in our own project&lt;/em&gt;. &lt;/p&gt;</comment>
                            <comment id="14394850" author="apurtell" created="Fri, 3 Apr 2015 18:29:27 +0000"  >&lt;p&gt;Surely we do not want to claim ownership of every dependency that comes in from Hadoop or ZooKeeper and officially state that all of the APIs of Hadoop, Jackson, jets3t, ZooKeeper, etc etc etc are part of &lt;em&gt;our&lt;/em&gt; API too. That&apos;s lunacy.&lt;/p&gt;</comment>
                            <comment id="14394859" author="apurtell" created="Fri, 3 Apr 2015 18:33:06 +0000"  >&lt;p&gt;And, although I do not know this for sure regarding this particular version of HDP, since I don&apos;t know the details of HDP, but vendors have been known to change the Hadoop version used to build HBase from the default. (smile) So even if we did accept responsibility for the S3 filesystem, even though most of us cannot commit changes to fix it, since it&apos;s not HBase code, we would also be accepting responsibility for a vendor munge of dependency versions.&lt;/p&gt;</comment>
                            <comment id="14394887" author="esteban" created="Fri, 3 Apr 2015 18:41:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Again, like with the discussion on Jackson, just because we have a dependency that gets packaged doesn&apos;t make it part of our API nor our problem to solve, especially if we don&apos;t have any S3 code in our own project.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I absolutely agree with you Andrew, what I&apos;m pointing out is that the issue has already been fixed in Hadoop and our recent HBase versions will use a  Hadoop version that has the fix, I&apos;m totally against of having to manage every single transient dependency specially if Hadoop hasn&apos;t even updated them. As you said thats lunacy.&lt;/p&gt;
</comment>
                            <comment id="14394894" author="apurtell" created="Fri, 3 Apr 2015 18:42:28 +0000"  >&lt;p&gt;Ok, &amp;lt;/rant&amp;gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 3 Apr 2015 18:00:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27rl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>