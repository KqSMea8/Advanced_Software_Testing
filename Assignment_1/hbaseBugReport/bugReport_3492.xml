<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3492/HBASE-3492.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3492] NPE while splitting table with empty column family store</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3492</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I did a simple test on trunk where I create a table (after wiping the local /tmp/hbase-&amp;lt;username&amp;gt;):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):001:0&amp;gt; create &apos;testtable&apos;, &apos;cf1&apos;, &apos;cf2&apos;                                                                                                  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I inserted 17k rows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):002:0&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in &apos;a&apos;..&apos;z&apos; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; j in &apos;a&apos;..&apos;z&apos; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; k in &apos;a&apos;..&apos;z&apos; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; put &apos;testtable&apos;, &lt;span class=&quot;code-quote&quot;&gt;&quot;row-#{i}#{j}#{k}&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;cf1:#{k}&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;#{k}&quot;&lt;/span&gt; end end end
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and called &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):003:0&amp;gt; split &apos;testttable&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the logs gave this NPE and &lt;em&gt;no&lt;/em&gt; split was performed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-01-31 10:06:38,534 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memstore flush &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testtable,,1296461957099.2528e23534565a83e2c8590d33f3a47c., current region memstore size 3.5m
2011-01-31 10:06:38,575 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Finished snapshotting, commencing flushing stores
2011-01-31 10:06:38,856 INFO org.apache.hadoop.hbase.regionserver.Store: Renaming flushed file at file:/tmp/hbase-larsgeorge/hbase/testtable/2528e23534565a83e2c8590d33f3a47c/.tmp/5265602271926296451 to file:/tmp/hbase-larsgeorge/hbase/testtable/2528e23534565a83e2c8590d33f3a47c/cf1/5349044325262044918
2011-01-31 10:06:38,861 INFO org.apache.hadoop.hbase.regionserver.Store: Added file:/tmp/hbase-larsgeorge/hbase/testtable/2528e23534565a83e2c8590d33f3a47c/cf1/5349044325262044918, entries=17576, sequenceid=17588, memsize=3.5m, filesize=549.9k
2011-01-31 10:06:38,863 INFO org.apache.hadoop.hbase.regionserver.HRegion: Finished memstore flush of ~3.5m &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region testtable,,1296461957099.2528e23534565a83e2c8590d33f3a47c. in 328ms, sequenceid=17588, compaction requested=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2011-01-31 10:06:38,869 INFO org.apache.hadoop.hbase.regionserver.HRegion: Starting compaction on region testtable,,1296461957099.2528e23534565a83e2c8590d33f3a47c.
2011-01-31 10:06:38,870 INFO org.apache.hadoop.hbase.regionserver.HRegion: aborted compaction on region testtable,,1296461957099.2528e23534565a83e2c8590d33f3a47c. after 0sec
2011-01-31 10:06:38,872 ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region testtable,,1296461957099.2528e23534565a83e2c8590d33f3a47c.
java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.Store.checkSplit(Store.java:1367)
        at org.apache.hadoop.hbase.regionserver.Store.compact(Store.java:633)
        at org.apache.hadoop.hbase.regionserver.HRegion.compactStores(HRegion.java:793)
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.run(CompactSplitThread.java:81)
2011-01-31 10:06:38,873 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction requested &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testtable,,1296461957099.2528e23534565a83e2c8590d33f3a47c. because User-triggered split; priority=1, compaction queue size=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I added a row with data in cf2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):005:0&amp;gt; put &apos;testtable&apos;, &apos;row1&apos;, &apos;cf2&apos;, &apos;test1&apos;                                                                                           
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the tried to split the table again like above and now it worked.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497184">HBASE-3492</key>
            <summary>NPE while splitting table with empty column family store</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="larsgeorge">Lars George</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Jan 2011 09:15:54 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:05 +0000</updated>
                            <resolved>Thu, 3 Feb 2011 11:36:12 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12988702" author="larsgeorge" created="Mon, 31 Jan 2011 09:22:36 +0000"  >&lt;p&gt;Hmm, after the split I tried to split again and got &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):011:0&amp;gt; split &apos;testtable&apos;

ERROR: org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hbase.NotServingRegionException: Region is not online: testtable,row-mdc,1296464923560.2ffc022de647c6b41552b971d067cbcf.
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2376)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.splitRegion(HRegionServer.java:2196)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:309)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1057)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the logs give the same NPE&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-01-31 10:18:43,598 INFO org.apache.hadoop.hbase.regionserver.HRegion: Starting compaction on region testtable,,1296464923560.4712495ddd39cae8c090348acc5d9aa7.
2011-01-31 10:18:43,598 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction requested &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testtable,,1296464923560.4712495ddd39cae8c090348acc5d9aa7. because User-triggered split; priority=1, compaction queue size=0
2011-01-31 10:18:43,598 INFO org.apache.hadoop.hbase.regionserver.HRegion: aborted compaction on region testtable,,1296464923560.4712495ddd39cae8c090348acc5d9aa7. after 0sec
2011-01-31 10:18:43,598 ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region testtable,,1296464923560.4712495ddd39cae8c090348acc5d9aa7.
java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.Store.checkSplit(Store.java:1367)
        at org.apache.hadoop.hbase.regionserver.Store.compact(Store.java:633)
        at org.apache.hadoop.hbase.regionserver.HRegion.compactStores(HRegion.java:793)
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.run(CompactSplitThread.java:81)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And as before, the region that failed had no store in &quot;cf2&quot; yet:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
larsgeorge@de1-app-mbp-2:~$ ll -R /tmp/hbase-larsgeorge/hbase/testtable/
total 0
drwxr-xr-x  5 larsgeorge  wheel  170 Jan 31 10:19 .
drwxr-xr-x  9 larsgeorge  wheel  306 Jan 31 09:19 ..
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:08 4712495ddd39cae8c090348acc5d9aa7
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:18 5f083c641da708244de17443b88d8df8
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:18 f3b822c1e31442a0de850d1c2aa5ccec

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//4712495ddd39cae8c090348acc5d9aa7:
&lt;/span&gt;total 16
drwxr-xr-x  7 larsgeorge  wheel   238 Jan 31 10:08 .
drwxr-xr-x  5 larsgeorge  wheel   170 Jan 31 10:19 ..
-rw-r--r--  1 larsgeorge  wheel    20 Jan 31 10:08 ..regioninfo.crc
-rwxrwxrwx  1 larsgeorge  wheel  1114 Jan 31 10:08 .regioninfo
drwxr-xr-x  2 larsgeorge  wheel    68 Jan 31 10:08 .tmp
drwxr-xr-x  4 larsgeorge  wheel   136 Jan 31 10:08 cf1
drwxr-xr-x  2 larsgeorge  wheel    68 Jan 31 10:08 cf2

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//4712495ddd39cae8c090348acc5d9aa7/.tmp:
&lt;/span&gt;total 0
drwxr-xr-x  2 larsgeorge  wheel   68 Jan 31 10:08 .
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:08 ..

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//4712495ddd39cae8c090348acc5d9aa7/cf1:
&lt;/span&gt;total 528
drwxr-xr-x  4 larsgeorge  wheel     136 Jan 31 10:08 .
drwxr-xr-x  7 larsgeorge  wheel     238 Jan 31 10:08 ..
-rw-r--r--  1 larsgeorge  wheel    2060 Jan 31 10:08 .6274767763783646503.crc
-rwxrwxrwx  1 larsgeorge  wheel  262639 Jan 31 10:08 6274767763783646503

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//4712495ddd39cae8c090348acc5d9aa7/cf2:
&lt;/span&gt;total 0
drwxr-xr-x  2 larsgeorge  wheel   68 Jan 31 10:08 .
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:08 ..

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//5f083c641da708244de17443b88d8df8:
&lt;/span&gt;total 16
drwxr-xr-x  7 larsgeorge  wheel   238 Jan 31 10:18 .
drwxr-xr-x  5 larsgeorge  wheel   170 Jan 31 10:19 ..
-rw-r--r--  1 larsgeorge  wheel    20 Jan 31 10:18 ..regioninfo.crc
-rwxrwxrwx  1 larsgeorge  wheel  1128 Jan 31 10:18 .regioninfo
drwxr-xr-x  2 larsgeorge  wheel    68 Jan 31 10:18 .tmp
drwxr-xr-x  4 larsgeorge  wheel   136 Jan 31 10:18 cf1
drwxr-xr-x  4 larsgeorge  wheel   136 Jan 31 10:18 cf2

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//5f083c641da708244de17443b88d8df8/.tmp:
&lt;/span&gt;total 0
drwxr-xr-x  2 larsgeorge  wheel   68 Jan 31 10:18 .
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:18 ..

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//5f083c641da708244de17443b88d8df8/cf1:
&lt;/span&gt;total 344
drwxr-xr-x  4 larsgeorge  wheel     136 Jan 31 10:18 .
drwxr-xr-x  7 larsgeorge  wheel     238 Jan 31 10:18 ..
-rw-r--r--  1 larsgeorge  wheel    1336 Jan 31 10:18 .6042144040116038351.crc
-rwxrwxrwx  1 larsgeorge  wheel  169667 Jan 31 10:18 6042144040116038351

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//5f083c641da708244de17443b88d8df8/cf2:
&lt;/span&gt;total 16
drwxr-xr-x  4 larsgeorge  wheel  136 Jan 31 10:18 .
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:18 ..
-rw-r--r--  1 larsgeorge  wheel   12 Jan 31 10:18 .1596755727779851952.crc
-rwxrwxrwx  1 larsgeorge  wheel  387 Jan 31 10:18 1596755727779851952

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//f3b822c1e31442a0de850d1c2aa5ccec:
&lt;/span&gt;total 16
drwxr-xr-x  7 larsgeorge  wheel   238 Jan 31 10:18 .
drwxr-xr-x  5 larsgeorge  wheel   170 Jan 31 10:19 ..
-rw-r--r--  1 larsgeorge  wheel    20 Jan 31 10:18 ..regioninfo.crc
-rwxrwxrwx  1 larsgeorge  wheel  1142 Jan 31 10:18 .regioninfo
drwxr-xr-x  2 larsgeorge  wheel    68 Jan 31 10:18 .tmp
drwxr-xr-x  4 larsgeorge  wheel   136 Jan 31 10:18 cf1
drwxr-xr-x  2 larsgeorge  wheel    68 Jan 31 10:18 cf2

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//f3b822c1e31442a0de850d1c2aa5ccec/.tmp:
&lt;/span&gt;total 0
drwxr-xr-x  2 larsgeorge  wheel   68 Jan 31 10:18 .
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:18 ..

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//f3b822c1e31442a0de850d1c2aa5ccec/cf1:
&lt;/span&gt;total 272
drwxr-xr-x  4 larsgeorge  wheel     136 Jan 31 10:18 .
drwxr-xr-x  7 larsgeorge  wheel     238 Jan 31 10:18 ..
-rw-r--r--  1 larsgeorge  wheel    1036 Jan 31 10:18 .2622660282527981793.crc
-rwxrwxrwx  1 larsgeorge  wheel  131479 Jan 31 10:18 2622660282527981793

/tmp/hbase-larsgeorge/hbase/testtable&lt;span class=&quot;code-comment&quot;&gt;//f3b822c1e31442a0de850d1c2aa5ccec/cf2:
&lt;/span&gt;total 0
drwxr-xr-x  2 larsgeorge  wheel   68 Jan 31 10:18 .
drwxr-xr-x  7 larsgeorge  wheel  238 Jan 31 10:18 ..
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12988705" author="larsgeorge" created="Mon, 31 Jan 2011 09:28:15 +0000"  >&lt;p&gt;During the NPE I also get a .META. like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):020:0&amp;gt; scan &apos;.META.&apos;, { COLUMNS =&amp;gt; [&apos;info:regioninfo&apos;] }
ROW                                       COLUMN+CELL                                                                                                            
 testtable,,1296464923560.4712495ddd39cae column=info:regioninfo, timestamp=1296464924169, value=REGION =&amp;gt; {NAME =&amp;gt; &apos;testtable,,1296464923560.4712495ddd39cae8c09
 8c090348acc5d9aa7.                       0348acc5d9aa7.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;row-mdc&apos;, ENCODED =&amp;gt; 4712495ddd39cae8c090348acc5d9aa7, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;
                                          testtable&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;cf1&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIO
                                          NS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;cf2&apos;, BLOO
                                          MFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; 
                                          &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}}                                                                
 testtable,row-mdc,1296465498825.f3b822c1 column=info:regioninfo, timestamp=1296465499372, value=REGION =&amp;gt; {NAME =&amp;gt; &apos;testtable,row-mdc,1296465498825.f3b822c1e314
 e31442a0de850d1c2aa5ccec.                42a0de850d1c2aa5ccec.&apos;, STARTKEY =&amp;gt; &apos;row-mdc&apos;, ENDKEY =&amp;gt; &apos;row-seq&apos;, ENCODED =&amp;gt; f3b822c1e31442a0de850d1c2aa5ccec, TABLE 
                                          =&amp;gt; {{NAME =&amp;gt; &apos;testtable&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;cf1&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; 
                                          &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}, {NAME 
                                          =&amp;gt; &apos;cf2&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;,
                                           BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}}                                                  
 testtable,row-seq,1296465498825.5f083c64 column=info:regioninfo, timestamp=1296465802030, value=REGION =&amp;gt; {NAME =&amp;gt; &apos;testtable,row-seq,1296465498825.5f083c641da7
 1da708244de17443b88d8df8.                08244de17443b88d8df8.&apos;, STARTKEY =&amp;gt; &apos;row-seq&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 5f083c641da708244de17443b88d8df8, OFFLINE =&amp;gt; tr
                                          ue, SPLIT =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;testtable&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;cf1&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOP
                                          E =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOC
                                          KCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;cf2&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; 
                                          &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}}                         
 testtable,row-seq,1296465801544.0b037fd8 column=info:regioninfo, timestamp=1296465802204, value=REGION =&amp;gt; {NAME =&amp;gt; &apos;testtable,row-seq,1296465801544.0b037fd873a9
 73a955a8b813736663a46deb.                55a8b813736663a46deb.&apos;, STARTKEY =&amp;gt; &apos;row-seq&apos;, ENDKEY =&amp;gt; &apos;row-vfk&apos;, ENCODED =&amp;gt; 0b037fd873a955a8b813736663a46deb, TABLE 
                                          =&amp;gt; {{NAME =&amp;gt; &apos;testtable&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;cf1&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; 
                                          &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}, {NAME 
                                          =&amp;gt; &apos;cf2&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;,
                                           BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}}                                                  
 testtable,row-vfk,1296465801544.cc8129ba column=info:regioninfo, timestamp=1296465802204, value=REGION =&amp;gt; {NAME =&amp;gt; &apos;testtable,row-vfk,1296465801544.cc8129ba713c
 713ce041892b784398647372.                e041892b784398647372.&apos;, STARTKEY =&amp;gt; &apos;row-vfk&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; cc8129ba713ce041892b784398647372, TABLE =&amp;gt; {{NA
                                          ME =&amp;gt; &apos;testtable&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;cf1&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;,
                                           VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;cf2
                                          &apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKS
                                          IZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}}                                                         
5 row(s) in 0.1060 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the wrong endkey where the NPE struck. Messy!&lt;/p&gt;</comment>
                            <comment id="12988709" author="larsgeorge" created="Mon, 31 Jan 2011 09:44:52 +0000"  >&lt;p&gt;The above gets eventually cleaned up by the master as it sees the references and performs the cleanup, so that borked line disappears and you can run &quot;split&quot; again, just to trigger a new NPE while waiting for the master to clean up the mess once again.&lt;/p&gt;</comment>
                            <comment id="12988710" author="larsgeorge" created="Mon, 31 Jan 2011 09:49:17 +0000"  >&lt;p&gt;Checking the Store.java code the issue is obvious:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      StoreFile largestSf = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (StoreFile sf : storefiles) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (splitable) {
          splitable = !sf.isReference();
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!splitable) {
            &lt;span class=&quot;code-comment&quot;&gt;// RETURN IN MIDDLE OF FUNCTION!!! If not splitable, just &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;.
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
              LOG.debug(sf +  &lt;span class=&quot;code-quote&quot;&gt;&quot; is not splittable&quot;&lt;/span&gt;);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
          }
        }
        StoreFile.Reader r = sf.getReader();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (r == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Storefile &quot;&lt;/span&gt; + sf + &lt;span class=&quot;code-quote&quot;&gt;&quot; Reader is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; size = r.length();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (size &amp;gt; maxSize) {
          &lt;span class=&quot;code-comment&quot;&gt;// This is the largest one so far
&lt;/span&gt;          maxSize = size;
          largestSf = sf;
        }
      }
      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the user explicit set a split point, use that
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.region.getSplitPoint() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StoreSize(maxSize, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.region.getSplitPoint());
      }
      StoreFile.Reader r = largestSf.getReader();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;largestSf&quot; is never assigned. Needs a simple extra &quot;if&quot; to guard. Any objections to fix this trivial issue without a review (but I will test it first obviously)?&lt;/p&gt;</comment>
                            <comment id="12988717" author="larsgeorge" created="Mon, 31 Jan 2011 10:12:39 +0000"  >&lt;p&gt;Patch swaps &quot;sanity checks&quot; to be sane.&lt;/p&gt;</comment>
                            <comment id="12988816" author="streamy" created="Mon, 31 Jan 2011 17:53:26 +0000"  >&lt;p&gt;This sounds like something we should have a unit test for.&lt;/p&gt;</comment>
                            <comment id="12988956" author="stack" created="Mon, 31 Jan 2011 23:24:29 +0000"  >&lt;p&gt;No objection from me Lars (Test as JG says would be nice).&lt;/p&gt;</comment>
                            <comment id="12989078" author="larsgeorge" created="Tue, 1 Feb 2011 07:37:15 +0000"  >&lt;p&gt;Let me look into creating a test, I agree this makes sense.&lt;/p&gt;</comment>
                            <comment id="12989090" author="larsgeorge" created="Tue, 1 Feb 2011 08:26:43 +0000"  >&lt;p&gt;Adds a simple test.&lt;/p&gt;</comment>
                            <comment id="12989091" author="larsgeorge" created="Tue, 1 Feb 2011 08:27:49 +0000"  >&lt;p&gt;I added a simple test that I checked against before and after and indeed it NPEs before while passes with the simple &quot;if&quot; rearrangements in place. Can I commit this?&lt;/p&gt;</comment>
                            <comment id="12989518" author="stack" created="Wed, 2 Feb 2011 05:25:40 +0000"  >&lt;p&gt;Patch looks good Lars.  +1 on commit to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="12989536" author="larsgeorge" created="Wed, 2 Feb 2011 07:10:36 +0000"  >&lt;p&gt;I checked and 0.90 branch was OK! This is a regression introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3437&quot; title=&quot;Allow Explicit Splits from the Shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3437&quot;&gt;&lt;del&gt;HBASE-3437&lt;/del&gt;&lt;/a&gt; into trunk. While it is good to add the test, I am wondering how we undo regressions? Could someone advise? Should I create a patch for the branch just with the test (which is not really needed there as a) branch is only for bugfixes and b) the code is correct there anyways) and another reverting the change plus the test for trunk (which is what the attached patch v2 is actually)?&lt;/p&gt;</comment>
                            <comment id="12989681" author="stack" created="Wed, 2 Feb 2011 15:52:10 +0000"  >&lt;p&gt;I&apos;d say just do the latter Lars.  There&apos;s already enough work to do (Good one finding its not broke in branch).&lt;/p&gt;</comment>
                            <comment id="12990062" author="larsgeorge" created="Thu, 3 Feb 2011 11:36:12 +0000"  >&lt;p&gt;I just committed this to trunk. Branch 0.90 is (still) OK as noted above.&lt;/p&gt;</comment>
                            <comment id="12990125" author="hudson" created="Thu, 3 Feb 2011 15:24:47 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1731 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1731/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1731/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3492&quot; title=&quot;NPE while splitting table with empty column family store&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3492&quot;&gt;&lt;del&gt;HBASE-3492&lt;/del&gt;&lt;/a&gt;  NPE while splitting table with empty column family store&lt;/p&gt;</comment>
                            <comment id="15017154" author="lars_francke" created="Fri, 20 Nov 2015 12:42:05 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469900" name="HBASE-3492-v2-with-test.patch" size="4134" author="larsgeorge" created="Tue, 1 Feb 2011 08:26:43 +0000"/>
                            <attachment id="12469810" name="HBASE-3492.patch" size="723" author="larsgeorge" created="Mon, 31 Jan 2011 10:12:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 31 Jan 2011 17:53:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26888</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100903</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>