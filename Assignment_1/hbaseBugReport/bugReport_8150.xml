<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:52:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8150/HBASE-8150.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8150] server should not produce RAITE for already-opening region in 0.94 (because master retry logic handles this case poorly)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8150</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The code in 0.94 AM sets the region plan to point to the same server when retrying the assignment due to RAITE.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed assignment of &quot;&lt;/span&gt;
            + state.getRegion().getRegionNameAsString()
            + &lt;span class=&quot;code-quote&quot;&gt;&quot; to &quot;&lt;/span&gt;
            + plan.getDestination()
            + &lt;span class=&quot;code-quote&quot;&gt;&quot;, trying to assign &quot;&lt;/span&gt;
            + (regionAlreadyInTransitionException ? &lt;span class=&quot;code-quote&quot;&gt;&quot;to the same region server&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot; because of RegionAlreadyInTransitionException;&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;elsewhere instead; &quot;&lt;/span&gt;)
            + &lt;span class=&quot;code-quote&quot;&gt;&quot;retry=&quot;&lt;/span&gt; + i, t);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, there&apos;s no wait time in the loop that retries the assignment, and if region is being marked failed to open, which may take some time, master can easily exhaust retries in less than half a second, going to the same server every time and getting the same exception (unfortunately I no longer have logs); then the region will be stuck.&lt;/p&gt;

&lt;p&gt;Do you think this is worth fixing (for example, by not using the same server here after a few retries, or by adding timed backoff in such cases)?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12637869">HBASE-8150</key>
            <summary>server should not produce RAITE for already-opening region in 0.94 (because master retry logic handles this case poorly)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Mar 2013 00:44:29 +0000</created>
                <updated>Sat, 27 Apr 2013 15:55:14 +0000</updated>
                            <resolved>Mon, 8 Apr 2013 18:28:20 +0000</resolved>
                                    <version>0.94.6</version>
                                    <fixVersion>0.94.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13607113" author="sershe" created="Wed, 20 Mar 2013 00:45:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; what do you guys think?&lt;/p&gt;</comment>
                            <comment id="13607208" author="zjushch" created="Wed, 20 Mar 2013 03:09:26 +0000"  >&lt;p&gt;Agree with adding some sleep time,&lt;/p&gt;

&lt;p&gt;but we should use the same server, else there&apos;s a risk of multi-assign&lt;/p&gt;</comment>
                            <comment id="13607216" author="ram_krish" created="Wed, 20 Mar 2013 03:30:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Agree with adding some sleep time,&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This may be needed but trying on same server is going to prevent multi-assign.  Same as what Chunhui says.&lt;/p&gt;</comment>
                            <comment id="13607251" author="zjushch" created="Wed, 20 Mar 2013 04:02:21 +0000"  >&lt;p&gt;In fact, I think there is no need to throw RegionAlreadyInTransitionException since master will assign to the same regionserver.&lt;/p&gt;

&lt;p&gt;Logging a message in regionserver is enough. And master consider it as a successful RPC&lt;/p&gt;</comment>
                            <comment id="13607254" author="ram_krish" created="Wed, 20 Mar 2013 04:05:59 +0000"  >&lt;p&gt;You mean differentiate RegionAlreadyInTransitionException  with normal operations thro successful RPC only.&lt;br/&gt;
Currently we return two things ALREADY_OPENED and FAILED_OPENING based on the condition.&lt;br/&gt;
You mean add another return type ?&lt;/p&gt;</comment>
                            <comment id="13607258" author="zjushch" created="Wed, 20 Mar 2013 04:13:00 +0000"  >&lt;p&gt;We could return OPENED for the case RegionAlreadyInTransitionException.&lt;/p&gt;</comment>
                            <comment id="13607261" author="zjushch" created="Wed, 20 Mar 2013 04:14:55 +0000"  >&lt;p&gt;Trunk has already done as the above&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.TRUE.equals(previous)) {
          &lt;span class=&quot;code-comment&quot;&gt;// An open is in progress. This is supported, but let&apos;s log &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.
&lt;/span&gt;          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Receiving OPEN &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the region:&quot;&lt;/span&gt; +
              region.getRegionNameAsString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; , which we are already trying to OPEN&quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot; - ignoring &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; request &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region.&quot;&lt;/span&gt;);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in 0.94 branch, we could also ignore the RegionAlreadyInTransitionException , not throw it to master&lt;/p&gt;</comment>
                            <comment id="13607700" author="jxiang" created="Wed, 20 Mar 2013 15:16:19 +0000"  >&lt;p&gt;In trunk, we hold a little before retry in this case.&lt;/p&gt;</comment>
                            <comment id="13607885" author="sershe" created="Wed, 20 Mar 2013 17:25:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;We could return OPENED for the case RegionAlreadyInTransitionException.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It can actually happen during transition to failed_open, the thread only sees region in rits, it doesn&apos;t know what open handler is doing.&lt;br/&gt;
Wouldn&apos;t region be stuck in this case if master assumes server will finish the assignment?&lt;/p&gt;</comment>
                            <comment id="13607901" author="rajesh23" created="Wed, 20 Mar 2013 17:37:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;In fact, I think there is no need to throw RegionAlreadyInTransitionException since master will assign to the same regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Its good IMO. Still if master gets RAITE when region is closing then we need to retry after some time.&lt;/p&gt;</comment>
                            <comment id="13607939" author="rajesh23" created="Wed, 20 Mar 2013 18:10:50 +0000"  >&lt;p&gt;Sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; didnt see your comment. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;It can actually happen during transition to failed_open, the thread only sees region in rits, it doesn&apos;t know what open handler is doing. Wouldn&apos;t region be stuck in this case if master assumes server will finish the assignment?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;transition to failed open will fail with version mismatch and second open starts transitioning. It wont be stuck.&lt;/p&gt;</comment>
                            <comment id="13607944" author="jxiang" created="Wed, 20 Mar 2013 18:12:31 +0000"  >&lt;p&gt;If the region is transitioning to OPEN state, I think it is ok to return OPENED.  If it is transitioning to CLOSE state, we should return RAITE.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Wouldn&apos;t region be stuck in this case if master assumes server will finish the assignment?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If the region is transitioning to failed_open, the master will retry after get the ZK event.&lt;/p&gt;</comment>
                            <comment id="13608161" author="sershe" created="Wed, 20 Mar 2013 20:38:49 +0000"  >&lt;p&gt;Hmm... too bad I cannot repro. Yeah, maybe in my case it got stuck because after RAITE master hijacks the node again, so assignment on the same server will fail too and then if master exhausts retries before this region indicates that, all will fail.&lt;br/&gt;
I will try to come up with a patch this week.&lt;/p&gt;</comment>
                            <comment id="13613212" author="sershe" created="Mon, 25 Mar 2013 22:03:32 +0000"  >&lt;p&gt;Patch for 94&lt;/p&gt;</comment>
                            <comment id="13613220" author="hadoopqa" created="Mon, 25 Mar 2013 22:12:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12575406/HBASE-8150-v0-094.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12575406/HBASE-8150-v0-094.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5001//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5001//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13613383" author="sershe" created="Tue, 26 Mar 2013 01:30:00 +0000"  >&lt;p&gt;tests pass on local&lt;/p&gt;</comment>
                            <comment id="13621711" author="lhofhansl" created="Thu, 4 Apr 2013 03:31:30 +0000"  >&lt;p&gt;Looks good. +1&lt;/p&gt;</comment>
                            <comment id="13622992" author="lhofhansl" created="Thu, 4 Apr 2013 23:34:48 +0000"  >&lt;p&gt;Everybody else happy with this?&lt;/p&gt;</comment>
                            <comment id="13623090" author="sershe" created="Thu, 4 Apr 2013 23:57:57 +0000"  >&lt;p&gt;Not sure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; My machine doesn&apos;t have bandwidth to run test suites for all things I need to commit, I will get to it eventually. Are you cutting an RC?&lt;/p&gt;</comment>
                            <comment id="13623104" author="lhofhansl" created="Fri, 5 Apr 2013 00:17:36 +0000"  >&lt;p&gt;Nope, not yet, no haste. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
But it might be prudent to move this to 0.94.8 then.&lt;/p&gt;</comment>
                            <comment id="13624233" author="hudson" created="Sat, 6 Apr 2013 00:35:18 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #948 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/948/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/948/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8150&quot; title=&quot;server should not produce RAITE for already-opening region in 0.94 (because master retry logic handles this case poorly)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8150&quot;&gt;&lt;del&gt;HBASE-8150&lt;/del&gt;&lt;/a&gt; server should not produce RAITE for already-opening region in 0.94 (because master retry logic handles this case poorly) (Revision 1465063)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
sershe : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedOpenCloseRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13625640" author="sershe" created="Mon, 8 Apr 2013 18:28:48 +0000"  >&lt;p&gt;Hmm... was 0.94.7 already cut or should this be moved back into it?&lt;/p&gt;</comment>
                            <comment id="13625841" author="lhofhansl" created="Mon, 8 Apr 2013 21:24:53 +0000"  >&lt;p&gt;All good, just moving it back into 0.94.7.&lt;/p&gt;</comment>
                            <comment id="13626341" author="hudson" created="Tue, 9 Apr 2013 07:33:23 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #133 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/133/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/133/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8150&quot; title=&quot;server should not produce RAITE for already-opening region in 0.94 (because master retry logic handles this case poorly)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8150&quot;&gt;&lt;del&gt;HBASE-8150&lt;/del&gt;&lt;/a&gt; server should not produce RAITE for already-opening region in 0.94 (because master retry logic handles this case poorly) (Revision 1465063)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
sershe : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedOpenCloseRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12575406" name="HBASE-8150-v0-094.patch" size="4297" author="sershe" created="Mon, 25 Mar 2013 22:03:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Mar 2013 03:09:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318349</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ixif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318690</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>