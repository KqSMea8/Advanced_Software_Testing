<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:50:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7944/HBASE-7944.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7944] Replication leaks file reader resource &amp; not reset currentNbOperations</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7944</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When I trace test case TestReplicationQueueFailover, I found current replication logic has two following issues:&lt;/p&gt;

&lt;p&gt;1) leak file reader when finishing read a file in function finishCurrentFile&lt;br/&gt;
2) never reset currentNbOperations(this can be seen in the attached error log) such as &quot;currentNbOperations:12655 and seenEntries:0 and size: 0&quot; inconsistant info. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12634292">HBASE-7944</key>
            <summary>Replication leaks file reader resource &amp; not reset currentNbOperations</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12625485">HBASE-7458</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeffreyz">Jeffrey Zhong</assignee>
                                    <reporter username="jeffreyz">Jeffrey Zhong</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Feb 2013 21:24:53 +0000</created>
                <updated>Fri, 5 Apr 2013 01:00:49 +0000</updated>
                            <resolved>Tue, 5 Mar 2013 22:50:04 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.6</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13587612" author="jeffreyz" created="Tue, 26 Feb 2013 21:59:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt;Could you please review the changes? Thanks.&lt;/p&gt;</comment>
                            <comment id="13587613" author="stack" created="Tue, 26 Feb 2013 22:00:56 +0000"  >&lt;p&gt;+1 on patch.  This is 0.94 too right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13587632" author="jeffreyz" created="Tue, 26 Feb 2013 22:07:00 +0000"  >&lt;p&gt;@Stack, Thanks for reviewing! Yes, the same issues happen in 0.94 as well. I can port the fix back to 0.94 branch once it gets committed into trunk.&lt;/p&gt;</comment>
                            <comment id="13587712" author="hadoopqa" created="Tue, 26 Feb 2013 23:07:06 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12571065/hbase-7944.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12571065/hbase-7944.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.TestHBaseFsck&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4561//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13587750" author="jdcryans" created="Tue, 26 Feb 2013 23:55:01 +0000"  >&lt;p&gt;+1 patch looks good, have you run the TestReplication* tests a bunch of times to see if it&apos;s still passing?&lt;/p&gt;</comment>
                            <comment id="13587877" author="jeffreyz" created="Wed, 27 Feb 2013 02:02:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt; Thanks for reviewing! Yes, I did run the TestReplication* a few times sequentially without any failures.(assuming &quot;export MAVEN_OPTS=-Xmx1024m&quot; has been run firstly)&lt;/p&gt;</comment>
                            <comment id="13588575" author="jeffreyz" created="Wed, 27 Feb 2013 18:13:07 +0000"  >&lt;p&gt;Attach patch for 0.94 branch as well.&lt;/p&gt;</comment>
                            <comment id="13588582" author="hadoopqa" created="Wed, 27 Feb 2013 18:22:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12571235/0.94.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12571235/0.94.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4581//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4581//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13588593" author="yuzhihong@gmail.com" created="Wed, 27 Feb 2013 18:30:56 +0000"  >&lt;p&gt;Integrated to 0.95 and trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Jeffrey.&lt;/p&gt;

&lt;p&gt;Thanks for the reviews, Stack and J-D.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;:&lt;br/&gt;
Do you want to take a look at 0.94 patch ?&lt;/p&gt;</comment>
                            <comment id="13588945" author="hudson" created="Thu, 28 Feb 2013 00:08:42 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #6 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/6/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/6/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1450902)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13589045" author="hudson" created="Thu, 28 Feb 2013 01:42:54 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3904 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3904/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3904/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1450901)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13589198" author="hudson" created="Thu, 28 Feb 2013 05:13:52 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #423 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/423/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/423/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1450901)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13589204" author="lhofhansl" created="Thu, 28 Feb 2013 05:21:32 +0000"  >&lt;p&gt;Looks good. +1 for 0.94&lt;/p&gt;

&lt;p&gt;The only question I have is: Why haven&apos;t we seen issues from currentNbOperations not being reset (beyond the strange log message)?&lt;/p&gt;</comment>
                            <comment id="13589213" author="hudson" created="Thu, 28 Feb 2013 05:29:12 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #3 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/3/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/3/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1450902)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13589216" author="yuzhihong@gmail.com" created="Thu, 28 Feb 2013 05:32:45 +0000"  >&lt;p&gt;Integrated to 0.94 as well.&lt;/p&gt;</comment>
                            <comment id="13589270" author="hudson" created="Thu, 28 Feb 2013 06:59:41 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #869 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/869/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/869/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1451100)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13589294" author="hudson" created="Thu, 28 Feb 2013 07:32:19 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #113 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/113/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/113/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1451100)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13589761" author="jeffreyz" created="Thu, 28 Feb 2013 18:30:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; For your question: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Why haven&apos;t we seen issues from currentNbOperations not being reset (beyond the strange log message)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;currentNbOperations only affects the metrics &quot;shippedOpsRate&quot; beside log. I guess no one pays attention to that metrics yet.&lt;/p&gt;</comment>
                            <comment id="13589789" author="lhofhansl" created="Thu, 28 Feb 2013 18:46:44 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ivarley&quot; class=&quot;user-hover&quot; rel=&quot;ivarley&quot;&gt;Ian Varley&lt;/a&gt; I remember you mentioning that you found some of the replication metrics off. Is this one of them?&lt;/p&gt;</comment>
                            <comment id="13589898" author="ivarley" created="Thu, 28 Feb 2013 20:30:42 +0000"  >&lt;p&gt;Yup. This is also reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6624&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-6624&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13592789" author="jeffreyz" created="Mon, 4 Mar 2013 23:23:15 +0000"  >&lt;p&gt;In the trunk, we found even test case pass while it throws NullPointerException.&lt;/p&gt;

&lt;p&gt;The issue is triggered by the last check in where we set internal reader to null after we close the reader inside function repLogReader.closeReader(). The root cause is an old issue that we don&apos;t reset this.reader when we close repLogReader.&lt;/p&gt;

&lt;p&gt;More details can be seen at hbase-7982.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Jeffrey&lt;/p&gt;</comment>
                            <comment id="13592821" author="lhofhansl" created="Tue, 5 Mar 2013 00:00:27 +0000"  >&lt;p&gt;This is only an issue in trunk?&lt;/p&gt;</comment>
                            <comment id="13592828" author="jeffreyz" created="Tue, 5 Mar 2013 00:04:11 +0000"  >&lt;p&gt;This will happen in 0.94 as well because tests pass so it covers the error.&lt;/p&gt;</comment>
                            <comment id="13592849" author="yuzhihong@gmail.com" created="Tue, 5 Mar 2013 00:28:07 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
           &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.repLogReader.closeReader();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should reader.close() be called before reader is set to null.&lt;/p&gt;</comment>
                            <comment id="13592867" author="jeffreyz" created="Tue, 5 Mar 2013 00:47:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; Set this.reader = null before closeReader so if closeReader fails to close and the next loop can recreate the reader(by function openReader) instead of potentially reusing it, which could trigger other issues. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Jeffrey&lt;/p&gt;</comment>
                            <comment id="13592916" author="lhofhansl" created="Tue, 5 Mar 2013 01:36:58 +0000"  >&lt;p&gt;OK, reopening, so I won&apos;t miss that this is still open.&lt;/p&gt;</comment>
                            <comment id="13592917" author="lhofhansl" created="Tue, 5 Mar 2013 01:37:39 +0000"  >&lt;p&gt;+1 on addendum&lt;/p&gt;</comment>
                            <comment id="13592951" author="lhofhansl" created="Tue, 5 Mar 2013 02:03:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; Are you Ok with the addendum?&lt;/p&gt;</comment>
                            <comment id="13592973" author="yuzhihong@gmail.com" created="Tue, 5 Mar 2013 02:29:26 +0000"  >&lt;p&gt;I haven&apos;t run related tests yet.&lt;br/&gt;
I give tentative +1&lt;/p&gt;</comment>
                            <comment id="13592989" author="jeffreyz" created="Tue, 5 Mar 2013 03:00:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt; Could you please take one more look as well? Thanks in advance! &lt;/p&gt;</comment>
                            <comment id="13593154" author="hudson" created="Tue, 5 Mar 2013 07:52:07 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #12 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Replication leaks file reader resource &amp;amp; not reset currentNbOperations (Jeffrey Zhong) (Revision 1451100)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593983" author="lhofhansl" created="Tue, 5 Mar 2013 22:09:02 +0000"  >&lt;p&gt;For 0.94.6 we either have commit the addendum or back out the already committed portion.&lt;br/&gt;
I don&apos;t want a half feature in an official release... Need to decide to today.&lt;/p&gt;</comment>
                            <comment id="13593993" author="jeffreyz" created="Tue, 5 Mar 2013 22:16:49 +0000"  >&lt;p&gt;I think we should check in the addendum since the fix is trivial and we don&apos;t have test replication cases failures.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Jeffrey&lt;/p&gt;</comment>
                            <comment id="13594032" author="jdcryans" created="Tue, 5 Mar 2013 22:34:53 +0000"  >&lt;p&gt;+1 looks good.&lt;/p&gt;

&lt;p&gt;Seems like the refactoring I did in the context of making HLog compression work with replication didn&apos;t really simplify the handling of switching the reader...&lt;/p&gt;</comment>
                            <comment id="13594046" author="lhofhansl" created="Tue, 5 Mar 2013 22:46:39 +0000"  >&lt;p&gt;Trunk addendum&lt;/p&gt;</comment>
                            <comment id="13594050" author="lhofhansl" created="Tue, 5 Mar 2013 22:50:04 +0000"  >&lt;p&gt;Committed addendum to all branches.&lt;/p&gt;</comment>
                            <comment id="13594100" author="hudson" created="Tue, 5 Mar 2013 23:39:33 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3916 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3916/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3916/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453059)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13594151" author="hudson" created="Wed, 6 Mar 2013 00:31:02 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #27 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/27/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/27/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453062)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13594225" author="hudson" created="Wed, 6 Mar 2013 01:50:20 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #431 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/431/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/431/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453059)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13594231" author="hudson" created="Wed, 6 Mar 2013 01:57:03 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #882 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/882/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/882/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453064)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13594239" author="hudson" created="Wed, 6 Mar 2013 02:02:00 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #12 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453062)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13594325" author="hudson" created="Wed, 6 Mar 2013 03:52:43 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #117 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/117/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/117/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453064)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13623153" author="hudson" created="Fri, 5 Apr 2013 01:00:49 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #13 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; Addendum (Jeffrey Zhong) (Revision 1453064)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12571235" name="0.94.patch" size="1541" author="jeffreyz" created="Wed, 27 Feb 2013 18:13:07 +0000"/>
                            <attachment id="12572188" name="7944-addendum-trunk.txt" size="1413" author="lhofhansl" created="Tue, 5 Mar 2013 22:46:39 +0000"/>
                            <attachment id="12571983" name="hbase-7944-addendum-fix-0.patch" size="1462" author="jeffreyz" created="Mon, 4 Mar 2013 23:23:15 +0000"/>
                            <attachment id="12571065" name="hbase-7944.patch" size="1665" author="jeffreyz" created="Tue, 26 Feb 2013 21:28:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Feb 2013 22:00:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314785</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ibjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>