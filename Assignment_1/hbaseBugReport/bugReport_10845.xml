<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:17:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10845/HBASE-10845.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10845] Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback()</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10845</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In DefaultMemStore#rollback() :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (found != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; found.getMvccVersion() == kv.getMvccVersion()) {
       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.snapshot.remove(kv);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;this.snapshotSize should be updated in case of rollback.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12703863">HBASE-10845</key>
            <summary>Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Mar 2014 23:55:13 +0000</created>
                <updated>Mon, 28 Apr 2014 22:29:36 +0000</updated>
                            <resolved>Tue, 15 Apr 2014 17:02:25 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>0.94.19</fixVersion>
                    <fixVersion>0.98.2</fixVersion>
                    <fixVersion>0.96.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13948827" author="stack" created="Thu, 27 Mar 2014 03:17:19 +0000"  >&lt;p&gt;How was the code before we moved to the MemStore Interface?  Is this an oversight that was always there or just an oversight refactoring to fit the Interface?&lt;/p&gt;</comment>
                            <comment id="13948834" author="yuzhihong@gmail.com" created="Thu, 27 Mar 2014 03:34:44 +0000"  >&lt;p&gt;This issue existed before MemStore Interface refactoring.&lt;/p&gt;</comment>
                            <comment id="13948847" author="anoop.hbase" created="Thu, 27 Mar 2014 03:54:14 +0000"  >&lt;p&gt;Thanks for the patch Ted. +1&lt;br/&gt;
Pls give a patch for 94 also.  The getFlushableSize() went into 94 also.&lt;/p&gt;</comment>
                            <comment id="13948848" author="lhofhansl" created="Thu, 27 Mar 2014 03:55:11 +0000"  >&lt;p&gt;Yep. Also exists in 0.94.&lt;/p&gt;</comment>
                            <comment id="13948851" author="hadoopqa" created="Thu, 27 Mar 2014 03:59:01 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12637055/10845-v1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12637055/10845-v1.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12637055&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 6 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9106//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13948852" author="stack" created="Thu, 27 Mar 2014 03:59:44 +0000"  >&lt;p&gt;-1 until this has a test &amp;#8211; a test that proves we are doing the math wrong (we&apos;ve been trying to build up coverage around the memstore sizing to catch the weird cases and to guard against regressions).&lt;/p&gt;</comment>
                            <comment id="13948883" author="yuzhihong@gmail.com" created="Thu, 27 Mar 2014 04:43:27 +0000"  >&lt;p&gt;Patch v2 with a new test for verifying flushable size.&lt;br/&gt;
Without the fix, we would see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: flushable size should be zero, but it is 160
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.assertTrue(Assert.java:41)
	at org.apache.hadoop.hbase.regionserver.TestRegionServerCoprocessorException.testExceptionFromCoprocessorDuringPostBatchMutate(TestRegionServerCoprocessorException.java:139)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The patch includes Devaraj&apos;s fix - will remove the change in HRegion.java once that fix is checked in.&lt;/p&gt;</comment>
                            <comment id="13948911" author="stack" created="Thu, 27 Mar 2014 05:25:19 +0000"  >&lt;p&gt;How does it make sense having a test for memstore size calculation in TestRegionServerCoprocessorException.testExceptionFromCoprocessorDuringPostBatchMutate ?&lt;/p&gt;</comment>
                            <comment id="13948938" author="hadoopqa" created="Thu, 27 Mar 2014 06:29:28 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12637091/10845-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12637091/10845-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12637091&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 6 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9107//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13948949" author="ram_krish" created="Thu, 27 Mar 2014 06:41:30 +0000"  >&lt;p&gt;+1 on the patch. Good catch.&lt;/p&gt;</comment>
                            <comment id="13949574" author="devaraj" created="Thu, 27 Mar 2014 16:55:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;How does it make sense having a test for memstore size calculation in TestRegionServerCoprocessorException.testExceptionFromCoprocessorDuringPostBatchMutate ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah.. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;, do remove the changes addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10844&quot; title=&quot;Coprocessor failure during batchmutation leaves the memstore datastructs in an inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10844&quot;&gt;&lt;del&gt;HBASE-10844&lt;/del&gt;&lt;/a&gt; from this patch. Let&apos;s not mix up the issues.&lt;/p&gt;</comment>
                            <comment id="13967390" author="lhofhansl" created="Sat, 12 Apr 2014 04:21:08 +0000"  >&lt;p&gt;Where are we with this? Seems important.&lt;/p&gt;</comment>
                            <comment id="13967394" author="yuzhihong@gmail.com" created="Sat, 12 Apr 2014 04:29:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;:&lt;br/&gt;
What do you think of patch v2 ?&lt;/p&gt;</comment>
                            <comment id="13967397" author="anoop.hbase" created="Sat, 12 Apr 2014 04:38:32 +0000"  >&lt;p&gt;The code changes looks fine. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;How does it make sense having a test for memstore size calculation in TestRegionServerCoprocessorException.testExceptionFromCoprocessorDuringPostBatchMutate &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;  failing cp is way by which we can make the rollback to get triggered.  Another way can be making a HLog sync() call to fail.    Ted can we put the test in TestHRegion some way with a custom CP loaded for the region? I guess this will be bit difficult.&lt;/p&gt;</comment>
                            <comment id="13967399" author="yuzhihong@gmail.com" created="Sat, 12 Apr 2014 04:44:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;put the test in TestHRegion some way with a custom CP loaded for the region?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I tried that approach first - didn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="13967681" author="lhofhansl" created="Sat, 12 Apr 2014 23:27:49 +0000"  >&lt;p&gt;v2 contains &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10844&quot; title=&quot;Coprocessor failure during batchmutation leaves the memstore datastructs in an inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10844&quot;&gt;&lt;del&gt;HBASE-10844&lt;/del&gt;&lt;/a&gt;, which I think is not correct (see my comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10844&quot; title=&quot;Coprocessor failure during batchmutation leaves the memstore datastructs in an inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10844&quot;&gt;&lt;del&gt;HBASE-10844&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
Don&apos;t really care how we name the test.&lt;/p&gt;</comment>
                            <comment id="13967688" author="lhofhansl" created="Sat, 12 Apr 2014 23:47:26 +0000"  >&lt;p&gt;Also, see testSharedData that I added to TestCoprocessorInterface a while back for a more &quot;unity&quot; way to test this.&lt;/p&gt;</comment>
                            <comment id="13967727" author="stack" created="Sun, 13 Apr 2014 04:20:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;I tried that approach first - didn&apos;t work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What did you try?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Lars Hofhansl: What do you think of patch v2 ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You have a -1 on the v2 and two other reviewers ask you change (DD and Anoop) it but still you petition another reviewer to entertain v2?  That might not be a good course of action.&lt;/p&gt;

</comment>
                            <comment id="13967735" author="yuzhihong@gmail.com" created="Sun, 13 Apr 2014 05:00:32 +0000"  >&lt;p&gt;I started with adding test in TestHRegion by setting up a custom RegionObserver:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    conf.set(CoprocessorHost.REGION_COPROCESSOR_CONF_KEY,
+        BuggyRegionObserver.class.getName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However the RegionObserver methods weren&apos;t called - RegionCoprocessorHost doesn&apos;t come into play in the context of TestHRegion.&lt;/p&gt;

&lt;p&gt;Let me take a look at TestCoprocessorInterface which Lars mentioned.&lt;/p&gt;</comment>
                            <comment id="13967955" author="yuzhihong@gmail.com" created="Sun, 13 Apr 2014 22:05:03 +0000"  >&lt;p&gt;In patch v3, I introduced FaultyHLog in org.apache.hadoop.hbase.regionserver.wal package so that TestHRegion can get to FSHLog.&lt;/p&gt;

&lt;p&gt;The new test would fail without fix in DefaultMemStore:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: flushable size should be zero, but it is 208
  at org.junit.Assert.fail(Assert.java:88)
  at org.junit.Assert.assertTrue(Assert.java:41)
  at org.apache.hadoop.hbase.regionserver.TestHRegion.testMemstoreSnapshotSize(TestHRegion.java:286)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13967990" author="hadoopqa" created="Sun, 13 Apr 2014 23:59:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12639995/10845-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12639995/10845-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12639995&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.mapreduce.TestTableMapReduceBase.testMultiRegionTable(TestTableMapReduceBase.java:96)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9273//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13968088" author="lhofhansl" created="Mon, 14 Apr 2014 05:27:58 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;This should be in 0.94 as well. Wanna make an 0.94 patch, Ted? If not, I&apos;ll create one.&lt;/p&gt;</comment>
                            <comment id="13968093" author="anoop.hbase" created="Mon, 14 Apr 2014 05:39:08 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    region.close();
+    HRegion.closeHRegion(region);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;HRegion.closeHRegion(region); -&amp;gt; Should be enough which will internally do region close.  Pls correct on commit.&lt;/p&gt;</comment>
                            <comment id="13968489" author="hadoopqa" created="Mon, 14 Apr 2014 16:20:47 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12640069/10845-v4.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12640069/10845-v4.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12640069&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9276//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13968626" author="hadoopqa" created="Mon, 14 Apr 2014 18:26:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12640098/10845-0.98.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12640098/10845-0.98.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12640098&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9280//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9280//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13968972" author="yuzhihong@gmail.com" created="Mon, 14 Apr 2014 23:05:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;:&lt;br/&gt;
Do you have more comments ?&lt;/p&gt;</comment>
                            <comment id="13969264" author="stack" created="Tue, 15 Apr 2014 06:34:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; Not what I was thinking but its a test... +1 (I was thinking you&apos;d just do mock up in TestDefaultMemStore &amp;#8211; it already has a bunch of these kind of size calculations).&lt;/p&gt;

&lt;p&gt;It looks like trunk already has this fix since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10648&quot; title=&quot;Pluggable Memstore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10648&quot;&gt;&lt;del&gt;HBASE-10648&lt;/del&gt;&lt;/a&gt;.  It was just not backported?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13969269" author="anoop.hbase" created="Tue, 15 Apr 2014 06:42:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like trunk already has this fix &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No Stack.  This fix is not there in any of the branch.&lt;/p&gt;</comment>
                            <comment id="13969456" author="ram_krish" created="Tue, 15 Apr 2014 11:42:04 +0000"  >&lt;p&gt;Patch looks good.  The test is also looking great.&lt;br/&gt;
+1.&lt;/p&gt;</comment>
                            <comment id="13969649" author="yuzhihong@gmail.com" created="Tue, 15 Apr 2014 15:55:31 +0000"  >&lt;p&gt;Patch for 0.94&lt;/p&gt;

&lt;p&gt;Porting the test is not trivial - none of the existing tests in TestHRegion uses StoreFlushContext&lt;/p&gt;</comment>
                            <comment id="13969651" author="yuzhihong@gmail.com" created="Tue, 15 Apr 2014 15:56:01 +0000"  >&lt;p&gt;Integrated to all branches.&lt;/p&gt;

&lt;p&gt;Thanks for the reviews.&lt;/p&gt;</comment>
                            <comment id="13969653" author="hudson" created="Tue, 15 Apr 2014 15:57:15 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #384 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/384/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/384/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587610)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969727" author="hudson" created="Tue, 15 Apr 2014 16:52:10 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #262 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/262/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/262/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587612)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969750" author="stack" created="Tue, 15 Apr 2014 17:06:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;No Stack.  This fix is not there in any of the branch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah.  Second misread of the evening.  Pardon me.&lt;/p&gt;</comment>
                            <comment id="13969796" author="hudson" created="Tue, 15 Apr 2014 17:42:13 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #465 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/465/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/465/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587628)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969845" author="hudson" created="Tue, 15 Apr 2014 18:17:39 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1346 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1346/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1346/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587628)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969888" author="hudson" created="Tue, 15 Apr 2014 18:50:10 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5086 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5086/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5086/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587614)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969967" author="hudson" created="Tue, 15 Apr 2014 19:34:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #278 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/278/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/278/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587612)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969981" author="hudson" created="Tue, 15 Apr 2014 19:44:20 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-JDK7 #112 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/112/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/112/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587628)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969995" author="hudson" created="Tue, 15 Apr 2014 20:05:05 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-on-Hadoop-2 #70 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-on-Hadoop-2/70/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-on-Hadoop-2/70/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587628)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13970061" author="hudson" created="Tue, 15 Apr 2014 21:08:33 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #385 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/385/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Addendum for 0.96 which corrects signature for appendNoSync() (tedyu: rev 1587626)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13970424" author="hudson" created="Wed, 16 Apr 2014 05:01:29 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96-hadoop2 #265 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/265/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/265/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Addendum for 0.96 which corrects signature for appendNoSync() (tedyu: rev 1587626)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10845&quot; title=&quot;Memstore snapshot size isn&amp;#39;t updated in DefaultMemStore#rollback()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10845&quot;&gt;&lt;del&gt;HBASE-10845&lt;/del&gt;&lt;/a&gt; Memstore snapshot size isn&apos;t updated in DefaultMemStore#rollback() (tedyu: rev 1587610)&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/FaultyHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640288" name="10845-0.94.txt" size="666" author="yuzhihong@gmail.com" created="Tue, 15 Apr 2014 15:55:31 +0000"/>
                            <attachment id="12640289" name="10845-0.96.addendum" size="1067" author="yuzhihong@gmail.com" created="Tue, 15 Apr 2014 16:12:12 +0000"/>
                            <attachment id="12640098" name="10845-0.98.txt" size="6463" author="yuzhihong@gmail.com" created="Mon, 14 Apr 2014 17:02:48 +0000"/>
                            <attachment id="12637055" name="10845-v1.txt" size="726" author="yuzhihong@gmail.com" created="Wed, 26 Mar 2014 23:55:56 +0000"/>
                            <attachment id="12637091" name="10845-v2.txt" size="7976" author="yuzhihong@gmail.com" created="Thu, 27 Mar 2014 04:43:27 +0000"/>
                            <attachment id="12639995" name="10845-v3.txt" size="6505" author="yuzhihong@gmail.com" created="Sun, 13 Apr 2014 22:05:53 +0000"/>
                            <attachment id="12640069" name="10845-v4.txt" size="6484" author="yuzhihong@gmail.com" created="Mon, 14 Apr 2014 14:22:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Mar 2014 03:17:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382197</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tuhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>