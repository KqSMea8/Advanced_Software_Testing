<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:15:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4050/HBASE-4050.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4050] Update HBase metrics framework to metrics2 framework</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4050</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Metrics Framework has been marked deprecated in Hadoop 0.20.203+ and 0.22+, and it might get removed in future Hadoop release.  Hence, HBase needs to revise the dependency of MetricsContext to use Metrics2 framework.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 6&lt;/p&gt;</environment>
        <key id="12512380">HBASE-4050</key>
            <summary>Update HBase metrics framework to metrics2 framework</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eclark">Elliott Clark</assignee>
                                    <reporter username="eyang">Eric Yang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jun 2011 20:32:18 +0000</created>
                <updated>Tue, 15 Oct 2013 04:46:48 +0000</updated>
                            <resolved>Wed, 19 Jun 2013 00:20:49 +0000</resolved>
                                    <version>0.90.4</version>
                                    <fixVersion>0.95.2</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>23</watches>
                                                                                                            <comments>
                            <comment id="13058864" author="stack" created="Fri, 1 Jul 2011 23:29:56 +0000"  >&lt;p&gt;Made this critical for 0.94 (its not going to happen for 0.92; it&apos;d probably be fine if 0.92 only ran on 0.20+0.22 hadoops... 0.94 hbase should be able to do 0.20, 0.22, and 0.23 hadoops).&lt;/p&gt;</comment>
                            <comment id="13286759" author="otis" created="Thu, 31 May 2012 17:28:44 +0000"  >&lt;p&gt;Stack mentioned this is critical for 0.94, but Fix Version/s says &quot;None&quot;.&lt;br/&gt;
Is anyone working on this by any chance?&lt;/p&gt;</comment>
                            <comment id="13286763" author="zhihyu@ebaysf.com" created="Thu, 31 May 2012 17:33:15 +0000"  >&lt;p&gt;@Otis:&lt;br/&gt;
It has been 11 months.&lt;br/&gt;
Please take this if you have time.&lt;/p&gt;</comment>
                            <comment id="13286810" author="alexb" created="Thu, 31 May 2012 18:34:38 +0000"  >&lt;p&gt;I&apos;ll try to get to this in 3 weeks (we want this to be done a lot), if anyone wants to jump on this sooner, that would be great, too&lt;/p&gt;</comment>
                            <comment id="13403542" author="zhihyu@ebaysf.com" created="Thu, 28 Jun 2012 22:55:52 +0000"  >&lt;p&gt;3 weeks flew by &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13403999" author="alexb" created="Fri, 29 Jun 2012 16:18:05 +0000"  >&lt;p&gt;True!&lt;/p&gt;

&lt;p&gt;There&apos;s an ongoing effort to sum up all the work we need to do around metrics, all jiras, etc.: &lt;a href=&quot;http://search-hadoop.com/m/DBMT21ENvX4&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://search-hadoop.com/m/DBMT21ENvX4&lt;/a&gt;. I.e. before hopping on this issue.&lt;/p&gt;

&lt;p&gt;At the same time I have a feeling we might want to attack this one first/anyways/independently.&lt;/p&gt;

&lt;p&gt;We may want to have old metrics to be still available (some existing systems may rely on them) while exposing new ones (in a new way). Or we don&apos;t?&lt;/p&gt;

&lt;p&gt;Having said that we can only integrate metrics2 framework within this issue. And add more and more metrics based on what we conclude while summing up many metrics issues (see above). I.e. the effort of this issue would be just integrating the metrics2 framework and adding some basic metrics. If we are 100% for going with metrics2 framework.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13404060" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 17:44:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;the effort of this issue would be just integrating the metrics2 framework and adding some basic metrics.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sounds good.&lt;/p&gt;</comment>
                            <comment id="13404269" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 22:09:45 +0000"  >&lt;p&gt;The following came from Andy under &apos;Metrics in 0.96&apos; discussion:&lt;/p&gt;

&lt;p&gt;&amp;gt; Meanwhile I suggested taking on this one:&lt;br/&gt;
&amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4050&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4050&lt;/a&gt; separately/first. What do&lt;br/&gt;
&amp;gt; you think?&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;In related discussion, it looks to me like Stack thinks pulling in the&lt;br/&gt;
histogram accuracy improvement work via metrics2 is a good idea.&lt;/p&gt;

&lt;p&gt;Independent of this something I would like to be able to do is log&lt;br/&gt;
metrics to a file as well as Ganglia concurrently, and metrics2 can do&lt;br/&gt;
that.&lt;/p&gt;</comment>
                            <comment id="13408516" author="alexb" created="Sat, 7 Jul 2012 01:26:50 +0000"  >&lt;p&gt;Attached very first version of a patch.&lt;/p&gt;

&lt;p&gt;Note: since HBase trunk points to 1.0.3 version of Hadoop, we cannot use fancy annotations of metrics2 framework which were added later. But still things should look clean. As far as I understand, if we decide to switch to using annotations, we should be OK: external system will not notice the change.&lt;br/&gt;
Note2: I only added new metrics for HMaster so far.&lt;/p&gt;

&lt;p&gt;As we agreed, I only integrated new framework, left old metrics as they are. Hence, sorry for weird &quot;V2&quot;-postfixed names in this initial patch.&lt;br/&gt;
Also, as agreed, I&apos;ve added only single metric to be exposed: cluster_requests. Tried to add unit-test for it (wasn&apos;t very easy to test that metric, I have a fear that this unit-test may fail sometimes because the fake request in this test not the only one that can happen at the time of execution).&lt;/p&gt;

&lt;p&gt;Anyhow, will work further on this.&lt;/p&gt;</comment>
                            <comment id="13408580" author="zhihyu@ebaysf.com" created="Sat, 7 Jul 2012 05:20:36 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+++ hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsV2.java  (revision )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can introduce metrics2 package and put MasterMetrics.java there, what do you think ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestMasterMetrics {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above class is a small test, right ?&lt;/p&gt;

&lt;p&gt;I assume, once complete, the Metrics2 metrics would substitute old metrics.&lt;/p&gt;</comment>
                            <comment id="13408581" author="zhihyu@ebaysf.com" created="Sat, 7 Jul 2012 05:29:06 +0000"  >&lt;p&gt;Since cluster is involved in the test, I categorize it as medium.&lt;/p&gt;</comment>
                            <comment id="13408615" author="zhihyu@ebaysf.com" created="Sat, 7 Jul 2012 10:32:35 +0000"  >&lt;p&gt;The reason Hadoop QA didn&apos;t get back was because of the OutOfMemoryError compiling against hadoop 2.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] Compiling 765 source files to /Users/zhihyu/trunk-hbase/hbase-server/target/classes
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Skipping HBase - Server
[INFO] This project has been banned from the build due to previous failures.
[INFO] ------------------------------------------------------------------------
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 12:10.921s
[INFO] Finished at: Sat Jul 07 03:25:44 PDT 2012
[INFO] Final Memory: 35M/123M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) on project hbase-server: Fatal error compiling: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing the compiler. InvocationTargetException: Java heap space -&amp;gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) on project hbase-server: Fatal error compiling
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:217)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145)
	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84)
	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59)
	at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183)
	at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161)
	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:319)
	at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156)
	at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537)
	at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196)
	at org.apache.maven.cli.MavenCli.main(MavenCli.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290)
	at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230)
	at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409)
	at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)
Caused by: org.apache.maven.plugin.MojoExecutionException: Fatal error compiling
	at org.apache.maven.plugin.AbstractCompilerMojo.execute(AbstractCompilerMojo.java:498)
	at org.apache.maven.plugin.CompilerMojo.execute(CompilerMojo.java:114)
	at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209)
	... 19 more
Caused by: org.codehaus.plexus.compiler.CompilerException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing the compiler.
	at org.codehaus.plexus.compiler.javac.JavacCompiler.compileInProcess(JavacCompiler.java:434)
	at org.codehaus.plexus.compiler.javac.JavacCompiler.compile(JavacCompiler.java:141)
	at org.apache.maven.plugin.AbstractCompilerMojo.execute(AbstractCompilerMojo.java:493)
	... 22 more
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.codehaus.plexus.compiler.javac.JavacCompiler.compileInProcess(JavacCompiler.java:420)
	... 24 more
Caused by: java.lang.OutOfMemoryError: Java heap space
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the command I used:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvn clean test help:active-profiles -X -DskipTests -Dhadoop.profile=2.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13408675" author="alexb" created="Sat, 7 Jul 2012 14:00:24 +0000"  >&lt;p&gt;The problem with building against hadoop 2.0 (and same is with hadoop 3.0 I believe) is that those classes in metrics2 package were renamed. So I got not OOME, but compilation errors, like these (showing not all):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] /Users/alex/shared/hbase-trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsV2.java:[25,37] cannot find symbol
[ERROR] symbol  : class MetricMutableCounterInt
[ERROR] location: package org.apache.hadoop.metrics2.lib
[ERROR] 
[ERROR] /Users/alex/shared/hbase-trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsV2.java:[27,40] cannot find symbol
[ERROR] symbol  : class JvmMetricsSource
[ERROR] location: package org.apache.hadoop.metrics2.source
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In hadoop 2.0+ these classes were renamed (not only these two):&lt;br/&gt;
MetricMutableCounterInt -&amp;gt; MutableCounterInt&lt;br/&gt;
JvmMetricsSource -&amp;gt; JvmMetrics&lt;/p&gt;

&lt;p&gt;How soon do you think HBase can leave off dependency on hadoop 1.0?&lt;br/&gt;
Any suggestions about this situation?&lt;/p&gt;</comment>
                            <comment id="13408679" author="alexb" created="Sat, 7 Jul 2012 14:08:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;We can introduce metrics2 package and put MasterMetrics.java there, what do you think ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Had same thought, but didn&apos;t want to have in HMaster two different classes used with same name, the code will look a bit ugly.&lt;br/&gt;
What I think is better than &quot;V2&quot; is to call those metrics classes &quot;HMasterMetrics&quot; and &quot;HRegionServerMetrics&quot;, while old ones are without &quot;H&quot; prefix. These names seems to me not that ugly.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I assume, once complete, the Metrics2 metrics would substitute old metrics&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe so. Though removing older metrics &lt;b&gt;very soon&lt;/b&gt; might be not an easy decision: I think there are home-grown systems/scripts for cluster monitoring out there which rely on them. So we may want to be polite and keep both in first release with metrics2 included and say that old ones will be removed in future. I think this needs broader discussion&lt;/p&gt;</comment>
                            <comment id="13408680" author="zhihyu@ebaysf.com" created="Sat, 7 Jul 2012 14:17:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;How soon do you think HBase can leave off dependency on hadoop 1.0?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;hadoop 1.0 is considered the stable release in the near future. We have to accommodate both hadoop 1.0 and hadoop 2.0&lt;br/&gt;
Certain form of shim would be needed.&lt;br/&gt;
Take a look at src/main/java/org/apache/hadoop/hbase/util/ShutdownHookManager.java which I introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5963&quot; title=&quot;ClassCastException: FileSystem$Cache$ClientFinalizer cannot be cast to Thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5963&quot;&gt;&lt;del&gt;HBASE-5963&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will send out a poll on dev@ list for when old metrics should be removed.&lt;/p&gt;</comment>
                            <comment id="13408748" author="alexb" created="Sat, 7 Jul 2012 19:20:31 +0000"  >&lt;p&gt;Added metrics v2 to HRegionServer. Renamed &quot;v2&quot; from the initial patch as per may previous comment.&lt;/p&gt;

&lt;p&gt;HRegionServerMetrics for now has only one gauge &quot;regions #&quot;.&lt;/p&gt;

&lt;p&gt;Added simplest unit-test. Also checked (locally) that new metrics are exposed via JMX.&lt;/p&gt;

&lt;p&gt;I did integration with metrics2 by analogy with DataNode metrics, some things (esp. naming) should be reviewed.&lt;/p&gt;

&lt;p&gt;Next things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;make it work with hadoop 2.0+ (the shim)&lt;/li&gt;
	&lt;li&gt;test at least one sink, e.g. FileSink, in addition to checking if things exposed by JMX&lt;/li&gt;
	&lt;li&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; test perf affect. Not sure this is needed...&lt;/li&gt;
	&lt;li&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; add more metrics in new classes. I think we decided not to do it as a part of this issue, as metrics in general should be reworked.&lt;/li&gt;
	&lt;li&gt;review patch + fix found issues&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13410634" author="zhihyu@ebaysf.com" created="Tue, 10 Jul 2012 17:58:40 +0000"  >&lt;p&gt;As Todd pointed out on dev mailing list, we can be flexible with the class names for the new metrics classes as long as we try to keep user-facing (JMX) interfaces the same with those from 0.94.&lt;br/&gt;
The new metrics classes should be annotated with @InterfaceAudience.Private&lt;/p&gt;</comment>
                            <comment id="13411693" author="alexb" created="Wed, 11 Jul 2012 16:23:50 +0000"  >&lt;p&gt;So, about the shim. Haven&apos;t done that kind of thing before, so please correct me where/if I&apos;m wrong.&lt;/p&gt;

&lt;p&gt;Background:&lt;br/&gt;
There are quite a lot (&amp;gt;10) classes we want to use in HBase code which are different in Hadoop 1.0+ and 2.0+ from metrics2 framework.&lt;/p&gt;

&lt;p&gt;There are two options basically.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;1. Create shim classes for every class we want to use from Hadoop metrics2&lt;/b&gt; and which are different in Hadoop 1.0+ and 2.0+ codebase. &lt;/p&gt;

&lt;p&gt;Shim class is basically consists of:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;interface (may be abstract class) similar (or exact same, depending on which methods we want to use from it)&lt;/li&gt;
	&lt;li&gt;multiple implementations of this interface, each uses reflection to dynamically load the class from hadoop (based on which hadoop version we should use) and propagate methods invocation to it&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;em&gt;Pros&lt;/em&gt;: no extra/external jars to be loaded, all code is in main HBase maven module&lt;br/&gt;
&lt;em&gt;Cons&lt;/em&gt;: a lot of code which uses reflection (i.e. ugly code, hard to maintain, + bad performance)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;2. Create shim classes for &quot;central/factory&quot; classes&lt;/b&gt;, &lt;b&gt;add only interfaces for classes which we want to use from Hadoop metrics2&lt;/b&gt; and which are different in Hadoop 1.0+ and 2.0+ codebase, &lt;b&gt;extract actual implementation of these interfaces into shim jars&lt;/b&gt; and load them depending on which Hadoop version we need to use.&lt;/p&gt;

&lt;p&gt;In other words:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;add &lt;em&gt;only&lt;/em&gt; interfaces in HBase codebase (in new metrics2 package) for classes of metrics2 framework we want to use&lt;/li&gt;
	&lt;li&gt;create shim classes for &quot;central/factory&quot; classes, such as MetricsRegistry: interface + code to load the actual implementation by classname&lt;/li&gt;
	&lt;li&gt;create two shim jars (e.g. &quot;metrics2-hadoop-1.0-shim.jar&quot; and &quot;metrics2-hadoop-2.0-shim.jar&quot;) each with implementation of the interfaces above using classes from the corresponded hadoop version&lt;/li&gt;
	&lt;li&gt;add ShimLoader class which, at runtime finds out which hadoop version is used and which shim jar should be loaded, and loads the correspondent jar&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;em&gt;Pros&lt;/em&gt;: minimum reflection (just for initializing &quot;central/factory&quot; classes, once)&lt;br/&gt;
&lt;em&gt;Cons&lt;/em&gt;: needs loading jars (not sure this is a con), probably we&apos;ll have to add separate maven modules to develop two shim jars&lt;/p&gt;</comment>
                            <comment id="13411694" author="alexb" created="Wed, 11 Jul 2012 16:25:02 +0000"  >&lt;p&gt;If the above correct/sensible, I&apos;d say I&apos;m for 2nd option.&lt;/p&gt;

&lt;p&gt;P.S. Sorry for a lot of text above.&lt;/p&gt;</comment>
                            <comment id="13411762" author="eclark" created="Wed, 11 Jul 2012 17:50:48 +0000"  >&lt;p&gt;The reflection option seems like it would be a big perf hit.  Reflection basically means that nothing ever gets inlined so all function calls into metrics2 code would be very expensive.  Since it seems like we are adding more and more instrumentation this perf impact would only grow.  In addition as more hadoop versions come out all of our reflection code would get much more complicated and brittle.&lt;/p&gt;

&lt;p&gt;The conditionally loaded jar would be nice in that the JIT would only see one version of the factory classes on the classpath and everything could be optimized just like any other jvm run jit&apos;d code. In addition there are other places that we use reflection to do things conditionally and a conditionally loaded jar would be nice.&lt;/p&gt;

&lt;p&gt;So I&apos;m for #2.&lt;/p&gt;</comment>
                            <comment id="13411771" author="jmhsieh" created="Wed, 11 Jul 2012 17:56:52 +0000"  >&lt;p&gt;Just a few points of data to help make the decision &amp;#8211; hbase needs to be recompiled to run against hadoop 2.0 hdfs &amp;#8211; the jars compiled against hadoop 1.0 doesn&apos;t work against a hadoop 2.0 hdfs.  Kind of makes you wish for #ifdefs. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Reflection only really needs to be done once &amp;#8211; after you have figured out which version you are in, you can cache the Method, and you should be able to use the same instance from that point forward.  You can see how to do it by checking how hadoop&apos;s sync/hflush are called in a region server.&lt;/p&gt;</comment>
                            <comment id="13411832" author="zhihyu@ebaysf.com" created="Wed, 11 Jul 2012 18:38:19 +0000"  >&lt;p&gt;For option #2, looks like we need some maven expert(s) to establish modules for building shim jars based on hadoop 1.0 and hadoop 2.0&lt;br/&gt;
This potentially can be a blocker.&lt;/p&gt;</comment>
                            <comment id="13411846" author="eclark" created="Wed, 11 Jul 2012 18:50:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;hbase needs to be recompiled to run against hadoop 2.0 hdfs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When did this happen ? In the pom all that changes for the hadoop 2.0 compile are that some dependencies are changed.  I just tried on a local machine only and just changing the libs dir I was able to run either version (stand alone only so not really an exhaustive test I know)&lt;/p&gt;</comment>
                            <comment id="13411891" author="eclark" created="Wed, 11 Jul 2012 19:37:53 +0000"  >&lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html&lt;/a&gt;  ServiceLoaders seem like the exact thing that we would need.&lt;/p&gt;

&lt;p&gt;hbase-hadoop1 &amp;#8211; Hadoop 1 implementations including the metrics providers&lt;br/&gt;
hbase-hadoop2 &amp;#8211; Hadoop 2 implementations including the metrics providers&lt;br/&gt;
hbase-server would then get one of the two above implementations&lt;/p&gt;


&lt;p&gt;Most things are pretty easy.  The assembly action is a little bit more difficult but I think I can get that.  My first question is should the interfaces for the shim classes be in hbase-common or should they go into a new module (hbase-hadoop-compat ? )&lt;/p&gt;

&lt;p&gt;Making a hbase-hadoop-compat module has the nice property of keeping the module dependency structure flat. (Please forgive the bad ascii art that follows)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase-(hadoop1|hadoop2) ----&amp;gt; hbase-hadoop-compat-----\
                                                       |
                                                       |
hbase-common --------------------------------------&amp;gt; hbase-server
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;otherwise we would have:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hadoop-common ------&amp;gt; hbase-compat -&amp;gt; hbase-(hadoop1|hadoop2) -----\
 |                                                                  |
 |                                                                  |
 +---------------------------------------------------------------&amp;gt; hbase-server
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Thoughts ?&lt;/p&gt;
</comment>
                            <comment id="13411900" author="zhihyu@ebaysf.com" created="Wed, 11 Jul 2012 19:45:42 +0000"  >&lt;p&gt;Good idea.&lt;br/&gt;
ServiceLoader is used widely in hadoop. e.g. from Token.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (TokenIdentifier id : ServiceLoader.load(TokenIdentifier.class)) {
        tokenKindMap.put(id.getKind(), id.getClass());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would vote for hbase-hadoop-compat module.&lt;/p&gt;</comment>
                            <comment id="13411949" author="jmhsieh" created="Wed, 11 Jul 2012 20:22:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;bq. hbase needs to be recompiled to run against hadoop 2.0 hdfs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;When did this happen ? In the pom all that changes for the hadoop 2.0 compile are that some dependencies are changed. I just tried on a local machine only and just changing the libs dir I was able to run either version (stand alone only so not really an exhaustive test I know)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here&apos;s one reason:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5861?focusedCommentId=13259785&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13259785&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5861?focusedCommentId=13259785&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13259785&lt;/a&gt;&lt;br/&gt;
Here&apos;s another: &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-1620&quot; title=&quot;Rename HdfsConstants -&amp;gt; HdfsServerConstants, FSConstants -&amp;gt; HdfsConstants&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-1620&quot;&gt;&lt;del&gt;HDFS-1620&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-2412&quot; title=&quot;Add backwards-compatibility layer for FSConstants&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-2412&quot;&gt;&lt;del&gt;HDFS-2412&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13411952" author="vicaya" created="Wed, 11 Jul 2012 20:24:54 +0000"  >&lt;p&gt;+1 on Alex&apos;s option 2 and ServiceLoader. For HBase we only need to implement shims for metrics sources, so interface for registry and &lt;b&gt;Mutable&lt;/b&gt; classes would suffice.&lt;/p&gt;</comment>
                            <comment id="13411963" author="eclark" created="Wed, 11 Jul 2012 20:33:52 +0000"  >&lt;p&gt;@Jonathan&lt;br/&gt;
Thanks.&lt;/p&gt;

&lt;p&gt;@Luke Lu&lt;br/&gt;
Unfortunately we need to shim a little bit more since the actual MetricsBuilder has also changed.  I&apos;m trying to have something ready to show in a little bit.&lt;/p&gt;</comment>
                            <comment id="13411975" author="vicaya" created="Wed, 11 Jul 2012 20:44:56 +0000"  >&lt;p&gt;@Elliott: MetricsBuilder/Collector is only needed for creating metrics dynamically and for implementing new Mutable metrics. Does HBase need to define new metrics at run time?&lt;/p&gt;</comment>
                            <comment id="13411979" author="eclark" created="Wed, 11 Jul 2012 20:49:56 +0000"  >&lt;p&gt;@Luke&lt;br/&gt;
Yes.  We have per region metrics, per replication stream metrics, and per schema metrics.  There might be others that I&apos;m missing but those are the ones I have touched.&lt;br/&gt;
In addition we will probably be implementing our own metrics classes.  Right now we have MetricsHistogram which is based on metrics1. &lt;/p&gt;</comment>
                            <comment id="13412451" author="eclark" created="Thu, 12 Jul 2012 01:54:52 +0000"  >&lt;p&gt;Here&apos;s a patch that add&apos;s hadoop compatibility shims.  I needed something to prototype and test with so I used my implementation of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6323&quot; title=&quot;[replication] most of the source metrics are wrong when there&amp;#39;s multiple slaves&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6323&quot;&gt;&lt;del&gt;HBASE-6323&lt;/del&gt;&lt;/a&gt; as an example.&lt;/p&gt;

&lt;p&gt;hbase-hadoop-compat contains the factory and the interface.  The factory uses ResourceFinder from the geronimo project.  It&apos;s much more flexible than ServiceLoader (allows different locations easily and most importantly it allows constructor arguments).  I didn&apos;t want to add the whole geronimo project as a dep so the code is copied in.  I tried to give as much credit as I could.  I can go back to using ServiceLoader if people object to having &lt;/p&gt;

&lt;p&gt;hbase-hadoop1-compat and hbase-hadoop2-compat add the actual implementation of the class who&apos;s interface is defined in hbase-hadoop-compat.  I don&apos;t have a hbase-hadoop23-compat&lt;/p&gt;

&lt;p&gt;Right now depending upon which profile is building the hbase-server module gets one of the above as a dependency.&lt;/p&gt;

&lt;p&gt;In addition when building assembly files only contain the hbase-hadoop&lt;/p&gt;
{1,2}
&lt;p&gt;-compat directory needed.  It&apos;s possible to keep the old assembly file the way it was and change the shell scripts to only load the one.  But I didn&apos;t get to that.&lt;/p&gt;

&lt;p&gt;I tested it in place and locally after building tar.gz&apos;s on both &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop 1.0.3&lt;/li&gt;
	&lt;li&gt;hadoop 2.0.0-alpha&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In place scripts still work though I&apos;m not really sure of why or how.  I need to investigate that later.&lt;/p&gt;</comment>
                            <comment id="13412456" author="alexb" created="Thu, 12 Jul 2012 02:09:04 +0000"  >&lt;p&gt;Heh, was about to commit example with ServiceLoader (and same extra modules based on your schema above), but looks like it makes sense to use ResourceFinder. Will use your patch and add metrics sources for RegionServer and Master to it (almost empty, as per discussion above) tomorrow and we can think about closing the issue (after review, etc.).&lt;/p&gt;

&lt;p&gt;Thank you, Elliott!&lt;/p&gt;</comment>
                            <comment id="13412457" author="alexb" created="Thu, 12 Jul 2012 02:09:50 +0000"  >&lt;p&gt;&quot;was about to commit&quot; read as &quot;was about to provide patch&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13412479" author="hadoopqa" created="Thu, 12 Jul 2012 03:29:10 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536162/HBASE-4050-0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536162/HBASE-4050-0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 7 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 11 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestMultiSlaveReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestMasterReplication&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2365//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13412483" author="eclark" created="Thu, 12 Jul 2012 03:41:35 +0000"  >&lt;p&gt;I missed one part in ReplicationSourceMetrics.  This should fix the tests.&lt;/p&gt;</comment>
                            <comment id="13412484" author="zhihyu@ebaysf.com" created="Thu, 12 Jul 2012 03:45:17 +0000"  >&lt;p&gt;Amazing work !&lt;/p&gt;

&lt;p&gt;ReplicationMetricsSource javadoc is to be filled.&lt;br/&gt;
And some catch clauses have boilerplate code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+        e.printStackTrace();  &lt;span class=&quot;code-comment&quot;&gt;//To change body of &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; statement use File | Settings | File Templates.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I thought author name shouldn&apos;t appear in the file header:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * author David Blevins
+ * version $Rev$ $Date$
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Consider using uppercase M in the string below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; METRICS_CONTEXT = &lt;span class=&quot;code-quote&quot;&gt;&quot;replicationmetrics&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Do we need to check that delta is non-negative ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    gaugeInt.decr(delta);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe give the assembly file a more descriptive name ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &amp;lt;assembly.file&amp;gt;src/assembly/two.xml&amp;lt;/assembly.file&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceMetrics.java is removed.&lt;br/&gt;
hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics2/ReplicationSourceMetrics.java is added.&lt;br/&gt;
What about metrics1 ?&lt;/p&gt;</comment>
                            <comment id="13412503" author="vicaya" created="Thu, 12 Jul 2012 04:19:25 +0000"  >&lt;p&gt;ResourceFinder seems to have a few nice properties but do we actually &lt;b&gt;require&lt;/b&gt; them?, it&apos;s &amp;gt; 1KLOC, 1/3 of the whole patch. According to a comment in &lt;a href=&quot;http://goo.gl/LmsXp&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://goo.gl/LmsXp&lt;/a&gt; it doesn&apos;t support comments etc in service definitions and that it doesn&apos;t offer perceivable performance improvement over ServiceLoader. Also, why did you pick this particular implementation of ResourceFinder from xbeans-3.7 (the current release is 3.11.1)?&lt;/p&gt;</comment>
                            <comment id="13412509" author="eclark" created="Thu, 12 Jul 2012 04:27:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;ReplicationMetricsSource javadoc is to be filled.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;And some catch clauses have boilerplate code&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed. I&apos;ll get a patch up soon.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I thought author name shouldn&apos;t appear in the file header:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was trying to keep the source as close to the original as possible.  I&apos;m open for whatever; I was just trying to make sure that the people who wrote it got credit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Consider using uppercase M in the string below&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hadoop&apos;s metrics2 uses all lowercase for context. &lt;a href=&quot;https://github.com/apache/hadoop-common/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/impl/MetricsSystemImpl.java#L68&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hadoop-common/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/impl/MetricsSystemImpl.java#L68&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do we need to check that delta is non-negative ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Nope.  Hadoop doesn&apos;t so I followed suit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe give the assembly file a more descriptive name ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure&lt;/p&gt;</comment>
                            <comment id="13412513" author="eclark" created="Thu, 12 Jul 2012 04:38:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;ResourceFinder seems to have a few nice properties but do we actually require them?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not 100%, we can get around ServiceLoader&apos;s short comings by having the ServiceLoader create factories that take in arguments and pass them to a constructor, however it would be cleaner .&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;why did you pick this particular implementation of ResourceFinder from xbeans-3.7&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;A friend sent me to that exact link, saying they were using it.  I can pull a newer one. &lt;/p&gt;</comment>
                            <comment id="13412515" author="hadoopqa" created="Thu, 12 Jul 2012 04:41:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536167/HBASE-4050-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536167/HBASE-4050-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 7 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 11 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2366//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13412524" author="eclark" created="Thu, 12 Jul 2012 05:17:01 +0000"  >&lt;p&gt;After code comments.&lt;/p&gt;</comment>
                            <comment id="13412550" author="hadoopqa" created="Thu, 12 Jul 2012 06:19:31 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536174/HBASE-4050-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536174/HBASE-4050-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 7 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 12 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2367//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13412721" author="larsgeorge" created="Thu, 12 Jul 2012 11:51:26 +0000"  >&lt;p&gt;Just a question, do we still need to use &quot;hadoop-metrics.properties&quot; (with out without the &quot;2&quot;) or could we now have the proper hbase-metrics.properties name?&lt;/p&gt;</comment>
                            <comment id="13412762" author="stack" created="Thu, 12 Jul 2012 13:16:01 +0000"  >&lt;p&gt;Double license in new pom.&lt;/p&gt;

&lt;p&gt;Is it right hardcoding the version in the sub module: &quot;+        &amp;lt;version&amp;gt;0.95-SNAPSHOT&amp;lt;/version&amp;gt;&quot;&lt;/p&gt;

&lt;p&gt;ditto in other new poms.&lt;/p&gt;

&lt;p&gt;Can we keep stuff in metrics rather than metrics and metrics2 now we have this fancy pants compatibility module?&lt;/p&gt;

&lt;p&gt;Did you say you wanted ResourceFinder because you wanted to pass stuff on construction?  Where are you using constructors here?&lt;/p&gt;

&lt;p&gt;Can you do tests for you implementations (and have dependencies in these new modules against the said hadoop versions?)&lt;/p&gt;

&lt;p&gt;This looks great Elliott.  I&apos;d be w/ Luke trying to make do with ServiceFinder if possible rather than pull in ResourceFinder (Its in hbase-hadoop-compat because hbase-common is not a dependency going by your ascii art above?)&lt;/p&gt;</comment>
                            <comment id="13413121" author="eclark" created="Thu, 12 Jul 2012 19:46:29 +0000"  >
&lt;blockquote&gt;&lt;p&gt;Just a question, do we still need to use &quot;hadoop-metrics.properties&quot; (with out without the &quot;2&quot;) or could we now have the proper hbase-metrics.properties name?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can do: hadoop-metrics2-hbase.properties&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Double license in new pom.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed in next patch&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is it right hardcoding the version in the sub module: &quot;+ &amp;lt;version&amp;gt;0.95-SNAPSHOT&amp;lt;/version&amp;gt;&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah I think so.  That&apos;s how common has it.  removing it or using a variable doesn&apos;t work.  I think it has something to do with how maven bootstraps module dependencies.  It&apos;s lame; I&apos;d love for a maven expert to find a better way.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can you do tests for you implementations (and have dependencies in these new modules against the said hadoop versions?)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure added in the new versions.  The modules already have dependencies on the version of hadoop that they would shim, so I added some tests.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Did you say you wanted ResourceFinder because you wanted to pass stuff on construction? Where are you using constructors here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;d be w/ Luke trying to make do with ServiceFinder if possible rather than pull in ResourceFinder&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m not using it yet.  However the discussion above basically wanted a very empty proof of concept.  So that&apos;s what I created.  The place that I see using constructor arguments would be when I implement Histograms.&lt;/p&gt;

&lt;p&gt;With all that said we can still just use factories, or guice like is being discussed on the mailing list so I&apos;m going back to ServiceLoader in the new patch. &lt;/p&gt;</comment>
                            <comment id="13413186" author="eclark" created="Thu, 12 Jul 2012 20:51:39 +0000"  >&lt;p&gt;Moved the main bulk of the implementation into a base classes.&lt;/p&gt;

&lt;p&gt;created a factory for metrics in hbase-hadoop2-compat as MetricsRegistry does not allow metrics to be removed.&lt;/p&gt;

&lt;p&gt;Added tests for implementations.&lt;/p&gt;

&lt;p&gt;Removed the ResourceFinder.&lt;/p&gt;

&lt;p&gt;Removed the double license.&lt;/p&gt;
</comment>
                            <comment id="13413197" author="zhihyu@ebaysf.com" created="Thu, 12 Jul 2012 20:59:54 +0000"  >&lt;p&gt;Putting patch on review board would help.&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/new/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/new/&lt;/a&gt; gave me Error 500 ...&lt;/p&gt;</comment>
                            <comment id="13413319" author="zhihyu@ebaysf.com" created="Thu, 12 Jul 2012 23:16:37 +0000"  >&lt;p&gt;Latest patch didn&apos;t compile against hadoop 2.0&lt;br/&gt;
See &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2372/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2372/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13413328" author="eclark" created="Thu, 12 Jul 2012 23:39:16 +0000"  >&lt;p&gt;I put it up on review board. &lt;a href=&quot;https://reviews.apache.org/r/5921/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/5921/&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;@Ted&lt;br/&gt;
Both of these worked for me:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;mvn clean install assembly:assembly -Dhadoop.profile=2.0 -DskipTests
	&lt;ul&gt;
		&lt;li&gt;shasum: 1fbb2cfbe2a506de29e7343d255a728e6bc57cd0  target/hbase-0.95-SNAPSHOT.tar.gz&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;mvn clean install assembly:assembly -DskipTests
	&lt;ul&gt;
		&lt;li&gt;shasum: b20010f969f0d8f68a9fb08f824680a6345ea05a  target/hbase-0.95-SNAPSHOT.tar.gz&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests in:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop-compat&lt;/li&gt;
	&lt;li&gt;hbase-hadoop1-compat&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat&lt;br/&gt;
are passing: cd hbase-hadoop-compat &amp;amp;&amp;amp; mvn clean test &amp;amp;&amp;amp; cd ../hbase-hadoop1-compat &amp;amp;&amp;amp; mvn clean test &amp;amp;&amp;amp; cd ../hbase-hadoop2-compat &amp;amp;&amp;amp; mvn clean test&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
~/Code/hbase HBASE-4050 &#10004; &#10148; cd hbase-hadoop-compat &amp;amp;&amp;amp; mvn clean test &amp;amp;&amp;amp; cd ../hbase-hadoop1-compat &amp;amp;&amp;amp; mvn clean test &amp;amp;&amp;amp; cd ../hbase-hadoop2-compat &amp;amp;&amp;amp; mvn clean test                                            ruby-1.9.3-p194  [0s] 
[INFO] Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase - Hadoop Compatibility 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase-hadoop-compat ---
[INFO] Deleting /Users/eclark/Code/hbase/hbase-hadoop-compat/target
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-hadoop-compat ---
[INFO] Setting property: classpath.resource.loader.class =&amp;gt; &apos;org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader&apos;.
[INFO] Setting property: velocimacro.messages.on =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] Setting property: resource.loader =&amp;gt; &apos;classpath&apos;.
[INFO] Setting property: resource.manager.logwhenfound =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] 
[INFO] --- maven-resources-plugin:2.5:resources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-resources) @ hbase-hadoop-compat ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /Users/eclark/Code/hbase/hbase-hadoop-compat/src/main/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ hbase-hadoop-compat ---
[INFO] Compiling 3 source files to /Users/eclark/Code/hbase/hbase-hadoop-compat/target/classes
[INFO] 
[INFO] --- maven-resources-plugin:2.5:testResources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testResources) @ hbase-hadoop-compat ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /Users/eclark/Code/hbase/hbase-hadoop-compat/src/test/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) @ hbase-hadoop-compat ---
[INFO] Compiling 1 source file to /Users/eclark/Code/hbase/hbase-hadoop-compat/target/test-classes
[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) @ hbase-hadoop-compat ---
[INFO] Surefire report directory: /Users/eclark/Code/hbase/hbase-hadoop-compat/target/surefire-reports
[INFO] Using configured provider org.apache.maven.surefire.junitcore.JUnitCoreProvider

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.apache.hadoop.hbase.replication.regionserver.metrics.ReplicationMetricsSourceFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.021 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (secondPartTestsExecution) @ hbase-hadoop-compat ---
[INFO] Tests are skipped.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.352s
[INFO] Finished at: Thu Jul 12 16:36:36 PDT 2012
[INFO] Final Memory: 12M/81M
[INFO] ------------------------------------------------------------------------
[INFO] Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase - Hadoop One Compatibility 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase-hadoop1-compat ---
[INFO] Deleting /Users/eclark/Code/hbase/hbase-hadoop1-compat/target
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-hadoop1-compat ---
[INFO] Setting property: classpath.resource.loader.class =&amp;gt; &apos;org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader&apos;.
[INFO] Setting property: velocimacro.messages.on =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] Setting property: resource.loader =&amp;gt; &apos;classpath&apos;.
[INFO] Setting property: resource.manager.logwhenfound =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] 
[INFO] --- maven-resources-plugin:2.5:resources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-resources) @ hbase-hadoop1-compat ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] Copying 1 resource
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ hbase-hadoop1-compat ---
[INFO] Compiling 2 source files to /Users/eclark/Code/hbase/hbase-hadoop1-compat/target/classes
[INFO] 
[INFO] --- maven-resources-plugin:2.5:testResources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testResources) @ hbase-hadoop1-compat ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /Users/eclark/Code/hbase/hbase-hadoop1-compat/src/test/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) @ hbase-hadoop1-compat ---
[INFO] Compiling 2 source files to /Users/eclark/Code/hbase/hbase-hadoop1-compat/target/test-classes
[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) @ hbase-hadoop1-compat ---
[INFO] Surefire report directory: /Users/eclark/Code/hbase/hbase-hadoop1-compat/target/surefire-reports
[INFO] Using configured provider org.apache.maven.surefire.junitcore.JUnitCoreProvider

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.apache.hadoop.hbase.metrics.BaseMetricsSourceImplTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec
Running org.apache.hadoop.hbase.replication.regionserver.metrics.ReplicationMetricsSourceImplTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.132 sec

Results :

Tests run: 7, Failures: 0, Errors: 0, Skipped: 0

[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (secondPartTestsExecution) @ hbase-hadoop1-compat ---
[INFO] Tests are skipped.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.926s
[INFO] Finished at: Thu Jul 12 16:36:40 PDT 2012
[INFO] Final Memory: 15M/81M
[INFO] ------------------------------------------------------------------------
[INFO] Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase - Hadoop Two Compatibility 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase-hadoop2-compat ---
[INFO] Deleting /Users/eclark/Code/hbase/hbase-hadoop2-compat/target
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-hadoop2-compat ---
[INFO] Setting property: classpath.resource.loader.class =&amp;gt; &apos;org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader&apos;.
[INFO] Setting property: velocimacro.messages.on =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] Setting property: resource.loader =&amp;gt; &apos;classpath&apos;.
[INFO] Setting property: resource.manager.logwhenfound =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] 
[INFO] --- maven-resources-plugin:2.5:resources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-resources) @ hbase-hadoop2-compat ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] Copying 1 resource
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ hbase-hadoop2-compat ---
[INFO] Compiling 3 source files to /Users/eclark/Code/hbase/hbase-hadoop2-compat/target/classes
[INFO] 
[INFO] --- maven-dependency-plugin:2.1:build-classpath (create-mrapp-generated-classpath) @ hbase-hadoop2-compat ---
[INFO] Wrote classpath file &apos;/Users/eclark/Code/hbase/hbase-hadoop2-compat/target/test-classes/mrapp-generated-classpath&apos;.
[INFO] 
[INFO] --- maven-resources-plugin:2.5:testResources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testResources) @ hbase-hadoop2-compat ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /Users/eclark/Code/hbase/hbase-hadoop2-compat/src/test/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) @ hbase-hadoop2-compat ---
[INFO] Compiling 2 source files to /Users/eclark/Code/hbase/hbase-hadoop2-compat/target/test-classes
[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) @ hbase-hadoop2-compat ---
[INFO] Surefire report directory: /Users/eclark/Code/hbase/hbase-hadoop2-compat/target/surefire-reports
[INFO] Using configured provider org.apache.maven.surefire.junitcore.JUnitCoreProvider

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.apache.hadoop.hbase.metrics.BaseMetricsSourceImplTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec
Running org.apache.hadoop.hbase.replication.regionserver.metrics.ReplicationMetricsSourceImplTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.218 sec

Results :

Tests run: 7, Failures: 0, Errors: 0, Skipped: 0

[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (secondPartTestsExecution) @ hbase-hadoop2-compat ---
[INFO] Tests are skipped.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.936s
[INFO] Finished at: Thu Jul 12 16:36:46 PDT 2012
[INFO] Final Memory: 21M/81M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13413356" author="zhihyu@ebaysf.com" created="Fri, 13 Jul 2012 00:17:00 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; BaseMetricsSource {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I suggest adding the following for above interface:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@InterfaceAudience.Public
@InterfaceStability.Evolving
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Subtract some amount to a gauge.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;to a&apos; -&amp;gt; &apos;from a&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        rms = ServiceLoader.load(ReplicationMetricsSource.class).iterator().next();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Shall we traverse the iterator and warn user if there are more than one implementation found ?&lt;/p&gt;

&lt;p&gt;Will continue on the review board.&lt;/p&gt;</comment>
                            <comment id="13413371" author="hadoopqa" created="Fri, 13 Jul 2012 00:33:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536301/HBASE-4050-5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536301/HBASE-4050-5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 11 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 12 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestClassLoading&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestServerCustomProtocol&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2375//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13413485" author="hadoopqa" created="Fri, 13 Jul 2012 04:20:43 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536329/HBASE-4050-7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536329/HBASE-4050-7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 11 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 10 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2380//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13413535" author="stack" created="Fri, 13 Jul 2012 07:14:12 +0000"  >&lt;p&gt;I suppose you don&apos;t need to set test size annotation on below because annotations are not a dependency when this is built:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class ReplicationMetricsSourceFactoryTest {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does BaseMetricsSource not implement MetricsSource?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class BaseMetricsSourceImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; BaseMetricsSource, MetricsSource {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These need to be this accessible:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ConcurrentMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, MetricMutableGaugeLong&amp;gt;
+      gauges = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, MetricMutableGaugeLong&amp;gt;();
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ConcurrentMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, MetricMutableCounterLong&amp;gt; counters =
+      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, MetricMutableCounterLong&amp;gt;();
+
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; metricsContext;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; metricsName;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; metricsDescription;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(I see above twice)&lt;/p&gt;

&lt;p&gt;The stuff below where we have a static boolean and in constructor we test something already created could be a PITA in minihbase setups?  Does it have to be static?  Aren&apos;t we slinging singletons here anyways?  (The singletons are ok in minihbasecontext too?):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!hasInited) {
+      &lt;span class=&quot;code-comment&quot;&gt;//Not too worried about mutli-threaded here as all it does is spam the logs.
&lt;/span&gt;+      hasInited = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+      DefaultMetricsSystem.initialize(HBASE_METRICS_SYSTEM_NAME);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&apos;hasInited&apos; is name of a method that tests &apos;inited&apos; variable... suggest changing its name.&lt;/p&gt;

&lt;p&gt;What about that jmx mess registering metrics in tests?  The exception saying metrics already registered because we have more than one daemon in the one jvm.  We still have that issue here?&lt;/p&gt;

&lt;p&gt;You wanted to complete this: &quot;+/** BaseClass for */&quot;&lt;/p&gt;

&lt;p&gt;Another class has no class comments though has the comment delimiters.&lt;/p&gt;

&lt;p&gt;Do we have to have metrics2 package?  Can this new stuff be in the metrics package?&lt;/p&gt;

&lt;p&gt;I thought I saw a patch where you&apos;d renamed the properties file to what LarsG suggested?&lt;/p&gt;

&lt;p&gt;You seem to have made it so we do not need to have a metrics2 in hbase... thats great... but in the properties file I see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+# See &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;.html &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.hadoop.metrics2 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details
+
+*.sink.file.class=org.apache.hadoop.metrics2.sink.FileSink
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is that just old stuff?&lt;/p&gt;

&lt;p&gt;Good stuff Elliott.  I&apos;d be up for committing this and then doing other stuff in other issues.&lt;/p&gt;
</comment>
                            <comment id="13413569" author="eclark" created="Fri, 13 Jul 2012 07:55:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;I suppose you don&apos;t need to set test size annotation on below because annotations are not a dependency when this is built:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Correct.  The hbase-hadoop-compat module has no hadoop dependency.  In addition hbase-hadoop1-compat and hbase-hadoop2-compat currently only have unit tests, so they have the second test pass completely turned off.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Does BaseMetricsSource not implement MetricsSource?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It does.  I guess it&apos;s just a little too explicit. I&apos;ll fix it in the patch first thing tomorrow morning.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;These need to be this accessible:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Kind of but not 100%; I&apos;m open to either way.  In hadoop 1 metrics are pretty hard to test. Opening the maps up will make testing any classes that extend MetricsBaseSourceImpl easier.  Those classes that add functionality will need those maps to be public for testing.  However with that said this patch doesn&apos;t have those classes in it, so if you prefer I could make them protected and change that when needed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The stuff below where we have a static boolean and in constructor we test something already created could be a PITA in minihbase setups? Does it have to be static? Aren&apos;t we slinging singletons here anyways? (The singletons are ok in minihbasecontext too?):&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We are currently slinging a singleton.  However when we add in more than just replication metrics we&apos;ll have more than one BaseMetricsSourceImpl.  The DefaultMetricsSystem.initialize call can be done multiple times as long as it&apos;s inited with the same string, however it complains quite loudly in logs.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&apos;hasInited&apos; is name of a method that tests &apos;inited&apos; variable... suggest changing its name.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure.  Something like defaultMetricsInited&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What about that jmx mess registering metrics in tests? The exception saying metrics already registered because we have more than one daemon in the one jvm. We still have that issue here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We&apos;ll still have that.  A little bit less spam but not completely gone.  Basically when all metrics are moved to metrics2 we&apos;ll see 4 or 5 log messages (one per dupe of ReplicationMeticsSource et al.) rather than the massive ammount we see now.&lt;br/&gt;
Maybe on test we should silience the junit messages from those classes ?  Probably a good issue to file for the metrics clean up.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do we have to have metrics2 package? Can this new stuff be in the metrics package?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Nope.  Earlier you were asking to remove it.  So everything is in the metrics namespace.  That should make things a little nicer if we go the DI route, that&apos;s being discussed on the mailing list, and someone wants to go back to the old hadoop metrics.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I thought I saw a patch where you&apos;d renamed the properties file to what LarsG suggested?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Nope just replied that we could.  That file needs some examples and other love (ganglia examples and examples for regionserver/rest).  Seems like a good issue for me to file after this.&lt;/p&gt;

&lt;p&gt;I&apos;ll clean up the two javadocs tomorrow morning.&lt;/p&gt;</comment>
                            <comment id="13413844" author="eclark" created="Fri, 13 Jul 2012 16:10:06 +0000"  >&lt;p&gt;Addressed stack&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13413872" author="hadoopqa" created="Fri, 13 Jul 2012 17:01:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536404/HBASE-4050-8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536404/HBASE-4050-8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 11 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 10 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.catalog.TestMetaReaderEditor&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2383//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13413945" author="eclark" created="Fri, 13 Jul 2012 18:37:31 +0000"  >&lt;p&gt;Test failure looks un-related.  Works on my machine.&lt;/p&gt;</comment>
                            <comment id="13416543" author="zhihyu@ebaysf.com" created="Tue, 17 Jul 2012 20:05:18 +0000"  >&lt;p&gt;Would integrate the patch later this afternoon if there is no further review comment.&lt;/p&gt;</comment>
                            <comment id="13416592" author="alexb" created="Tue, 17 Jul 2012 21:00:23 +0000"  >&lt;p&gt;Should I add metric sources for RegionServer and Master in a patch? (those from 4050-metrics-v3.patch)&lt;/p&gt;</comment>
                            <comment id="13416599" author="zhihyu@ebaysf.com" created="Tue, 17 Jul 2012 21:05:15 +0000"  >&lt;p&gt;How long would it take to align them with the work from Elliot ?&lt;/p&gt;</comment>
                            <comment id="13416601" author="alexb" created="Tue, 17 Jul 2012 21:08:00 +0000"  >&lt;p&gt;Let me try to do that in coming hour or two. If not - you can proceed without it. I guess.&lt;/p&gt;</comment>
                            <comment id="13416602" author="eclark" created="Tue, 17 Jul 2012 21:08:43 +0000"  >&lt;p&gt;Lets do those in another issue.  I&apos;m planning on creating an umbrella jira for the move to metrics2.  This would probably also be where most of the metrics clean up work, that lars was asking for, would be listed under.&lt;/p&gt;

&lt;p&gt;So Far I have:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Investigate moving to DI (guice) framework for plugin arch.&lt;/li&gt;
	&lt;li&gt;Naming and documenting of the hadoop-metrics2.properties file&lt;/li&gt;
	&lt;li&gt;Create histogram class for metrics 2&lt;/li&gt;
	&lt;li&gt;Move RegionServer Metrics to metrics2&lt;/li&gt;
	&lt;li&gt;Move Master Metrics to metrics 2&lt;/li&gt;
	&lt;li&gt;Move external servers to metrics2 (thrift,thrift2,rest)&lt;/li&gt;
	&lt;li&gt;Investigate having hbase-env.sh decide which hadoop-compat to include&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13416606" author="alexb" created="Tue, 17 Jul 2012 21:13:29 +0000"  >&lt;p&gt;This works too.&lt;/p&gt;

&lt;p&gt;I was going to add &quot;almost empty&quot; placeholders for these points:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Move RegionServer Metrics to metrics2&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Move Master Metrics to metrics 2&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With one metric in each. So that actual moving of metrics can be done separately by placing them in these classes, as was discussed in the first part of comments for the issue. Can do that as a part of other issue (I&apos;d say the code + some unit-test is there, in that early patch)&lt;/p&gt;</comment>
                            <comment id="13416608" author="zhihyu@ebaysf.com" created="Tue, 17 Jul 2012 21:14:02 +0000"  >&lt;p&gt;The above is a nice list.&lt;br/&gt;
The title of this JIRA is general sounding.&lt;br/&gt;
Does it make sense to create the above sub-tasks (including Elliot&apos;s latest patch) under this JIRA ?&lt;/p&gt;</comment>
                            <comment id="13416628" author="eclark" created="Tue, 17 Jul 2012 21:34:47 +0000"  >&lt;p&gt;Doesn&apos;t matter to me too much&lt;/p&gt;</comment>
                            <comment id="13416653" author="eclark" created="Tue, 17 Jul 2012 22:05:51 +0000"  >&lt;p&gt;There.  After I saw Ted create the first sub task I created all the rest.  Alex I assigned some to you.  Feel free to assign them as you see fit.&lt;/p&gt;</comment>
                            <comment id="13416661" author="alexb" created="Tue, 17 Jul 2012 22:15:20 +0000"  >&lt;p&gt;2Elliott, just to understand:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;MetricsRegistry does not allow metrics to be removed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;1. As we don&apos;t use MetricsRegistry class and basically reimplementing it inside BaseMetricsSourceImpl, should we also allow adding tags (MetricsTag) there? Sounds like a useful feature.&lt;/p&gt;

&lt;p&gt;2. Why do we need to remove metrics?&lt;/p&gt;</comment>
                            <comment id="13416664" author="alexb" created="Tue, 17 Jul 2012 22:20:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;After I saw Ted create the first sub task I created all the rest. Alex I assigned some to you.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Great, thanx!&lt;/p&gt;</comment>
                            <comment id="13416665" author="eclark" created="Tue, 17 Jul 2012 22:20:53 +0000"  >&lt;ol&gt;
	&lt;li&gt;Yes that does for sure.&lt;/li&gt;
	&lt;li&gt;When replication sources are turned off we need to remove them.  Also pre region metrics and per table metrics need to be removed when they are no longer on a rs.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13416667" author="eclark" created="Tue, 17 Jul 2012 22:21:38 +0000"  >&lt;p&gt;s/pre region/per region/g&lt;/p&gt;</comment>
                            <comment id="13416681" author="alexb" created="Tue, 17 Jul 2012 22:46:02 +0000"  >&lt;p&gt;Looks to me that we are going to copy-paste MetricsRegistry with one addition: allow remove metrics. Not nice.&lt;/p&gt;

&lt;p&gt;Btw, it seems to me (if I&apos;m not mistaken) that there&apos;s a way to remove metric from MetricRegistry. Though it is far from nice, may be it is OK to depend on it and file a JIRA issue to allow removals? There&apos;s a method metrics() that returns map entries (in hadoop1) or map values (in hadoop2) which are backing internal map of metrics and thus can be used to remove items. However:&lt;br/&gt;
1. searching in list for item to remove is not performance efficient. Do we want to do it frequently? I suppose we may, but not sure&lt;br/&gt;
2. in general it&apos;s very bad to rely on implementation details (in future they can return copy of values collection)&lt;/p&gt;

&lt;p&gt;Having said that, is it better to duplicate MetricsRegistry class in our code or use/rely on that metrics() method for now + filing JIRA to allow metrics removals?&lt;/p&gt;</comment>
                            <comment id="13416709" author="zhihyu@ebaysf.com" created="Tue, 17 Jul 2012 23:26:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;filing JIRA to allow metrics removals&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 on above.&lt;/p&gt;</comment>
                            <comment id="13416736" author="eclark" created="Tue, 17 Jul 2012 23:53:46 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  Collection&amp;lt;MutableMetric&amp;gt; metrics()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Removing from a linked list (the collection backing the map in question) is icky.  I filed a jira a while ago.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8313&quot; title=&quot;Add the ability for MetricsRegistry to remove metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8313&quot;&gt;HADOOP-8313&lt;/a&gt;&lt;br/&gt;
yes this is not great.  As soon as possible I would love to remove the metrics factory and all related maps.  That would greatly simplify stuff.  I think we should get things working now and refactor away as soon as possible.&lt;/p&gt;</comment>
                            <comment id="13417793" author="alexb" created="Wed, 18 Jul 2012 22:51:40 +0000"  >&lt;p&gt;Looking at adding MetricSources for Master and RegionServer and have some Qs.&lt;/p&gt;

&lt;p&gt;1) MetricsSystem - always has name &quot;hbase&quot;? What if we want to try single-node cluster? Would be great to separate metrics systems. E.g. in Hadoop code I see &quot;datanode&quot;, &quot;namenode&quot;, &#8230;&lt;/p&gt;

&lt;p&gt;2) I was thinking to extract maps (counters &amp;amp; gauges) into separate class along with the code that manages them. I.e. in new hbase.MetricsRegistry. We can add then Tags in there, etc. I.e. this would be pretty much similar to org.apache.hadoop.metrics2.lib.MetricsRegistry, but will allow also removing metrics (also read the last piece of comment to see why we might want it as well). Thoughts? &lt;/p&gt;

&lt;p&gt;3) Does it make sense to create interfaces for MetricMutableGaugeLong and MetricMutableCounterLong and allow MetricSource implementations to create &amp;amp; obtain them? So that they could be fields in MetricSource classes. This would allow at least:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;access metrics much faster, without lookup in Map&lt;/li&gt;
	&lt;li&gt;this would remove &quot;proxy methods&quot; from BaseMetricsSourceImpl (or from MetricsRegistry, after extracting it) and will make easier to provide other implementations (in addition to counter &amp;amp; gauge), independently (i.e. without adding proxy methods in BaseMetricsSourceImpl).&lt;br/&gt;
Thoughts?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;4) In case of RegionServer and Master metrics I need to pass initialization parameters. By analogy with DataNode metrics, I&apos;d pass servername, sessionId. As we use ServiceLoader, there&apos;s no way to pass parameters to constructor. I was thinking about adding smth like init() method to the MasterMetricsSource (which is in common compat module), but looks not very nice and will not actually work very well with current BaseMetricsSource implementation as things are initialized in constructor there. I.e. I will have to change that and move things into init() method (doesn&apos;t look nice to me).&lt;/p&gt;

&lt;p&gt;Another thought. What if slightly &quot;move&quot; what is placed in compat module? What if we put there more &quot;lower-level&quot; intruments. We could: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;extract hbase.MetricRegistry as per above, make common interface for it and place in hadoop compat module, provide factory for creating hbase.MetricsRegistry there as well&lt;/li&gt;
	&lt;li&gt;define hbase.MetricSource interface with single method getMetricRegistry()&lt;/li&gt;
	&lt;li&gt;create service wrapper of DefaultMetricsSystem, which allows to register hbase.MetricsSource&lt;br/&gt;
  (in each hadoop1/2-compat modules hbase.MetricsSource.getMetricRegistry() can be used to implement hadoop.MetricSource&apos;s getMetrics() method via getting data from hbase.MetricsRegistry)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This way we will offer to MetricsSource implementations (in main hbase modules) lower-level tools and will be more flexible (e.g. with passing parameters to MetricSource implementation ctors). Also, MetricSource implementations (in main modules) will look closer to what was intended by Hadoop Metrics framework (judging by datanode/namenode metric sources). We could do what is mentioned in 3rd point above. E.g. typical metricSource will look like: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public class HMasterMetrics implements MetricsSource {
  final String name;
  [...]
  final MetricsRegistry registry = MetricsRegistryFactory.create(&quot;hmaster&quot;);

  final MutableCounterLong clusterRequests =
          registry.newCounter(&quot;cluster_requests&quot;, &quot;&quot;, 0);
  [&#8230;]

  public HMasterMetrics(final String name, final String sessionId) {
    this.name = name;
    JvmMetricsSourceFactory.create(&quot;HMaster&quot;, sessionId);
    registry.setContext(name).tag(&quot;sessionId&quot;, &quot;&quot;, sessionId);
  }

  @Override
  public MetricsRegistry getMetrics() {
    return registry;
  }

  public void incClusterRequests(int delta) {
    clusterRequests.inc(delta);
  }
  [&#8230;]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, it will be easier to move out wrom using this shim when it is no longer needed by easy switching these shim hbase.MetricsRegistry, hbase.MetricsSource, hbase.DefaultMetricsSystem classes to hadoop.* ones.&lt;/p&gt;

&lt;p&gt;I see a lot of benefits, but may be I&apos;m missing smth. The only fear is that by going with lower-level tools shims we might end up having more of these shim classes/interfaces (like adding shim MetricMutableGaugeLong and MetricMutableCounterLong interfaces in this case so far). Though this might not be that bad.&lt;/p&gt;

&lt;p&gt;Does it makes sense to you guys at all?&lt;/p&gt;

&lt;p&gt;I hope I&apos;m not acting counter-productive by suggesting changes to things that already work (the patch by Elliott)&lt;/p&gt;</comment>
                            <comment id="13417808" author="eclark" created="Wed, 18 Jul 2012 23:16:50 +0000"  >&lt;ol&gt;
	&lt;li&gt;I would like that, except I think that grouping things together all under an hbase node in jmx is nice.  Since hadoop too the top one.  That leaves us with sharing the metrics system name. So all of the contexts will have to be well named so that it&apos;s pretty evident which daemon they came from.&lt;/li&gt;
	&lt;li&gt;Sure.  That would make it easier to remove if we ever get all the methods that we need on the hadoop metrics registry.&lt;/li&gt;
	&lt;li&gt;But MetricMutableGaugeLong and MetricMutableCounterLong will never implement our interfaces so you would be forced to create whole wrapper classes around every class.  I think it would be better if sources just implemented specialized methods for interacting with known MetricMutable&apos;s.  Then you get all the speed and it abstracts the actual metrics from any code in hbase-server&lt;/li&gt;
	&lt;li&gt;I was going to handle this by having ServiceLoader find a factory implementation that creates an implementation of the source needed.&lt;/li&gt;
	&lt;li&gt;As far as moving SourceImpl into hbase-hadoop-compat.  It&apos;s not really possible because it needs to implement interfaces that come from hadoop.  And those interfaces refer to classes that have changed.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13417816" author="zhihyu@ebaysf.com" created="Wed, 18 Jul 2012 23:21:28 +0000"  >&lt;p&gt;Elliot&apos;s first patch used ResourceFinder which allowed passing initialization parameters to ctor.&lt;br/&gt;
Maybe revive that approach ?&lt;/p&gt;</comment>
                            <comment id="13417819" author="alexb" created="Wed, 18 Jul 2012 23:24:09 +0000"  >&lt;p&gt;Let me try to adjust patch to show what I meant&lt;/p&gt;</comment>
                            <comment id="13417895" author="alexb" created="Thu, 19 Jul 2012 00:25:05 +0000"  >&lt;p&gt;Tried to sketch what I suggested so that it is easier to follow. Haven&apos;t added implementations in hadoop1/2-compat modules of the interfaces I added to hadoop-compat, but they should be pretty much clear: they will be just wrappers/proxies on top of hadoop.metrics2 classes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;you would be forced to create whole wrapper classes around every class.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah.. That is what I meant by &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The only fear is that by going with lower-level tools shims we might end up having more of these shim classes/interfaces &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure how many of them will be needed, i.e. can&apos;t say how much bad it is. I believe we&apos;ll need just several (Elliott&apos;s patch uses just 2) and their interfaces are very small.&lt;/p&gt;


&lt;p&gt;Anyhow, I will be completely OK if you turn down my suggestion. Just wanted to share thoughts in which I saw some benefits (though there are cons as well)&lt;/p&gt;</comment>
                            <comment id="13417922" author="eclark" created="Thu, 19 Jul 2012 01:05:04 +0000"  >&lt;p&gt;It took me a little to get the patch to apply.  &lt;/p&gt;

&lt;p&gt;Looking at it, I don&apos;t see anything that&apos;s implementing hadoop 1 or 2&apos;s MetricSource so none of the metrics implemented in this patch will get exposed.  Implementing that part is the part that convinced me that most of the implementation of BaseMetricsSourceImpl needed to be in Hbase-hadoop&lt;/p&gt;
{1,2}
&lt;p&gt;-compat.  Just a registry is not enough to have things exposed through metrics.&lt;/p&gt;

&lt;p&gt;We should move this discussion to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6411&quot; title=&quot;Move Master Metrics to metrics 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6411&quot;&gt;&lt;del&gt;HBASE-6411&lt;/del&gt;&lt;/a&gt; since this was converted to an umbrella issue and 6411 is for master.&lt;/p&gt;</comment>
                            <comment id="13418354" author="alexb" created="Thu, 19 Jul 2012 15:17:25 +0000"  >&lt;p&gt;Ok... Added all implementations, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6411&quot; title=&quot;Move Master Metrics to metrics 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6411&quot;&gt;&lt;del&gt;HBASE-6411&lt;/del&gt;&lt;/a&gt;. Also added unit-test to actually test the metrics values (I guess this is smth we need to add for ReplicationMetricSources as well).&lt;/p&gt;</comment>
                            <comment id="13442830" author="hudson" created="Tue, 28 Aug 2012 00:19:03 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #151 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/151/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4050&quot; title=&quot;Update HBase metrics framework to metrics2 framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4050&quot;&gt;&lt;del&gt;HBASE-4050&lt;/del&gt;&lt;/a&gt; Combine Master Metrics into a single class (Revision 1377896)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSource.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics/ReplicationMetricsSource.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceFactoryImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics/ReplicationMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSource&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSourceFactory&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/test/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/test/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceFactoryImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics/ReplicationMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSource&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSourceFactory&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MXBean.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MXBeanImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsWrapperImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMXBean.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/metrics&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/metrics/TestMasterMetricsWrapper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13442838" author="hudson" created="Tue, 28 Aug 2012 00:31:18 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3286 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3286/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3286/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4050&quot; title=&quot;Update HBase metrics framework to metrics2 framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4050&quot;&gt;&lt;del&gt;HBASE-4050&lt;/del&gt;&lt;/a&gt; Combine Master Metrics into a single class (Revision 1377896)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSource.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics/ReplicationMetricsSource.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceFactoryImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics/ReplicationMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSource&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSourceFactory&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/test/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/test/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceFactoryImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/replication/regionserver/metrics/ReplicationMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSource&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/resources/META-INF/services/org.apache.hadoop.hbase.master.metrics.MasterMetricsSourceFactory&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImplTest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MXBean.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MXBeanImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsWrapperImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMXBean.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/metrics&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/metrics/TestMasterMetricsWrapper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13448525" author="hudson" created="Wed, 5 Sep 2012 06:50:47 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3304 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3304/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3304/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4050&quot; title=&quot;Update HBase metrics framework to metrics2 framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4050&quot;&gt;&lt;del&gt;HBASE-4050&lt;/del&gt;&lt;/a&gt; Clean up BaseMetricsSourceImpl (Revision 1381008)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13448650" author="hudson" created="Wed, 5 Sep 2012 11:39:38 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #160 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/160/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/160/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4050&quot; title=&quot;Update HBase metrics framework to metrics2 framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4050&quot;&gt;&lt;del&gt;HBASE-4050&lt;/del&gt;&lt;/a&gt; Clean up BaseMetricsSourceImpl (Revision 1381008)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/master/metrics/MasterMetricsSourceImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/metrics/BaseMetricsSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13459368" author="stack" created="Thu, 20 Sep 2012 05:58:10 +0000"  >&lt;p&gt;What is to be done w/ the patches on this issue?  They are taken up elsewhere?  The commit above probably came of a commit of another issue that had wrong JIRA number is my guess.&lt;/p&gt;</comment>
                            <comment id="13459386" author="eclark" created="Thu, 20 Sep 2012 06:47:14 +0000"  >&lt;p&gt;One of the patches above was the one that added the compat jars and the first versions of some of the classes that were used. A couple patches have since been committed with hbase-4050 in the commit message even though the code was from sub-issues.&lt;/p&gt;

&lt;p&gt;This really has one issue left to solve and then the metrics2 move will be complete.  Now that all testing is possible and all the helper classes are in (MetricsAssertHelper, MetricsHistogram, and MetricQuantile) just the region server is left.  I&apos;ll start work on that.  However it will be the most detail oriented so it might take a little longer than some of the other sub-issues.&lt;/p&gt;</comment>
                            <comment id="13633523" author="enis" created="Tue, 16 Apr 2013 22:58:25 +0000"  >&lt;p&gt;Last update indicates that there is still some more work to be done on this. Elliot, since this is a critical, would you be able to work on it by 0.95.1 or 0.95.2 timeframe. &lt;/p&gt;</comment>
                            <comment id="13633531" author="eclark" created="Tue, 16 Apr 2013 23:05:42 +0000"  >&lt;p&gt;There&apos;s an apache blog post explaining all this that should be up soon.&lt;/p&gt;</comment>
                            <comment id="13648766" author="stack" created="Fri, 3 May 2013 20:23:58 +0000"  >&lt;p&gt;Just waiting on doc.  All else is in.&lt;/p&gt;</comment>
                            <comment id="13687430" author="eclark" created="Wed, 19 Jun 2013 00:20:49 +0000"  >&lt;p&gt;All of the tasks that must be done have been completed.&lt;/p&gt;


&lt;p&gt;Yay&lt;/p&gt;</comment>
                            <comment id="13687480" author="stack" created="Wed, 19 Jun 2013 01:10:54 +0000"  >&lt;p&gt;whhop!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12597355">HBASE-6323</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12633093">HBASE-7882</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12527065">HADOOP-7742</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12541011">HBASE-5325</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12542272">HADOOP-8061</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12463170">HADOOP-6728</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12535507" name="4050-metrics-v2.patch" size="13058" author="zhihyu@ebaysf.com" created="Sat, 7 Jul 2012 05:29:06 +0000"/>
                            <attachment id="12535542" name="4050-metrics-v3.patch" size="23917" author="alexb" created="Sat, 7 Jul 2012 19:20:31 +0000"/>
                            <attachment id="12536162" name="HBASE-4050-0.patch" size="123459" author="eclark" created="Thu, 12 Jul 2012 01:54:52 +0000"/>
                            <attachment id="12536167" name="HBASE-4050-1.patch" size="123415" author="eclark" created="Thu, 12 Jul 2012 03:41:34 +0000"/>
                            <attachment id="12536174" name="HBASE-4050-2.patch" size="125593" author="eclark" created="Thu, 12 Jul 2012 05:17:01 +0000"/>
                            <attachment id="12536282" name="HBASE-4050-3.patch" size="99899" author="eclark" created="Thu, 12 Jul 2012 20:51:39 +0000"/>
                            <attachment id="12536301" name="HBASE-4050-5.patch" size="99607" author="eclark" created="Thu, 12 Jul 2012 23:20:07 +0000"/>
                            <attachment id="12536327" name="HBASE-4050-6.patch" size="100559" author="eclark" created="Fri, 13 Jul 2012 03:01:11 +0000"/>
                            <attachment id="12536329" name="HBASE-4050-7.patch" size="100569" author="eclark" created="Fri, 13 Jul 2012 03:05:19 +0000"/>
                            <attachment id="12536404" name="HBASE-4050-8.patch" size="101347" author="eclark" created="Fri, 13 Jul 2012 16:10:06 +0000"/>
                            <attachment id="12537105" name="HBASE-4050-8_1.patch" size="20842" author="alexb" created="Thu, 19 Jul 2012 00:25:05 +0000"/>
                            <attachment id="12535495" name="HBASE-4050.patch" size="12929" author="alexb" created="Sat, 7 Jul 2012 01:26:50 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12599173">HBASE-6405</subtask>
                            <subtask id="12599176">HBASE-6407</subtask>
                            <subtask id="12599180">HBASE-6411</subtask>
                            <subtask id="12603793">HBASE-6598</subtask>
                            <subtask id="12599177">HBASE-6408</subtask>
                            <subtask id="12599181">HBASE-6412</subtask>
                            <subtask id="12606184">HBASE-6718</subtask>
                            <subtask id="12599178">HBASE-6409</subtask>
                            <subtask id="12607693">HBASE-6791</subtask>
                            <subtask id="12601232">HBASE-6501</subtask>
                            <subtask id="12599179">HBASE-6410</subtask>
                            <subtask id="12613949">HBASE-7062</subtask>
                            <subtask id="12618615">HBASE-7262</subtask>
                            <subtask id="12599182">HBASE-6413</subtask>
                            <subtask id="12608130">HBASE-6809</subtask>
                            <subtask id="12615252">HBASE-7121</subtask>
                            <subtask id="12606169">HBASE-6717</subtask>
                            <subtask id="12614090">HBASE-7074</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Jul 2011 23:29:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ctf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72710</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.96notable</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>