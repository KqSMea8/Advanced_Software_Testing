<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:42:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7034/HBASE-7034.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7034] Bad version, failed OPENING to OPENED but master thinks it is open anyways</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7034</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have this in RS log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-10-22 02:21:50,698 ERROR org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Failed transitioning node b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. from OPENING to OPENED -- closing region
org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Master says this (it is bulk assigning):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
....
2012-10-22 02:21:40,673 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Set watcher on existing znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
...

then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
....

2012-10-22 02:23:47,089 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Set watcher on existing znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
....
2012-10-22 02:24:34,176 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Retrieved 112 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;(s) of data from znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f and set watcher; region=b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f., origin=sv4r17s44,10304,1350872216778, state=RS_ZK_REGION_OPENED

etc.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Disagreement as to what is going on here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12613097">HBASE-7034</key>
            <summary>Bad version, failed OPENING to OPENED but master thinks it is open anyways</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anoopsamjohn">Anoop Sam John</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Oct 2012 06:37:24 +0000</created>
                <updated>Tue, 26 Feb 2013 08:27:17 +0000</updated>
                            <resolved>Fri, 18 Jan 2013 00:03:19 +0000</resolved>
                                    <version>0.94.2</version>
                                    <fixVersion>0.94.5</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13482160" author="ram_krish" created="Tue, 23 Oct 2012 06:46:20 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
This happens in 0.94.2? Which RS failed in transitioning the node to OPENED? new one or the one which already transitioned to OPENED?&lt;br/&gt;
Sorry for the questions as there are no full logs i had these doubts.  Thanks Stack for reporting this, it should be useful for us also.&lt;/p&gt;</comment>
                            <comment id="13482739" author="stack" created="Tue, 23 Oct 2012 21:58:25 +0000"  >&lt;p&gt;Here is more from log Ram.&lt;/p&gt;

&lt;p&gt;Master side listing of all lines related to 1349052737638.9af7cfc9b15910a0b3d714bf40a3248f&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-10-22 02:20:01,351 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:10302-0xb3a862e57a503ba Async create of unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 9af7cfc9b15910a0b3d714bf40a3248f with OFFLINE state
2012-10-22 02:20:24,577 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Set watcher on existing znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:21:08,770 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$CreateUnassignedAsyncCallback: rs=b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. state=OFFLINE, ts=1350872401351, server=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, server=sv4r17s44,10304,1350872216778
2012-10-22 02:21:09,495 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$ExistsUnassignedAsyncCallback: rs=b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. state=OFFLINE, ts=1350872401351, server=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2012-10-22 02:21:40,673 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Set watcher on existing znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:23:47,089 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Set watcher on existing znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:24:34,154 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher: master:10302-0xb3a862e57a503ba Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:24:34,176 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Retrieved 112 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;(s) of data from znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f and set watcher; region=b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f., origin=sv4r17s44,10304,1350872216778, state=RS_ZK_REGION_OPENED
2012-10-22 02:24:34,176 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENED, server=sv4r17s44,10304,1350872216778, region=9af7cfc9b15910a0b3d714bf40a3248f, which is more than 15 seconds late
2012-10-22 02:24:34,176 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Handling OPENED event &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. from sv4r17s44,10304,1350872216778; deleting unassigned node
2012-10-22 02:24:34,176 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:10302-0xb3a862e57a503ba Deleting existing unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 9af7cfc9b15910a0b3d714bf40a3248f that is in expected state RS_ZK_REGION_OPENED
2012-10-22 02:24:34,221 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: master:10302-0xb3a862e57a503ba Retrieved 112 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;(s) of data from znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f; data=region=b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f., origin=sv4r17s44,10304,1350872216778, state=RS_ZK_REGION_OPENED
2012-10-22 02:24:34,239 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:10302-0xb3a862e57a503ba Successfully deleted unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region 9af7cfc9b15910a0b3d714bf40a3248f in expected state RS_ZK_REGION_OPENED
2012-10-22 02:27:09,169 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher: master:10302-0xb3a862e57a503ba Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:27:09,169 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: The znode of region b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. has been deleted.
2012-10-22 02:27:09,174 INFO org.apache.hadoop.hbase.master.AssignmentManager: The master has opened the region b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. that was online on sv4r17s44,10304,1350872216778

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above is being processed some minutes after the regionserver (see below) I guess because it is a bulk assign and there is a lot of other zk&apos;ing going on at this time.&lt;/p&gt;

&lt;p&gt;Here is the regionserver side.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-10-22 02:21:34,778 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:10304-0xd3a863aa2ee011a Attempting to transition node 9af7cfc9b15910a0b3d714bf40a3248f from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED
2012-10-22 02:21:34,801 DEBUG org.apache.hadoop.hbase.zookeeper.ZKUtil: regionserver:10304-0xd3a863aa2ee011a Retrieved 112 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;(s) of data from znode /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f; data=region=b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f., origin=sv4r17s44,10304,1350872216778, state=RS_ZK_REGION_OPE
NING
2012-10-22 02:21:48,240 WARN org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper: Possibly &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; ZooKeeper exception: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:21:50,698 ERROR org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Failed transitioning node b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f. from OPENING to OPENED -- closing region
org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/unassigned/9af7cfc9b15910a0b3d714bf40a3248f
2012-10-22 02:21:50,698 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Closing b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f.: disabling compactions &amp;amp; flushes
2012-10-22 02:21:50,698 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Updates disabled &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f.
2012-10-22 02:21:50,703 INFO org.apache.hadoop.hbase.regionserver.HRegion: Closed b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f.
2012-10-22 02:43:35,980 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: NotServingRegionException; Region is not online: b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f.
2012-10-22 02:43:36,392 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: NotServingRegionException; Region is not online: b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f.
2012-10-22 02:43:37,012 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: NotServingRegionException; Region is not online: b9,\xEE\xAE\x9BiQO\x89]+a\xE0\x7F\xB7&apos;X?,1349052737638.9af7cfc9b15910a0b3d714bf40a3248f.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the client keeps coming here because it was here previously before the restart so that is what is in the .META. table for the location.&lt;/p&gt;</comment>
                            <comment id="13550900" author="anoopsamjohn" created="Fri, 11 Jan 2013 06:58:03 +0000"  >&lt;p&gt;Is this code came in by mistake?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RecoverableZooKeeper#setData(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] data, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; version){
....
  &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] revData = zk.getData(path, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, stat);
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; idLength = Bytes.toInt(revData, ID_LENGTH_SIZE);
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dataLength = revData.length-ID_LENGTH_SIZE-idLength;
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dataOffset = ID_LENGTH_SIZE+idLength;
  
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(Bytes.compareTo(revData, ID_LENGTH_SIZE, id.length, 
	  revData, dataOffset, dataLength) == 0) {
	&lt;span class=&quot;code-comment&quot;&gt;// the bad version is caused by previous successful setData
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; stat;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When we write the data to zk, we write an identifier for the process. Here in order to check whether the BADVERSION exception from zookeeper is due to a previous setData (from the same process), we need to compare the id read from the zookeeper and the id for this process (this.id).. Or am I missing some thing. The above offset and length calculating math and compare looks problematic for me.&lt;/p&gt;

&lt;p&gt;In that case this is the issue for this bug I guess.&lt;/p&gt;

&lt;p&gt;From the log it is clear that there is no problem wrt the node and version at 1st. &lt;span class=&quot;error&quot;&gt;&amp;#91;As part of the transition of state from OPENING to OPENED 1st the present data is read and the check below tells the data and its version every thing is fine.&amp;#93;&lt;/span&gt; Immediately a connection loss happened. This triggers a retry for the setData. May be the previous operation made the data change in zookeeper and master got the data changed event. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think correcting the above code may solve the problems.&lt;/p&gt;</comment>
                            <comment id="13551942" author="anoopsamjohn" created="Sat, 12 Jan 2013 15:25:02 +0000"  >&lt;p&gt;Will submit patch .&lt;/p&gt;</comment>
                            <comment id="13552348" author="stack" created="Sun, 13 Jan 2013 23:13:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; You mean this bit Anoop?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(Bytes.compareTo(revData, ID_LENGTH_SIZE, id.length, 
	  revData, dataOffset, dataLength) == 0) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13552444" author="anoopsamjohn" created="Mon, 14 Jan 2013 05:43:20 +0000"  >&lt;p&gt;Yep the same. What does this compare? &lt;/p&gt;</comment>
                            <comment id="13553523" author="stack" created="Tue, 15 Jan 2013 05:51:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; I don&apos;t know (I would swear we were in here recently looking at this exact area of the code..)&lt;/p&gt;</comment>
                            <comment id="13553536" author="anoopsamjohn" created="Tue, 15 Jan 2013 06:10:37 +0000"  >&lt;p&gt;Stack - I will try with some sort of unit tests. I believe this caused the issue&lt;/p&gt;</comment>
                            <comment id="13554021" author="anoopsamjohn" created="Tue, 15 Jan 2013 17:22:30 +0000"  >&lt;p&gt;Unit test case which clearly reproduces the issue with retry. Ideally the test case should not throw any Exception as the 1st call to setData actually sets the data and then throw ConnectionLossException. The subsequent call to setData in retry loop will throw BadVersionException from zookeeper layer but RecoverableZK should catch it and think the op as success&lt;/p&gt;</comment>
                            <comment id="13554022" author="anoopsamjohn" created="Tue, 15 Jan 2013 17:23:09 +0000"  >&lt;p&gt;Patch for 94 version. Pls review&lt;/p&gt;</comment>
                            <comment id="13554042" author="yuzhihong@gmail.com" created="Tue, 15 Jan 2013 17:42:35 +0000"  >&lt;p&gt;Patch looks good - TestRecoverableZooKeeper passes with patch and fails without patch.&lt;/p&gt;

&lt;p&gt;Can you add TestRecoverableZooKeeper to the patch as well ?&lt;br/&gt;
Please add license header and test category to TestRecoverableZooKeeper.&lt;/p&gt;</comment>
                            <comment id="13554144" author="ram_krish" created="Tue, 15 Jan 2013 18:53:54 +0000"  >&lt;p&gt;@Anoop&lt;br/&gt;
I feel that we should check for the data part whether it was set correctly.  The id part is any way going to be the same i feel.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;we need to compare the id read from the zookeeper and the id for this process (this.id)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Just referring to the above comment.  I may be wrong.  I know you would have done sufficient study on this.&lt;/p&gt;</comment>
                            <comment id="13554663" author="anoopsamjohn" created="Wed, 16 Jan 2013 02:14:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I feel that we should check for the data part whether it was set correctly. The id part is any way going to be the same i feel.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes Ram. I am also thinking so. This was not final patch any way. Was thinking that I can do this in final patch. This was for the feedback from you guys. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  As I read from the code the intent was to check this process id against the id in the zoo data. This is to check while this process try to change the data in the zookeeper another process changed that already or not. In such a case this process will give up this op. That is the whole reason why we add the id stuff in the data.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The old check was any way wrong which compare the id against data.&lt;/p&gt;

&lt;p&gt;Yes Ted I can add the test case in the final patch.&lt;/p&gt;</comment>
                            <comment id="13555165" author="anoopsamjohn" created="Wed, 16 Jan 2013 16:16:26 +0000"  >&lt;p&gt;Patch for 94. Added the test case also. As Ram said the data check is also added.&lt;/p&gt;</comment>
                            <comment id="13556334" author="yuzhihong@gmail.com" created="Thu, 17 Jan 2013 16:00:43 +0000"  >&lt;p&gt;+1 on patch v2.&lt;/p&gt;

&lt;p&gt;Patch v2 aligns with trunk code. It would be nice to have a trunk patch which contains the new test.&lt;/p&gt;</comment>
                            <comment id="13556354" author="anoopsamjohn" created="Thu, 17 Jan 2013 16:30:45 +0000"  >&lt;p&gt;Oh.. Now when I seen the trunk code to apply the fix, it is already fixed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; How we missed 94 then!!&lt;/p&gt;</comment>
                            <comment id="13556356" author="anoopsamjohn" created="Thu, 17 Jan 2013 16:32:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;It would be nice to have a trunk patch which contains the new test.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Let me make that then Ted.&lt;br/&gt;
Didn&apos;t seen your comment. I was trying to apply the fix in trunk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13556396" author="yuzhihong@gmail.com" created="Thu, 17 Jan 2013 17:36:34 +0000"  >&lt;p&gt;Ran the new test and it passed in both 0.94 and trunk.&lt;/p&gt;

&lt;p&gt;Integrated to 0.94 and trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Anoop.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Ram.&lt;/p&gt;</comment>
                            <comment id="13556470" author="hudson" created="Thu, 17 Jan 2013 19:00:30 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #355 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/355/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/355/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7034&quot; title=&quot;Bad version, failed OPENING to OPENED but master thinks it is open anyways&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7034&quot;&gt;&lt;del&gt;HBASE-7034&lt;/del&gt;&lt;/a&gt; Bad version, failed OPENING to OPENED but master thinks it is open anyways (Anoop) (Revision 1434800)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/zookeeper/TestRecoverableZooKeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13556522" author="hudson" created="Thu, 17 Jan 2013 19:48:14 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3762 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3762/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3762/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7034&quot; title=&quot;Bad version, failed OPENING to OPENED but master thinks it is open anyways&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7034&quot;&gt;&lt;del&gt;HBASE-7034&lt;/del&gt;&lt;/a&gt; Bad version, failed OPENING to OPENED but master thinks it is open anyways (Anoop) (Revision 1434800)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/zookeeper/TestRecoverableZooKeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13556556" author="hudson" created="Thu, 17 Jan 2013 20:21:06 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #743 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/743/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/743/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7034&quot; title=&quot;Bad version, failed OPENING to OPENED but master thinks it is open anyways&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7034&quot;&gt;&lt;del&gt;HBASE-7034&lt;/del&gt;&lt;/a&gt; Bad version, failed OPENING to OPENED but master thinks it is open anyways (Anoop) (Revision 1434797)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestRecoverableZooKeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13557366" author="ram_krish" created="Fri, 18 Jan 2013 17:19:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6858&quot; title=&quot;Fix the incorrect BADVERSION checking in the recoverable zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6858&quot;&gt;&lt;del&gt;HBASE-6858&lt;/del&gt;&lt;/a&gt; has the fix for trunk.&lt;/p&gt;</comment>
                            <comment id="13561725" author="hudson" created="Thu, 24 Jan 2013 16:04:50 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #96 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/96/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/96/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7034&quot; title=&quot;Bad version, failed OPENING to OPENED but master thinks it is open anyways&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7034&quot;&gt;&lt;del&gt;HBASE-7034&lt;/del&gt;&lt;/a&gt; Bad version, failed OPENING to OPENED but master thinks it is open anyways (Anoop) (Revision 1434797)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestRecoverableZooKeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13570983" author="hudson" created="Tue, 5 Feb 2013 03:58:27 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #11 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/11/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/11/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7034&quot; title=&quot;Bad version, failed OPENING to OPENED but master thinks it is open anyways&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7034&quot;&gt;&lt;del&gt;HBASE-7034&lt;/del&gt;&lt;/a&gt; Bad version, failed OPENING to OPENED but master thinks it is open anyways (Anoop) (Revision 1434797)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestRecoverableZooKeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12564958" name="HBASE-7034_94.patch" size="1168" author="anoopsamjohn" created="Tue, 15 Jan 2013 17:23:09 +0000"/>
                            <attachment id="12565142" name="HBASE-7034_94_V2.patch" size="6010" author="anoopsamjohn" created="Wed, 16 Jan 2013 16:38:56 +0000"/>
                            <attachment id="12565343" name="HBASE-7034_Test_Trunk.patch" size="5043" author="anoopsamjohn" created="Thu, 17 Jan 2013 16:34:48 +0000"/>
                            <attachment id="12564957" name="TestRecoverableZooKeeper.java" size="3312" author="anoopsamjohn" created="Tue, 15 Jan 2013 17:22:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Oct 2012 06:46:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ayxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61933</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>