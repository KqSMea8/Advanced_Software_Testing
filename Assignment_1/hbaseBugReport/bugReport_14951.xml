<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:58:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14951/HBASE-14951.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14951] Make hbase.regionserver.maxlogs obsolete</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14951</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There was a discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14388&quot; title=&quot;Compaction improvements: Avoid flush storms by jittering flush interval and max log files &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14388&quot;&gt;HBASE-14388&lt;/a&gt; related to maximum number of log files. It was an agreement that we should calculate this number in a code but still need to honor user&apos;s setting. &lt;/p&gt;

&lt;p&gt;Maximum number of log files now is calculated as following:&lt;br/&gt;
 maxLogs = HEAP_SIZE * memstoreRatio * 2/ LogRollSize&lt;/p&gt;</description>
                <environment></environment>
        <key id="12920199">HBASE-14951</key>
            <summary>Make hbase.regionserver.maxlogs obsolete</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vrodionov">Vladimir Rodionov</assignee>
                                    <reporter username="vrodionov">Vladimir Rodionov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2015 21:42:15 +0000</created>
                <updated>Tue, 22 Dec 2015 21:11:43 +0000</updated>
                            <resolved>Wed, 16 Dec 2015 23:08:16 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Performance</component>
                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="15047544" author="vrodionov" created="Tue, 8 Dec 2015 21:58:32 +0000"  >&lt;p&gt;Patch.&lt;/p&gt;</comment>
                            <comment id="15047616" author="enis" created="Tue, 8 Dec 2015 22:43:34 +0000"  >&lt;p&gt;Just some numbers for comparison&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; heap &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; memstore perc &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; maxLogs &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1G &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 40% &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 8 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2G &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 40% &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 16 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 10G &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 40% &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 80 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 20G &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 40% &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 160 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 32G &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 40% &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 256 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Do we need to do &lt;tt&gt;max(32, calculateMaxLogFiles(..))&lt;/tt&gt; given that with 1G default it is 8 now? &lt;/p&gt;

&lt;p&gt;There is some discrepancy between the memstore size of edits and the WAL size of the edits, but 2x multiplier I guess accounts for that. &lt;/p&gt;
</comment>
                            <comment id="15047636" author="vrodionov" created="Tue, 8 Dec 2015 22:56:26 +0000"  >&lt;p&gt;The idea is to avoid premature memstore flush due to max log files. 32 is too small. Should not be capped. &lt;/p&gt;</comment>
                            <comment id="15047770" author="vrodionov" created="Wed, 9 Dec 2015 00:27:27 +0000"  >&lt;p&gt;v2.&lt;/p&gt;</comment>
                            <comment id="15047862" author="hadoopqa" created="Wed, 9 Dec 2015 02:00:58 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776411/HBASE-14951-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776411/HBASE-14951-v1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 2430efc2b2f2ec43e6ae1f88b6ebcb04f4e116c4.&lt;br/&gt;
  ATTACHMENT ID: 12776411&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16797//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15048109" author="hadoopqa" created="Wed, 9 Dec 2015 06:09:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776453/HBASE-14951-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776453/HBASE-14951-v2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 2430efc2b2f2ec43e6ae1f88b6ebcb04f4e116c4.&lt;br/&gt;
  ATTACHMENT ID: 12776453&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16803//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15049185" author="enis" created="Wed, 9 Dec 2015 18:54:25 +0000"  >&lt;p&gt;+1. The checkstyle warning is this:  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java	LeftCurlyCheck	0	1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can fix it in commit. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; FYI. &lt;/p&gt;</comment>
                            <comment id="15052187" author="stack" created="Fri, 11 Dec 2015 05:11:26 +0000"  >&lt;p&gt;This is an interesting change ( &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;... this is something you&apos;ve been on about for ever.)&lt;/p&gt;

&lt;p&gt;The nice table does should go into the release notes.&lt;/p&gt;

&lt;p&gt;Also, any chance of a longer exposition on why the formula (I grep -r memstoreSizeRatio but find nothing... am I doing it wrong?)? Add this to release notes too because we need to hoist this up into the documentation for 2.0.&lt;/p&gt;

&lt;p&gt;Suggest marking this an incompatible change because it changes a fundamental behavior.&lt;/p&gt;

&lt;p&gt;On this:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...... It was an agreement that we should calculate this number in a code but still need to honor user&apos;s setting&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;... looking at patch, it seems to do as expected with nice warning....&lt;/p&gt;

&lt;p&gt;Patch seems good. Its a fundamental change in our behavior so needs the fat release note.  With that +1 (if the explanation makes sense &amp;#8211; smile)&lt;/p&gt;</comment>
                            <comment id="15052258" author="lhofhansl" created="Fri, 11 Dec 2015 06:22:12 +0000"  >&lt;p&gt;Yeah. Would love to get rid of this config option.&lt;/p&gt;

&lt;p&gt;Where the *2 come from in the formula? Just to account for WALEdit being larger than a memstore Cell?&lt;/p&gt;</comment>
                            <comment id="15056473" author="vrodionov" created="Mon, 14 Dec 2015 19:01:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Where the *2 come from in the formula?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just to make sure that we do not trigger memstore flushes only because we reached the max wal files limit. &lt;/p&gt;</comment>
                            <comment id="15056545" author="vrodionov" created="Mon, 14 Dec 2015 19:31:31 +0000"  >&lt;p&gt;Updated Release Notes. &lt;/p&gt;</comment>
                            <comment id="15056918" author="vrodionov" created="Mon, 14 Dec 2015 23:07:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; ping-ping&lt;/p&gt;</comment>
                            <comment id="15061007" author="enis" created="Wed, 16 Dec 2015 22:18:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; I was gonna commit this now to 1.2+. Should I hold on for the RC? &lt;/p&gt;</comment>
                            <comment id="15061022" author="busbey" created="Wed, 16 Dec 2015 22:25:54 +0000"  >&lt;p&gt;please go ahead. I&apos;ll send out a warning email about the branch once I make sure I have jira sufficiently cleaned up to make release notes.&lt;/p&gt;</comment>
                            <comment id="15061089" author="enis" created="Wed, 16 Dec 2015 23:08:16 +0000"  >&lt;p&gt;I&apos;ve pushed to 1.2+. Thanks Vladimir. Sorry I forgot to add the author at the commit message. &lt;/p&gt;</comment>
                            <comment id="15061202" author="hudson" created="Thu, 17 Dec 2015 00:21:47 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #345 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/345/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/345/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14951&quot; title=&quot;Make hbase.regionserver.maxlogs obsolete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14951&quot;&gt;&lt;del&gt;HBASE-14951&lt;/del&gt;&lt;/a&gt; Make hbase.regionserver.maxlogs obsolete (enis: rev 300da031fd35a037782f649d36ac9cd0d39fc3de)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061366" author="hudson" created="Thu, 17 Dec 2015 02:48:07 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #442 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/442/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/442/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14951&quot; title=&quot;Make hbase.regionserver.maxlogs obsolete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14951&quot;&gt;&lt;del&gt;HBASE-14951&lt;/del&gt;&lt;/a&gt; Make hbase.regionserver.maxlogs obsolete (enis: rev 8bd0d9dacd5c9d600615f65787323683850afeb2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061403" author="hudson" created="Thu, 17 Dec 2015 03:37:26 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #379 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/379/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/379/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14951&quot; title=&quot;Make hbase.regionserver.maxlogs obsolete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14951&quot;&gt;&lt;del&gt;HBASE-14951&lt;/del&gt;&lt;/a&gt; Make hbase.regionserver.maxlogs obsolete (enis: rev 8bd0d9dacd5c9d600615f65787323683850afeb2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061413" author="hudson" created="Thu, 17 Dec 2015 03:51:07 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #448 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/448/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/448/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14951&quot; title=&quot;Make hbase.regionserver.maxlogs obsolete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14951&quot;&gt;&lt;del&gt;HBASE-14951&lt;/del&gt;&lt;/a&gt; Make hbase.regionserver.maxlogs obsolete (enis: rev 300da031fd35a037782f649d36ac9cd0d39fc3de)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15061440" author="hudson" created="Thu, 17 Dec 2015 04:28:23 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #559 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/559/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/559/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14951&quot; title=&quot;Make hbase.regionserver.maxlogs obsolete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14951&quot;&gt;&lt;del&gt;HBASE-14951&lt;/del&gt;&lt;/a&gt; Make hbase.regionserver.maxlogs obsolete (enis: rev 3dec8582f527e4e7e35280cd34c4928648290658)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15068384" author="stack" created="Tue, 22 Dec 2015 16:47:23 +0000"  >&lt;p&gt;So, default now is 256 when before it was 32: i.e. usual heap size is 31G or so... and the default max WALs was 32 but with this algorithm, we get a max of 256 instead. Need to highlight this difference when we roll out 1.2 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Can you explain the *2 in the release note &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrodionov&quot; class=&quot;user-hover&quot; rel=&quot;vrodionov&quot;&gt;Vladimir Rodionov&lt;/a&gt;  *2 seems a bit arbitrary no? And if it is to stop blocking because too many WALs, is that going to happen now with these new limits?&lt;/p&gt;</comment>
                            <comment id="15068616" author="vrodionov" created="Tue, 22 Dec 2015 19:33:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Can you explain the *2 in the release note Vladimir Rodionov *2 seems a bit arbitrary no? And if it is to stop blocking because too many WALs, is that going to happen now with these new limits?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, 2 is arbitrary. We need to make sure that we avoid fully or minimize events when RS has to flush memstores prematurely only because it reached artificial limit of hbase.regionserver.maxlogs, this is why I put this  multiplier into equation, this gives us maximum WAL capacity of 2 x RS memstore-size. As for the second question,  we won&apos;t have runaway memstore files in any case, LogRoller will be archiving old WALs periodically (hbase.regionserver.logroll.period = 1 h, by default). User has three options, either override default  &lt;b&gt;hbase.regionserver.maxlogs&lt;/b&gt; or override default  &lt;b&gt;hbase.regionserver.logroll.period&lt;/b&gt;, or both to control runaway WALs. I will update Release notes.&lt;/p&gt;</comment>
                            <comment id="15068656" author="stack" created="Tue, 22 Dec 2015 20:09:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes, 2 is arbitrary.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok. Say so in release notes when explaining equation.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...artificial limit of hbase.regionserver.maxlogs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Its not artificial, though, right? We want to clean up WALs. If we have too many WALs, the MTTR suffers.. takes longer because more to replay.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;User has three options, either override default hbase.regionserver.maxlogs or override default hbase.regionserver.logroll.period, or both to control runaway WALs. I will update Release notes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m concerned about defaults. Users will only consider this option after their cluster has crashed and burned and won&apos;t start because thousands of WAL that need cleaning up preventing cluster coming back promptly.&lt;/p&gt;

&lt;p&gt;So with 2*, that means that if heap is 31G, then new default is 256 or is it 2* 256? Thanks V.&lt;/p&gt;</comment>
                            <comment id="15068712" author="vrodionov" created="Tue, 22 Dec 2015 20:45:07 +0000"  >&lt;blockquote&gt;
&lt;p&gt;So with 2*, that means that if heap is 31G, then new default is 256 or is it 2* 256? Thanks V.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;256.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I&apos;m concerned about defaults. Users will only consider this option after their cluster has crashed and burned and won&apos;t start because thousands of WAL that need cleaning up preventing cluster coming back promptly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To be on a safe side we need to decrease default of &lt;b&gt;hbase.regionserver.logroll.period&lt;/b&gt; (to, say 10min) and/or to mention this in release notes. With low &lt;b&gt;hbase.regionserver.logroll.period&lt;/b&gt;, the maximum number of wal files will be defined by the total size of memstore (unflushed data), not by the &lt;b&gt;hbase.regionserver.maxlogs&lt;/b&gt;. But for majority of applications I do not see any issue with defaults. Data will be flushed periodically from memstore, the LogRoller will archive old wals and we will never reach the new defaults for  &lt;b&gt;hbase.regionserver.maxlogs&quot;, unless we put system under extreme load for prolonged period of time, but in this case, decreasing  *hbase.regionserver.logroll.period&lt;/b&gt; allows us to control runaway wal files.&lt;/p&gt;

</comment>
                            <comment id="15068733" author="stack" created="Tue, 22 Dec 2015 21:11:43 +0000"  >&lt;p&gt;Nice release note. Thanks V.&lt;/p&gt;

&lt;p&gt;+1 for 2.0 and probably 1.3. Too big a change at too late a stage for 1.2 in my estimation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12776411" name="HBASE-14951-v1.patch" size="2636" author="vrodionov" created="Tue, 8 Dec 2015 21:58:32 +0000"/>
                            <attachment id="12776453" name="HBASE-14951-v2.patch" size="2660" author="vrodionov" created="Wed, 9 Dec 2015 00:27:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Dec 2015 22:43:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            51 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pmdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Rolling WAL events across a cluster can be highly correlated, hence flushing memstores, hence triggering minor compactions, that can be promoted to major ones. These events are highly correlated in time if there is a balanced write-load on the regions in a table. Default value for maximum WAL files (* hbase.regionserver.maxlogs*), which controls WAL rolling events - 32 is too small for many modern deployments. &lt;br/&gt;
Now we calculate this value dynamically (if not defined by user), using the following formula:&lt;br/&gt;
&lt;br/&gt;
maxLogs = Math.max( 32, HBASE_HEAP_SIZE * memstoreRatio * 2/ LogRollSize), where&lt;br/&gt;
&lt;br/&gt;
memstoreRatio is *hbase.regionserver.global.memstore.size*&lt;br/&gt;
LogRollSize is maximum WAL file size (default 0.95 * HDFS block size)&lt;br/&gt;
&lt;br/&gt;
We need to make sure that we avoid fully or minimize events when RS has to flush memstores prematurely only because it reached artificial limit of hbase.regionserver.maxlogs, this is why we put this 2 x multiplier in equation, this gives us maximum WAL capacity of 2 x RS memstore-size. &lt;br/&gt;
&lt;br/&gt;
Runaway WAL files.&lt;br/&gt;
&lt;br/&gt;
The default log rolling period (1h) allows to accumulate up to 2 X Memstore Size data in a WAL. For heap size - 32G and all other default setting, this gives ~ 26GB of data. Under heavy write load, the number of WAL files can increase dramatically. RegionServer LogRoller will be archiving old WALs periodically. User has three options, either override default hbase.regionserver.maxlogs or override default hbase.regionserver.logroll.period (decrease), or both to control runaway WALs.&lt;br/&gt;
&lt;br/&gt;
For system with bursty write load,  the hbase.regionserver.logroll.period can be decreased to lower value. In this case the maximum number of wal files will be defined by the total size of memstore (unflushed data), not by the hbase.regionserver.maxlogs. But for majority of applications there will be no issues with defaults. Data will be flushed periodically from memstore, the LogRoller will archive old wal files and the system will never reach the new defaults for hbase.regionserver.maxlogs, unless the system is under extreme load for prolonged period of time, but in this case, decreasing hbase.regionserver.logroll.period allows us to control runaway wal files.&lt;br/&gt;
&lt;br/&gt;
The following table gives the new default maximum log files values for several different Region Server heap sizes:&lt;br/&gt;
&lt;br/&gt;
heap	memstore perc	maxLogs&lt;br/&gt;
1G	        40%	                        32&lt;br/&gt;
2G	        40%	                        32&lt;br/&gt;
10G	        40%	                        80&lt;br/&gt;
20G	        40%	                        160&lt;br/&gt;
32G	        40%	                        256&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>