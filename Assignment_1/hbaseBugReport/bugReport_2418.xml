<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:01:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2418/HBASE-2418.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2418] add support for ZooKeeper authentication</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2418</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Some users may run a ZooKeeper cluster in &quot;multi tenant mode&quot; meaning that more than one client service would&lt;br/&gt;
like to share a single ZooKeeper service instance (cluster). In this case the client services typically want to protect&lt;br/&gt;
their data (ZK znodes) from access by other services (tenants) on the cluster. Say you are running HBase and Solr &lt;br/&gt;
and Neo4j, or multiple HBase instances, etc... having authentication/authorization on the znodes is important for both &lt;br/&gt;
security and helping to ensure that services don&apos;t interact negatively (touch each other&apos;s data).&lt;/p&gt;

&lt;p&gt;Today HBase does not have support for authentication or authorization. This should be added to the HBase clients&lt;br/&gt;
that are accessing the ZK cluster. In general it means calling addAuthInfo once after a session is established:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/current/api/org/apache/zookeeper/ZooKeeper.html#addAuthInfo(java.lang.String&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/current/api/org/apache/zookeeper/ZooKeeper.html#addAuthInfo(java.lang.String&lt;/a&gt;, byte[])&lt;/p&gt;

&lt;p&gt;with a user specific credential, often times this is a shared secret or certificate. You may be able to statically configure this&lt;br/&gt;
in some cases (config string or file to read from), however in my case in particular you may need to access it programmatically,&lt;br/&gt;
which adds complexity as the end user may need to load code into HBase for accessing the credential.&lt;/p&gt;

&lt;p&gt;Secondly you need to specify a non &quot;world&quot; ACL when interacting with znodes (create primarily):&lt;br/&gt;
&lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/current/api/org/apache/zookeeper/data/ACL.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/current/api/org/apache/zookeeper/data/ACL.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/current/api/org/apache/zookeeper/ZooDefs.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/current/api/org/apache/zookeeper/ZooDefs.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Feel free to ping the ZooKeeper team if you have questions. It might also be good to discuss with some &lt;br/&gt;
potential end users - in particular regarding how the end user can specify the credential.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12461439">HBASE-2418</key>
            <summary>add support for ZooKeeper authentication</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoontz">Eugene Koontz</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                            <label>security</label>
                            <label>zookeeper</label>
                    </labels>
                <created>Wed, 7 Apr 2010 18:11:50 +0000</created>
                <updated>Thu, 2 May 2013 02:29:50 +0000</updated>
                            <resolved>Sun, 20 Nov 2011 19:46:49 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="12854660" author="apurtell" created="Wed, 7 Apr 2010 19:27:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;however in my case in particular you may need to access it programmatically, which adds complexity as the end user may need to load code into HBase for accessing the credential&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So this is some config on the HBase side involving reflection and HBase users would need to deploy some jar onto the HBase classpath, I assume. &lt;/p&gt;</comment>
                            <comment id="13011304" author="posix4e" created="Fri, 25 Mar 2011 17:40:21 +0000"  >&lt;p&gt;Didn&apos;t mean to click that button&lt;/p&gt;</comment>
                            <comment id="13127259" author="dlescohier" created="Fri, 14 Oct 2011 03:44:18 +0000"  >&lt;p&gt;The purpose of this issue is to prevent other (non-hbase) applications from accidentally writing to hbase&apos;s znodes on a multi-tenant zookeeper cluster &lt;span class=&quot;error&quot;&gt;&amp;#91;so this isn&amp;#39;t really related to HBASE-1697 or HBASE-3025&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we have to get too fancy; Zookeeper&apos;s Digest authentication would be sufficient for this use-case.&lt;/p&gt;

&lt;p&gt;Assuming that Hbase clients only need read-only access to hbase&apos;s zookeeper znodes, then this simple approache would be sufficient:&lt;/p&gt;

&lt;p&gt;Add a configuration property: hbase.zookeepeer.digest.auth.secrets.filename.&lt;/p&gt;

&lt;p&gt;The secret will go in a separate file so that you can deploy the secret only on the hbase servers; you don&apos;t want the secret directly in the hbase config file, since the hbase config file is also deployed to hbase clients.&lt;/p&gt;

&lt;p&gt;The contents of the secrets file will have one line with the data: username:password.&lt;/p&gt;

&lt;p&gt;The Hbase server code (master/regionserver) will change to:&lt;/p&gt;

&lt;p&gt;On server startup:&lt;br/&gt;
-----------------&lt;/p&gt;

&lt;p&gt;if the property exists and the file exists and the file is readable:&lt;br/&gt;
  open the file and read the contents&lt;br/&gt;
  save the secret in server config state so that it can be used when connecting to zookeeper&lt;/p&gt;

&lt;p&gt;On connecting to zookeeper:&lt;br/&gt;
--------------------------&lt;/p&gt;

&lt;p&gt;right after connected to zookeeper:&lt;br/&gt;
  if we have a digest secret from server startup:&lt;br/&gt;
    zk.addAuthInfo(&quot;digest&quot;, digest_secret);&lt;br/&gt;
    save in server config state:&lt;br/&gt;
      create_acl_list = ZooDefs.Ids.READ_ACL_UNSAFE.clone();&lt;br/&gt;
      create_acl_list.addAll(ZooDefs.Ids.CREATOR_ALL_ACL);&lt;br/&gt;
      // allows world: read access; hbase servers: all privs&lt;br/&gt;
  else: // don&apos;t use authentication&lt;br/&gt;
    save in server configuration state:&lt;br/&gt;
      create_acl_list = ZooDefs.Ids.OPEN_ACL_UNSAFE;&lt;/p&gt;

&lt;p&gt;On creating a node in zookeeper:&lt;br/&gt;
-------------------------------&lt;br/&gt;
  pass create_acl_list as the acl parameter when calling Zookeeper.create()&lt;/p&gt;</comment>
                            <comment id="13150713" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 19:43:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;

&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;

&lt;p&gt;  Server &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    storeKey=true
    useTicketCache=false
    principal=&quot;zookeeper/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;br/&gt;
  Client &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    useTicketCache=false
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    principal=&quot;hbase/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;${HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;

&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;

&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;br/&gt;
  pom.xml c74ce25 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;

&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Andrew&lt;/p&gt;
</comment>
                            <comment id="13150733" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 20:12:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3270&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3270&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Patch looks good.  There&apos;s a few questions below.  You fellas are running this at TM?&lt;/p&gt;


&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7314&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7314&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What are the implications of shipping a 3.4 zk snapshot with 0.92 hbase?  Will a 3.4 client be able to talk to a 3.3.3. ensemble?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7316&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7316&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    So, how do we guarantee that our session w/ zk is secure if the hbase install is configured secure?  What is in place to prevent our connecting insecure to a zk ensemble if the hbase is supposed to be secure?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7315&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7315&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Would suggest filing the jira and reference it here.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7317&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7317&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7318&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7318&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This line is no longer needed.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7319&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7319&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is an insecure cluster using a secure zk?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-15 19:43:37, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 19:43:37)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13150742" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 20:16:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3272&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3272&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7320&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7320&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I agree that simply checking for a configuration file is insufficient. &lt;/p&gt;

&lt;p&gt;    We should use the JAAS configuration class (&lt;a href=&quot;http://download.oracle.com/javase/1.4.2/docs/api/javax/security/auth/login/Configuration.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/1.4.2/docs/api/javax/security/auth/login/Configuration.html&lt;/a&gt;) API to parse the supplied JAAS configuration and make sure that the &quot;Client&quot; section exists. We could also log some warnings or info based on what we find there (for example, if the &quot;Client&quot; section exists, but there&apos;s no principal, LOG.warn(&quot;No principal found in Client section&quot;).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7321&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7321&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    s/Its/It&apos;s/&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7322&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7322&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Note that this fix is also in the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3861&quot; title=&quot;MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3861&quot;&gt;&lt;del&gt;HBASE-3861&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12478359/HBASE-3861.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12478359/HBASE-3861.patch&lt;/a&gt;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Eugene&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-15 19:43:37, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 19:43:37)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13150772" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 21:01:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3277&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3277&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7334&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7334&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Maybe add something about final test, since we are summarizing the other tests: &lt;/p&gt;

&lt;p&gt;    &quot;Finally, we check the ACLs of a node outside of the /hbase hierarchy and verify that its ACL is simply &apos;hbase:Perms.ALL&apos;.&quot;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Eugene&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-15 19:43:37, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 19:43:37)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13150828" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 22:09:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:12:11, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 794&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58410#file58410line794&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58410#file58410line794&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     What are the implications of shipping a 3.4 zk snapshot with 0.92 hbase?  Will a 3.4 client be able to talk to a 3.3.3. ensemble?&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;Will a 3.4 client be able to talk to a 3.3.3. ensemble?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, but we can make this change conditional on enabling the Maven &apos;-P security&apos; profile. I should have done that already.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:12:11, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java, line 668&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line668&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line668&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     So, how do we guarantee that our session w/ zk is secure if the hbase install is configured secure?  What is in place to prevent our connecting insecure to a zk ensemble if the hbase is supposed to be secure?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ZooKeeper auth is independent of RPC auth.&lt;/p&gt;

&lt;p&gt;Connecting insecurely to a secure ZK ensemble is totally acceptable from a non-HBase point of view. It allows backwards compatibility over in ZK land.&lt;/p&gt;

&lt;p&gt;Even when running secure HBase, most clients would have no trouble even if connecting insecurely to ZK; only the Master and RegionServers would want to authenticate and set ACLs accordingly.&lt;/p&gt;

&lt;p&gt;We could add another check elsewhere in the Master and RegionServer (via ZKUtil presumably) if HBase security is enabled to test that ACLs are set up, but this won&apos;t let someone run with an insecure ZooKeeper version, maybe 3.3.3 or whatever. Maybe someone will want that. I think it&apos;s a user concern.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:12:11, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java, line 676&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line676&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line676&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Would suggest filing the jira and reference it here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Eugene opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4791&quot; title=&quot;Allow Secure Zookeeper JAAS configuration to be programmatically set (rather than only by reading JAAS configuration file)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4791&quot;&gt;&lt;del&gt;HBASE-4791&lt;/del&gt;&lt;/a&gt;. Will make a note.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:12:11, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java, line 77&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58415#file58415line77&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58415#file58415line77&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is an insecure cluster using a secure zk?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ZooKeeper auth is independent of RPC auth.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3270&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3270&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-15 19:43:37, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 19:43:37)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13150831" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 22:11:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:15:21, Eugene Koontz wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java, line 669&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line669&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line669&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I agree that simply checking for a configuration file is insufficient. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We should use the JAAS configuration class (&lt;a href=&quot;http://download.oracle.com/javase/1.4.2/docs/api/javax/security/auth/login/Configuration.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/1.4.2/docs/api/javax/security/auth/login/Configuration.html&lt;/a&gt;) API to parse the supplied JAAS configuration and make sure that the &quot;Client&quot; section exists. We could also log some warnings or info based on what we find there (for example, if the &quot;Client&quot; section exists, but there&apos;s no principal, LOG.warn(&quot;No principal found in Client section&quot;).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for opening &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4791&quot; title=&quot;Allow Secure Zookeeper JAAS configuration to be programmatically set (rather than only by reading JAAS configuration file)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4791&quot;&gt;&lt;del&gt;HBASE-4791&lt;/del&gt;&lt;/a&gt;. I think we can follow up on this there.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3272&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3272&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-15 19:43:37, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 19:43:37)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13150850" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 22:37:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:12:11, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java, line 676&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line676&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58412#file58412line676&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Would suggest filing the jira and reference it here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Eugene opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4791&quot; title=&quot;Allow Secure Zookeeper JAAS configuration to be programmatically set (rather than only by reading JAAS configuration file)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4791&quot;&gt;&lt;del&gt;HBASE-4791&lt;/del&gt;&lt;/a&gt;. Will make a note.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;JIRA created and linked to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4791&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4791&lt;/a&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-15 20:12:11, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java, line 77&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/1/?file=58415#file58415line77&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/1/?file=58415#file58415line77&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is an insecure cluster using a secure zk?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ZooKeeper auth is independent of RPC auth.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Both zookeeper server and client are using SASL authentication since there are both &quot;Server&quot; and &quot;Client&quot; sections in the jaas.conf file. So HBase and Zookeeper authenticate with each other in this test.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Eugene&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3270&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3270&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-15 19:43:37, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 19:43:37)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13150876" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 23:15:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-15 23:15:34.845036)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated patch addresses review comments to date that have specific suggestions.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;

&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;

&lt;p&gt;  Server &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    storeKey=true
    useTicketCache=false
    principal=&quot;zookeeper/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;br/&gt;
  Client &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    useTicketCache=false
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    principal=&quot;hbase/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;${HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;

&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;

&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  pom.xml c74ce25 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;

&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Andrew&lt;/p&gt;
</comment>
                            <comment id="13150879" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 23:19:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3286&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3286&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7352&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7352&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This addresses the comment about shipping a 3.4-SNAPSHOT if it is not warranted. The POM stanza here is a dup from related changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; with the zookeeper.version property added.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-15 23:15:34, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 23:15:34)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152318" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 20:58:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-17 20:58:47.295983)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated POM to pull in Hadoop 0.20.205.1-7070-SNAPSHOT if building under the security profile (-P security). 0.20.205 does not yet include &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7070&quot; title=&quot;JAAS configuration should delegate unknown application names to pre-existing configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7070&quot;&gt;&lt;del&gt;HADOOP-7070&lt;/del&gt;&lt;/a&gt;. Without it, the JAAS configuration required for secure operation of the ZooKeeper client will be ignored. This is not an issue with this patch per se. Hadoop without 7070 overrides any JAAS configuration. ZooKeeper integrated security in such a way as to require one. HBase is stuck in the middle here.&lt;/p&gt;

&lt;p&gt;We will file another JIRA for simplifying the configuration of a secure HBase cluster. The user should need only to update one or two configuration properties in hbase-site.xml with the remainder handled behind the scenes. Within the context of that JIRA we can look at having HBase build the ZooKeeper JAAS configuration programatically, like Hadoop does. We may be able to simply update the LoginContext that Hadoop provides. &lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;

&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;

&lt;p&gt;  Server &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    storeKey=true
    useTicketCache=false
    principal=&quot;zookeeper/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;br/&gt;
  Client &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    useTicketCache=false
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    principal=&quot;hbase/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;${HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;

&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;

&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  pom.xml c74ce25 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;

&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Andrew&lt;/p&gt;
</comment>
                            <comment id="13152445" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 23:21:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3335&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1 on commit (if all tests pass and my questions below have the answers i want)&lt;/p&gt;


&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7446&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7446&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This stuff is also in other patches?  I suppose we&apos;ll see who goes in first.&lt;/p&gt;



&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7449&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7449&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is in gary&apos;s repo?  Is this the only version we&apos;ll work with? &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7450&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7450&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    These are not zk 3.4 imports are they?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7451&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this a 3.4 zk change?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7453&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7453&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Are these only in zk 3.4?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7455&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This will work w/ 3.3.3. zk?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-17 20:58:47, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 20:58:47)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152619" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 03:41:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:21:44, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; +1 on commit (if all tests pass and my questions below have the answers i want)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-1 based on review, thanks.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:21:44, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 251&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59198#file59198line251&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59198#file59198line251&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This stuff is also in other patches?  I suppose we&apos;ll see who goes in first.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:21:44, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java, line 39&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59199#file59199line39&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59199#file59199line39&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     These are not zk 3.4 imports are they?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are right, this is not going to work without some kind of shim. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:21:44, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 1354&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59198#file59198line1354&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59198#file59198line1354&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is in gary&apos;s repo?  Is this the only version we&apos;ll work with?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Without 7070 Hadoop will clobber any JAAS configuration supplied for ZK. So a Hadoop with 7070 must be used if one wants to set up ZK 3.4 for SASL authentication.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3335&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 20:58:47, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 20:58:47)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152630" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 04:15:53 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7486&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7486&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;

&lt;p&gt;    Any ideas?&lt;/p&gt;

&lt;p&gt;    I think we have to pull in 3.4 unconditionally.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-17 20:58:47, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 20:58:47)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152635" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 04:23:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 04:14:48, Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any ideas?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we have to pull in 3.4 unconditionally.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Might be a good thing anyway. 3.4 is in RC right now, would probably be GA by the time we GA 0.92. (we&apos;re meeting with Ted Dunning tomorrow - unrelated - can ask him what he thinks about it).&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 20:58:47, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 20:58:47)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152638" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 04:29:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 04:14:48, Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any ideas?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we have to pull in 3.4 unconditionally.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Might be a good thing anyway. 3.4 is in RC right now, would probably be GA by the time we GA 0.92. (we&apos;re meeting with Ted Dunning tomorrow - unrelated - can ask him what he thinks about it).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can put in the other two patches and defer this one until 3.4 is released. Consequence would be that 3025 can be subverted if one allows direct client access to the ZK cluster.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 20:58:47, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 20:58:47)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152679" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 06:25:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 04:14:48, Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any ideas?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we have to pull in 3.4 unconditionally.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Might be a good thing anyway. 3.4 is in RC right now, would probably be GA by the time we GA 0.92. (we&apos;re meeting with Ted Dunning tomorrow - unrelated - can ask him what he thinks about it).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We can put in the other two patches and defer this one until 3.4 is released. Consequence would be that 3025 can be subverted if one allows direct client access to the ZK cluster.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 on fixing this patch so it just upgrades our zk to 3.4.  I just tried hbase w/ a 3.4 client and a 3.3.3. ensemble and it seems to work.  I asked Mahadev to be sure and he says &quot;A 3.3.* client should be able to talk to 3.4.0 server and vice versa.&quot;  Its as yet unreleased but I&apos;m pretty sure it&apos;ll be out before we ship &amp;#8211; maybe even a 3.4.1 (smile).&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 20:58:47, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 20:58:47)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml c74ce25 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152939" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 16:06:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-18 16:05:49.921654)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unconditionally pull in ZK 3.4.&lt;/p&gt;

&lt;p&gt;Some of the POM changes might reject, depending on what goes in first, but would be trivial to fix up.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;

&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;

&lt;p&gt;  Server &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    storeKey=true
    useTicketCache=false
    principal=&quot;zookeeper/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;br/&gt;
  Client &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    useTicketCache=false
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    principal=&quot;hbase/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;${HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;

&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;

&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  pom.xml 382c7c2 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;

&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Andrew&lt;/p&gt;
</comment>
                            <comment id="13152941" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 16:08:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 04:14:48, Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any ideas?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we have to pull in 3.4 unconditionally.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Might be a good thing anyway. 3.4 is in RC right now, would probably be GA by the time we GA 0.92. (we&apos;re meeting with Ted Dunning tomorrow - unrelated - can ask him what he thinks about it).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We can put in the other two patches and defer this one until 3.4 is released. Consequence would be that 3025 can be subverted if one allows direct client access to the ZK cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;+1 on fixing this patch so it just upgrades our zk to 3.4.  I just tried hbase w/ a 3.4 client and a 3.3.3. ensemble and it seems to work.  I asked Mahadev to be sure and he says &quot;A 3.3.* client should be able to talk to 3.4.0 server and vice versa.&quot;  Its as yet unreleased but I&apos;m pretty sure it&apos;ll be out before we ship &amp;#8211; maybe even a 3.4.1 (smile).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Say what you will about the Hadoop Record compiler aka Jute, but ZK is 1) the only project that uses it that I know of 2) yet consistently can answer in the affirmative regarding cross-version compatibility.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-18 16:05:49, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-18 16:05:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 382c7c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152965" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 17:00:53 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3355&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This last version pulls in 3.4?  Maybe I&apos;m blind but I don&apos;t see it.  Mind putting a patch up in JIRA for hadoopqa patch-build to run Andrew?  Good stuff.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-18 16:05:49, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-18 16:05:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 382c7c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153000" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 17:56:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 16:59:52, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This last version pulls in 3.4?  Maybe I&apos;m blind but I don&apos;t see it.  Mind putting a patch up in JIRA for hadoopqa patch-build to run Andrew?  Good stuff.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Patch won&apos;t apply until 3025 is committed.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3355&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-18 16:05:49, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-18 16:05:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 382c7c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153031" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 18:36:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 04:14:48, Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any ideas?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we have to pull in 3.4 unconditionally.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Might be a good thing anyway. 3.4 is in RC right now, would probably be GA by the time we GA 0.92. (we&apos;re meeting with Ted Dunning tomorrow - unrelated - can ask him what he thinks about it).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We can put in the other two patches and defer this one until 3.4 is released. Consequence would be that 3025 can be subverted if one allows direct client access to the ZK cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;+1 on fixing this patch so it just upgrades our zk to 3.4.  I just tried hbase w/ a 3.4 client and a 3.3.3. ensemble and it seems to work.  I asked Mahadev to be sure and he says &quot;A 3.3.* client should be able to talk to 3.4.0 server and vice versa.&quot;  Its as yet unreleased but I&apos;m pretty sure it&apos;ll be out before we ship &amp;#8211; maybe even a 3.4.1 (smile).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Say what you will about the Hadoop Record compiler aka Jute, but ZK is 1) the only project that uses it that I know of 2) yet consistently can answer in the affirmative regarding cross-version compatibility.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let me add, Mahadev tried it himself on his end too and it seemed fine and then he did the caveat that 3.4 has not yet been used in production.....&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-18 16:05:49, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-18 16:05:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 382c7c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153269" author="jiraposter@reviews.apache.org" created="Sat, 19 Nov 2011 00:36:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 16:59:52, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This last version pulls in 3.4?  Maybe I&apos;m blind but I don&apos;t see it.  Mind putting a patch up in JIRA for hadoopqa patch-build to run Andrew?  Good stuff.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patch won&apos;t apply until 3025 is committed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;3025 just went in to 0.92 and trunk, so we should be good to put the patch up for testing.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3355&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-18 16:05:49, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-18 16:05:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 382c7c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153284" author="jiraposter@reviews.apache.org" created="Sat, 19 Nov 2011 00:54:52 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 16:59:52, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This last version pulls in 3.4?  Maybe I&apos;m blind but I don&apos;t see it.  Mind putting a patch up in JIRA for hadoopqa patch-build to run Andrew?  Good stuff.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patch won&apos;t apply until 3025 is committed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3025 just went in to 0.92 and trunk, so we should be good to put the patch up for testing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Rebased patch against current trunk, running tests, will post patch shortly.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3355&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-18 16:05:49, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-18 16:05:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 382c7c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java 05abeb7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 74b9e62 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java f613ba9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153316" author="jiraposter@reviews.apache.org" created="Sat, 19 Nov 2011 01:36:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-19 01:36:34.607701)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Rebased to trunk.&lt;/p&gt;

&lt;p&gt;Updated TestZooKeeperACL so it won&apos;t break the build if Hadoop is missing &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7070&quot; title=&quot;JAAS configuration should delegate unknown application names to pre-existing configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7070&quot;&gt;&lt;del&gt;HADOOP-7070&lt;/del&gt;&lt;/a&gt;, but the issue will be logged at WARN in the test output. (-P security selects an artifact that includes it.)&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;

&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;

&lt;p&gt;  Server &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    storeKey=true
    useTicketCache=false
    principal=&quot;zookeeper/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;br/&gt;
  Client &lt;/p&gt;
{
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    useTicketCache=false
    keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
    principal=&quot;hbase/$HOSTNAME&quot;;
  }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;${HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;br/&gt;
  HBASE_OPTS=&quot;$&lt;/p&gt;
{HBASE_OPTS}
&lt;p&gt; -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;

&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;

&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  pom.xml eccf41f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java fe6f4a5 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 960c9c1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java d1b7647 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;

&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Andrew&lt;/p&gt;
</comment>
                            <comment id="13153324" author="jiraposter@reviews.apache.org" created="Sat, 19 Nov 2011 01:44:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3368&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3368&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/#comment7546&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#comment7546&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing &apos;return&apos; here will be added upon commit.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-19 01:36:34, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-19 01:36:34)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml eccf41f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java fe6f4a5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 960c9c1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java d1b7647 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153325" author="apurtell" created="Sat, 19 Nov 2011 01:44:53 +0000"  >&lt;p&gt;Missing &apos;return&apos;&lt;/p&gt;</comment>
                            <comment id="13153353" author="hadoopqa" created="Sat, 19 Nov 2011 02:32:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504324/HBASE-2418-5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504324/HBASE-2418-5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/304//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/304//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153358" author="apurtell" created="Sat, 19 Nov 2011 03:00:36 +0000"  >&lt;p&gt;This time again with --no-prefix&lt;/p&gt;</comment>
                            <comment id="13153376" author="jiraposter@reviews.apache.org" created="Sat, 19 Nov 2011 04:38:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-18 04:14:48, Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 338&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff/3/?file=59201#file59201line338&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see how to work around this. The code has to be recompiled against 3.3 or 3.4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Any ideas?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we have to pull in 3.4 unconditionally.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Might be a good thing anyway. 3.4 is in RC right now, would probably be GA by the time we GA 0.92. (we&apos;re meeting with Ted Dunning tomorrow - unrelated - can ask him what he thinks about it).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We can put in the other two patches and defer this one until 3.4 is released. Consequence would be that 3025 can be subverted if one allows direct client access to the ZK cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;+1 on fixing this patch so it just upgrades our zk to 3.4.  I just tried hbase w/ a 3.4 client and a 3.3.3. ensemble and it seems to work.  I asked Mahadev to be sure and he says &quot;A 3.3.* client should be able to talk to 3.4.0 server and vice versa.&quot;  Its as yet unreleased but I&apos;m pretty sure it&apos;ll be out before we ship &amp;#8211; maybe even a 3.4.1 (smile).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Let me add, Mahadev tried it himself on his end too and it seemed fine and then he did the caveat that 3.4 has not yet been used in production.....&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew Purtell wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Say what you will about the Hadoop Record compiler aka Jute, but ZK is 1) the only project that uses it that I know of 2) yet consistently can answer in the affirmative regarding cross-version compatibility.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ted said 3.4RC is stable and wire and diskformat compatible with 3.3. Apparently 3.4 will be happening soon.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2837/#review3344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/#review3344&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-19 01:36:34, Andrew Purtell wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-19 01:36:34)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Gary Helmling and Eugene Koontz.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes add support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0, currently at RC2. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt; (Coprocessor based access control).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Server {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      storeKey=true
bq.      useTicketCache=false
bq.      principal=&quot;zookeeper/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Client {
bq.      com.sun.security.auth.module.Krb5LoginModule required
bq.      useKeyTab=true
bq.      useTicketCache=false
bq.      keyTab=&quot;/etc/hbase/conf/hbase.keytab&quot;
bq.      principal=&quot;hbase/$HOSTNAME&quot;;
bq.    };&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&quot;&lt;br/&gt;
bq.    HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBASE_OPTS=&quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There is extraneous whitespace in code surrounding these changes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2418&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml eccf41f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java fe6f4a5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 960c9c1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java a75cf87 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java d1b7647 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2837/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2837/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;These changes are running in production at Trend Micro, using a snapshot build of ZooKeeper 3.4.0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit test TestZooKeeperACL passes 100 iterations. All test pass not otherwise currently failing on trunk.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Andrew&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13153384" author="hadoopqa" created="Sat, 19 Nov 2011 04:49:30 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504329/HBASE-2418-5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504329/HBASE-2418-5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 60 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestShell&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/305//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/305//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/305//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/305//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/305//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/305//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153388" author="stack" created="Sat, 19 Nov 2011 04:55:13 +0000"  >&lt;p&gt;Could the TestAdmin be because of this patch A?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error Message

An error is preventing HBase from connecting to ZooKeeper
Stacktrace

org.apache.hadoop.hbase.ZooKeeperConnectionException: An error is preventing HBase from connecting to ZooKeeper
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Might be same issue w/ the TestShell fails)&lt;/p&gt;


&lt;p&gt;TestLogRolling seems innocuous.. that can&apos;t lock data dir.&lt;/p&gt;
</comment>
                            <comment id="13153538" author="apurtell" created="Sat, 19 Nov 2011 18:05:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could the TestAdmin be because of this patch A?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t see it locally. &lt;/p&gt;

&lt;p&gt;This change in the patch could be suspect but it&apos;s a shot in the dark:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java
+++ src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java
@@ -148,11 +156,14 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class MiniZooKeeperCluster {
         tickTimeToUse = TICK_TIME;
       }
       ZooKeeperServer server = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZooKeeperServer(dir, dir, tickTimeToUse);
-      NIOServerCnxn.Factory standaloneServerFactory;
+      NIOServerCnxnFactory standaloneServerFactory;
       &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
-          standaloneServerFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NIOServerCnxn.Factory(
-              &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InetSocketAddress(tentativePort));
+          standaloneServerFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NIOServerCnxnFactory();
+          standaloneServerFactory.configure(
+            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InetSocketAddress(tentativePort),
+            configuration.getInt(HConstants.ZOOKEEPER_MAX_CLIENT_CNXNS,
+              HConstants.DEFAULT_ZOOKEPER_MAX_CLIENT_CNXNS));
         } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BindException e) {
           LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed binding ZK Server to client port: &quot;&lt;/span&gt; +
               tentativePort);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I could change HConstants.DEFAULT_ZOOKEPER_MAX_CLIENT_CNXNS here to 1000 and resubmit.&lt;/p&gt;</comment>
                            <comment id="13153541" author="apurtell" created="Sat, 19 Nov 2011 18:13:08 +0000"  >&lt;p&gt;v6 patch with above described change.&lt;/p&gt;</comment>
                            <comment id="13153546" author="hadoopqa" created="Sat, 19 Nov 2011 18:21:26 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504379/HBASE-2418-6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504379/HBASE-2418-6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/312//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/312//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153553" author="apurtell" created="Sat, 19 Nov 2011 18:35:12 +0000"  >&lt;p&gt;Rebased patch on latest trunk.&lt;/p&gt;</comment>
                            <comment id="13153554" author="stack" created="Sat, 19 Nov 2011 18:35:13 +0000"  >&lt;p&gt;Trunk is changing too fast on you Andrew!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
patching file pom.xml
Hunk #1 FAILED at 276.
Hunk #2 succeeded at 861 (offset 41 lines).
Hunk #3 succeeded at 1404 with fuzz 2 (offset 3 lines).
1 out of 3 hunks FAILED -- saving rejects to file pom.xml.rej
patching file src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java
patching file src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
patching file src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java
patching file src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java
patching file src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java
PATCH APPLICATION FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is last 0.92 patch though.... Almost there.&lt;/p&gt;</comment>
                            <comment id="13153578" author="hadoopqa" created="Sat, 19 Nov 2011 20:28:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504384/HBASE-2418-6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504384/HBASE-2418-6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 60 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestShell&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/313//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/313//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/313//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/313//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/313//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/313//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153857" author="apurtell" created="Sun, 20 Nov 2011 19:46:50 +0000"  >&lt;p&gt;Committed to trunk and 0.92.&lt;/p&gt;

&lt;p&gt;TestZooKeeperACL passes with and without &apos;-P security&apos; locally. Does not break the build if &apos;-P security&apos; is not specified. Test failures found by HudsonQA are not directly related to this change.&lt;/p&gt;</comment>
                            <comment id="13153888" author="hudson" created="Sun, 20 Nov 2011 21:56:09 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2466 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2466/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2466/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Support for ZooKeeper authentication&lt;/p&gt;

&lt;p&gt;apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153889" author="hudson" created="Sun, 20 Nov 2011 21:56:26 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #152 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/152/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/152/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Support for ZooKeeper authentication&lt;/p&gt;

&lt;p&gt;apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153893" author="yuzhihong@gmail.com" created="Sun, 20 Nov 2011 22:15:45 +0000"  >&lt;p&gt;Addendum adds Gary&apos;s maven repository to pom&lt;/p&gt;</comment>
                            <comment id="13153894" author="yuzhihong@gmail.com" created="Sun, 20 Nov 2011 22:21:23 +0000"  >&lt;p&gt;Applied addendum to 0.92 branch.&lt;br/&gt;
Build 153 is running tests as this moment.&lt;/p&gt;</comment>
                            <comment id="13153913" author="hudson" created="Mon, 21 Nov 2011 00:03:36 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #153 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/153/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/153/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Addendum adds Gary&apos;s maven repo to pom.xml&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153921" author="apurtell" created="Mon, 21 Nov 2011 00:33:45 +0000"  >&lt;p&gt;Thanks Ted. I thought that went in with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;del&gt;HBASE-3025&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13153923" author="apurtell" created="Mon, 21 Nov 2011 00:41:47 +0000"  >&lt;p&gt;And it looks like this part of the POM in trunk is not in the POM on 0.92:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;pluginRepositories&amp;gt;
    &amp;lt;pluginRepository&amp;gt;
      &amp;lt;id&amp;gt;ghelmling.testing&amp;lt;/id&amp;gt;
      &amp;lt;name&amp;gt;Gary Helmling test repo&amp;lt;/name&amp;gt;
      &amp;lt;url&amp;gt;http:&lt;span class=&quot;code-comment&quot;&gt;//people.apache.org/~garyh/mvn/&amp;lt;/url&amp;gt;
&lt;/span&gt;      &amp;lt;snapshots&amp;gt;
        &amp;lt;enabled&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/enabled&amp;gt;
      &amp;lt;/snapshots&amp;gt;
      &amp;lt;releases&amp;gt;
        &amp;lt;enabled&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/enabled&amp;gt;
      &amp;lt;/releases&amp;gt;
    &amp;lt;/pluginRepository&amp;gt;
  &amp;lt;/pluginRepositories&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t know enough about Maven or how Gary set up the security profile to know if it is needed or not. Gary?&lt;/p&gt;</comment>
                            <comment id="13153931" author="hudson" created="Mon, 21 Nov 2011 01:15:57 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #2 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/2/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/2/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Addendum adds Gary&apos;s maven repo to pom.xml&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Support for ZooKeeper authentication&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153934" author="apurtell" created="Mon, 21 Nov 2011 01:29:10 +0000"  >&lt;p&gt;Hudson returned another build failure report. I committed the above to the 0.92 POM.&lt;/p&gt;</comment>
                            <comment id="13153968" author="hudson" created="Mon, 21 Nov 2011 03:57:43 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #154 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/154/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/154/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Add pluginRepositories to POM&lt;/p&gt;

&lt;p&gt;apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153974" author="ghelmling" created="Mon, 21 Nov 2011 04:17:01 +0000"  >&lt;p&gt;The &lt;tt&gt;&amp;lt;pluginRepositories/&amp;gt;&lt;/tt&gt; entry was added for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4763&quot; title=&quot;Integrate surefire and junit for category management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4763&quot;&gt;&lt;del&gt;HBASE-4763&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4781&quot; title=&quot;Pom update to use the new versions of surefire &amp;amp; junit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4781&quot;&gt;&lt;del&gt;HBASE-4781&lt;/del&gt;&lt;/a&gt; for the custom maven-surefire build.  It&apos;s not needed for the security components and should not be in the 0.92 branch as far as I can tell (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4781&quot; title=&quot;Pom update to use the new versions of surefire &amp;amp; junit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4781&quot;&gt;&lt;del&gt;HBASE-4781&lt;/del&gt;&lt;/a&gt; is marked for 0.94).&lt;/p&gt;</comment>
                            <comment id="13153975" author="hudson" created="Mon, 21 Nov 2011 04:18:30 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #3 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/3/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/3/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Add pluginRepositories to POM&lt;/p&gt;

&lt;p&gt;apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153976" author="ghelmling" created="Mon, 21 Nov 2011 04:23:51 +0000"  >&lt;p&gt;&lt;a href=&quot;http://monitoring.apache.org/status/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://monitoring.apache.org/status/&lt;/a&gt; is showing people.apache.org is down (minotaur.apache.org).  This is probably the cause of the build failures, which are showing connection timed out retrieving artifacts from my repo.&lt;/p&gt;</comment>
                            <comment id="13154088" author="mikhail" created="Mon, 21 Nov 2011 09:44:30 +0000"  >&lt;p&gt;I just saw this regionserver crash in my five-node, three-RS cluster test. Since this is a ZK-related patch that went in recently, I am attaching the stack trace here just in case.&lt;/p&gt;

&lt;p&gt;2011-11-21 01:30:15,188 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server &amp;lt;machine_name&amp;gt;,60020,1321867814890: Initialization of RS failed.  Hence aborting RS.&lt;br/&gt;
java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.Hashtable$Enumerator.next(Hashtable.java:1031)&lt;br/&gt;
        at org.apache.hadoop.conf.Configuration.iterator(Configuration.java:1042)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKConfig.makeZKProps(ZKConfig.java:75)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKConfig.getZKQuorumServersString(ZKConfig.java:245)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher.&amp;lt;init&amp;gt;(ZooKeeperWatcher.java:144)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher.&amp;lt;init&amp;gt;(ZooKeeperWatcher.java:124)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.getZooKeeperWatcher(HConnectionManager.java:1262)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:568)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.&amp;lt;init&amp;gt;(HConnectionManager.java:559)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager.getConnection(HConnectionManager.java:183)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.CatalogTracker.&amp;lt;init&amp;gt;(CatalogTracker.java:177)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.initializeZooKeeper(HRegionServer.java:575)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.preRegistrationInitialization(HRegionServer.java:534)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:642)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</comment>
                            <comment id="13154100" author="ram_krish" created="Mon, 21 Nov 2011 10:26:10 +0000"  >&lt;p&gt;Not able to build from the maven repository for zookeeper 3.4.0 SNAPSHOT.&lt;br/&gt;
Correct me if am wrong.&lt;/p&gt;</comment>
                            <comment id="13154104" author="ram_krish" created="Mon, 21 Nov 2011 10:32:25 +0000"  >&lt;p&gt;I resolved by adding this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;repository&amp;gt;
      &amp;lt;id&amp;gt;ghelmling.testing&amp;lt;/id&amp;gt;
      &amp;lt;name&amp;gt;Gary Helmling test repo&amp;lt;/name&amp;gt;
      &amp;lt;url&amp;gt;http:&lt;span class=&quot;code-comment&quot;&gt;//people.apache.org/~garyh/mvn/&amp;lt;/url&amp;gt;
&lt;/span&gt;      &amp;lt;snapshots&amp;gt;
        &amp;lt;enabled&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/enabled&amp;gt;
      &amp;lt;/snapshots&amp;gt;
      &amp;lt;releases&amp;gt;
        &amp;lt;enabled&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/enabled&amp;gt;
      &amp;lt;/releases&amp;gt;
    &amp;lt;/repository&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this was present in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt;-3.patch&lt;/p&gt;</comment>
                            <comment id="13154146" author="hudson" created="Mon, 21 Nov 2011 13:01:27 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #2 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/2/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/2/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2418&quot; title=&quot;add support for ZooKeeper authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2418&quot;&gt;&lt;del&gt;HBASE-2418&lt;/del&gt;&lt;/a&gt; Support for ZooKeeper authentication&lt;/p&gt;

&lt;p&gt;apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MiniZooKeeperCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperACL.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13154276" author="apurtell" created="Mon, 21 Nov 2011 16:30:27 +0000"  >&lt;p&gt;@Mikhail: Thanks, that doesn&apos;t have a clear direct relation. If it were a test failure, I&apos;d say otherwise. This patch modified the MiniZKCluster to take a Configuration in constructor and use it. This patch did not touch ZKConfig, which is HBase side code.&lt;/p&gt;</comment>
                            <comment id="13154280" author="apurtell" created="Mon, 21 Nov 2011 16:32:54 +0000"  >&lt;p&gt;@Ram I&apos;m looking at the 0.92 pom right now and it includes the repository entry for ghelmling.testing.&lt;/p&gt;</comment>
                            <comment id="13154281" author="apurtell" created="Mon, 21 Nov 2011 16:35:45 +0000"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4835&quot; title=&quot;ConcurrentModificationException out of ZKConfig.makeZKProps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4835&quot;&gt;&lt;del&gt;HBASE-4835&lt;/del&gt;&lt;/a&gt; for the CME.&lt;/p&gt;</comment>
                            <comment id="13159618" author="ekoontz" created="Tue, 29 Nov 2011 23:04:44 +0000"  >&lt;p&gt;HBase clients can authenticate with Kerberos using &lt;tt&gt;kinit&lt;/tt&gt; and connect to hbase (e.g. with hbase shell) with &lt;tt&gt;-Djava.security.auth.login.config=/path/to/client/jaas.conf&lt;/tt&gt; , where this configuration file is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Client {
 com.sun.security.auth.module.Krb5LoginModule required
 useKeyTab=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
 useTicketCache=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 doNotPrompt=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 renewTGT=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13159828" author="stack" created="Wed, 30 Nov 2011 05:18:34 +0000"  >&lt;p&gt;@Eugene Should your above comment go into the hbase book? i.e. on how to set up secure zk?&lt;/p&gt;</comment>
                            <comment id="13160213" author="ekoontz" created="Wed, 30 Nov 2011 18:27:38 +0000"  >&lt;p&gt;@stack, Great idea. Will learn more about how to add content to the hbase book and will create a patch and JIRA.&lt;/p&gt;</comment>
                            <comment id="13160430" author="stack" created="Wed, 30 Nov 2011 23:00:08 +0000"  >&lt;p&gt;If you write up a bit of text, I can add it np E.&lt;/p&gt;</comment>
                            <comment id="13161089" author="ekoontz" created="Thu, 1 Dec 2011 19:59:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4376&quot; title=&quot;Document login configuration when running on top of secure Hadoop with Kerberos auth enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4376&quot;&gt;&lt;del&gt;HBASE-4376&lt;/del&gt;&lt;/a&gt; addresses need for security-related documentation, as also discussed recently in this JIRA.&lt;/p&gt;</comment>
                            <comment id="13163150" author="ekoontz" created="Mon, 5 Dec 2011 23:11:46 +0000"  >&lt;p&gt;Hi @stack, thanks for encouraging me to write some documentation relating to this; please see: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4960&lt;/a&gt; &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12480698">ZOOKEEPER-938</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12431322">HBASE-1697</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12522821">HBASE-4376</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12474775">HBASE-3025</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12533954">HBASE-4960</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12547153">HBASE-5603</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12531530">HBASE-4791</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12504444" name="2418.addendum" size="581" author="yuzhihong@gmail.com" created="Sun, 20 Nov 2011 22:15:45 +0000"/>
                            <attachment id="12504384" name="HBASE-2418-6.patch" size="25411" author="apurtell" created="Sat, 19 Nov 2011 18:35:12 +0000"/>
                            <attachment id="12504379" name="HBASE-2418-6.patch" size="25901" author="apurtell" created="Sat, 19 Nov 2011 18:13:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 7 Apr 2010 19:27:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32573</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08qqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48933</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This adds support for protecting the state of HBase znodes on a multi-tenant ZooKeeper cluster. This support requires ZK 3.4.0. It is a companion patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;strike&gt;HBASE-2742&lt;/strike&gt;&lt;/a&gt; (secure RPC), and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3025&quot; title=&quot;Coprocessor based simple access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3025&quot;&gt;&lt;strike&gt;HBASE-3025&lt;/strike&gt;&lt;/a&gt; (Coprocessor based access control).&lt;br/&gt;
&lt;br/&gt;
SASL authentication of ZooKeeper clients with the quorum is handled in the ZK client independently of HBase concerns. To enable strong ZK authentication, one must create a suitable JaaS configuration, for example:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Server {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;com.sun.security.auth.module.Krb5LoginModule required&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;useKeyTab=true&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;keyTab=&amp;quot;/etc/hbase/conf/hbase.keytab&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;storeKey=true&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;useTicketCache=false&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;principal=&amp;quot;zookeeper/$HOSTNAME&amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;};&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Client {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;com.sun.security.auth.module.Krb5LoginModule required&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;useKeyTab=true&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;useTicketCache=false&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;keyTab=&amp;quot;/etc/hbase/conf/hbase.keytab&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;principal=&amp;quot;hbase/$HOSTNAME&amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;};&lt;br/&gt;
&lt;br/&gt;
and then configure both the client and server processes to use it, for example in hbase-site.xml:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;HBASE_OPTS=&amp;quot;${HBASE_OPTS} -Djava.security.auth.login.config=/etc/hbase/conf/jaas.conf&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;HBASE_OPTS=&amp;quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeHostFromPrincipal=true&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;HBASE_OPTS=&amp;quot;${HBASE_OPTS} -Dzookeeper.kerberos.removeRealmFromPrincipal=true&amp;quot;&lt;br/&gt;
&lt;br/&gt;
HBase will then secure all znodes but for a few world-readable read-only ones needed for clients to look up region locations. All internal cluster operations will be protected from unauthenticated ZK clients, or clients not authenticated to the HBase principal. Presumably the only ZK clients authenticated to the HBase principal will be those embedded in the master and regionservers.&lt;br/&gt;
&lt;br/&gt;
We will pull in a Hadoop artifact patched with &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7070&quot; title=&quot;JAAS configuration should delegate unknown application names to pre-existing configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7070&quot;&gt;&lt;strike&gt;HADOOP-7070&lt;/strike&gt;&lt;/a&gt; if building under the security profile (-P security). 0.20.205 does not yet include &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7070&quot; title=&quot;JAAS configuration should delegate unknown application names to pre-existing configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7070&quot;&gt;&lt;strike&gt;HADOOP-7070&lt;/strike&gt;&lt;/a&gt;. Without it, the JAAS configuration required for secure operation of the ZooKeeper client will be ignored.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>