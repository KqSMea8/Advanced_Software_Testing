<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:45:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-602/HBASE-602.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-602] HBase Crash when network card has a IPv6 address</title>
                <link>https://issues.apache.org/jira/browse/HBASE-602</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;ve met a problem startup HBase.&lt;/p&gt;

&lt;p&gt;I setup hbase with hdfs,&lt;br/&gt;
My server&apos;s network card has a ipv4 address and also a ipv6 address.&lt;/p&gt;

&lt;p&gt;When I first startup hbase with default configuration file,&lt;br/&gt;
I found that the region server can&apos;t &lt;br/&gt;
register to master. And I found lots of 127.0.0.1 in log.&lt;/p&gt;

&lt;p&gt;So I suppose interface &quot;default&quot; would not work and add following:&lt;/p&gt;

&lt;p&gt;&amp;lt;property&amp;gt;&lt;br/&gt;
  &amp;lt;name&amp;gt;dfs.datanode.dns.interface&amp;lt;/name&amp;gt;&lt;br/&gt;
  &amp;lt;value&amp;gt;eth0&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;description&amp;gt;The name of the Network Interface from which a data node should &lt;br/&gt;
  report its IP address.&lt;br/&gt;
  &amp;lt;/description&amp;gt;&lt;br/&gt;
 &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;However, when this is done. HBase master crashes;&lt;br/&gt;
And I see ipv6 addresses in the log.&lt;/p&gt;

&lt;p&gt;So I dig into the source code,&lt;br/&gt;
found that HBase fails to deal with IPv6 address.&lt;/p&gt;

&lt;p&gt;Details is in following:&lt;br/&gt;
In class  org.apache.hadoop.hbase.HRegionServer&lt;br/&gt;
the method getThisIP() invoke the method of class belongs to Hadoop-core package&lt;br/&gt;
The class is: org.apache.hadoop.net.DNS&lt;br/&gt;
the method is: getDefaultIP(String strInterface)&lt;br/&gt;
This method invokes another method in the same class: getIPs(String strInterface)&lt;br/&gt;
Method getIPs always returns the first ip address  no matter it is ipv4 or ipv6&lt;/p&gt;

&lt;p&gt;I have fixed it by modifying method of org.apache.hadoop.net.DNS.getIPs(String&lt;br/&gt;
strInterface)&lt;br/&gt;
Such that it always returns ipv4 address&lt;br/&gt;
It is working now for me.&lt;br/&gt;
But when hadoop upgrades, I have to modify again.&lt;/p&gt;

&lt;p&gt;In order to avoid the problem,&lt;br/&gt;
I modify a method in class: org.apache.hadoop.net.DNS&lt;/p&gt;

&lt;p&gt;The following is the modified code of this method, it would not return IPv6&lt;br/&gt;
address now.&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns all the IPs associated with the provided interface, if any, in&lt;/li&gt;
	&lt;li&gt;textual form.&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;@param strInterface&lt;/li&gt;
	&lt;li&gt;The name of the network interface to query (e.g. eth0)&lt;/li&gt;
	&lt;li&gt;@return A string vector of all the IPs associated with the provided&lt;/li&gt;
	&lt;li&gt;interface&lt;/li&gt;
	&lt;li&gt;@throws UnknownHostException&lt;/li&gt;
	&lt;li&gt;If an UnknownHostException is encountered in querying the&lt;/li&gt;
	&lt;li&gt;default interface&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;   */&lt;br/&gt;
  public static String[] getIPs(String strInterface)&lt;br/&gt;
  throws UnknownHostException {&lt;br/&gt;
	    try {&lt;br/&gt;
	      NetworkInterface netIF = NetworkInterface.getByName(strInterface);&lt;br/&gt;
	      if (netIF == null)&lt;br/&gt;
	        return new String[] &lt;/p&gt;
{ InetAddress.getLocalHost()
	                              .getHostAddress() }
&lt;p&gt;;&lt;br/&gt;
	      else {&lt;br/&gt;
	        Vector&amp;lt;String&amp;gt; ips = new Vector&amp;lt;String&amp;gt;();&lt;br/&gt;
	        Enumeration e = netIF.getInetAddresses();&lt;br/&gt;
	        while (e.hasMoreElements())&lt;/p&gt;
	          				{
	        	String addr=((InetAddress) e.nextElement()).getHostAddress();
	        	if(addr.length()&amp;lt;=15)//only when it is a IPv4 address
	        		ips.add(addr);
	        	//ips.add(((InetAddress) e.nextElement()).getHostAddress());
	          				}
&lt;p&gt;	        return ips.toArray(new String[] {});&lt;br/&gt;
	      }&lt;br/&gt;
	    } catch (SocketException e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {	      return new String[] { InetAddress.getLocalHost().getHostAddress() };	    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;  }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Linux, java jdk 1.5&lt;br/&gt;
Network Card Address:&lt;br/&gt;
eth0      Link encap:Ethernet  HWaddr 00:1E:C9:6B:2F:71  &lt;br/&gt;
          inet addr:192.168.10.98  Bcast:192.168.10.255  Mask:255.255.255.0&lt;br/&gt;
          inet6 addr: fe80::21e:c9ff:fe6b:2f71/64 Scope:Link&lt;br/&gt;
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1&lt;br/&gt;
          RX packets:2061472 errors:0 dropped:0 overruns:0 frame:0&lt;br/&gt;
          TX packets:1936088 errors:0 dropped:0 overruns:0 carrier:0&lt;br/&gt;
          collisions:0 txqueuelen:100 &lt;br/&gt;
          RX bytes:493367388 (470.5 MB)  TX bytes:160961988 (153.5 MB)&lt;br/&gt;
          Base address:0xfe00 Memory:fdfc0000-fdfe0000&lt;/p&gt;</environment>
        <key id="12394946">HBASE-602</key>
            <summary>HBase Crash when network card has a IPv6 address</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="zhouw">Zhou Wei</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Apr 2008 00:28:06 +0000</created>
                <updated>Mon, 28 Dec 2009 19:24:55 +0000</updated>
                            <resolved>Wed, 12 Nov 2008 20:45:24 +0000</resolved>
                                    <version>0.1.1</version>
                    <version>0.2.1</version>
                    <version>0.18.1</version>
                    <version>0.19.0</version>
                                    <fixVersion>0.19.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12646995" author="jimk" created="Wed, 12 Nov 2008 18:43:53 +0000"  >&lt;p&gt;There are two places where the hlog directory name is built:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;HRegionServer.setupHLog&lt;/li&gt;
	&lt;li&gt;master.ProcessServerShutdown constructor&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If the host address is an IPV6 address, the directory name built contains &apos;:&apos; which is not acceptable for a Hadoop file name, and produces an error like the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-11-12 12:48:29,759 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer
: Unhandled exception. Aborting...
java.lang.IllegalArgumentException: java.net.URISyntaxException: Relative path in absolute URI: log_0:0:0:0:0:0:0:1_1226512108481_58009
        at org.apache.hadoop.fs.Path.initialize(Path.java:140)
        at org.apache.hadoop.fs.Path.&amp;lt;init&amp;gt;(Path.java:126)
        at org.apache.hadoop.fs.Path.&amp;lt;init&amp;gt;(Path.java:50)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.setupHLog(HRegionServer.java:545)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.init(HRegionServer.java:518)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:290)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
Caused by: java.net.URISyntaxException: Relative path in absolute URI: log_0:0:0:0:0:0:0:1_1226512108481_58009
        at java.net.URI.checkPath(URI.java:1787)
        at java.net.URI.&amp;lt;init&amp;gt;(URI.java:735)
        at org.apache.hadoop.fs.Path.initialize(Path.java:137)
        ... 6 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12647055" author="jimk" created="Wed, 12 Nov 2008 20:45:24 +0000"  >&lt;p&gt;Committed to branch and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Nov 2008 18:43:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h8bb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>