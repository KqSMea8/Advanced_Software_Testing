<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:18:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4358/HBASE-4358.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4358] Batch Table Alter Operations</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4358</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;

&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;

&lt;p&gt;Before patch:&lt;br/&gt;
hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, &lt;/p&gt;
{NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 2.6450 seconds&lt;br/&gt;
&lt;br/&gt;
After patch:&lt;br/&gt;
hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}
&lt;p&gt;, &lt;/p&gt;
{METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}
&lt;p&gt;Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 1.1930 seconds&lt;/p&gt;

&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12522349">HBASE-4358</key>
            <summary>Batch Table Alter Operations</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="riley">Riley Patterson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Sep 2011 00:08:46 +0000</created>
                <updated>Sat, 11 Apr 2015 00:49:49 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 00:49:49 +0000</resolved>
                                    <version>0.92.0</version>
                                                    <component>IPC/RPC</component>
                    <component>master</component>
                    <component>shell</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13100823" author="riley" created="Fri, 9 Sep 2011 00:38:43 +0000"  >&lt;p&gt;Note that several assumptions changed in TestMasterObserver due to automatically routing single calls through the batched API in order to minimize code redundancy. So I changed TestMasterObserver accordingly.&lt;/p&gt;</comment>
                            <comment id="13100824" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 00:44:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;

&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;

&lt;p&gt;Before patch:&lt;br/&gt;
hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, &lt;/p&gt;
{NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 2.6450 seconds&lt;br/&gt;
&lt;br/&gt;
After patch:&lt;br/&gt;
hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}
&lt;p&gt;, &lt;/p&gt;
{METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}
&lt;p&gt;Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 1.1930 seconds&lt;/p&gt;

&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;br/&gt;
  /src/main/ruby/hbase/admin.rb 1166933 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran unit tests I thought were relevant, which passed. In the process of running all unit tests.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Riley&lt;/p&gt;
</comment>
                            <comment id="13100870" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 02:14:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1826&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1826&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Nice feature.&lt;br/&gt;
More review to follow.&lt;/p&gt;


&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4198&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4198&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Year should be 2011.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4199&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    addFamily() can perform overwrite.&lt;br/&gt;
    Better add more javadoc.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 00:43:36, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 00:43:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran unit tests I thought were relevant, which passed. In the process of running all unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13100931" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 03:41:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1828&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1828&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Looks good to me.  All the table mod tests still pass though they go via a different path now?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 00:43:36, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 00:43:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran unit tests I thought were relevant, which passed. In the process of running all unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13100932" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 03:41:10 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1827&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1827&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This is awesome. We need this badly.&lt;/p&gt;


&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4200&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4200&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Coprocessors can modify these lists,right?&lt;br/&gt;
    The list returned by Arrays.asList(...) is fixed-length, i.e. the coprocessor can neither add nor remove entries.&lt;/p&gt;

&lt;p&gt;    If that&apos;s OK you can consider Collections.singletonList(column) instead.&lt;/p&gt;

&lt;p&gt;    If it&apos;s not OK - which I think is the case - this probably needs to be new ArrayList(Collections.singleton(column))&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 00:43:36, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 00:43:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran unit tests I thought were relevant, which passed. In the process of running all unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13100967" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 04:39:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1830&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4201&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4201&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This javadoc should be updated to match current parameter.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4202&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4202&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Year should be 2011.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4203&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4203&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    IOE may pop up from any operation.&lt;br/&gt;
    I think we should document that we adopt fail fast strategy.&lt;/p&gt;

&lt;p&gt;    Personally I think we should catch and store one InvalidFamilyOperationException, if any pops up.&lt;br/&gt;
    After completing all operations, we throw the stored InvalidFamilyOperationException.&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 00:43:36, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 00:43:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran unit tests I thought were relevant, which passed. In the process of running all unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101455" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 18:39:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-09-09 18:39:05.404480)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;

&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;

&lt;p&gt;Before patch:&lt;br/&gt;
hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, &lt;/p&gt;
{NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 2.6450 seconds&lt;br/&gt;
&lt;br/&gt;
After patch:&lt;br/&gt;
hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}
&lt;p&gt;, &lt;/p&gt;
{METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}
&lt;p&gt;Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 1.1930 seconds&lt;/p&gt;

&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;br/&gt;
  /src/main/ruby/hbase/admin.rb 1166933 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Riley&lt;/p&gt;
</comment>
                            <comment id="13101456" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 18:39:10 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 03:40:32, Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java, line 949&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/diff/1/?file=38934#file38934line949&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff/1/?file=38934#file38934line949&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Coprocessors can modify these lists,right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     The list returned by Arrays.asList(...) is fixed-length, i.e. the coprocessor can neither add nor remove entries.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If that&apos;s OK you can consider Collections.singletonList(column) instead.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If it&apos;s not OK - which I think is the case - this probably needs to be new ArrayList(Collections.singleton(column))&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense. Good catch.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Riley&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1827&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1827&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101457" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 18:39:12 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 02:13:22, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java, line 63&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/diff/1/?file=38944#file38944line63&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff/1/?file=38944#file38944line63&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     addFamily() can perform overwrite.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Better add more javadoc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not clear on exactly what you mean here. If it&apos;s that addFamily() will replace the old family descriptor with the new one, it seems like that would be expected behavior for a modify family handler.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Riley&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1826&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1826&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101461" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 18:41:09 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 04:38:24, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java, line 75&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/diff/1/?file=38945#file38945line75&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff/1/?file=38945#file38945line75&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     IOE may pop up from any operation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we should document that we adopt fail fast strategy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Personally I think we should catch and store one InvalidFamilyOperationException, if any pops up.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     After completing all operations, we throw the stored InvalidFamilyOperationException.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How about we just allocate a new HTableDescriptor object that we pass to updateTableDescriptor? Then we can document that if there is even a single exception, no changes were made. The updates to the FS and region restarts don&apos;t occur until after the potential IOExceptions due to updateTableDescriptor.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Riley&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1830&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101462" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 18:41:11 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 03:40:33, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Looks good to me.  All the table mod tests still pass though they go via a different path now?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;All unit tests pass.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Riley&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1828&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1828&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101490" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 19:01:14 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1841&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1841&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Can you perform testing on a small, real cluster ?&lt;/p&gt;


&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4212&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4212&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Where does this method call end up in this patch ?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4213&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I meant we should document that addFamily() performs modification here.&lt;br/&gt;
    This is minor.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101503" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 19:28:13 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 19:00:11, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Can you perform testing on a small, real cluster ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will do with this next revision.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 19:00:11, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java, line 64&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/diff/1/?file=38941#file38941line64&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff/1/?file=38941#file38941line64&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Where does this method call end up in this patch ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is not in the patch - its functionality is redundant with TableFamilyHandler.handleTableOperation(). Both the MasterFileSystem&apos;s services and the services passed to the handlers are simply a reference to the master itself, and both run getTableDescriptors().add() and getTableDescriptors().get() on the reference.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Riley&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1841&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1841&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101515" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 19:50:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1843&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1843&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4215&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-451&quot; title=&quot;Remove HTableDescriptor from HRegionInfo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-451&quot;&gt;&lt;del&gt;HBASE-451&lt;/del&gt;&lt;/a&gt;, changes to table descriptor have to be persisted to HDFS.&lt;/p&gt;

&lt;p&gt;    I browsed handleTableOperation() methods in this patch and didn&apos;t find that.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101551" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 20:48:09 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-09-09 19:48:45, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java, line 64&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/diff/1/?file=38941#file38941line64&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff/1/?file=38941#file38941line64&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-451&quot; title=&quot;Remove HTableDescriptor from HRegionInfo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-451&quot;&gt;&lt;del&gt;HBASE-451&lt;/del&gt;&lt;/a&gt;, changes to table descriptor have to be persisted to HDFS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I browsed handleTableOperation() methods in this patch and didn&apos;t find that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not familiar enough with how exactly table descriptors are persisted to be able to tell you for certain that this approach correctly ensures persistence. But I can confidently tell you that this diff does everything that the current trunk does with regards to updating table descriptors. If you look at the actual implementation of MasterFileSystem.&lt;/p&gt;
{add,modify,Delete}
&lt;p&gt;Column(), it gets a table descriptor from master services, modifies the table descriptor appropriately, then adds it back to master services&apos; table descriptors. Between handleTableOperation() and updateTableDescriptor(), this patch follows the exact same procedure, and has the same instance of MasterServices. This separation is for the purpose of enabling batching to happen in a way that doesn&apos;t leave the system in an intermediate state in the case of a thrown exception. From basic testing, I see that the table descriptor changes are actually being written to my fs. If this procedure is not enough to actually ensure that this happens, we should file a separate JIRA to look into it.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Riley&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1843&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1843&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-09-09 18:39:05, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 18:39:05)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101578" author="riley" created="Fri, 9 Sep 2011 21:22:26 +0000"  >&lt;p&gt;Addressed comments made on the review board. Cleaned up whitespace.&lt;/p&gt;</comment>
                            <comment id="13101579" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 21:24:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-09-09 21:23:14.655517)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Addressed various comments made here.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;

&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;

&lt;p&gt;Before patch:&lt;br/&gt;
hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, &lt;/p&gt;
{NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 2.6450 seconds&lt;br/&gt;
&lt;br/&gt;
After patch:&lt;br/&gt;
hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}
&lt;p&gt;, &lt;/p&gt;
{METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}
&lt;p&gt;Updating all regions with the new schema...&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 1.1930 seconds&lt;/p&gt;

&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/HTableDescriptor.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;br/&gt;
  /src/main/ruby/hbase/admin.rb 1166933 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Riley&lt;/p&gt;
</comment>
                            <comment id="13101592" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 21:48:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1846&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1846&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4218&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missed another Arrays.asList(...) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4219&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4219&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Trailing whitespace &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 21:23:14, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 21:23:14)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/HTableDescriptor.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101640" author="jiraposter@reviews.apache.org" created="Fri, 9 Sep 2011 23:18:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1768/#review1847&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#review1847&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1768/#comment4220&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/#comment4220&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Riley:&lt;br/&gt;
    Thanks for the detailed explanation.&lt;br/&gt;
    I should have patched your patch locally and performed the drill down.&lt;/p&gt;

&lt;p&gt;    There&apos;re 3 Arrays.asList() calls in patch v2.&lt;/p&gt;

&lt;p&gt;    If you don&apos;t have time, I can change them before committing.&lt;/p&gt;

&lt;p&gt;    Thanks for the nice work.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-09 21:23:14, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1768/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-09 21:23:14)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Currently, the RPC provides no way of asking for several table alterations at once, and the master has no way of batch handling alter requests. Thus, when the user requests several changes at the same time (i.e. add these I columns, delete these J columns, and modify these K columns), each region is brought down (I+J+K) times so that it can reflect the new schema. Additionally, multiple writes are made to META, and multiple RPC calls must be made.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch provides batching for these operations, both at the RPC level and within the Master&apos;s TableEventHandlers. This involves a bit of reorganization in the TableEventHandler class hierarchy, and a new TableEventHandler, TableMultiFamilyHandler. The net effect ends up being the difference seen here:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Before patch:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  Updating all regions with the new schema...&lt;br/&gt;
bq.  1/1 regions updated.&lt;br/&gt;
bq.  Done.&lt;br/&gt;
bq.  0 row(s) in 2.6450 seconds&lt;br/&gt;
bq.  &lt;br/&gt;
bq.  After patch:&lt;br/&gt;
bq.  hbase(main):002:0&amp;gt; alter &apos;peeps&apos;, {NAME =&amp;gt; &apos;rawr&apos;}, {METHOD =&amp;gt; &apos;delete&apos;, NAME =&amp;gt; &apos;name&apos;}&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updating all regions with the new schema...&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1/1 regions updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;0 row(s) in 1.1930 seconds&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Regions are only brought down once, and the duration is cut 1/N.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; title=&quot;Batch Table Alter Operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4358&quot;&gt;&lt;del&gt;HBASE-4358&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4358&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/HTableDescriptor.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableMultiFamilyHandler.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1166933 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1768/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1768/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sanity checked functionality in psuedo-distributed mode (tried several permutations of different alterations, all completed successfully and with only one round of region restarts). Ran all unit tests successfully.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13101657" author="yuzhihong@gmail.com" created="Fri, 9 Sep 2011 23:50:11 +0000"  >&lt;p&gt;Patch version 3 removes Arrays.asList() calls.&lt;/p&gt;</comment>
                            <comment id="13102369" author="yuzhihong@gmail.com" created="Sun, 11 Sep 2011 22:40:19 +0000"  >&lt;p&gt;A variant of HTableDescriptor ctor should be created. The storage for the new HTableDescriptor is under /hbase/tmp on hdfs.&lt;br/&gt;
A new method, possibly called copyAndRename() should be added to HTableDescriptor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void copyAndRename(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HTableDescriptor htd) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This method copies the contents of htd to this HTableDescriptor and renames the .tableinfo of htd to .tableinfo of this HTableDescriptor.&lt;/p&gt;

&lt;p&gt;The following should be done to make multi-family modifications atomic:&lt;br/&gt;
1. Create new HTableDescriptor, htd1, whose storage is under /hbase/tmp on hdfs and is a clone of original HTableDescriptor, htd&lt;br/&gt;
2. Perform series of modifications on htd1&lt;br/&gt;
3. Assuming there is no error, copy contents of htd1 onto htd and rename the .tableinfo file under /hbase/tmp using htd.copyAndRename(htd1).&lt;br/&gt;
4. If there was error, report back the exception and skip step 3 above&lt;/p&gt;</comment>
                            <comment id="13103035" author="stack" created="Mon, 12 Sep 2011 20:49:20 +0000"  >&lt;p&gt;Sounds good Ted (Do we  have a &apos;tmp&apos; dir under each table directory in hbase or under hbase.rootdir where we could write the tmp files).&lt;/p&gt;</comment>
                            <comment id="13103043" author="yuzhihong@gmail.com" created="Mon, 12 Sep 2011 20:58:47 +0000"  >&lt;p&gt;I don&apos;t see tmp or .tmp under hbase.rootdir&lt;br/&gt;
There is .tmp directory under each table directory currently.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12493870" name="4358-v3.txt" size="38936" author="yuzhihong@gmail.com" created="Fri, 9 Sep 2011 23:50:11 +0000"/>
                            <attachment id="12493858" name="HBASE-4358-v2.patch" size="36785" author="riley" created="Fri, 9 Sep 2011 21:22:26 +0000"/>
                            <attachment id="12493704" name="HBASE-4358.patch" size="35624" author="riley" created="Fri, 9 Sep 2011 00:38:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Sep 2011 00:44:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02f0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12035</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>