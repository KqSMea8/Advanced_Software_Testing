<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:47:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-739/HBASE-739.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-739] HBaseAdmin.createTable() using old HTableDescription doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/HBASE-739</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The following test case (see below) illustrate what used to work in branch 0.1 and that doesn&apos;t anymore. testTruncateInTrunk() shows how I got it to work again. I get this error now when trying the old code but using trunk:&lt;/p&gt;

&lt;p&gt;java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at com.openplaces.test.fixture.FixtureLoader.truncateHbaseTable(FixtureLoader.java:105)&lt;br/&gt;
	at com.openplaces.test.fixture.FixtureLoader.loadHbaseFixtures(FixtureLoader.java:63)&lt;br/&gt;
	at com.openplaces.test.fixture.TestCaseWithFixtures.hbaseFixtures(TestCaseWithFixtures.java:34)&lt;br/&gt;
	at com.openplaces.test.isolated.TestSearchSRFIEF.setUp(TestSearchSRFIEF.java:37)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:125)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)&lt;br/&gt;
Caused by: java.net.SocketTimeoutException: timed out waiting for rpc response&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:559)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HbaseRPC$Invoker.invoke(HbaseRPC.java:211)&lt;br/&gt;
	at $Proxy5.createTable(Unknown Source)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.HBaseAdmin.createTableAsync(HBaseAdmin.java:184)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.HBaseAdmin.createTable(HBaseAdmin.java:144)&lt;br/&gt;
	at com.openplaces.util.hbaserecord.connectionadapters.HbaseAdapter.truncateTable(HbaseAdapter.java:502)&lt;br/&gt;
	at com.openplaces.util.hbaserecord.Base$Singleton.truncate(Base.java:609)&lt;br/&gt;
	... 21 more&lt;/p&gt;




&lt;p&gt;import java.io.IOException;&lt;br/&gt;
import java.util.Collection;&lt;/p&gt;

&lt;p&gt;import org.apache.hadoop.hbase.HBaseConfiguration;&lt;br/&gt;
import org.apache.hadoop.hbase.HColumnDescriptor;&lt;br/&gt;
import org.apache.hadoop.hbase.HTableDescriptor;&lt;br/&gt;
import org.apache.hadoop.hbase.client.HBaseAdmin;&lt;br/&gt;
import org.apache.hadoop.hbase.client.HTable;&lt;/p&gt;

&lt;p&gt;import junit.framework.TestCase;&lt;/p&gt;

&lt;p&gt;@SuppressWarnings(&quot;deprecation&quot;)&lt;br/&gt;
public class TestTruncate extends TestCase {&lt;/p&gt;

&lt;p&gt;	public void testTruncateInBranch_0_1() throws IOException&lt;/p&gt;
{
		HTable table = new HTable(&quot;mytable&quot;);
		HBaseAdmin admin = new HBaseAdmin(new HBaseConfiguration());
		HTableDescriptor tableDesc = table.getMetadata();
		admin.deleteTable(table.getTableName());
		admin.createTable(tableDesc);
	}

&lt;p&gt;	public void testTruncateInTrunk() throws IOException{&lt;br/&gt;
		HTable table = new HTable(&quot;mytable&quot;);&lt;br/&gt;
		HBaseAdmin admin = new HBaseAdmin(new HBaseConfiguration());&lt;br/&gt;
		Collection&amp;lt;HColumnDescriptor&amp;gt; families = table.getMetadata().getFamilies();&lt;/p&gt;

&lt;p&gt;		HTableDescriptor tableDesc = new HTableDescriptor(table.getTableName());&lt;br/&gt;
		for(HColumnDescriptor family : families)&lt;/p&gt;
{
			tableDesc.addFamily(family);
		}

&lt;p&gt;		admin.deleteTable(table.getTableName());&lt;br/&gt;
		admin.createTable(tableDesc);&lt;br/&gt;
	}&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400062">HBASE-739</key>
            <summary>HBaseAdmin.createTable() using old HTableDescription doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="irubin">Izaak Rubin</assignee>
                                    <reporter username="srainville">Sebastien Rainville</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jul 2008 21:26:53 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:20 +0000</updated>
                            <resolved>Mon, 14 Jul 2008 21:40:34 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12612910" author="jimk" created="Fri, 11 Jul 2008 15:56:47 +0000"  >&lt;p&gt;The API for 0.2.0 is not backward compatible with 0.1.x &lt;/p&gt;

&lt;p&gt;This was a deliberate decision since the new features of 0.2.0 required big API changes, and some of the 0.1.x behavior cannot be supported with a compatibility layer.&lt;/p&gt;</comment>
                            <comment id="12613007" author="irubin" created="Fri, 11 Jul 2008 22:14:00 +0000"  >&lt;p&gt;I&apos;ve investigated this issue and have several things to report.  Sebastien, I wasn&apos;t able to replicate the exact error you gave in the issue description.  I did, however, get an error under the same circumstances (for testTruncateInBranch_0_1, although my error was a SocketTimeoutException).  Also, I should point out that the testing code you posted doesn&apos;t disable the table before dropping it, which causes other problems.&lt;/p&gt;

&lt;p&gt;The issue, or at least the one that I experienced with SocketTimeoutException, was that UnmodifyableHTableDescriptor did not serialize.  The server could not see the UnmodifyableHTableDescriptor class because it was package-protected and resides in hbase.client.  The solution, and the attached patch, merely involves adding the word &quot;public&quot; to the UnmodifyableHTableDescriptor class declaration.  The server can now see the class and serialize it.  &lt;/p&gt;</comment>
                            <comment id="12613009" author="stack" created="Fri, 11 Jul 2008 22:19:40 +0000"  >&lt;p&gt;I applied Izaak&apos;s patch (You should be able to use an UnmodifableHTD in the manner Sebastien is trying to use it above).&lt;/p&gt;

&lt;p&gt;Sebastien, if Izaak&apos;s patch fixes your issue, please close this issue; otherwise, provide more info.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12613010" author="irubin" created="Fri, 11 Jul 2008 22:21:55 +0000"  >&lt;p&gt;I&apos;m attaching the JUnit test I used for testing the issue.  The code is almost identical to that posted by Sebastien, except I&apos;ve added lines that disable the table before dropping.&lt;/p&gt;</comment>
                            <comment id="12613322" author="srainville" created="Mon, 14 Jul 2008 13:54:08 +0000"  >&lt;p&gt;I&apos;m still getting the same error. I attached the logs of the test case and the master in debug mode. I modified the test case so it creates the test table automatically. I&apos;m not so worried about this issue but it might uncover something worse underneath. And about the missing disableTable()... it was a copy paste error.&lt;/p&gt;</comment>
                            <comment id="12613325" author="srainville" created="Mon, 14 Jul 2008 14:01:55 +0000"  >&lt;p&gt;Actually, I&apos;m not getting the exact same error as before. I&apos;m getting java.net.SocketTimeoutException directly... and before I was getting a java.lang.reflect.InvocationTargetException CAUSED BY java.net.SocketTimeoutException.&lt;/p&gt;

&lt;p&gt;It sounds like I&apos;m getting the same error as you were seeing Isaac but somehow you got rid of it and not me. (and yes I updated my code and I see that you patch has been applied) So, your patch resolved the java.lang.reflect.InvocationTargetException but not the java.net.SocketTimeoutException.&lt;/p&gt;</comment>
                            <comment id="12613362" author="irubin" created="Mon, 14 Jul 2008 16:33:08 +0000"  >&lt;p&gt;Yeah, I&apos;m also getting the same error again.  Its weird, the code hasn&apos;t changed since Friday!  I&apos;m looking back into it again.&lt;/p&gt;</comment>
                            <comment id="12613442" author="irubin" created="Mon, 14 Jul 2008 20:21:56 +0000"  >&lt;p&gt;I think I&apos;ve really fixed it this time.  I added a default constructor to UnmodifyableHTableDescriptor, which I should have done in the last patch (this all goes in the same vein of making UnmodifyableHTableDescriptor serializable).  &lt;/p&gt;

&lt;p&gt;I found that Eclipse really confused the testing process - I definitely ran the test with and without the default constructor, sometimes succeeding and sometimes failing.  Running the test on the command-line was much more useful and straightforward, and I&apos;d recommend doing that instead (at least for this test).  Here&apos;s how you can run just that test on the command-line:&lt;/p&gt;

&lt;p&gt;Add the following to your build.xml:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;target name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ensure-test-name&quot;&lt;/span&gt; unless=&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;fail message=&lt;span class=&quot;code-quote&quot;&gt;&quot;You must run &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; target with -Dtest=TestName&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/target&amp;gt;

&amp;lt;target name=&lt;span class=&quot;code-quote&quot;&gt;&quot;runtest&quot;&lt;/span&gt; description=&lt;span class=&quot;code-quote&quot;&gt;&quot;Runs the test you specify on the command line with -Dtest=&quot;&lt;/span&gt; depends=&lt;span class=&quot;code-quote&quot;&gt;&quot;compile, ensure-test-name&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;junit printsummary=&lt;span class=&quot;code-quote&quot;&gt;&quot;withOutAndErr&quot;&lt;/span&gt; fork=&lt;span class=&quot;code-quote&quot;&gt;&quot;yes&quot;&lt;/span&gt;&amp;gt; 
    &amp;lt;classpath refid=&lt;span class=&quot;code-quote&quot;&gt;&quot;test.classpath&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;formatter type=&lt;span class=&quot;code-quote&quot;&gt;&quot;plain&quot;&lt;/span&gt; usefile=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;batchtest&amp;gt;
      &amp;lt;fileset dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;${src.test}&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;include name=&lt;span class=&quot;code-quote&quot;&gt;&quot;**/${test}.java&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/fileset&amp;gt;
    &amp;lt;/batchtest&amp;gt;
  &amp;lt;/junit&amp;gt;
&amp;lt;/target&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start HBase, make sure TestHbase739.java is added, &quot;mytable&quot; exists, etc, and then enter:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean jar compile-test runtest -Dtest=TestHbase739
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without the attached patch, hbase-739_v2.patch, this should fail (it might say &quot;Build Successful&quot;, but check the actual junit output).  After adding the attached patch, this should succeed (at least it did for me, when doing this process on a fresh copy of HBase).  &lt;/p&gt;

&lt;p&gt;Let me know if this is still generating errors.&lt;/p&gt;</comment>
                            <comment id="12613454" author="stack" created="Mon, 14 Jul 2008 21:15:33 +0000"  >&lt;p&gt;Applied Izaaks second patch (Thanks Izaak).&lt;/p&gt;</comment>
                            <comment id="12613462" author="srainville" created="Mon, 14 Jul 2008 21:40:34 +0000"  >&lt;p&gt;Unit test ran successfuly on my box too using the code in trunk, which has your patch applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12385981" name="TEST-org.apache.hadoop.hbase.TestTruncateIsaak.txt" size="7211" author="srainville" created="Mon, 14 Jul 2008 13:54:08 +0000"/>
                            <attachment id="12385908" name="TestHbase739.java" size="1453" author="irubin" created="Fri, 11 Jul 2008 22:21:55 +0000"/>
                            <attachment id="12385982" name="TestTruncate2.java" size="2075" author="srainville" created="Mon, 14 Jul 2008 13:54:08 +0000"/>
                            <attachment id="12385907" name="hbase-739.patch" size="819" author="irubin" created="Fri, 11 Jul 2008 22:14:00 +0000"/>
                            <attachment id="12386010" name="hbase-739_v2.patch" size="578" author="irubin" created="Mon, 14 Jul 2008 20:21:56 +0000"/>
                            <attachment id="12385983" name="master.log" size="12942" author="srainville" created="Mon, 14 Jul 2008 13:54:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Jul 2008 15:56:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25370</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h95j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>