<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:22:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11351/HBASE-11351.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11351] Experiments with OffHeap memstores</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11351</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have been experimenting with offheap memstores using an offheap BTree implementation of ConcurrentMap provided by MapDB (www.mapdb.org)&lt;/p&gt;

&lt;p&gt;So far I hooked this up in an experimental way with inefficient serialization (in the sense that due to our special usage of the set api we need to back the set by a map, which in the off heap case means we need to serialize and store the value twice. It is used as key and value). But it works.&lt;/p&gt;

&lt;p&gt;It&apos;s quite a bit slower and due to need to deserialize upon scan it produces &lt;b&gt;more&lt;/b&gt; short term garbage.&lt;/p&gt;

&lt;p&gt;Let&apos;s use this issue to discuss.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12721207">HBASE-11351</key>
            <summary>Experiments with OffHeap memstores</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jun 2014 22:28:51 +0000</created>
                <updated>Sun, 15 Jun 2014 03:58:49 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>17</watches>
                                                                <comments>
                            <comment id="14031298" author="mantonov" created="Fri, 13 Jun 2014 22:52:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I hooked this up in an experimental way&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;is there supposed to be a patch posted here?&lt;/p&gt;</comment>
                            <comment id="14031380" author="lhofhansl" created="Sat, 14 Jun 2014 01:01:35 +0000"  >&lt;p&gt;Not yet &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I have one, but it only work in 0.94 since serialization into bytes was easy then (just from the writeable).&lt;/p&gt;</comment>
                            <comment id="14031444" author="mantonov" created="Sat, 14 Jun 2014 04:11:41 +0000"  >&lt;p&gt;Ah, I see &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Eager to look at one once it&apos;s available..&lt;/p&gt;</comment>
                            <comment id="14031737" author="lhofhansl" created="Sat, 14 Jun 2014 23:41:25 +0000"  >&lt;p&gt;Here&apos;s the hacked up patch.&lt;br/&gt;
WARNING: Total hack.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;For some reason MapDB wants &lt;b&gt;everything&lt;/b&gt; Serializable&lt;/li&gt;
	&lt;li&gt;All code in Memstore.java&lt;/li&gt;
	&lt;li&gt;Currently KVs are serialized twice into the off heap map (could work around this if we forked MapDB NavigableSet implementation).&lt;/li&gt;
	&lt;li&gt;Much slower&lt;/li&gt;
	&lt;li&gt;Generates more GC churn (but should be young gen only)&lt;/li&gt;
	&lt;li&gt;0.94 only right now&lt;/li&gt;
	&lt;li&gt;Just for playing!&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14031769" author="lhofhansl" created="Sun, 15 Jun 2014 03:26:40 +0000"  >&lt;p&gt;Hmm... Doesn&apos;t work quite yet. I must have broken something playing around. Stay tuned.&lt;/p&gt;</comment>
                            <comment id="14031773" author="lhofhansl" created="Sun, 15 Jun 2014 03:41:03 +0000"  >&lt;p&gt;This one works. MapDB requires each class do be serializable.&lt;/p&gt;</comment>
                            <comment id="14031775" author="lhofhansl" created="Sun, 15 Jun 2014 03:51:14 +0000"  >&lt;p&gt;Next:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make it work in 0.96+ (protobufs). Although could keep the current serialization as well&lt;/li&gt;
	&lt;li&gt;Better serialization (that makes use of the the sorted nature of the keys and does prefix compression)&lt;/li&gt;
	&lt;li&gt;Only store key portion in the key of the map&lt;/li&gt;
	&lt;li&gt;Add code to MapDB to allow serialization from an array with offset&lt;/li&gt;
	&lt;li&gt;Fork the set implementation so that we do not need to store KV in a map (which in offheap means two copies of the KV)&lt;/li&gt;
	&lt;li&gt;Do comparisons off heap! Needs more access into the BTree details (i.e. to the data before it is deserialized onto the heap again)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Not sure how much time I&apos;ll get on those. If somebody wants to experiment I&apos;m happy to collaborate.&lt;/p&gt;</comment>
                            <comment id="14031777" author="lhofhansl" created="Sun, 15 Jun 2014 03:57:57 +0000"  >&lt;p&gt;Very slightly better. Stores only the key portion of the KV in the off heap map&apos;s key.&lt;/p&gt;</comment>
                            <comment id="14031779" author="lhofhansl" created="Sun, 15 Jun 2014 03:58:49 +0000"  >&lt;p&gt;Right patch this time.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12685275">HBASE-10191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12650466" name="11351-0.94-v2.txt" size="8906" author="lhofhansl" created="Sun, 15 Jun 2014 03:41:03 +0000"/>
                            <attachment id="12650469" name="11351-0.94-v3.txt" size="8921" author="lhofhansl" created="Sun, 15 Jun 2014 03:58:49 +0000"/>
                            <attachment id="12650462" name="11351-0.94.txt" size="7805" author="lhofhansl" created="Sat, 14 Jun 2014 23:41:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 13 Jun 2014 22:52:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399403</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wr9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>