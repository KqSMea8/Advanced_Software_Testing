<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:59:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8877/HBASE-8877.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8877] Reentrant row locks</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8877</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8806&quot; title=&quot;Row locks are acquired repeatedly in HRegion.doMiniBatchMutation for duplicate rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8806&quot;&gt;&lt;del&gt;HBASE-8806&lt;/del&gt;&lt;/a&gt; revealed performance problems with batch mutations failing to reacquire the same row locks.  It looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8806&quot; title=&quot;Row locks are acquired repeatedly in HRegion.doMiniBatchMutation for duplicate rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8806&quot;&gt;&lt;del&gt;HBASE-8806&lt;/del&gt;&lt;/a&gt; will use a less intrusive change for 0.94 to have batch mutations track their own row locks and not attempt to reacquire them.  Another approach will be to support reentrant row locks directly.  This allows simplifying a great deal of calling code to no longer track and pass around lock ids.&lt;/p&gt;

&lt;p&gt;One affect this change will have is changing the RegionObserver coprocessor&apos;s methods preBatchMutate and postBatchMutate from taking a &lt;tt&gt;MiniBatchOperationInProgress&amp;lt;Pair&amp;lt;Mutation, Integer&amp;gt;&amp;gt; miniBatchOp&lt;/tt&gt; to taking a &lt;tt&gt;MiniBatchOperationInProgress&amp;lt;Mutation&amp;gt; miniBatchOp&lt;/tt&gt;.  I don&apos;t believe CPs should be relying on these lock ids, but that&apos;s a potential incompatibility.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12656386">HBASE-8877</key>
            <summary>Reentrant row locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davelatham">Dave Latham</assignee>
                                    <reporter username="davelatham">Dave Latham</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jul 2013 15:28:10 +0000</created>
                <updated>Tue, 15 Oct 2013 04:46:48 +0000</updated>
                            <resolved>Wed, 17 Jul 2013 05:34:27 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.95.2</fixVersion>
                                    <component>Coprocessors</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="13700936" author="davelatham" created="Fri, 5 Jul 2013 15:36:14 +0000"  >&lt;p&gt;Here&apos;s a patch implementing reentrant row locks.  It changes the locking interface to these 3 methods:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;void getRowLock(byte[] row) throws IOException (acquire, throw if unable to acqurie before timeout)&lt;/li&gt;
	&lt;li&gt;boolean tryRowLock(byte[] row) (acquire without wait and return true iff successful)&lt;/li&gt;
	&lt;li&gt;void releaseMyRowLocks() (release all row locks held by the current thread)&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13700940" author="davelatham" created="Fri, 5 Jul 2013 15:39:19 +0000"  >&lt;p&gt;A few changes in this patch compared to the latest similar patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8806&quot; title=&quot;Row locks are acquired repeatedly in HRegion.doMiniBatchMutation for duplicate rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8806&quot;&gt;&lt;del&gt;HBASE-8806&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed the heap size logic to match the new fields&lt;/li&gt;
	&lt;li&gt;wrapped a couple lines that were longer than 100 chars&lt;/li&gt;
	&lt;li&gt;changed releaseMyRowLocks method to free the list of locks from the thread local so that each thread doesn&apos;t wind up having very long empty lists hanging around&lt;/li&gt;
	&lt;li&gt;changed the row lock methods from public to package private as they are only used inside HRegion (and by some tests)&lt;/li&gt;
	&lt;li&gt;added some comments to checkAndMutate to make clear row it&apos;s reusing locks&lt;/li&gt;
	&lt;li&gt;renamed new thread local field to rowLocksHeldByThread&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13700971" author="yuzhihong@gmail.com" created="Fri, 5 Jul 2013 16:19:43 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OperationStatus[] batchMutate(
-      Pair&amp;lt;Mutation, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;[] mutationsAndLocks) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
-    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; batchMutate(mutationsAndLocks, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OperationStatus[] batchMutate(Mutation[] mutations) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should dev@hbase be polled for the removal of lock Id ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   /**
-   * Returns existing row lock &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; found, otherwise
-   * obtains a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; row lock and returns it.
-   * @param lockid requested by the user, or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the user didn&apos;t already hold lock
-   * @param row the row to lock
-   * @param waitForLock &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, will block until the lock is available, otherwise will
-   * simply &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it could not acquire the lock.
-   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lockid or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; waitForLock is &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; and the lock was unavailable.
+   * &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void getRowLock(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] row) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
+   * internalObtainRowLock(row, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The change in javadoc seems unnecessary.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class RowLockContext {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;RowLockContext can be private, right ?&lt;/p&gt;</comment>
                            <comment id="13700996" author="hadoopqa" created="Fri, 5 Jul 2013 16:54:50 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591013/HBASE-8877.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591013/HBASE-8877.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6224//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13701013" author="apurtell" created="Fri, 5 Jul 2013 17:30:42 +0000"  >&lt;p&gt;+1 on the CP interface change. There might (in theory - doubt in practice) have been some utility before for passing through lock ids but if this issue is committed obviously no longer. This proposal is only for &amp;gt;= 0.95?&lt;/p&gt;

&lt;p&gt;Edit: fix JIRA formatting. &lt;/p&gt;</comment>
                            <comment id="13701421" author="davelatham" created="Sat, 6 Jul 2013 21:56:49 +0000"  >&lt;p&gt;Thanks, Ted, for the review.  I sent out a note to the dev list for input on the removal of lock ids.  Here&apos;s a new patch in which I fixed javadoc on tryRowLock and made RowLockContext private.&lt;/p&gt;</comment>
                            <comment id="13701422" author="davelatham" created="Sat, 6 Jul 2013 21:57:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;+1 on the CP interface change. There might (in theory - doubt in practice) have been some utility before for passing through lock ids but if this issue is committed obviously no longer. This proposal is only for &amp;gt;= 0.95?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, Andrew.  Yes, this proposal is for 0.95+ only.&lt;/p&gt;</comment>
                            <comment id="13701447" author="hadoopqa" created="Sat, 6 Jul 2013 23:14:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591094/HBASE-8877-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591094/HBASE-8877-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestIOFencing&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6232//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13701712" author="yuzhihong@gmail.com" created="Mon, 8 Jul 2013 00:50:25 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; getLock(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; lockid, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] row, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; waitForLock)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Looks like the following methods should be public:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  @VisibleForTesting &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; tryRowLock(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] row) {
+  @VisibleForTesting void getRowLock(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] row) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13701745" author="davelatham" created="Mon, 8 Jul 2013 03:26:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;Looks like the following methods should be public:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why do you think they should be public methods?&lt;/p&gt;</comment>
                            <comment id="13701747" author="anoop.hbase" created="Mon, 8 Jul 2013 03:35:00 +0000"  >&lt;p&gt;Should we allow acquire and release locks from CPs?&lt;/p&gt;</comment>
                            <comment id="13701796" author="ram_krish" created="Mon, 8 Jul 2013 05:41:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should we allow acquire and release locks from CPs?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Is this in lieu with having some cross region locks using CPs? May be we need to make the tryRowLock and releaseRowLocks to be public in case we are giving CPs the option to acquire and release the locks.  Do correct me if am wrong.&lt;/p&gt;</comment>
                            <comment id="13701992" author="davelatham" created="Mon, 8 Jul 2013 13:28:30 +0000"  >&lt;p&gt;Ah, ok I&apos;ve reverted them in this patch (v3) to public so that CPs can acquire and release locks if desired.  Thanks, Ted, Anoop, Ramkrishna.&lt;/p&gt;</comment>
                            <comment id="13702034" author="hadoopqa" created="Mon, 8 Jul 2013 14:42:49 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591212/HBASE-8877-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591212/HBASE-8877-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6237//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13702037" author="yuzhihong@gmail.com" created="Mon, 8 Jul 2013 14:46:33 +0000"  >&lt;p&gt;+1 on patch v3.&lt;/p&gt;</comment>
                            <comment id="13707408" author="davelatham" created="Fri, 12 Jul 2013 21:42:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=churromorales&quot; class=&quot;user-hover&quot; rel=&quot;churromorales&quot;&gt;churro morales&lt;/a&gt; ran the patch v3 through his microbenchmark on mini batch puts.  It revealed an issue in the patch that the list of locks from the same thread held duplicates resulting in erroneous errors being logged.  Here&apos;s a v4 patch fixing that issue.  Here are also results for the microbenchmark on this patch that show it as fast or faster than the existing trunk.&lt;/p&gt;

&lt;p&gt;If this looks good, It think it&apos;s ready for commit to trunk and 0.96.&lt;/p&gt;

&lt;p&gt;Should also have a patch soon for 0.94 that is similar to Anoop&apos;s patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8806&quot; title=&quot;Row locks are acquired repeatedly in HRegion.doMiniBatchMutation for duplicate rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8806&quot;&gt;&lt;del&gt;HBASE-8806&lt;/del&gt;&lt;/a&gt; but only uses reentrancy for doMiniBatchMutation and mutateRowsWithLocks to avoid problems with client side row locks.  Verifying tests and perf for that one.&lt;/p&gt;</comment>
                            <comment id="13707421" author="yuzhihong@gmail.com" created="Fri, 12 Jul 2013 21:47:03 +0000"  >&lt;p&gt;Nice results.&lt;/p&gt;

&lt;p&gt;What was the unit for min/max/mean values ?&lt;/p&gt;</comment>
                            <comment id="13707431" author="hadoopqa" created="Fri, 12 Jul 2013 21:52:32 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592082/hbase-8807-v4-microbenchmark.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592082/hbase-8807-v4-microbenchmark.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6317//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6317//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707481" author="davelatham" created="Fri, 12 Jul 2013 22:40:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;What was the unit for min/max/mean values ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Each trial measures the number of milliseconds to execute a batchMutate of 25000 puts.&lt;/p&gt;</comment>
                            <comment id="13707550" author="davelatham" created="Fri, 12 Jul 2013 23:39:31 +0000"  >&lt;p&gt;Here&apos;s the patch for some minimal reentrant locks for the 0.94 branch.  It is similar to Anoop&apos;s patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8806&quot; title=&quot;Row locks are acquired repeatedly in HRegion.doMiniBatchMutation for duplicate rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8806&quot;&gt;&lt;del&gt;HBASE-8806&lt;/del&gt;&lt;/a&gt;.  Also attached are the perf benchmark results showing it is as fast or faster than current 0.94.&lt;/p&gt;</comment>
                            <comment id="13707555" author="hadoopqa" created="Fri, 12 Jul 2013 23:43:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592108/hbase-8877-v4-microbenchmark.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592108/hbase-8877-v4-microbenchmark.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6319//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6319//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707747" author="davelatham" created="Sat, 13 Jul 2013 14:35:18 +0000"  >&lt;p&gt;Reattached &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-v4.patch for Hadoop QA to notice.&lt;/p&gt;</comment>
                            <comment id="13707750" author="hadoopqa" created="Sat, 13 Jul 2013 14:42:37 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592150/HBASE-8877-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592150/HBASE-8877-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6324//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6324//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707768" author="davelatham" created="Sat, 13 Jul 2013 15:37:26 +0000"  >&lt;p&gt;Here&apos;s a v5 patch which merges in changes from trunk since v4 could no longer apply.&lt;/p&gt;</comment>
                            <comment id="13707776" author="hadoopqa" created="Sat, 13 Jul 2013 16:03:18 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592151/HBASE-8877-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592151/HBASE-8877-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.TestHeapSize&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6325//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707786" author="davelatham" created="Sat, 13 Jul 2013 17:04:10 +0000"  >&lt;p&gt;Last patch failed on TestHeapSize.  This surprised me since it had passed for me locally.  Turns out locally I was on a 64-bit VM and Jenkins ran it out a 32-bit.  It also turns out the current trunk had the FIXED_OVERHEAD off by +1 long, -1 reference and -2 booleans which just happened to pass the tests due to alignment but after this change began to fail.  Digging further it&apos;s obvious the DEEP_OVERHEAD is missing many fields as is the heapSize() method.  Looks like we may not be even trying any more.  Has there already been any discussion about this?&lt;/p&gt;

&lt;p&gt;Attaching v6 patch.  In this patch I&apos;ve corrected FIXED_OVERHEAD which gets the test passing.  I also added a couple missing AtomicIntegers to DEEP_OVERHEAD as well as a comment specifying all the other missing things which I think is too great a scope for me to try to fix in this patch, but at least serves as a warning to others. &lt;/p&gt;</comment>
                            <comment id="13707787" author="davelatham" created="Sat, 13 Jul 2013 17:04:54 +0000"  >&lt;p&gt;Note the above comment is referencing the HRegion class.&lt;/p&gt;</comment>
                            <comment id="13707808" author="hadoopqa" created="Sat, 13 Jul 2013 18:20:02 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592154/HBASE-8877-v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592154/HBASE-8877-v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6326//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707809" author="yuzhihong@gmail.com" created="Sat, 13 Jul 2013 18:28:19 +0000"  >&lt;p&gt;+1 on patch v6.&lt;/p&gt;</comment>
                            <comment id="13708016" author="lhofhansl" created="Sun, 14 Jul 2013 13:07:00 +0000"  >&lt;p&gt;0.94 patch looks good. I played through scenarios where the client provides a lock id, it should work find in all cases (as long as obtainRowLock does not acquire reentrant locks, which is the case).&lt;/p&gt;

&lt;p&gt;This worries me a little bit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Release unknown lockId: &quot;&lt;/span&gt; + lockId);
+      &lt;span class=&quot;code-comment&quot;&gt;// Row not locked.  Likely released by the same thread already.
&lt;/span&gt;       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We&apos;re loosing a double check here. Not a deal breaker, though.&lt;/p&gt;

&lt;p&gt;Also, while we&apos;re at it, let&apos;s fix the typo here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rowLockContext == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
       LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Releases row not locked, lockId: &quot;&lt;/span&gt; + lockId + &lt;span class=&quot;code-quote&quot;&gt;&quot; row: &quot;&lt;/span&gt;
           + rowKey);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&quot;Releases&quot; -&amp;gt; &quot;Released&quot;. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13708034" author="davelatham" created="Sun, 14 Jul 2013 14:09:17 +0000"  >&lt;p&gt;Thanks, Ted and Lars for the reviews.&lt;/p&gt;

&lt;p&gt;Here&apos;s a new patch, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-0.94-v2.patch which fixes the typo in the log messages &quot;Releases&quot; -&amp;gt; &quot;Released&quot;.&lt;/p&gt;</comment>
                            <comment id="13708035" author="hadoopqa" created="Sun, 14 Jul 2013 14:12:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592195/HBASE-8877-0.94-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592195/HBASE-8877-0.94-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6329//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6329//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13708163" author="stack" created="Mon, 15 Jul 2013 00:00:04 +0000"  >&lt;p&gt;Very nice patch.  Nice cleanup.&lt;/p&gt;

&lt;p&gt;A bit of doc on this would help:&lt;/p&gt;

&lt;p&gt;rowLocksHeldByThread&lt;/p&gt;

&lt;p&gt;It is a nice trick.  It is worth talking up!&lt;/p&gt;

&lt;p&gt;Should we deprecate stuff like this,    public OperationStatus[] put(Put[] puts) throws IOException {, the methods that you have made into pass-throughs? (Fine in another issue)&lt;/p&gt;

&lt;p&gt;When we fall out here because we failed to acquire a lock, what happens?  We apply all mutations for which we did get a lock?  And then return the client reporting as failed those we did not get a lock on?&lt;/p&gt;

&lt;p&gt;           assert !shouldBlock : &quot;Should never fail to get lock when blocking&quot;;&lt;br/&gt;
           break; // stop acquiring more rows for this batch&lt;/p&gt;

&lt;p&gt;Is this racey?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        RowLockContext existingContext = lockedRows.putIfAbsent(rowKey, rowLockContext);
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (existingContext == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+          &lt;span class=&quot;code-comment&quot;&gt;// Row is not already locked by any thread, add it to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; thread&apos;s list
&lt;/span&gt;+          rowLocksHeldByThread.get().add(rowKey);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could another thread come in and add to lockedRows before get to add this rowKey to the thread local?&lt;/p&gt;

&lt;p&gt;This should be finals&lt;/p&gt;

&lt;p&gt;+    private CountDownLatch latch;&lt;br/&gt;
+    private Thread thread;&lt;/p&gt;

&lt;p&gt;Otherwise +1 on commit.&lt;/p&gt;</comment>
                            <comment id="13708647" author="davelatham" created="Mon, 15 Jul 2013 17:07:51 +0000"  >&lt;p&gt;Thanks, Stack, for the review.  Judging by your comments I believe you&apos;re addressing &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-v6.patch (rather than &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-0.94-v2.patch).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A bit of doc on this would help: ... rowLocksHeldByThread&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;hould we deprecate stuff like this, public OperationStatus[] put(Put[] puts) throws IOException {, the methods that you have made into pass-throughs? (Fine in another issue)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s the only method that became a pass-through.  I considered just removing it - we&apos;re already changing the HRegion public methods from row locks - I assumed that was OK to do in the singularity (not to mention the CP change).  It&apos;s only used by HBaseFsck and 3 tests.  I&apos;ve now inlined it directly.  Let me know if you think it needs to be deprecated for a release first.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;When we fall out here because we failed to acquire a lock, what happens? We apply all mutations for which we did get a lock? And then return the client reporting as failed those we did not get a lock on?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If we did get any locks then we apply those mutations for which we did get locks, clean them up, return out to batchMutate which will continue again.  If we failed to get any locks at all, then it means the timeout expired (default 30 seconds) and by my reading it still goes through all the cleanup methods then tries again.  None of that logic was touched for these issues.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is this racey?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Strictly rated G&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Could another thread come in and add to lockedRows before get to add this rowKey to the thread local?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Nope, lockedRows.putIfAbsent gives atomicity so the next thread would get back a non null existingContext.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This should be finals&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed.  Done.&lt;/p&gt;

&lt;p&gt;Attached &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-v7.patch&lt;/p&gt;</comment>
                            <comment id="13708660" author="davelatham" created="Mon, 15 Jul 2013 17:19:16 +0000"  >&lt;p&gt;3 +1&apos;s on the dev mailing list for the removal of lock ids from the coprocessor, in addition to Andrew&apos;s +1 here.  No -1&apos;s.&lt;/p&gt;

&lt;p&gt;One thought - should we commit to 0.94 a javadoc method at least warning that the locks are going to disappear from the coprocessor?&lt;/p&gt;</comment>
                            <comment id="13708754" author="stack" created="Mon, 15 Jul 2013 18:09:54 +0000"  >&lt;p&gt;+1 on patch.  Will commit to trunk in few hours unless objection.&lt;/p&gt;

&lt;p&gt;No harm adding warning on 0.94 patch.&lt;/p&gt;</comment>
                            <comment id="13708794" author="hadoopqa" created="Mon, 15 Jul 2013 18:35:36 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592355/HBASE-8877-v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592355/HBASE-8877-v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestFullLogReconstruction&lt;br/&gt;
                  org.apache.hadoop.hbase.security.access.TestAccessController&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6343//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13708803" author="lhofhansl" created="Mon, 15 Jul 2013 18:45:33 +0000"  >&lt;p&gt;Do we need to do reference counting on the locks?&lt;/p&gt;

&lt;p&gt;Technically the patch is correct, since an HBase lock does not outlive an RPC request, but it still seems a tad fragile.&lt;br/&gt;
For example what if in the future a method does its own locking: It acquires a lock on a row, does some logic, releases the lock. If a method higher up in the call stack had the row locked, it is now unlocked from under it.&lt;/p&gt;</comment>
                            <comment id="13708851" author="davelatham" created="Mon, 15 Jul 2013 19:23:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Agreed that it&apos;s a bit fragile and that exactly was why I was initially concerned about checkAndMutate before I convinced myself it was safe and added the comment indicating that the nested release may have already released the locks.&lt;/p&gt;

&lt;p&gt;Reference counts would change the contract (from current patch) and require clients like doMiniBatchMutation to track the number of times it acquires the lock on each row and then release them the same number of times as opposed to a simple releaseAll.  I can give it a shot to see how it turns out if you want to see it.&lt;/p&gt;</comment>
                            <comment id="13708869" author="stack" created="Mon, 15 Jul 2013 19:43:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;...what if in the future a method does its own locking...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You have a use case in mind &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13709109" author="davelatham" created="Mon, 15 Jul 2013 22:53:40 +0000"  >&lt;p&gt;Alright, here&apos;s a patch with reentrant row locks and reference counts.&lt;/p&gt;

&lt;p&gt;This patch updates the row lock interface on HRegion to the following methods:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RowLock HRegion.getRowLock(final byte[] row, boolean waitForLock): acquire lock, optionally wait for lock&lt;/li&gt;
	&lt;li&gt;RowLock HRegion.getRowLock(final byte[] row): acquire lock, always waits for lock&lt;/li&gt;
	&lt;li&gt;RowLock.release(): releases the row lock&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The same thread can acquire multiple locks on the same row, but must release them all.  doMiniBatchMutate now keeps a List of row locks (one for each row) and releases them all.&lt;/p&gt;

&lt;p&gt;While reviewing the clients I noticed that HRegion.increment and the duplicated code in HRegion.append both had possible paths to fail to release their row locks so I added a try/finally block to ensure they always release their locks.&lt;/p&gt;

&lt;p&gt;All the tests pass locally.  I will run the microbenchmark too and post the results.&lt;/p&gt;</comment>
                            <comment id="13709140" author="yuzhihong@gmail.com" created="Mon, 15 Jul 2013 23:09:56 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (existingContext != &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) {
+          LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal row lock state inconsistent, should not happen, row: &quot;&lt;/span&gt; + row);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should an assertion (or exception) be placed in the if block above ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class RowLock {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can RowLock class be package private ?&lt;/p&gt;</comment>
                            <comment id="13709141" author="davelatham" created="Mon, 15 Jul 2013 23:10:03 +0000"  >&lt;p&gt;microbenchmark comparing latest patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts.patch) to trunk and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-v7.patch.&lt;/p&gt;

&lt;p&gt;Shows that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts is about the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-v7 and both faster than trunk.&lt;/p&gt;</comment>
                            <comment id="13709156" author="davelatham" created="Mon, 15 Jul 2013 23:18:00 +0000"  >&lt;p&gt;Reattaching refCounts patch with check to enforce that only the same thread may release a lock that acquired it and so that Hadoop QA checks this file rather than the benchmark results.&lt;/p&gt;</comment>
                            <comment id="13709171" author="davelatham" created="Mon, 15 Jul 2013 23:28:00 +0000"  >&lt;p&gt;Thanks, Ted, for taking a look.  Sorry for changing the same file while you were looking.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should an assertion (or exception) be placed in the if block above ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The same behavior is there in the previous patch (v7) (and nearly the same in trunk as well) so it&apos;s not really a change.  That said, this state cannot happen as I read the code, but if it did then the row locks may be stuck, so an exception sounds good to me so that it would be louder.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can RowLock class be package private ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It should be the same scope as the getRowLock method (needed for clients to keep references and release them) which I believe we decided to be public (for CPs for example).&lt;/p&gt;

&lt;p&gt;I&apos;ve attached &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts-v2.patch with the change to throw an exception on inconsistent row lock state.&lt;/p&gt;</comment>
                            <comment id="13709181" author="davelatham" created="Mon, 15 Jul 2013 23:37:44 +0000"  >&lt;p&gt;One more patch, fixes a typo and moves the enforcement of current thread from RowLock.release into RowLockContext.releaseLock for consistency.&lt;/p&gt;

&lt;p&gt;Apologies for the patch spam.&lt;/p&gt;</comment>
                            <comment id="13709217" author="hadoopqa" created="Tue, 16 Jul 2013 00:02:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592445/HBASE-8877-refCounts-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592445/HBASE-8877-refCounts-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6353//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6353//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13709354" author="lhofhansl" created="Tue, 16 Jul 2013 01:55:56 +0000"  >&lt;p&gt;Awesome. Thanks for bearing with our (or at least my) bickering &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Patch looks good. (You even made the lock count a simple int, since it is only ever changed by the same thread). The change is big, because of the new try/catch blocks, wonder whether I should put it up on RB.&lt;/p&gt;</comment>
                            <comment id="13709387" author="hadoopqa" created="Tue, 16 Jul 2013 02:25:19 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592445/HBASE-8877-refCounts-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592445/HBASE-8877-refCounts-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6354//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6354//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13709412" author="davelatham" created="Tue, 16 Jul 2013 03:15:28 +0000"  >&lt;p&gt;Another try rebased off current tip of trunk.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts-v4&lt;/p&gt;</comment>
                            <comment id="13709416" author="davelatham" created="Tue, 16 Jul 2013 03:23:48 +0000"  >&lt;p&gt;And here&apos;s the diff up on review board if that makes it easier for anyone.&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/12573/diff/#index_header&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/12573/diff/#index_header&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13709425" author="lhofhansl" created="Tue, 16 Jul 2013 03:37:23 +0000"  >&lt;p&gt;Patch looks good.&lt;br/&gt;
In the context of doMiniBatchMutation the previous version that could release all &quot;my&quot; locks was nicer. Hmm.&lt;/p&gt;

&lt;p&gt;+1 on either v7 or refCounts-v4.&lt;br/&gt;
Any opinions? v7 makes life easy for doMiniBatchMutation, refcounts-v4 provides for a more general API in the future that we may or may not use.&lt;/p&gt;</comment>
                            <comment id="13709428" author="davelatham" created="Tue, 16 Jul 2013 03:44:12 +0000"  >&lt;p&gt;Now that it&apos;s done, I&apos;d prefer refCounts.  I think it&apos;s less likely for someone to get it wrong in the future, because there&apos;s no worry about nested methods releasing a lock you acquired.&lt;/p&gt;</comment>
                            <comment id="13709441" author="lhofhansl" created="Tue, 16 Jul 2013 03:54:30 +0000"  >&lt;p&gt;Let&apos;s do that. +1 from me.&lt;/p&gt;</comment>
                            <comment id="13709475" author="hadoopqa" created="Tue, 16 Jul 2013 05:12:19 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592477/HBASE-8877-refCounts-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592477/HBASE-8877-refCounts-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6355//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13709778" author="davelatham" created="Tue, 16 Jul 2013 13:45:38 +0000"  >&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts-v5.patch&lt;br/&gt;
This one&apos;s for all the marbles.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Reformatted the too-long line (thanks Hadoop QA)&lt;/li&gt;
	&lt;li&gt;improved a log message and an exception message&lt;/li&gt;
	&lt;li&gt;reduced scope of RowLockContext methods from public to package&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here are the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts-v4.patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt;-refCounts-v5.patch&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;476,477c476,477
&amp;lt; +  public RowLock getRowLock(final byte[] row, boolean waitForLock)
&amp;lt;    throws IOException {
---
&amp;gt; -  throws IOException {
&amp;gt; +  public RowLock getRowLock(byte[] row, boolean waitForLock) throws IOException {
499c499
&amp;lt; +          // Row is already locked by some other thread
---
&amp;gt; +          // Row is already locked by some other thread, give up or wait for it
505a506,507
&amp;gt; -              throw new IOException(&quot;Timed out on getting lock for row=&quot;
&amp;gt; -                  + Bytes.toStringBinary(row));
&amp;gt; +              throw new IOException(&quot;Timed out waiting for lock for row: &quot; + rowKey);
510c511,516
&amp;gt; -            LOG.warn(&quot;internalObtainRowLock interrupted for row=&quot; + Bytes.toStringBinary(row));
&amp;gt; +            LOG.warn(&quot;Thread interrupted waiting for lock on row: &quot; + rowKey);
1144c1150
&amp;lt; +    public RowLockContext(HashedBytes row) {
---
&amp;gt; +    RowLockContext(HashedBytes row) {
1149c1155
&amp;lt; +    public boolean ownedByCurrentThread() {
---
&amp;gt; +    boolean ownedByCurrentThread() {
1153c1159
&amp;lt; +    public RowLock newLock() {
---
&amp;gt; +    RowLock newLock() {
1168c1174,1175
&amp;lt; +          throw new RuntimeException(&quot;Internal row lock state inconsistent, should not happen, row: &quot; + row);
---
&amp;gt; +          throw new RuntimeException(
&amp;gt; +              &quot;Internal row lock state inconsistent, should not happen, row: &quot; + row);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13709830" author="hadoopqa" created="Tue, 16 Jul 2013 15:01:25 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592549/HBASE-8877-refCounts-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592549/HBASE-8877-refCounts-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6357//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13710307" author="davelatham" created="Tue, 16 Jul 2013 21:40:41 +0000"  >&lt;p&gt;Looks good to commit to me.  Hadoop QA says that org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat failed, but that area of the code is untouched by this change, the test passed in the previous very similar patch, and the test passes for me locally.&lt;/p&gt;

&lt;p&gt;If no one objects, perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; could do the honors and commit to trunk and 0.95 later today or tomorrow?  (Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8806&quot; title=&quot;Row locks are acquired repeatedly in HRegion.doMiniBatchMutation for duplicate rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8806&quot;&gt;&lt;del&gt;HBASE-8806&lt;/del&gt;&lt;/a&gt; will take care of 0.94 which sounds good to me.)&lt;/p&gt;</comment>
                            <comment id="13710319" author="lhofhansl" created="Tue, 16 Jul 2013 21:46:14 +0000"  >&lt;p&gt;Will commit in a bit, unless I hear objections or somebody beats me to it.&lt;/p&gt;</comment>
                            <comment id="13710693" author="lhofhansl" created="Wed, 17 Jul 2013 04:55:36 +0000"  >&lt;p&gt;Actually. Can I get another +1 for refCounts-v5?&lt;/p&gt;</comment>
                            <comment id="13710704" author="yuzhihong@gmail.com" created="Wed, 17 Jul 2013 05:07:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13710736" author="lhofhansl" created="Wed, 17 Jul 2013 05:34:27 +0000"  >&lt;p&gt;Committed to 0.95 and trunk. Thanks for the patch Dave!&lt;/p&gt;</comment>
                            <comment id="13710881" author="hudson" created="Wed, 17 Jul 2013 08:53:21 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.95 #331 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/331/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/331/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt; Reentrant row locks (Dave Latham) (larsh: rev 1504000)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-examples/src/main/java/org/apache/hadoop/hbase/coprocessor/example/BulkDeleteEndpoint.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestAtomicOperation.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestParallelPut.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13710887" author="hudson" created="Wed, 17 Jul 2013 09:01:38 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #4260 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4260/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4260/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt; Reentrant row locks (Dave Latham) (larsh: rev 1504002)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-examples/src/main/java/org/apache/hadoop/hbase/coprocessor/example/BulkDeleteEndpoint.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestAtomicOperation.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestParallelPut.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13711027" author="hudson" created="Wed, 17 Jul 2013 12:36:02 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.95-on-hadoop2 #182 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/182/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/182/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt; Reentrant row locks (Dave Latham) (larsh: rev 1504000)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-examples/src/main/java/org/apache/hadoop/hbase/coprocessor/example/BulkDeleteEndpoint.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestAtomicOperation.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestParallelPut.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13711047" author="hudson" created="Wed, 17 Jul 2013 13:01:17 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #620 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/620/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/620/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8877&quot; title=&quot;Reentrant row locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8877&quot;&gt;&lt;del&gt;HBASE-8877&lt;/del&gt;&lt;/a&gt; Reentrant row locks (Dave Latham) (larsh: rev 1504002)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-examples/src/main/java/org/apache/hadoop/hbase/coprocessor/example/BulkDeleteEndpoint.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestAtomicOperation.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestParallelPut.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13711260" author="davelatham" created="Wed, 17 Jul 2013 16:47:16 +0000"  >&lt;p&gt;Thanks everyone for your attention, help, and patience, and especially Lars for getting it committed.  I added a Release Note to note the incompatible change to the RegionObserver.  I&apos;m also curious about the integration failure messages from Jenkins.  Particularly the first two where the console doesn&apos;t show any test failures.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12654793">HBASE-8806</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12592195" name="HBASE-8877-0.94-v2.patch" size="8201" author="davelatham" created="Sun, 14 Jul 2013 14:10:56 +0000"/>
                            <attachment id="12592106" name="HBASE-8877-0.94.patch" size="8128" author="davelatham" created="Fri, 12 Jul 2013 23:39:31 +0000"/>
                            <attachment id="12592442" name="HBASE-8877-refCounts-v2.patch" size="72513" author="davelatham" created="Mon, 15 Jul 2013 23:28:00 +0000"/>
                            <attachment id="12592445" name="HBASE-8877-refCounts-v3.patch" size="72497" author="davelatham" created="Mon, 15 Jul 2013 23:37:44 +0000"/>
                            <attachment id="12592477" name="HBASE-8877-refCounts-v4.patch" size="70734" author="davelatham" created="Tue, 16 Jul 2013 03:15:28 +0000"/>
                            <attachment id="12592549" name="HBASE-8877-refCounts-v5.patch" size="71126" author="davelatham" created="Tue, 16 Jul 2013 13:45:38 +0000"/>
                            <attachment id="12592439" name="HBASE-8877-refCounts.patch" size="72515" author="davelatham" created="Mon, 15 Jul 2013 23:18:00 +0000"/>
                            <attachment id="12591094" name="HBASE-8877-v2.patch" size="45812" author="davelatham" created="Sat, 6 Jul 2013 21:56:49 +0000"/>
                            <attachment id="12591212" name="HBASE-8877-v3.patch" size="45669" author="davelatham" created="Mon, 8 Jul 2013 13:28:30 +0000"/>
                            <attachment id="12592150" name="HBASE-8877-v4.patch" size="45832" author="davelatham" created="Sat, 13 Jul 2013 14:33:55 +0000"/>
                            <attachment id="12592151" name="HBASE-8877-v5.patch" size="45576" author="davelatham" created="Sat, 13 Jul 2013 15:37:26 +0000"/>
                            <attachment id="12592154" name="HBASE-8877-v6.patch" size="46721" author="davelatham" created="Sat, 13 Jul 2013 17:04:10 +0000"/>
                            <attachment id="12592355" name="HBASE-8877-v7.patch" size="50001" author="davelatham" created="Mon, 15 Jul 2013 17:07:51 +0000"/>
                            <attachment id="12591013" name="HBASE-8877.patch" size="45796" author="davelatham" created="Fri, 5 Jul 2013 15:36:14 +0000"/>
                            <attachment id="12592107" name="hbase-8877-0.94-microbenchmark.txt" size="3124" author="davelatham" created="Fri, 12 Jul 2013 23:39:31 +0000"/>
                            <attachment id="12592437" name="hbase-8877-refCounts-microbenchmarks.txt" size="6505" author="davelatham" created="Mon, 15 Jul 2013 23:10:03 +0000"/>
                            <attachment id="12592108" name="hbase-8877-v4-microbenchmark.txt" size="4342" author="davelatham" created="Fri, 12 Jul 2013 23:39:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Jul 2013 16:19:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m287:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336932</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Changed the coprocessor RegionObserver methods preBatchMutate and postBatchMutate to remove the lock ids from the methods as lock ids are not longer used.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.96notable</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>