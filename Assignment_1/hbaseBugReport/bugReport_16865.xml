<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:18:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16865/HBASE-16865.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16865] Procedure v2 - Inherit lock from root proc</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16865</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;At the moment we support inheriting locks from the parent procedure for a 2 level procedures, but in case of reopen table regions we have a 3 level procedures (ModifyTable -&amp;gt; ReOpen -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Unassign/Assign&amp;#93;&lt;/span&gt;)  and reopen does not have any locks on its own.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13013007">HBASE-16865</key>
            <summary>Procedure v2 - Inherit lock from root proc</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12860901">HBASE-14350</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="mbertozzi">Matteo Bertozzi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Oct 2016 22:14:01 +0000</created>
                <updated>Fri, 4 Nov 2016 23:31:50 +0000</updated>
                            <resolved>Fri, 4 Nov 2016 20:54:53 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>proc-v2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15627001" author="syuanjiang" created="Tue, 1 Nov 2016 23:15:47 +0000"  >&lt;p&gt;The following is hard-coded to check parent and root - either we should recursively check parents if we support more than 3-levels in the future or we can assume that the root always passing down, then we should just check root - &lt;tt&gt;proc.hasParent() &amp;amp;&amp;amp; isLockOwner(proc.getRootProcId())&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasParentLock(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Procedure proc) {
-	      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; proc.hasParent() &amp;amp;&amp;amp; isLockOwner(proc.getParentProcId());		
+	      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; proc.hasParent() &amp;amp;&amp;amp;
+	        (isLockOwner(proc.getParentProcId()) || isLockOwner(proc.getRootProcId()));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15627320" author="mbertozzi" created="Wed, 2 Nov 2016 01:37:14 +0000"  >&lt;p&gt;we don&apos;t have the ability to go back recursively to the root at the moment. and we only have two use cases for now child that want to lock what the parent have and the child far down the line that wants to lock what the root has. I don&apos;t want to make this too generic for now and end up with strange deep procs at the moment. I prefer having people complaining about the inability to do something and figure out if there is a better way to do it, instead of allowing strange behaviors.&lt;/p&gt;</comment>
                            <comment id="15627385" author="syuanjiang" created="Wed, 2 Nov 2016 02:14:12 +0000"  >&lt;p&gt;Since we always passes down lock from root, that is why I also suggestion to just check root - &lt;tt&gt;return proc.hasParent() &amp;amp;&amp;amp; isLockOwner(proc.getRootProcId());&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15627405" author="mbertozzi" created="Wed, 2 Nov 2016 02:21:09 +0000"  >&lt;p&gt;root may just be a &quot;launcher&quot; like Move/Balance don&apos;t take a lock they just start N children&lt;/p&gt;</comment>
                            <comment id="15627414" author="syuanjiang" created="Wed, 2 Nov 2016 02:24:06 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15638043" author="hudson" created="Fri, 4 Nov 2016 23:31:50 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build HBase-Trunk_matrix #1916 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/1916/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/1916/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16865&quot; title=&quot;Procedure v2 - Inherit lock from root proc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16865&quot;&gt;&lt;del&gt;HBASE-16865&lt;/del&gt;&lt;/a&gt; Procedure v2 - Inherit lock from root proc (matteo.bertozzi: rev efe0a0eeadac14c2804a3d1590761502e5f247ee)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hbase-server/src/test/java/org/apache/hadoop/hbase/master/procedure/TestMasterProcedureScheduler.java&lt;/li&gt;
	&lt;li&gt;(edit) hbase-procedure/src/test/java/org/apache/hadoop/hbase/procedure2/ProcedureTestingUtility.java&lt;/li&gt;
	&lt;li&gt;(edit) hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/MasterProcedureScheduler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12833822" name="HBASE-16865-v0.patch" size="10009" author="mbertozzi" created="Mon, 17 Oct 2016 22:14:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Nov 2016 23:15:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3508n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>