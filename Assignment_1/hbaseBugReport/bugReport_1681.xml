<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:55:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1681/HBASE-1681.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1681] NSRE due to duplicate assignment to the same region server</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1681</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Reproduce: &lt;br/&gt;
1. populate hbase with 100 m records: bin/hadop jar hbase-dev-test.jar --rows=1000000 sequtialWrite 100&lt;br/&gt;
2. populate hbase with 10 m records (random writes): bin/hadoop jar hbase-dev-test.jar --rows=1000000 randomWrite 10&lt;br/&gt;
3. scan 10 m records: bin/hadoop jar hbase-dev-test.jar --rows=1000000 scan 10&lt;br/&gt;
2 scan mapper task failed with NSRE exception for one region:&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: TestTable,0001724032,1248204794507&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2251)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegionServer.openScanner(HRegionServer.java:1862)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:650)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:913)&lt;/p&gt;

&lt;p&gt;Grep master log for TestTable,0001724032,1248204794507:&lt;/p&gt;

&lt;p&gt;2009-07-21 12:33:18,275 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_SPLIT: TestTable,0001724032,1248141721258: Daughters; TestTable,0&lt;br/&gt;
001724032,1248204794507, TestTable,0001780000,1248204794507 from snv-it-lin-010.&lt;br/&gt;
projectrialto.com,60020,1248115451722; 1 of 3&lt;br/&gt;
2009-07-21 12:33:19,169 INFO org.apache.hadoop.hbase.master.RegionManager: Assig&lt;br/&gt;
ning region TestTable,0001724032,1248204794507 to snv-it-lin-011.projectrialto.c&lt;br/&gt;
om,60020,1248115452051&lt;br/&gt;
2009-07-21 12:33:21,464 DEBUG org.apache.hadoop.hbase.master.BaseScanner: Curren&lt;br/&gt;
t assignment of TestTable,0001724032,1248204794507 is not valid;  Server &apos;&apos; star&lt;br/&gt;
tCode: 0 unknown.&lt;br/&gt;
2009-07-21 12:33:22,207 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_PROCESS_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-&lt;br/&gt;
011.projectrialto.com,60020,1248115452051; 1 of 1&lt;br/&gt;
2009-07-21 12:33:22,208 INFO org.apache.hadoop.hbase.master.RegionManager: Assig&lt;br/&gt;
ning region TestTable,0001724032,1248204794507 to snv-it-lin-011.projectrialto.c&lt;br/&gt;
om,60020,1248115452051&lt;br/&gt;
2009-07-21 12:33:25,245 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_PROCESS_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-&lt;br/&gt;
011.projectrialto.com,60020,1248115452051; 1 of 3&lt;br/&gt;
2009-07-21 12:33:25,245 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_PROCESS_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-&lt;br/&gt;
011.projectrialto.com,60020,1248115452051; 3 of 3&lt;br/&gt;
2009-07-21 12:33:28,283 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_PROCESS_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-&lt;br/&gt;
011.projectrialto.com,60020,1248115452051; 1 of 7&lt;br/&gt;
2009-07-21 12:33:28,283 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_PROCESS_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-&lt;br/&gt;
011.projectrialto.com,60020,1248115452051; 3 of 7&lt;br/&gt;
2009-07-21 12:33:28,283 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-011.proj&lt;br/&gt;
ectrialto.com,60020,1248115452051; 5 of 7&lt;br/&gt;
2009-07-21 12:33:28,284 INFO org.apache.hadoop.hbase.master.ServerManager: Received MSG_REPORT_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-011.proj&lt;br/&gt;
ectrialto.com,60020,1248115452051; 5 of 7&lt;br/&gt;
2009-07-21 12:33:28,284 INFO org.apache.hadoop.hbase.master.ServerManager: Recei&lt;br/&gt;
ved MSG_REPORT_OPEN: TestTable,0001724032,1248204794507 from snv-it-lin-011.proj&lt;br/&gt;
ectrialto.com,60020,1248115452051; 7 of 7&lt;br/&gt;
2009-07-21 12:33:28,284 DEBUG org.apache.hadoop.hbase.master.ServerManager: regi&lt;br/&gt;
on server 10.10.30.105:60020 should not have opened region TestTable,0001724032,&lt;br/&gt;
1248204794507&lt;br/&gt;
2009-07-21 12:33:28,289 INFO org.apache.hadoop.hbase.master.RegionServerOperatio&lt;br/&gt;
n: TestTable,0001724032,1248204794507 open on 10.10.30.105:60020&lt;br/&gt;
2009-07-21 12:33:28,289 INFO org.apache.hadoop.hbase.master.RegionServerOperatio&lt;br/&gt;
n: updating row TestTable,0001724032,1248204794507 in region .META.,,1 with star&lt;br/&gt;
tcode 1248115452051 and server 10.10.30.105:60020&lt;/p&gt;


&lt;p&gt;Grep region server log for TestTable,0001724032,1248204794507: &lt;/p&gt;

&lt;p&gt;2009-07-21 12:33:19,163 INFO org.apache.hadoop.hbase.regionserver.HRegionServer:&lt;br/&gt;
 MSG_REGION_OPEN: TestTable,0001724032,1248204794507&lt;br/&gt;
2009-07-21 12:33:22,202 INFO org.apache.hadoop.hbase.regionserver.HRegionServer:&lt;br/&gt;
 MSG_REGION_OPEN: TestTable,0001724032,1248204794507&lt;br/&gt;
2009-07-21 12:33:26,183 INFO org.apache.hadoop.hbase.regionserver.HRegionServer:&lt;br/&gt;
 Worker: MSG_REGION_OPEN: TestTable,0001724032,1248204794507&lt;br/&gt;
2009-07-21 12:33:26,184 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Open&lt;br/&gt;
ing region TestTable,0001724032,1248204794507, encoded=3313355&lt;br/&gt;
2009-07-21 12:33:26,204 INFO org.apache.hadoop.hbase.regionserver.HRegion: regio&lt;br/&gt;
n TestTable,0001724032,1248204794507/3313355 available; sequence id is 45707088&lt;br/&gt;
2009-07-21 12:33:26,204 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitT&lt;br/&gt;
hread: Compaction requested for region TestTable,0001724032,1248204794507/331335&lt;br/&gt;
5 because: Region has references on open&lt;br/&gt;
2009-07-21 12:33:26,204 INFO org.apache.hadoop.hbase.regionserver.HRegionServer:&lt;br/&gt;
 Worker: MSG_REGION_OPEN: TestTable,0001724032,1248204794507&lt;br/&gt;
2009-07-21 12:33:28,278 INFO org.apache.hadoop.hbase.regionserver.HRegionServer:&lt;br/&gt;
 MSG_REGION_CLOSE_WITHOUT_REPORT: TestTable,0001724032,1248204794507: Duplicate&lt;br/&gt;
assignment&lt;br/&gt;
2009-07-21 12:33:28,279 INFO org.apache.hadoop.hbase.regionserver.HRegionServer:&lt;br/&gt;
 Worker: MSG_REGION_CLOSE_WITHOUT_REPORT: TestTable,0001724032,1248204794507: Du&lt;br/&gt;
plicate assignment&lt;br/&gt;
2009-07-21 12:33:28,279 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Clos&lt;br/&gt;
ing TestTable,0001724032,1248204794507: compactions &amp;amp; flushes disabled&lt;br/&gt;
2009-07-21 12:33:28,279 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Upda&lt;br/&gt;
tes disabled for region, no outstanding scanners on TestTable,0001724032,1248204&lt;br/&gt;
794507&lt;br/&gt;
2009-07-21 12:33:28,279 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: No m&lt;br/&gt;
ore row locks outstanding on region TestTable,0001724032,1248204794507&lt;br/&gt;
2009-07-21 12:33:28,279 INFO org.apache.hadoop.hbase.regionserver.HRegion: Close&lt;br/&gt;
d TestTable,0001724032,1248204794507&lt;br/&gt;
2009-07-21 12:34:45,728 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Skip&lt;br/&gt;
ping compaction on TestTable,0001724032,1248204794507 because closing/closed&lt;br/&gt;
org.apache.hadoop.hbase.NotServingRegionException: TestTable,0001724032,12482047&lt;br/&gt;
94507&lt;br/&gt;
2009-07-21 13:24:35,902 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handl&lt;br/&gt;
er 27 on 60020, call openScanner([B@1756ef1, startRow=0001700000, stopRow=, maxV&lt;br/&gt;
ersions=1, timeRange=[0,9223372036854775807), families={(family=info, columns={d&lt;br/&gt;
ata}}) from 10.10.30.105:50797: error: org.apache.hadoop.hbase.NotServingRegionE&lt;br/&gt;
xception: TestTable,0001724032,1248204794507&lt;br/&gt;
org.apache.hadoop.hbase.NotServingRegionException: TestTable,0001724032,12482047&lt;br/&gt;
94507&lt;br/&gt;
org.apache.hadoop.hbase.NotServingRegionException: TestTable,0001724032,12482047&lt;br/&gt;
94507&lt;br/&gt;
2009-07-21 13:24:37,908 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handl&lt;br/&gt;
er 19 on 60020, call openScanner([B@25b414, startRow=0001700000, stopRow=, maxVe&lt;br/&gt;
rsions=1, timeRange=[0,9223372036854775807), families={(family=info, columns={da&lt;br/&gt;
ta}}) from 10.10.30.105:50797: error: org.apache.hadoop.hbase.NotServingRegionEx&lt;br/&gt;
ception: TestTable,0001724032,1248204794507&lt;br/&gt;
org.apache.hadoop.hbase.NotServingRegionException: TestTable,0001724032,12482047&lt;br/&gt;
94507&lt;br/&gt;
org.apache.hadoop.hbase.NotServingRegionException: TestTable,0001724032,12482047&lt;br/&gt;
94507&lt;/p&gt;</description>
                <environment>&lt;p&gt;Software&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase trunk (0.20.0-dev, r795916)&lt;/li&gt;
	&lt;li&gt;hadoop-0.20.0&lt;/li&gt;
	&lt;li&gt;zookeeper-3.2.0&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Hardware&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;3 dev servers: 8 core, 16G ram, 4x750G 7200 rpm SATA disk, RAID 0, each disk individually mounted&lt;/li&gt;
	&lt;li&gt;snv-it-lin-010:&lt;br/&gt;
          o hadoop namenode (1G)&lt;br/&gt;
          o hadoop secondary namenode (1G)&lt;br/&gt;
          o hadoop datanode (1G, max_xreciver=4096, handler=50)&lt;br/&gt;
          o hadoop job track (1G)&lt;br/&gt;
          o hadoop taks tracker (1G, max_map=1, max_red=1)&lt;br/&gt;
          o zookeeper (1G)&lt;br/&gt;
          o hbase master (2G)&lt;br/&gt;
          o hbase region server (2G) &lt;/li&gt;
	&lt;li&gt;snv-it-lin-011:&lt;br/&gt;
          o hadoop datanode (1G, max_xreciver=4096, handler=50)&lt;br/&gt;
          o hadoop taks tracker (1G, max_map=1, max_red=1)&lt;br/&gt;
          o zookeeper (1G)&lt;br/&gt;
          o hbase region server (2G, handler=50) &lt;/li&gt;
	&lt;li&gt;snv-it-lin-012:&lt;br/&gt;
          o hadoop datanode (1G, max_xreciver=4096, handler=50)&lt;br/&gt;
          o hadoop taks tracker (1G, max_map=1, max_red=1)&lt;br/&gt;
          o zookeeper (1G)&lt;br/&gt;
          o hbase region server (2G, handler=50) &lt;/li&gt;
	&lt;li&gt;jvm: 32bit&lt;/li&gt;
&lt;/ul&gt;



</environment>
        <key id="12431081">HBASE-1681</key>
            <summary>NSRE due to duplicate assignment to the same region server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="haijuncao">Haijun Cao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jul 2009 22:31:04 +0000</created>
                <updated>Tue, 7 Dec 2010 21:07:22 +0000</updated>
                            <resolved>Tue, 7 Dec 2010 21:07:22 +0000</resolved>
                                    <version>0.20.0</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12733870" author="haijuncao" created="Tue, 21 Jul 2009 22:37:34 +0000"  >&lt;p&gt;In summary, this is the event sequence that lead to NSRE for region TestTable,0001724032,1248204794507:&lt;/p&gt;

&lt;p&gt;1 master assign  to snv-it-lin-011&lt;br/&gt;
2 master complain that the assignment is invalid&lt;br/&gt;
3 master assign to snv-it-lin-011 (again?)&lt;br/&gt;
4 region is opened in snv-it-lin-011&lt;br/&gt;
5 region is opened in snv-it-lin-011 again, region server decide to close the region (without report to master) due to duplicate assignment.&lt;/p&gt;


&lt;p&gt;The workaround is to delete &apos;.META.&apos;,&apos;TestTable,0001724032,1248204794507&apos;,&apos;info:server&apos;&lt;br/&gt;
to force master to assign the region again.&lt;/p&gt;</comment>
                            <comment id="12746184" author="stack" created="Fri, 21 Aug 2009 19:48:00 +0000"  >&lt;p&gt;hbase-1738 should  help here.&lt;/p&gt;</comment>
                            <comment id="12968985" author="stack" created="Tue, 7 Dec 2010 21:07:22 +0000"  >&lt;p&gt;Closing as no longer valid given master has been redone to make duplicate assignment (near) impossible &amp;#8211; least if a duplicate assign, it should be fixable bug now rather than an unpluggable race.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Aug 2009 19:48:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25913</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0henz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99638</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>