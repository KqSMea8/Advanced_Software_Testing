<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:46:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-626/HBASE-626.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-626] Use Visitor pattern in MetaRegion to reduce code clones in HTable and HConnectionManager</title>
                <link>https://issues.apache.org/jira/browse/HBASE-626</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HTable and HConnectionManager.TableServers both scan the meta region in the same way (but the later also retry one time if it fails). A Visitor pattern should be used in a new scanning method in MetaRegion to accept visitors that gather information such as region names for a table or the list of all tables.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12395970">HBASE-626</key>
            <summary>Use Visitor pattern in MetaRegion to reduce code clones in HTable and HConnectionManager</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 May 2008 20:03:59 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:15 +0000</updated>
                            <resolved>Tue, 20 May 2008 16:55:25 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12596524" author="jdcryans" created="Tue, 13 May 2008 20:28:10 +0000"  >&lt;p&gt;Should be in a MetaTable class, not in MetaRegion, since we scan the whole table.&lt;/p&gt;</comment>
                            <comment id="12596530" author="stack" created="Tue, 13 May 2008 20:53:31 +0000"  >&lt;p&gt;MetaUtils also does catalog table scanning.  Here is a comment from head of the scanMetaRegion method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   * TODO: Use Visitor rather than Listener pattern.  Allow multiple Visitors.
   * Use &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; everywhere we scan meta regions: e.g. in metascanners, in close
   * handling, etc.  Have it pass in the whole row, not just HRegionInfo.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;scanMetaRegion takes a Listener.  Should be a Visitor as you suggested above.&lt;/p&gt;</comment>
                            <comment id="12596838" author="jdcryans" created="Wed, 14 May 2008 17:26:21 +0000"  >&lt;p&gt;Well in fact I checked this and this is already uses a form of visitor. The listener (usually called observer) reacts to events, which is not the case in this piece of code. But this is the good place I think to do the modification. What I plan is :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Refactor the scanMetaRegion method so it uses RowResult.&lt;/li&gt;
	&lt;li&gt;Modify the listener (renamed visitor) so it accepts a RowResult and a HRegionInfo.&lt;/li&gt;
	&lt;li&gt;Add a method to scan all the meta regions which will take a visitor in argument and optionally a row start key.&lt;/li&gt;
	&lt;li&gt;Modify all impacted code.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Question : In the TODO it says that it has to &quot;Allow multiple Visitors&quot;. Since the ScannerListener already has to be implemented, I don&apos;t see the purpose of that comment. Am I missing something bigger?&lt;/p&gt;</comment>
                            <comment id="12596843" author="stack" created="Wed, 14 May 2008 17:37:10 +0000"  >&lt;p&gt;Looks good JDC.  Regards the TODO, just ignore.  No use case that I can think of for a scan taking multiple Visitors.&lt;/p&gt;</comment>
                            <comment id="12597186" author="jdcryans" created="Thu, 15 May 2008 16:43:30 +0000"  >&lt;p&gt;Please review.&lt;/p&gt;

&lt;p&gt;Things to look at :&lt;/p&gt;

&lt;p&gt;processRow returns a boolean. I did this to &quot;emulate&quot; the break behavior so it speeds up processing.&lt;/p&gt;

&lt;p&gt;metaScan has parametric polymorphism so devs can specify row keys.&lt;/p&gt;</comment>
                            <comment id="12597252" author="stack" created="Thu, 15 May 2008 20:38:36 +0000"  >&lt;p&gt;On src/java/org/apache/hadoop/hbase/client/MetaScanner.java&lt;/p&gt;

&lt;p&gt;+ The class comment could be clearer.  Be explicit it scans the .META. table only (in hbase-speak, up to this, both &lt;del&gt;ROOT&lt;/del&gt; and .META., are &apos;meta&apos; tables).&lt;br/&gt;
+ FYI, in hadoop, lines are &amp;lt;= 80 characters&lt;br/&gt;
+ Why pass in scannerRow and startRow?  When would they ever differ?  Should the opening of the scanner be done with startRow rather than scannerRow since startRow is being updated as we move over regions?&lt;/p&gt;

&lt;p&gt;On src/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/p&gt;

&lt;p&gt;+ No biggie, but do you think the MetaScanner should return something richer than RowResult? Nearly every Visitor will be doing what your Visitor in this class is doing constructing an HRegionInfo, checking its null.  Should the MetaScanner parse and check for null HRegionInfos returning this plus server and startcodes?&lt;/p&gt;

&lt;p&gt;This is patch for all the duplicated code it removes.&lt;/p&gt;



</comment>
                            <comment id="12597255" author="jdcryans" created="Thu, 15 May 2008 20:50:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is patch for all the duplicated code it removes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is there a word missing or you mean that this patch is as good as leaving the code duplicated?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why pass in scannerRow and startRow? When would they ever differ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See in HTable. Basically I keep the same behavior as the code before this patch.&lt;/p&gt;

&lt;p&gt;On HCM, I think you`re right.&lt;/p&gt;</comment>
                            <comment id="12597286" author="stack" created="Thu, 15 May 2008 21:49:07 +0000"  >&lt;p&gt;Sorry.  Missing words.  Should have said: &quot;This is a great patch...&quot;&lt;/p&gt;

&lt;p&gt;I took a look at HTable.  What if you took &apos;tableName&apos; instead of a startRow and a scannerRow?&lt;/p&gt;
</comment>
                            <comment id="12597333" author="jdcryans" created="Fri, 16 May 2008 01:59:04 +0000"  >&lt;p&gt;Good question. As I said, I first tried to just keep the same behavior so this patch only a way of expressing my solution to this code clone problem (should have said that before). If you guys like it, I&apos;ll do it cleaner. &lt;/p&gt;

&lt;p&gt;So the answer is... I don&apos;t know, but I&apos;ll see into it. I tried using the start row as the scannerRow in HTable and zero region showed up in the UI. I&apos;ll see the other way around and write a test case.&lt;/p&gt;</comment>
                            <comment id="12597522" author="jdcryans" created="Fri, 16 May 2008 16:11:15 +0000"  >&lt;p&gt;Well it seems to work.&lt;/p&gt;</comment>
                            <comment id="12597554" author="jdcryans" created="Fri, 16 May 2008 17:40:17 +0000"  >&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="12597615" author="stack" created="Fri, 16 May 2008 21:11:57 +0000"  >&lt;p&gt;The NINEs trick composing the startrow key to use finding meta region has been dropped.  Makes me nervous... might work in tests but not in the real world.&lt;/p&gt;</comment>
                            <comment id="12598309" author="jdcryans" created="Tue, 20 May 2008 14:33:44 +0000"  >&lt;p&gt;Please review.&lt;/p&gt;

&lt;p&gt;NINES restored. Cleaned up comments. Passes tests, all is well in UI.&lt;/p&gt;</comment>
                            <comment id="12598359" author="stack" created="Tue, 20 May 2008 16:55:25 +0000"  >&lt;p&gt;Committed.  Thanks for the patch Jean-Daniel (FYI, there is a Bytes.equals for comparing two byte arrays rather than convert to String to test for equals).  Good stuff.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12382125" name="hbase-626-v1.patch" size="13556" author="jdcryans" created="Thu, 15 May 2008 16:43:30 +0000"/>
                            <attachment id="12382191" name="hbase-626-v2.patch" size="14582" author="jdcryans" created="Fri, 16 May 2008 17:40:17 +0000"/>
                            <attachment id="12382383" name="hbase-626-v3.patch" size="18940" author="jdcryans" created="Tue, 20 May 2008 14:37:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 May 2008 20:53:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31787</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h8gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98633</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>