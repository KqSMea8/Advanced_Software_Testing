<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2742/HBASE-2742.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2742] Provide strong authentication with a secure RPC engine</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2742</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The HBase RPC code (org.apache.hadoop.hbase.ipc.*) was originally forked off of Hadoop RPC classes, with some performance tweaks added.  Those optimizations have come at a cost in keeping up with Hadoop RPC changes however, both bug fixes and improvements/new features.  &lt;/p&gt;

&lt;p&gt;In particular, this impacts how we implement security features in HBase (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1697&quot; title=&quot;Discretionary access control&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1697&quot;&gt;&lt;del&gt;HBASE-1697&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2016&quot; title=&quot;[DAC] Authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2016&quot;&gt;&lt;del&gt;HBASE-2016&lt;/del&gt;&lt;/a&gt;).  The secure Hadoop implementation (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-4487&quot; title=&quot;Security features for Hadoop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-4487&quot;&gt;&lt;del&gt;HADOOP-4487&lt;/del&gt;&lt;/a&gt;) relies heavily on RPC changes to support client authentication via kerberos and securing and mutual authentication of client/server connections via SASL.  Making use of the built-in Hadoop RPC classes will gain us these pieces for free in a secure HBase.&lt;/p&gt;

&lt;p&gt;So, I&apos;m proposing that we drop the HBase forked version of RPC and convert to direct use of Hadoop RPC, while working to contribute important fixes back upstream to Hadoop core.  Based on a review of the HBase RPC changes, the key divergences seem to be:&lt;/p&gt;

&lt;p&gt;HBaseClient:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added use of TCP keepalive (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1754&quot; title=&quot;use TCP keepalives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1754&quot;&gt;&lt;del&gt;HBASE-1754&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;made connection retries and sleep configurable (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1815&quot; title=&quot;HBaseClient can get stuck in an infinite loop while attempting to contact a failed regionserver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1815&quot;&gt;&lt;del&gt;HBASE-1815&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;prevent NPE if socket == null due to creation failure (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2443&quot; title=&quot;IPC client can throw NPE if socket creation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2443&quot;&gt;&lt;del&gt;HBASE-2443&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HBaseRPC:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mapping of method names &amp;lt;-&amp;gt; codes (removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2219&quot; title=&quot;stop using code mapping for method names in the RPC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2219&quot;&gt;&lt;del&gt;HBASE-2219&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HBaseServer:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use of TCP keep alives (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1754&quot; title=&quot;use TCP keepalives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1754&quot;&gt;&lt;del&gt;HBASE-1754&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;OOME in server does not trigger abort (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1198&quot; title=&quot;OOME in IPC server does not trigger abort behavior&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1198&quot;&gt;&lt;del&gt;HBASE-1198&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HbaseObjectWritable:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;allows List&amp;lt;&amp;gt; serialization&lt;/li&gt;
	&lt;li&gt;includes it&apos;s own class &amp;lt;-&amp;gt; code mapping (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-328&quot; title=&quot;[hbase] Performance improvements: Customized RPC serialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-328&quot;&gt;&lt;del&gt;HBASE-328&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Proposed process is:&lt;/p&gt;

&lt;p&gt;1. open issues with patches on Hadoop core for important fixes/adjustments from HBase RPC (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1198&quot; title=&quot;OOME in IPC server does not trigger abort behavior&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1198&quot;&gt;&lt;del&gt;HBASE-1198&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1815&quot; title=&quot;HBaseClient can get stuck in an infinite loop while attempting to contact a failed regionserver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1815&quot;&gt;&lt;del&gt;HBASE-1815&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1754&quot; title=&quot;use TCP keepalives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1754&quot;&gt;&lt;del&gt;HBASE-1754&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2443&quot; title=&quot;IPC client can throw NPE if socket creation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2443&quot;&gt;&lt;del&gt;HBASE-2443&lt;/del&gt;&lt;/a&gt;, plus a pluggable ObjectWritable implementation in RPC.Invocation to allow use of HbaseObjectWritable).&lt;/p&gt;

&lt;p&gt;2. ship a Hadoop version with RPC patches applied &amp;#8211; ideally we should avoid another copy-n-paste code fork, subject to ability to isolate changes from impacting Hadoop internal RPC wire formats&lt;/p&gt;

&lt;p&gt;3. if all Hadoop core patches are applied we can drop back to a plain vanilla Hadoop version&lt;/p&gt;


&lt;p&gt;I realize there are many different opinions on how to proceed with HBase RPC, so I&apos;m hoping this issue will kick off a discussion on what the best approach might be.  My own motivation is maximizing re-use of the authentication and connection security work that&apos;s already gone into Hadoop core.  I&apos;ll put together a set of patches around #1 and #2, but obviously we need some consensus around this to move forward.  If I&apos;m missing other differences between HBase and Hadoop RPC, please list as well.  Discuss!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467142">HBASE-2742</key>
            <summary>Provide strong authentication with a secure RPC engine</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ghelmling">Gary Helmling</assignee>
                                    <reporter username="ghelmling">Gary Helmling</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jun 2010 01:09:47 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:13 +0000</updated>
                            <resolved>Fri, 18 Nov 2011 07:38:54 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="12879607" author="ghelmling" created="Thu, 17 Jun 2010 01:11:19 +0000"  >&lt;p&gt;This is a key enabler for providing client authentication and secure connections to HBase&lt;/p&gt;</comment>
                            <comment id="12879611" author="tlipcon" created="Thu, 17 Jun 2010 01:16:57 +0000"  >&lt;p&gt;In sentiment I agree. In practicality, the idea that we could get the necessary changes into Hadoop in a reasonable timeline seems unlikely. Also, we&apos;d have to wait until Hadoop 0.22 to get these in, which won&apos;t be out til 2011, so in the meantime we&apos;d still be maintaining copy-paste. Lastly, Hadoop is hopefully moving to Avro down the line, and we should consider that too.&lt;/p&gt;

&lt;p&gt;I&apos;ve only looked a bit at the secure RPC code in hadoop trunk, but IIRC the RPC part of security is reasonably straightforward (most of the work was in adding delegation tokens, etc, which are hadoop-layer, not IPC layer). How hard would it be to put similar security into, say, Avro, which we should be thinking about anyway?&lt;/p&gt;</comment>
                            <comment id="12879654" author="stack" created="Thu, 17 Jun 2010 04:11:35 +0000"  >&lt;p&gt;Adding link to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2425&quot; title=&quot;Crossport HADOOP-1849 rpc fix&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2425&quot;&gt;&lt;del&gt;HBASE-2425&lt;/del&gt;&lt;/a&gt;.  If we do this issue, then it subsumes need to do hbase-2425.&lt;/p&gt;

&lt;p&gt;Gary, since you&apos;ve been looking, are any of hbase fixes already up in hadoop rpc?  Or, is it that the ones you call out are in hbase rpc but not in hadoop rpc?&lt;/p&gt;

&lt;p&gt;I agree w/ Todd on the not till 2011.... (none of the pieces we&apos;d need to override are overrideable IIRC &amp;#8211; hence the copy local)&lt;/p&gt;

&lt;p&gt;On AVRO, what you reckon Gary?  Seems like you have the lads (T+J) to get any needs committed on AVRO front.  How hard would it be to do?  It&apos;d be good for the hbase client to hbase servers.   What happens then moving the credentials over to hbase&amp;lt;-&amp;gt;DN+NN connections?&lt;/p&gt;

&lt;p&gt;For me, AVRO ain&apos;t even a contender  unless it has a real transport.  HTTP doesn&apos;t cut it if only because it hurts my teeth just thinking about fat http headers wrapping and perhaps even replicating info in avro headers (The latter is foggy rememberance from emails long ago &amp;#8211; world has probably changed since but HTTP for transport seems horribly profligate at least in hbase case).&lt;/p&gt;

&lt;p&gt;Any timelines for when the double-turbo-netty (or whatever its going to be done on) avro transport is going to make a showing Todd/Jeff?&lt;/p&gt;</comment>
                            <comment id="12879800" author="ghelmling" created="Thu, 17 Jun 2010 15:07:51 +0000"  >&lt;p&gt;On the issues listed:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2443&quot; title=&quot;IPC client can throw NPE if socket creation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2443&quot;&gt;&lt;del&gt;HBASE-2443&lt;/del&gt;&lt;/a&gt; looks to be already present in Hadoop trunk.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1198&quot; title=&quot;OOME in IPC server does not trigger abort behavior&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1198&quot;&gt;&lt;del&gt;HBASE-1198&lt;/del&gt;&lt;/a&gt; (OOME) is really about the RS not getting notified of an OOME happening in the RPC layer.  Seems like bad practice to me to swallow the exception and an important fix for us, but it may not be an issue or be handled differently by the Hadoop procs?  The other 2 are not applied, but maybe not high priority for Hadoop core:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1815&quot; title=&quot;HBaseClient can get stuck in an infinite loop while attempting to contact a failed regionserver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1815&quot;&gt;&lt;del&gt;HBASE-1815&lt;/del&gt;&lt;/a&gt;: configurable max retries and sleep for connection timeouts&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1754&quot; title=&quot;use TCP keepalives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1754&quot;&gt;&lt;del&gt;HBASE-1754&lt;/del&gt;&lt;/a&gt;: allow use of TCP keep alive&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@Todd&lt;br/&gt;
Understood about the long timeline to get any of these changes committed.  Based on that and discussion on IRC, maybe a reasonable alternative would be to just update our copy-paste fork with the security enabled code.  I can still file the issues against core, as they seem generally useful, and in the future, either core integrates them or we move to our own alternate RPC (avro), either way potentially allowing us to drop the fork later on.&lt;/p&gt;

&lt;p&gt;@Stack&lt;br/&gt;
I&apos;m generally pro alternate rpc for HBase internal purposes.  But I&apos;m hesitant to make the security implementation (already a big project) depend on replacing internal rpc with avro (another big project).  I just envision too many complications with one bleeding into the other.  I also think that piggy-backing off the client user authentication and SASL setup code already in the secure Hadoop RPC will get us a good way started on secure HBase.&lt;/p&gt;

&lt;p&gt;In any case, for a full security implementation, we will need hooks into the new Avro connector, Thrift, Stargate/REST, etc. in order to secure all endpoints.  But it seems wiser to leave those as separate tasks and off the critical path.  And work done there could then be used to enable an Avro-based internal RPC.&lt;/p&gt;

&lt;p&gt;For the HBase authentication implementation, the plan for the first stage is to have HBase authenticate clients and perform access control, but have HBase interact with HDFS as a single server principal &amp;#8211; so all of /hbase is owned by an &quot;hbase&quot; user, say.  There are some issues to work out there with bulk loading mechanisms, but it&apos;s much simpler than passing ownership/credentials all the way down to HDFS.  We&apos;ve discussed a future stage mapping users to file ownership for isolation all the way down, but it&apos;s not clear that we will wind up going there or that it even provides better security to do so.  So passing client credentials through to NN may not be necessary at all.&lt;/p&gt;

&lt;p&gt;Based on all of the above, I guess I&apos;m leaning towards updating our copy-paste fork as part of the security implementation, at least as a first step.  The original proposal to ship a patched Hadoop seems a non-starter if the changes won&apos;t be quickly integrated and we want to support multiple versions.&lt;/p&gt;</comment>
                            <comment id="12879831" author="tlipcon" created="Thu, 17 Jun 2010 16:24:08 +0000"  >&lt;p&gt;+1 for updating our copypaste with security.&lt;br/&gt;
Regarding the OOME swallowing, it&apos;s done so that sending a malformed packet to a server doesn&apos;t crash it. It&apos;s way too easy to craft a packet (on purpose or by accident) that has a 100GB &quot;length&quot; header in it, and cause OOME.&lt;/p&gt;</comment>
                            <comment id="12884822" author="ghelmling" created="Fri, 2 Jul 2010 22:09:26 +0000"  >&lt;p&gt;Update title to reflect discussed approach.&lt;/p&gt;</comment>
                            <comment id="13109101" author="ghelmling" created="Tue, 20 Sep 2011 23:51:28 +0000"  >&lt;p&gt;Token-based DIGEST-MD5 is just one of the authentication methods supported in secure RPC, so it&apos;s subsumed by this issue.&lt;/p&gt;</comment>
                            <comment id="13109104" author="ghelmling" created="Tue, 20 Sep 2011 23:53:26 +0000"  >&lt;p&gt;Changing title for clarity.&lt;/p&gt;</comment>
                            <comment id="13109289" author="jiraposter@reviews.apache.org" created="Wed, 21 Sep 2011 05:55:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/li&gt;
	&lt;li&gt;Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/li&gt;
	&lt;li&gt;Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/li&gt;
	&lt;li&gt;The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/li&gt;
	&lt;li&gt;implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/li&gt;
	&lt;li&gt;The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;existing RPC changes&lt;/li&gt;
	&lt;li&gt;The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/li&gt;
	&lt;li&gt;All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/li&gt;
	&lt;li&gt;Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase.(master|regionserver).keytab.file&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.principal&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.https.principal&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  conf/hbase-policy.xml PRE-CREATION &lt;br/&gt;
  pom.xml 241973c &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HServerAddress.java 94977e0 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 5afaedf &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4621109 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 36b0560 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java a069400 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 3679c02 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 06bf814 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/User.java d90f2c7 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 699a5f5 &lt;br/&gt;
  src/main/resources/hbase-default.xml 2c8f44b &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;

&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="13112157" author="jiraposter@reviews.apache.org" created="Wed, 21 Sep 2011 22:07:26 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review2013&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review2013&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This is what we are running in production, incorporating additional bug fixes currently in staging, and ported to trunk. Looks ok but I found a few details worth looking at.&lt;/p&gt;


&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4539&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4539&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Didn&apos;t we move the serialization of the call and params out of the synchronized block? Or, we should.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4540&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4540&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Let&apos;s fix the spelling error here finally&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4541&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4541&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Logs tend to fill up with this, make it DEBUG?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4542&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4542&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Likewise&lt;/p&gt;




&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4543&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4543&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Likewise, but maybe this should be TRACE&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4544&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should be &quot;hbase.rpc.protection&quot;&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4545&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4545&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Writes are synchronized but not this read&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4546&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4546&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Could conceivably get a CME here too right?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment4547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment4547&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Could use a comment here explaining why it is important.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-21 05:54:32, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-21 05:54:32)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 241973c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java 94977e0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 5afaedf &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4621109 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 36b0560 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java a069400 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 3679c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 06bf814 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java d90f2c7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 699a5f5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 2c8f44b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13113044" author="yuzhihong@gmail.com" created="Fri, 23 Sep 2011 00:03:33 +0000"  >&lt;p&gt;When I ran the test suite, I got:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
initializationError(org.apache.hadoop.hbase.security.token.TestTokenAuthentication)  Time elapsed: 0.005 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NoClassDefFoundError: org/apache/hadoop/security/token/SecretManager
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClass1(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClassCond(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:632)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:616)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:283)
        at java.net.URLClassLoader.access$000(URLClassLoader.java:58)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13132283" author="jiraposter@reviews.apache.org" created="Fri, 21 Oct 2011 02:32:15 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-21 00:14:15.788894)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated patch against current trunk.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Cleaned out some unnecessary code duplication in SecureClient vs. HBaseClient&lt;/li&gt;
	&lt;li&gt;Some javadoc cleanups and additions&lt;/li&gt;
	&lt;li&gt;Addressed Andy&apos;s review comments&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Running tests using SecureRpcEngine requires manually editing src/test/resources/hbase-site.xml and adding:&lt;/p&gt;

&lt;p&gt;&amp;lt;property&amp;gt;&lt;br/&gt;
 &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
 &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;Then run the tests with &quot;mvn test -P hadoop-0.20S&quot;&lt;/p&gt;

&lt;p&gt;I&apos;m hacking at the pom.xml to see if I can get it to override the hbase-site.xml that&apos;s used so this isn&apos;t necessary.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/li&gt;
	&lt;li&gt;Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/li&gt;
	&lt;li&gt;Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/li&gt;
	&lt;li&gt;The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/li&gt;
	&lt;li&gt;implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/li&gt;
	&lt;li&gt;The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;existing RPC changes&lt;/li&gt;
	&lt;li&gt;The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/li&gt;
	&lt;li&gt;All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/li&gt;
	&lt;li&gt;Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase.(master|regionserver).keytab.file&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.principal&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.https.principal&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  conf/hbase-policy.xml PRE-CREATION &lt;br/&gt;
  pom.xml bfe8103 &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HServerAddress.java 94977e0 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java f7fac44 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 1db05cb &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 50b49a6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;br/&gt;
  src/main/resources/hbase-default.xml a35e7c7 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;

&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="13136309" author="jiraposter@reviews.apache.org" created="Wed, 26 Oct 2011 20:21:32 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-26 20:23:19.711393)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This updated patch just changes the POM security profile from the previous version:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Renames the profile from &quot;hadoop-0.20S&quot; to &quot;security&quot;&lt;/li&gt;
	&lt;li&gt;Since the default hadoop profile now uses 0.20.205.0 as the build version, the hadoop version is no longer needed in the security profile.  The security profile can now be used in combination with any of the Hadoop profiles (though I&apos;ve only tested with 0.20.205.0, aka profile &quot;hadoop-0.20&quot;).&lt;/li&gt;
	&lt;li&gt;The security profile now overrides the hbase-site.xml used for testing with one that enables SecureRpcEngine.  This should make testing with the RPC changes easier, though the pom.xml changes to accommodate it are a little clunky.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To run tests using SecureRpcEngine, just do:&lt;/p&gt;

&lt;p&gt;  mvn clean test -P security&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/li&gt;
	&lt;li&gt;Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/li&gt;
	&lt;li&gt;Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/li&gt;
	&lt;li&gt;The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/li&gt;
	&lt;li&gt;implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/li&gt;
	&lt;li&gt;The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;existing RPC changes&lt;/li&gt;
	&lt;li&gt;The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/li&gt;
	&lt;li&gt;All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/li&gt;
	&lt;li&gt;Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase.(master|regionserver).keytab.file&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.principal&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.https.principal&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  conf/hbase-policy.xml PRE-CREATION &lt;br/&gt;
  pom.xml 9d42e2b &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/resources/hbase-site.xml PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;br/&gt;
  src/main/resources/hbase-default.xml 3785533 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;

&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="13144406" author="jiraposter@reviews.apache.org" created="Fri, 4 Nov 2011 22:19:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3056&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3056&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13144446" author="jiraposter@reviews.apache.org" created="Fri, 4 Nov 2011 23:17:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3058&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3058&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I made a start; more to follow later.&lt;/p&gt;


&lt;p&gt;conf/hbase-policy.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6821&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6821&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Apache license?&lt;/p&gt;



&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6819&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6819&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We need to change this when we ship 0.92?  Can you use variable here? $&lt;/p&gt;
{pom.version}
&lt;p&gt;?&lt;/p&gt;



&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6820&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6820&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is probably best place for this code for now.  Was thinking src/security but that gets weird when test code and main.  This is pseudo-maven-modules for now.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6822&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6822&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Minor nit:  My guess is that this is not your code.  Why not just a return CONDITIONS... no need of this if ... return true else return false&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13145254" author="jiraposter@reviews.apache.org" created="Mon, 7 Nov 2011 06:59:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3072&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3072&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1 on getting it in.&lt;/p&gt;


&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6843&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6843&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good.  We&apos;re pretty far from hadoop rpc now, huh..&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6844&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6844&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This happen on every rpc?  It won&apos;t show in hbase logs because our logger is up in hadoop ipc package.... that should be fine.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6845&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6845&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This if/else seems a little fuzzy.  Server-side, this is how it chooses an auth method?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6846&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6846&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should we set saslRpcClient to null after dispose?  Is it good to just swallow the exception?  Should log at least?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6847&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6847&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this be configurable?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6848&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6848&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Formatting.  This copied from hadoop?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6849&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What about the &apos;length&apos; thing that we added to hbase? I don&apos;t see you processing it here.  I suppose its ok because these are different client and servers and they just don&apos;t do it (and things like asynchbase are not going to do secure hase any time soon).&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6850&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6850&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    In secure hbase we don&apos;t do that delayed response stuff that was recently added to insecure rpc?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6851&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6851&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why we need this?  This in all our rpc&apos;ing?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6852&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6852&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Where does TRACELOG come from?  Why not LOG.trace?  Is it from parent?  Should logging be from this class?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6853&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6853&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    An insecure client cannot talk to a secure server (which makes &apos;sense&apos;)&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6854&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    If result is null, this will work?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6855&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6855&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This copy/pasted from hadoop?  Else its style violation (minor nit)&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6856&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6856&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This has been added already.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6857&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6857&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    These are copied from hadoop?  Don&apos;t look like Gary style.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6858&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should a &apos;secret manager&apos; have a public constructor?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6859&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6859&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ditoo&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment6860&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment6860&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this &apos;generic&apos; zk facility?  Put in zk package?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13149228" author="stack" created="Sun, 13 Nov 2011 06:05:58 +0000"  >&lt;p&gt;This is in way of a 0.92 release.&lt;/p&gt;</comment>
                            <comment id="13149242" author="jiraposter@reviews.apache.org" created="Sun, 13 Nov 2011 07:31:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-04 23:17:46, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 1335&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53576#file53576line1335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53576#file53576line1335&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is probably best place for this code for now.  Was thinking src/security but that gets weird when test code and main.  This is pseudo-maven-modules for now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, my thinking was once we get to full blown modules we won&apos;t have to move the source around, just add a security pom.xml.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-04 23:17:46, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; conf/hbase-policy.xml, line 1&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53575#file53575line1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53575#file53575line1&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Apache license?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-04 23:17:46, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 1320&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53576#file53576line1320&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53576#file53576line1320&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We need to change this when we ship 0.92?  Can you use variable here? ${pom.version}?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Removed this bit to use the project version.  I&apos;m trying out using finalName in the profile, which would allow us to wind up with the name &quot;hbase-0.92.0-security&quot;.  Dependent projects could then use artifactId=hbase, version=0.92.0, classifier=security.  Or we could use versions:set -DnewVersion=0.92.0-security during the build, but making it more automatic seems nicer.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-04 23:17:46, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 158&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line158&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line158&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Minor nit:  My guess is that this is not your code.  Why not just a return CONDITIONS... no need of this if ... return true else return false&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, was copied.  Changed to just do a return.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3058&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3058&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13149246" author="jiraposter@reviews.apache.org" created="Sun, 13 Nov 2011 08:09:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 128&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line128&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This if/else seems a little fuzzy.  Server-side, this is how it chooses an auth method?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, this matches up with server side.  If not using kerberos auth, then does SIMPLE auth, otherwise if a token is present does DIGEST, otherwise requires kerberos ticket.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 233&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line233&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line233&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Formatting.  This copied from hadoop?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, from Hadoop.  Cleaning up.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 195&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line195&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line195&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should this be configurable?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Some config here is probably good, for the case of those who are very sensitive to latency.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java, line 366&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line366&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why we need this?  This in all our rpc&apos;ing?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, WritableRpcEngine$Server.call() does the same.  Don&apos;t know why we&apos;d be implementing RPC protocols with non-public methods, but predates me...&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java, line 85&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line85&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line85&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     An insecure client cannot talk to a secure server (which makes &apos;sense&apos;)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, HEADER bytes are distinct and will prevent this as well.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java, line 597&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line597&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line597&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This copy/pasted from hadoop?  Else its style violation (minor nit)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, fixed anyway.  (HBaseServer$Connection.processData has the same problem).&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java, line 87&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53589#file53589line87&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53589#file53589line87&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should a &apos;secret manager&apos; have a public constructor?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s currently instantiated from SecureServer, so we need to access it somehow.  With secured ZK access, znode ACLs will prevent creating a secret manager instance to obtain the secret keys.  There is an opening here with coprocessors though, since they run in process on the RS.  We&apos;ll ultimately need to lock those down separately.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java, line 43&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53588#file53588line43&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53588#file53588line43&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     These are copied from hadoop?  Don&apos;t look like Gary style.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, largely copied and modified.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 147&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line147&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should we set saslRpcClient to null after dispose?  Is it good to just swallow the exception?  Should log at least?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good points, updating.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java, line 98&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53589#file53589line98&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53589#file53589line98&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     ditoo&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This also gets called from SecureServer, so it needs to be able to access.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java, line 47&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53593#file53593line47&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53593#file53593line47&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is this &apos;generic&apos; zk facility?  Put in zk package?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, will move to o.a.h.h.zookeeper.  I very briefly considered trying to combine with ActiveMasterManager when implementing this but that seemed too far out of scope.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java, line 1&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53581#file53581line1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53581#file53581line1&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This has been added already.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, will update the patch against that change and remove this.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java, line 172&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line172&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line172&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     In secure hbase we don&apos;t do that delayed response stuff that was recently added to insecure rpc?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Delayed stuff should work since it&apos;s using the rpc engine interfaces, but I&apos;ll check if there are upstream discrepancies since this patch.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 345&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line345&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line345&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     What about the &apos;length&apos; thing that we added to hbase? I don&apos;t see you processing it here.  I suppose its ok because these are different client and servers and they just don&apos;t do it (and things like asynchbase are not going to do secure hase any time soon).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, doesn&apos;t do &quot;length&quot; currently.  I could add it, but asynchbase would still have to deal with the sasl negotiation on connection setup.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java, line 381&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line381&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line381&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Where does TRACELOG come from?  Why not LOG.trace?  Is it from parent?  Should logging be from this class?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;TRACELOG comes from HBaseServer I think.  We added it with the simple rpc call introspection I did.  We wanted it to be a separate logger so it could be easily enabled to get those stats without bringing in all the rest of the debug logging.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java, line 123&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line123&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If result is null, this will work?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, this is just doing same as HBaseServer, isn&apos;t it?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3072&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3072&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13149343" author="jiraposter@reviews.apache.org" created="Sun, 13 Nov 2011 20:03:52 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 128&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line128&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This if/else seems a little fuzzy.  Server-side, this is how it chooses an auth method?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, this matches up with server side.  If not using kerberos auth, then does SIMPLE auth, otherwise if a token is present does DIGEST, otherwise requires kerberos ticket.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Grand&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 233&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line233&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line233&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Formatting.  This copied from hadoop?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, from Hadoop.  Cleaning up.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d say if copied from hadoop, don&apos;t clean it up.  Just leave it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 345&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line345&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53577#file53577line345&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     What about the &apos;length&apos; thing that we added to hbase? I don&apos;t see you processing it here.  I suppose its ok because these are different client and servers and they just don&apos;t do it (and things like asynchbase are not going to do secure hase any time soon).&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yeah, doesn&apos;t do &quot;length&quot; currently.  I could add it, but asynchbase would still have to deal with the sasl negotiation on connection setup.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;asynchbase is not going to be doing secure rpc anytime soon if ever so don&apos;t worry about it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java, line 366&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line366&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why we need this?  This in all our rpc&apos;ing?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, WritableRpcEngine$Server.call() does the same.  Don&apos;t know why we&apos;d be implementing RPC protocols with non-public methods, but predates me...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;grand&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java, line 381&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line381&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line381&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Where does TRACELOG come from?  Why not LOG.trace?  Is it from parent?  Should logging be from this class?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;TRACELOG comes from HBaseServer I think.  We added it with the simple rpc call introspection I did.  We wanted it to be a separate logger so it could be easily enabled to get those stats without bringing in all the rest of the debug logging.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java, line 123&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line123&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If result is null, this will work?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Hmm, this is just doing same as HBaseServer, isn&apos;t it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fair enough&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java, line 597&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line597&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53580#file53580line597&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This copy/pasted from hadoop?  Else its style violation (minor nit)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, fixed anyway.  (HBaseServer$Connection.processData has the same problem).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Don&apos;t bother fixing the hadoop copies (you&apos;ll be working on it till cows come home and then next update will mess it all up again &amp;#8211; not to mention the pain mapping hadoop to the cleaned up hbase version)&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java, line 43&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53588#file53588line43&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53588#file53588line43&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     These are copied from hadoop?  Don&apos;t look like Gary style.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, largely copied and modified.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;np&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-07 06:59:29, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java, line 87&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53589#file53589line87&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53589#file53589line87&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should a &apos;secret manager&apos; have a public constructor?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It&apos;s currently instantiated from SecureServer, so we need to access it somehow.  With secured ZK access, znode ACLs will prevent creating a secret manager instance to obtain the secret keys.  There is an opening here with coprocessors though, since they run in process on the RS.  We&apos;ll ultimately need to lock those down separately.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Make a comment for now?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3072&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3072&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13149389" author="jiraposter@reviews.apache.org" created="Sun, 13 Nov 2011 23:23:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3198&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3198&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7094&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7094&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t see this member used.&lt;br/&gt;
    Shall we remove this.authorize ?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7095&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7095&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think we should respond to the IOE beyond logging it.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7096&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7096&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    username should also be compared in equals().&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13149464" author="jiraposter@reviews.apache.org" created="Mon, 14 Nov 2011 06:37:52 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-13 23:22:58, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java, line 317&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line317&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53579#file53579line317&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t see this member used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Shall we remove this.authorize ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, removed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-13 23:22:58, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java, line 405&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53599#file53599line405&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53599#file53599line405&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     username should also be compared in equals().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, good catch.  Added.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-13 23:22:58, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java, line 141&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/4/?file=53594#file53594line141&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/4/?file=53594#file53594line141&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I think we should respond to the IOE beyond logging it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What would you suggest?  An IOE here means there was a failure in deserializing the key as a Writable, which is bad, but need not be fatal.  Some authentication attempts based on the corrupted key may fail, but authentication using other existing keys may still be succeeding.  The only other option I can think of is aborting, but that could mean all RS&apos;s in the cluster going down, which is pretty bad in itself.&lt;/p&gt;

&lt;p&gt;Any other options you can think of for how we handle this?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3198&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3198&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-26 20:23:19, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-26 20:23:19)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 9d42e2b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/Status.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 06a2312 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 1365411 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 18310d6 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 4a8918a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 000f99c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 965102c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 1f8b629 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 60a9248 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 3f8f929 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java bb67e53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 3785533 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java 7194c02 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java 3982eff &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13149750" author="yuzhihong@gmail.com" created="Mon, 14 Nov 2011 17:09:07 +0000"  >&lt;p&gt;For ZKSecretWatcher.refreshNodes(), can we remove the zk node corresponding to path whose deserialization resulted in IOE ?&lt;/p&gt;</comment>
                            <comment id="13149859" author="jiraposter@reviews.apache.org" created="Mon, 14 Nov 2011 20:04:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-14 20:03:17.125142)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This update addresses the current review comments.&lt;/p&gt;

&lt;p&gt;The only comment not addressed is Ted&apos;s suggestion in ZKSecretWatcher to attempt to remove the znode for any secret key that could not be deserialized.  I need to look at the implications of this for the &quot;leader&quot; secret manager, as well as for potential upgrade scenarios.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/li&gt;
	&lt;li&gt;Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/li&gt;
	&lt;li&gt;Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/li&gt;
	&lt;li&gt;The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/li&gt;
	&lt;li&gt;implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/li&gt;
	&lt;li&gt;The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;existing RPC changes&lt;/li&gt;
	&lt;li&gt;The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/li&gt;
	&lt;li&gt;All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/li&gt;
	&lt;li&gt;Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase.(master|regionserver).keytab.file&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.principal&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.https.principal&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  conf/hbase-policy.xml PRE-CREATION &lt;br/&gt;
  pom.xml 2847416 &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/resources/hbase-site.xml PRE-CREATION &lt;br/&gt;
  src/assembly/all.xml 3ad8ab3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 9117f12 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;br/&gt;
  src/main/resources/hbase-default.xml 6f98f5d &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;

&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="13150018" author="jiraposter@reviews.apache.org" created="Mon, 14 Nov 2011 22:37:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3235&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3235&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7204&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7204&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should we use org.apache.hadoop.hbase.ipc.SecureClient ?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7203&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7203&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should read &apos;when running as master&apos;&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7202&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7202&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This log should be guarded by LOG.isDebugEnabled()&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7231&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7231&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please add curly braces around the log statement.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7227&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7227&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can we rewrite using a loop instead of recursion ?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-14 20:03:17, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-14 20:03:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 2847416 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/assembly/all.xml 3ad8ab3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 9117f12 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 6f98f5d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13151881" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 07:26:52 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-14 22:36:05, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 72&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/5/?file=57988#file57988line72&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/5/?file=57988#file57988line72&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should we use org.apache.hadoop.hbase.ipc.SecureClient ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This follows the same logging convention as HBaseClient/HBaseServer &amp;#8211; it uses a mangled package name so that we don&apos;t get noisy IPC debug logging when setting org.apache.hadoop.hbase=DEBUG in log4j config.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit weird, but it works.  Since log4j does actually support &quot;trace&quot; level now, it might be better to correct the package names and use trace level for all the noisy (per request) logging.  This would keep debug logging relatively clean without the package mangling.  But I think we should tackle that as a separate issue.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-14 22:36:05, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java, line 1229&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/5/?file=58014#file58014line1229&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/5/?file=58014#file58014line1229&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Please add curly braces around the log statement.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since this is pre-existing code copied from Hadoop, style changes here will just make it more difficult to merge Hadoop RPC updates in the future, but maybe we&apos;re already beyond that...&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-14 22:36:05, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java, line 147&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/5/?file=58027#file58027line147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/5/?file=58027#file58027line147&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can we rewrite using a loop instead of recursion ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done, with additional test.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3235&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3235&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-14 20:03:17, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-14 20:03:17)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 2847416 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/assembly/all.xml 3ad8ab3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 9117f12 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 6f98f5d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13151882" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 07:28:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-17 07:27:20.090955)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated patch addressing Ted&apos;s comments.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/li&gt;
	&lt;li&gt;Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/li&gt;
	&lt;li&gt;Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/li&gt;
	&lt;li&gt;The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/li&gt;
	&lt;li&gt;implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/li&gt;
	&lt;li&gt;The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;existing RPC changes&lt;/li&gt;
	&lt;li&gt;The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/li&gt;
	&lt;li&gt;All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/li&gt;
	&lt;li&gt;Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase.(master|regionserver).keytab.file&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.principal&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.https.principal&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  conf/hbase-policy.xml PRE-CREATION &lt;br/&gt;
  pom.xml 2847416 &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/resources/hbase-site.xml PRE-CREATION &lt;br/&gt;
  src/assembly/all.xml 3ad8ab3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java d9ba0ea &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;br/&gt;
  src/main/resources/hbase-default.xml 6f98f5d &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;

&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="13152184" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 18:18:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-14 22:36:05, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 72&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/5/?file=57988#file57988line72&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/5/?file=57988#file57988line72&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should we use org.apache.hadoop.hbase.ipc.SecureClient ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This follows the same logging convention as HBaseClient/HBaseServer &amp;#8211; it uses a mangled package name so that we don&apos;t get noisy IPC debug logging when setting org.apache.hadoop.hbase=DEBUG in log4j config.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It&apos;s a bit weird, but it works.  Since log4j does actually support &quot;trace&quot; level now, it might be better to correct the package names and use trace level for all the noisy (per request) logging.  This would keep debug logging relatively clean without the package mangling.  But I think we should tackle that as a separate issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4810&quot; title=&quot;Clean up IPC logging configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4810&quot;&gt;&lt;del&gt;HBASE-4810&lt;/del&gt;&lt;/a&gt; for broader logging cleanup task.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-14 22:36:05, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java, line 171&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/5/?file=57999#file57999line171&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/5/?file=57999#file57999line171&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should read &apos;when running as master&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-14 22:36:05, Ted Yu wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java, line 173&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/5/?file=57999#file57999line173&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/5/?file=57999#file57999line173&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This log should be guarded by LOG.isDebugEnabled()&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3235&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3235&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 07:27:20, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 07:27:20)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 2847416 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/assembly/all.xml 3ad8ab3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java d9ba0ea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 6f98f5d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152224" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 18:51:39 +0000"  >&lt;p&gt;Changes to waitToBecomeLeader() look good.&lt;/p&gt;

&lt;p&gt;Looking at AuthenticationTokenSecretManager, it becomes leader upon entering run().&lt;br/&gt;
Periodically it calls rollCurrentKey() which checks whether it is still leader. I think rollCurrentKey() should return a boolean value indicating leadership status so that the while loop can re-obtain leadership if leadership is lost.&lt;/p&gt;

&lt;p&gt;I think exception handling below may have some room for improvement:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
          LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error updating keys&quot;&lt;/span&gt;, ioe);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In my opinion, failure to remove expired key or to add new key should be treated with more caution.&lt;br/&gt;
addKeyToZK() and updateKeyInZK() throws RuntimeException, alleviating this concern a little. But zkWatcher.removeKeyFromZK() swallows KeeperException, making things complicated. We may need to call ZKUtil.deleteNode() directly.&lt;/p&gt;

&lt;p&gt;In rollCurrentKey():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE, &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t allow to expire until it&apos;s replace by a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; key&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above should read &apos;replaced by&apos;.&lt;/p&gt;</comment>
                            <comment id="13152238" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 19:03:40 +0000"  >&lt;p&gt;In src/main/resources/hbase-default.xml, I think we should use dot instead of dash for parameter key names:&lt;br/&gt;
hbase.auth.key.update-interval should be hbase.auth.key.update.interval&lt;br/&gt;
hbase.auth.token.max-lifetime should be hbase.auth.token.max.lifetime&lt;/p&gt;</comment>
                            <comment id="13152243" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 19:11:39 +0000"  >&lt;p&gt;In ZKLeaderManager.stepDownAsLeader():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          ZKUtil.deleteNodeFailSilent(watcher, leaderZNode);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think we should call ZKUtil.deleteNode() instead and handle KeeperException gracefully because waitToBecomeLeader() would only delete zk node which has the other candidate&apos;s Id.&lt;/p&gt;</comment>
                            <comment id="13152248" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 19:17:46 +0000"  >&lt;p&gt;Minor:&lt;br/&gt;
For User.obtainAuthTokenForJob() methods, we rethrow RuntimeException so that we can reach the final Exception clause.&lt;br/&gt;
I wonder if this is necessary. NPE, e.g., is a RuntimeException.&lt;/p&gt;</comment>
                            <comment id="13152275" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 19:38:29 +0000"  >&lt;p&gt;In HBaseServer.closeCurrentConnection(), the following is added:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          c = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since c is the attachment to SelectionKey, should we call key.attach(null) ?&lt;/p&gt;</comment>
                            <comment id="13152277" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 19:46:49 +0000"  >&lt;p&gt;HBaseRPC.call() is marked deprecated. Probably we should mention SecureRpcEngine so that developers know what to look for.&lt;/p&gt;</comment>
                            <comment id="13152429" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 23:03:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3322&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3322&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Pretty crazy patch Gary.  I tried reviewing the security code but my eyes started to glaze over and besides it looks like a bunch of copy/paste; in other words, it don&apos;t look like you wrote it.  I skipped ahead after a while to core changes.  There are a few questions below but as long as all tests pass, I&apos;m fine w/ commit (even fine w/ the bit of pollution of core w/ security mentions).&lt;/p&gt;


&lt;p&gt;pom.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7409&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7409&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats going on here?  Why would we exclude the test hbase-site.xml?  I thought it had all configs. for test running?  Or is this in the security profile?  I see you then add it back in later under the plugin section.   Did we have it in wrong place?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7424&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7424&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is a number?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7413&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7413&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Could we get an enum we don&apos;t know about?&lt;/p&gt;

&lt;p&gt;    If copied from hadoop code, don&apos;t worry about this comment.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7414&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7414&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Man, this is kinda ugly... its a data member in a super class?  Cryptic!&lt;/p&gt;

&lt;p&gt;    (This is hadoop code?)&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7422&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This stuff is hard to review since seems to be mostly hadoop copy paste code.&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7423&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7423&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Funny.  Above we compare on State.SUCCESS.state.   What if there is a FATAL here?  Anything special we should do?&lt;/p&gt;



&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7430&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This ain&apos;t you but crazy stuff here...  You&apos;d think hadoop would at least log it?  I suppose notthing you can do about these on close anyways?&lt;/p&gt;



&lt;p&gt;src/assembly/all.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7431&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7431&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This will add the &apos;security&apos; on the end if we are building w/ the security profile?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7433&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7433&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    So, in insecure hbase, is user provided?  If not, this message will be all over our logs? &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7434&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7434&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7436&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7436&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Say what to use instead?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7438&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7438&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This seems like an odd one to expose to subclasses.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7439&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7439&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this &apos;fix&apos; copied from hadoop?  Seems sensible.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7440&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7440&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats happening here?  Do we have to do this &amp;#8211; security pollution of base hbase interface?&lt;/p&gt;




&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7441&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ditto&lt;/p&gt;

&lt;p&gt;    Not a problem if this is the way it has to be...&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7442&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7442&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this a new call we have to make?&lt;/p&gt;



&lt;p&gt;src/main/resources/hbase-default.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/#comment7443&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#comment7443&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This stuff should be in here and not in an hbase-security-default.xml that comes in only when running security?&lt;/p&gt;

&lt;p&gt;    Its ok this stuff is here... just wondering if could be shown only when a security context.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-17 07:27:20, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 07:27:20)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 2847416 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/assembly/all.xml 3ad8ab3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java d9ba0ea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 6f98f5d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152476" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 23:57:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 408&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=58999#file58999line408&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=58999#file58999line408&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats going on here?  Why would we exclude the test hbase-site.xml?  I thought it had all configs. for test running?  Or is this in the security profile?  I see you then add it back in later under the plugin section.   Did we have it in wrong place?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is so that, when building with security profile, we can override the hbase-site.xml used for tests &amp;#8211; specifically set it to use SecureRpcEngine.  It&apos;s an ugly change to the POM and kind of ugly to duplicate the test hbase-site.xml, but I didn&apos;t see an easier way of doing it.  I&apos;m open to other suggestions to improve it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 355&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line355&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is a number?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes:&lt;/p&gt;

&lt;p&gt;  SUCCESS (0),&lt;br/&gt;
  ERROR (1),&lt;br/&gt;
  FATAL (-1);&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 369&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line369&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Could we get an enum we don&apos;t know about?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If copied from hadoop code, don&apos;t worry about this comment.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah this is direct from Hadoop.  It is a bit odd not to have a default block, which should probably behave same as fatal.  Depends if we want to diverge more by adding it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 375&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line375&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line375&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Man, this is kinda ugly... its a data member in a super class?  Cryptic!&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     (This is hadoop code?)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is actually from HBaseClient.  Hadoop just does:&lt;/p&gt;

&lt;p&gt;      } catch (IOException e) &lt;/p&gt;
{
        markClosed(e);
      }


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java, line 143&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59003#file59003line143&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59003#file59003line143&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Funny.  Above we compare on State.SUCCESS.state.   What if there is a FATAL here?  Anything special we should do?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In SecureClient, I think the check on State.SUCCESS.state is to avoid mapping the deserialized value back to the enum value.&lt;/p&gt;

&lt;p&gt;In the case of FATAL, the client will still see fatal status written separately in the response.  For errorClass and error, FATAL is equivalent to ERROR.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/assembly/all.xml, line 60&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59019#file59019line60&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59019#file59019line60&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This will add the &apos;security&apos; on the end if we are building w/ the security profile?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, so for say 0.92, when building with -P security, you would wind up with hbase-0.92.0-security.jar.  Without the security profile, you just get hbase-0.92.0.jar.&lt;/p&gt;

&lt;p&gt;This at least saves having to fiddle with the project version for secure vs. insecure builds, and gives artifacts named as expected.  But not sure if it complicates deploying to a maven repo?  It might still need more tweaking to improve how it works.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java, line 399&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59021#file59021line399&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59021#file59021line399&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     So, in insecure hbase, is user provided?  If not, this message will be all over our logs?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In insecure HBase, User.getCurrent() should return the operating system user.  So I don&apos;t think this should show up in normal circumstances with either insecure or secure versions.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java, line 359&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59024#file59024line359&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59024#file59024line359&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Say what to use instead?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ted pointed this out too.  Fixing to reference RpcEngine.call().&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java, line 119&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59026#file59026line119&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59026#file59026line119&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This seems like an odd one to expose to subclasses.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, must have been necessary at one point, but I no longer see any usage that requires it.  Changing back to private.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java, line 826&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59026#file59026line826&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59026#file59026line826&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is this &apos;fix&apos; copied from hadoop?  Seems sensible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, copied from Hadoop.  Made sense to me as well.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java, line 44&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59027#file59027line44&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59027#file59027line44&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats happening here?  Do we have to do this &amp;#8211; security pollution of base hbase interface?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, these annotations are required for the connection authorization process and authentication.  I copied over the annotation definitions to org.apache.hadoop.hbase.security as part of core.  But actually removing them and using another means might take some work.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/HMaster.java, line 256&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59035#file59035line256&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59035#file59035line256&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     this a new call we have to make?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This was moved down to after ZooKeeperWatcher setup so that AuthenticationTokenSecretManager (which needs zk) can be setup correctly in SecureServer.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/resources/hbase-default.xml, line 468&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59041#file59041line468&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59041#file59041line468&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This stuff should be in here and not in an hbase-security-default.xml that comes in only when running security?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Its ok this stuff is here... just wondering if could be shown only when a security context.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, looks like the keytab stuff got duplicated.  It&apos;s already there from previous patches for running on secure Hadoop.&lt;/p&gt;

&lt;p&gt;The hbase.auth.*, hbase.policy.file, and hbase.superuser properties are new.  I guess we could split them out into a separate default file and add it to the resources in HBaseConfiguration.  How important do you think it is?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Gary&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3322&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3322&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 07:27:20, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 07:27:20)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 2847416 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/assembly/all.xml 3ad8ab3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java d9ba0ea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 6f98f5d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152484" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 00:05:51 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; pom.xml, line 408&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=58999#file58999line408&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=58999#file58999line408&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats going on here?  Why would we exclude the test hbase-site.xml?  I thought it had all configs. for test running?  Or is this in the security profile?  I see you then add it back in later under the plugin section.   Did we have it in wrong place?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is so that, when building with security profile, we can override the hbase-site.xml used for tests &amp;#8211; specifically set it to use SecureRpcEngine.  It&apos;s an ugly change to the POM and kind of ugly to duplicate the test hbase-site.xml, but I didn&apos;t see an easier way of doing it.  I&apos;m open to other suggestions to improve it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Its fine.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java, line 369&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59000#file59000line369&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Could we get an enum we don&apos;t know about?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If copied from hadoop code, don&apos;t worry about this comment.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yeah this is direct from Hadoop.  It is a bit odd not to have a default block, which should probably behave same as fatal.  Depends if we want to diverge more by adding it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No to diverging.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/assembly/all.xml, line 60&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59019#file59019line60&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59019#file59019line60&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This will add the &apos;security&apos; on the end if we are building w/ the security profile?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, so for say 0.92, when building with -P security, you would wind up with hbase-0.92.0-security.jar.  Without the security profile, you just get hbase-0.92.0.jar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This at least saves having to fiddle with the project version for secure vs. insecure builds, and gives artifacts named as expected.  But not sure if it complicates deploying to a maven repo?  It might still need more tweaking to improve how it works.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java, line 399&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59021#file59021line399&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59021#file59021line399&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     So, in insecure hbase, is user provided?  If not, this message will be all over our logs?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In insecure HBase, User.getCurrent() should return the operating system user.  So I don&apos;t think this should show up in normal circumstances with either insecure or secure versions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java, line 44&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59027#file59027line44&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59027#file59027line44&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats happening here?  Do we have to do this &amp;#8211; security pollution of base hbase interface?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, these annotations are required for the connection authorization process and authentication.  I copied over the annotation definitions to org.apache.hadoop.hbase.security as part of core.  But actually removing them and using another means might take some work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok.  we&apos;ll live with it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-11-17 23:03:06, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/resources/hbase-default.xml, line 468&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1991/diff/6/?file=59041#file59041line468&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff/6/?file=59041#file59041line468&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This stuff should be in here and not in an hbase-security-default.xml that comes in only when running security?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Its ok this stuff is here... just wondering if could be shown only when a security context.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary Helmling wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Hmm, looks like the keytab stuff got duplicated.  It&apos;s already there from previous patches for running on secure Hadoop.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The hbase.auth.*, hbase.policy.file, and hbase.superuser properties are new.  I guess we could split them out into a separate default file and add it to the resources in HBaseConfiguration.  How important do you think it is?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can do that later.   You&apos;ve done enough gymnastics Gary getting security in w/o too much disruption to core.  Maybe add note that these configs are for secure hbase only if its not obvious already?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/#review3322&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/#review3322&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-11-17 07:27:20, Gary Helmling wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-17 07:27:20)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- existing RPC changes&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;- Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/property&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).keytab.file&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;* hbase.(master|regionserver).kerberos.https.principal&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;conf/hbase-policy.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;pom.xml 2847416 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;security/src/test/resources/hbase-site.xml PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/assembly/all.xml 3ad8ab3 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java d9ba0ea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 6f98f5d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Gary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13152558" author="ghelmling" created="Fri, 18 Nov 2011 01:16:18 +0000"  >&lt;p&gt;Thanks for the review!  Please add additional comments to review board.  In a patch this big, it&apos;s much easier for me to keep track of comments and replies there.&lt;/p&gt;
&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;Looking at AuthenticationTokenSecretManager, it becomes leader upon entering run().&lt;br/&gt;
Periodically it calls rollCurrentKey() which checks whether it is still leader. I think rollCurrentKey() should return a boolean value indicating leadership status so that the while loop can re-obtain leadership if leadership is lost.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Leader election for AuthenticationTokenSecretManager is equivalent to active master management.  In run(), all instances block on zkLeader.waitToBecomeLeader().  Only the leader returns.  The leader remains active until stopped or the zk session is lost (which should cause an abort), so I don&apos;t see where we would need to recheck in this case?&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;In my opinion, failure to remove expired key or to add new key should be treated with more caution.&lt;br/&gt;
addKeyToZK() and updateKeyInZK() throws RuntimeException, alleviating this concern a little. But zkWatcher.removeKeyFromZK() swallows KeeperException, making things complicated. We may need to call ZKUtil.deleteNode() directly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree, removeKeyFromZK() should be aborting on KeeperException.  That was missing in other places as well.  Cleaning up to call watch.abort() on KeeperException, as well as replacing the RuntimeExceptions with watcher.abort().&lt;/p&gt;

&lt;p&gt;I am very hesitant, though, to call ZKUtil.deleteNode() in the case of IOExceptions (which only occur from the Writable serialization).  In the case of say an upgrade with changed serialization format or a znode that somehow got corrupted data, this seems appropriate.  But I&apos;m more worried about what would occur in the case of a massive misconfiguration, where &lt;tt&gt;zookeeper.znode.tokenauth.parent&lt;/tt&gt; is pointing to the wrong path, and what the consequences might be from deleting every znode it can&apos;t deserialize.  I&apos;d rather abort the server in this case and let the end user deal with it.&lt;/p&gt;

&lt;p&gt;Some ZKWatcher methods shouldn&apos;t even have been throwing IOExceptions.  Those have been fixed.  The remaining cases (nodeDataChanged(), refreshNodes(), addKeyToZK(), updatedKeyInZK()) have been changed to abort on IOException since it would likely mean a programming error.&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;In src/main/resources/hbase-default.xml, I think we should use dot instead of dash for parameter key names:&lt;br/&gt;
  hbase.auth.key.update-interval should be hbase.auth.key.update.interval&lt;br/&gt;
  hbase.auth.token.max-lifetime should be hbase.auth.token.max.lifetime&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These keys were named to match the keys used for HDFS delegation tokens:&lt;br/&gt;
dfs.namenode.delegation.key.update-interval&lt;br/&gt;
dfs.namenode.delegation.token.max-lifetime&lt;/p&gt;

&lt;p&gt;But, since we are consistent about not using &apos;-&apos; in HBase config I will replace.&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;In ZKLeaderManager.stepDownAsLeader():&lt;/p&gt;

&lt;p&gt;ZKUtil.deleteNodeFailSilent(watcher, leaderZNode);&lt;/p&gt;

&lt;p&gt;I think we should call ZKUtil.deleteNode() instead and handle KeeperException gracefully because waitToBecomeLeader() would only delete zk node which has the other candidate&apos;s Id.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t really see what ZKUtil.deleteNode() would improve in this context?  If we instead got the KeeperException.NoNodeException that it exposes, what would we want to do differently?  Since the point of stepDownAsLeader() is to step down, my opinion would be to ignore the NoNodeException if the znode has somehow been removed.  The logic in waitToBecomeLeader() is completely separate and clones the logic in ActiveMasterManager.blockUntilBecomingActiveMaster().&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;In HBaseServer.closeCurrentConnection(), the following is added:&lt;/p&gt;

&lt;p&gt;c = null;&lt;/p&gt;

&lt;p&gt;Since c is the attachment to SelectionKey, should we call key.attach(null) ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point.  The &lt;tt&gt;c = null&lt;/tt&gt; assignment is useless.  Changing to &lt;tt&gt;key.attach(null)&lt;/tt&gt;.&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
&lt;p&gt;HBaseRPC.call() is marked deprecated. Probably we should mention SecureRpcEngine so that developers know what to look for.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added @depecated tag pointing to RpcEngine.call().&lt;/p&gt;</comment>
                            <comment id="13152574" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 01:37:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-18 01:37:36.587135)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updating to address Ted&apos;s comments in JIRA.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch creates a new secure RPC engine for HBase, which provides Kerberos based authentication of clients, and a token-based authentication mechanism for mapreduce jobs.  Primary components of the patch are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new maven profile for secure Hadoop/HBase: hadoop-0.20S&lt;/li&gt;
	&lt;li&gt;Secure Hadoop dependent classes are separated under a pseudo-module in the security/ directory.  These source and test directories are only including if building the secure Hadoop profile&lt;/li&gt;
	&lt;li&gt;Currently the security classes get packaged with the regular HBase build artifacts.  We need a way to at least override project.version, so we can append something like a &quot;-security&quot; suffix indicating the additional security components.&lt;/li&gt;
	&lt;li&gt;The pseudo-module here is really a half-step forward.  It enables the security code to be optionally included in the build for now, and sets up the structure for a security module.  But we still will want to pursue full modularization (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4336&quot; title=&quot;Convert source tree into maven modules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4336&quot;&gt;&lt;del&gt;HBASE-4336&lt;/del&gt;&lt;/a&gt;), which will allow packing the security code in a separate build artifact.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new RPC engine providing kerberos and token-based authentication: org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/li&gt;
	&lt;li&gt;implementation under security/src/main/java/org/apache/hadoop/hbase/ipc/&lt;/li&gt;
	&lt;li&gt;The implementation classes extend the existing HBaseClient and HBaseServer to share as much of the RPC code as possible.  The main override is of the connection classes to allow control over the SASL negotiation of secure connections&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;existing RPC changes&lt;/li&gt;
	&lt;li&gt;The existing HBaseClient and HBaseServer have been modified to make subclassing possible&lt;/li&gt;
	&lt;li&gt;All references to Hadoop UserGroupInformation have been replaced with org.apache.hadoop.hbase.security.User to insulate from future dependencies on specific Hadoop versions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a coprocessor endpoint for obtaining new authentication tokens: TokenProvider, and supporting classes for token generation and synchronization (incorporating &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3615&quot; title=&quot;Implement token based DIGEST-MD5 authentication for MapReduce tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3615&quot;&gt;&lt;del&gt;HBASE-3615&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;implementation is under security/src/main/java/org/apache/hadoop/hbase/security/token/&lt;/li&gt;
	&lt;li&gt;Secret keys for token generation and verification are synchronized throughout the cluster in zookeeper, under /hbase/tokenauth/keys&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;To enable secure RPC, add the following configuration to hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hadoop.security.authentication&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;kerberos&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.rpc.engine&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
   &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;&lt;br/&gt;
   &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, the master and regionserver processes must be configured for kerberos authentication using the properties:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hbase.(master|regionserver).keytab.file&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.principal&lt;/li&gt;
	&lt;li&gt;hbase.(master|regionserver).kerberos.https.principal&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2742&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  conf/hbase-policy.xml PRE-CREATION &lt;br/&gt;
  pom.xml 2847416 &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java PRE-CREATION &lt;br/&gt;
  security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java PRE-CREATION &lt;br/&gt;
  security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java PRE-CREATION &lt;br/&gt;
  security/src/test/resources/hbase-site.xml PRE-CREATION &lt;br/&gt;
  src/assembly/all.xml 3ad8ab3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HServerAddress.java f28240c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java cba7bd1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java 904c107 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 4086829 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 054b92b &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java 337da78 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java d9ba0ea &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 9e0535e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java 0dc5bea &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java e8b2c9e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java 1b5629a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java c8e030c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java db07ed1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java ad88b76 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 19ed5b8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/security/User.java 00bd06d &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 4c5e844 &lt;br/&gt;
  src/main/resources/hbase-default.xml 6f98f5d &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java c0634f4 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java bb9ea45 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1991/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1991/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A full test suite run showed failures in TestMasterFailover (timeout) and TestAvroServer.  I&apos;ll look into those.&lt;/p&gt;

&lt;p&gt;Cluster testing (1 master + 3 slaves in ec2) with Kerberos authentication and map reduce token authentication, using YCSB, RowCounter, PerformanceEvaluation.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="13152601" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 02:30:22 +0000"  >&lt;p&gt;I am fine with aborting watcher in stepDownAsLeader().&lt;/p&gt;

&lt;p&gt;+1 if tests pass.&lt;/p&gt;</comment>
                            <comment id="13152615" author="ghelmling" created="Fri, 18 Nov 2011 03:26:28 +0000"  >&lt;p&gt;Latest patch from review board.&lt;/p&gt;</comment>
                            <comment id="13152649" author="hadoopqa" created="Fri, 18 Nov 2011 05:15:20 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504164/HBASE-2742_10.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504164/HBASE-2742_10.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 23 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 14 javac compiler warnings (more than the trunk&apos;s current 5 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 60 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestShell&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/288//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/288//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/288//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/288//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/288//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/288//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13152703" author="ghelmling" created="Fri, 18 Nov 2011 07:12:35 +0000"  >&lt;p&gt;TestAdmin and TestShell failures seem to be unrelated, and both pass for me locally.&lt;/p&gt;</comment>
                            <comment id="13152706" author="ghelmling" created="Fri, 18 Nov 2011 07:38:56 +0000"  >&lt;p&gt;Committed to 0.92 branch and trunk.  Thanks for all the reviews Andy, Stack, and Ted!  This was a big one.&lt;/p&gt;</comment>
                            <comment id="13152757" author="hudson" created="Fri, 18 Nov 2011 09:57:34 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #143 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/143/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/143/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;  Provide strong authentication with a secure RPC engine&lt;/p&gt;

&lt;p&gt;garyh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/conf/hbase-policy.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/ipc&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache/hadoop&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache/hadoop/hbase&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache/hadoop/hbase/security&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache/hadoop/hbase/security/token&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/resources&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/security/src/test/resources/hbase-site.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/assembly/all.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HServerAddress.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/security/User.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13152799" author="hudson" created="Fri, 18 Nov 2011 11:36:06 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2455 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2455/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2455/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;  Provide strong authentication with a secure RPC engine&lt;/p&gt;

&lt;p&gt;garyh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/conf/hbase-policy.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureConnectionHeader.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureRpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/ipc/SecureServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/AccessDeniedException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/HBasePolicyProvider.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/HBaseSaslRpcServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationKey.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationProtocol.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenIdentifier.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSecretManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/AuthenticationTokenSelector.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/TokenProvider.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/TokenUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/main/java/org/apache/hadoop/hbase/security/token/ZKSecretWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache/hadoop&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache/hadoop/hbase&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache/hadoop/hbase/security&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache/hadoop/hbase/security/token&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/java/org/apache/hadoop/hbase/security/token/TestZKSecretWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/resources&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/security/src/test/resources/hbase-site.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/assembly/all.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HServerAddress.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/ConnectionHeader.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseRpcMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HMasterRegionInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/RequestContext.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/RpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/security/KerberosInfo.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/security/TokenInfo.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/security/User.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKLeaderManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/MiniHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/PerformanceEvaluation.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153106" author="ghelmling" created="Fri, 18 Nov 2011 20:36:06 +0000"  >&lt;p&gt;Here&apos;s a trivial addendum patch to fix intermittent failures in TestZKLeaderManager.  Previously the test was always using &lt;tt&gt;CANDIDATES&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;.getWatcher()&lt;/tt&gt; as the ZooKeeperWatcher for verifying data in zk matched the expected leader.  This could fail if &lt;tt&gt;CANDIDATES&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;/tt&gt; was a previous leader stopped by the test.&lt;/p&gt;</comment>
                            <comment id="13153113" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 20:48:55 +0000"  >&lt;p&gt;+1 on addendum.&lt;/p&gt;

&lt;p&gt;Thanks Gary.&lt;/p&gt;</comment>
                            <comment id="13153127" author="ghelmling" created="Fri, 18 Nov 2011 21:09:28 +0000"  >&lt;p&gt;Addendum patch committed to 0.92 branch and trunk.  Thanks for review, Ted.&lt;/p&gt;</comment>
                            <comment id="13153252" author="hudson" created="Sat, 19 Nov 2011 00:08:35 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #144 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/144/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/144/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;  Fix intermittent TestZKLeaderManager failure&lt;/p&gt;

&lt;p&gt;garyh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13153327" author="hudson" created="Sat, 19 Nov 2011 01:49:14 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2458 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2458/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2458/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2742&quot; title=&quot;Provide strong authentication with a secure RPC engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2742&quot;&gt;&lt;del&gt;HBASE-2742&lt;/del&gt;&lt;/a&gt;  Fix intermittent TestZKLeaderManager failure&lt;/p&gt;

&lt;p&gt;garyh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKLeaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15017466" author="lars_francke" created="Fri, 20 Nov 2015 12:43:13 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12441875">HBASE-2016</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12500976">HBASE-3615</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12461509">HBASE-2425</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12474775">HBASE-3025</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12504164" name="HBASE-2742_10.patch" size="261059" author="ghelmling" created="Fri, 18 Nov 2011 03:26:27 +0000"/>
                            <attachment id="12504263" name="HBASE-2742_addendum.patch" size="1976" author="ghelmling" created="Fri, 18 Nov 2011 20:36:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Jun 2010 01:16:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d28n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74139</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>