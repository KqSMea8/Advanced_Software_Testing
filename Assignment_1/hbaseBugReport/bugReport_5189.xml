<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5189/HBASE-5189.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5189] Add metrics to keep track of region-splits in RS</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5189</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;For write-heavy workload with region-size 1 GB, region-split is considerably high. We do normally grep the NN log (grep &quot;mkdir*.split&quot; NN.log | sort | uniq -c) to get the count.&lt;/p&gt;

&lt;p&gt;I would like to have a counter incremented each time region-split execution succeeds and this counter exposed via the metrics stuff in HBase.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;regionSplitSuccessCount&lt;/li&gt;
	&lt;li&gt;regionSplitFailureCount (will help us to correlate the timestamp range in RS logs across all RS)&lt;/li&gt;
&lt;/ul&gt;


</description>
                <environment></environment>
        <key id="12538278">HBASE-5189</key>
            <summary>Add metrics to keep track of region-splits in RS</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="mubarakseyed">Mubarak Seyed</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jan 2012 00:54:45 +0000</created>
                <updated>Tue, 5 Aug 2014 20:11:43 +0000</updated>
                            <resolved>Tue, 7 Aug 2012 22:55:52 +0000</resolved>
                                    <version>0.90.5</version>
                    <version>0.92.0</version>
                                    <fixVersion>0.94.0</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>metrics</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13186062" author="mubarakseyed" created="Sat, 14 Jan 2012 02:02:09 +0000"  >&lt;p&gt;Waiting for corporate approval to contribute this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="13190606" author="mubarakseyed" created="Sun, 22 Jan 2012 04:56:15 +0000"  >&lt;p&gt;The attached file is a patch.&lt;/p&gt;</comment>
                            <comment id="13190703" author="zhihyu@ebaysf.com" created="Sun, 22 Jan 2012 16:01:12 +0000"  >&lt;p&gt;For the failure case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getMetrics().incrementSplitFailureCount();
           } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
             &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.abort(&lt;span class=&quot;code-quote&quot;&gt;&quot;Abort; we got an error after point-of-no-&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think getMetrics().incrementSplitFailureCount() should be moved to after this log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running rollback/cleanup of failed split of &quot;&lt;/span&gt; +
            parent.getRegionNameAsString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;; &quot;&lt;/span&gt; + e.getMessage(), e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13191401" author="mubarakseyed" created="Mon, 23 Jan 2012 19:59:47 +0000"  >&lt;p&gt;If we move getMetrics().incrementSplitFailureCount() before rollback() and if rollback() returns false (or) throws RuntimeException then we don&apos;t need to increment split failure count as RS is going to abort itself.&lt;/p&gt;

&lt;p&gt;The one place which needs to call getMetrics().incrementSplitFailureCount() is catch block&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ex) {
      LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Split failed &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, RemoteExceptionHandler
          .checkIOException(ex));
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getMetrics().incrementSplitFailureCount();
      server.checkFileSystem();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;as rollback() throws IOException.&lt;/p&gt;

&lt;p&gt;The attached patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5189&quot; title=&quot;Add metrics to keep track of region-splits in RS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5189&quot;&gt;&lt;del&gt;HBASE-5189&lt;/del&gt;&lt;/a&gt;.trunk.v2.patch) updates the patch.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13191421" author="zhihyu@ebaysf.com" created="Mon, 23 Jan 2012 20:26:12 +0000"  >&lt;p&gt;Patch v2 makes sense.&lt;/p&gt;</comment>
                            <comment id="13191888" author="hadoopqa" created="Tue, 24 Jan 2012 04:55:58 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12511544/HBASE-5189.trunk.v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12511544/HBASE-5189.trunk.v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -145 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 84 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/845//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/845//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/845//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/845//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/845//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/845//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13191920" author="stack" created="Tue, 24 Jan 2012 06:14:42 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13211176" author="mubarakseyed" created="Sun, 19 Feb 2012 01:18:11 +0000"  >&lt;p&gt;Tested in live cluster, works fine. Thanks.&lt;/p&gt;</comment>
                            <comment id="13213401" author="stack" created="Wed, 22 Feb 2012 06:51:19 +0000"  >&lt;p&gt;Applied to trunk.  Thanks for the patch Mubarak.&lt;/p&gt;</comment>
                            <comment id="13424421" author="mbertozzi" created="Sat, 28 Jul 2012 20:39:42 +0000"  >&lt;p&gt;From the MetricsTimeVaryingLong documentation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The metrics is accumulated over an interval (set in the metrics config file); the metrics is published at the end of each interval and then reset to zero. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This means that the region split count doesn&apos;t contains the total number of splits but just the diff between the previous time.&lt;/p&gt;

&lt;p&gt;Given that the counter will be most of the time zero, if there&apos;re no continuous split.&lt;/p&gt;

&lt;p&gt;Can&apos;t we just use a MetricsLongValue to keep track of the number of split, or since we&apos;re at this point we can use a PersistentMetricsTimeVaryingRate to keep track of the avg time of the splits? (patch attached)&lt;/p&gt;

&lt;p&gt;Can someone comment on the original idea/use case of the region split counter?&lt;/p&gt;</comment>
                            <comment id="13429327" author="dsw" created="Mon, 6 Aug 2012 18:34:59 +0000"  >&lt;p&gt;Matteo, my non-binding opintion is that I think moving to PersistentMetricsTimeVaryingRate would be the right idea here in order to make this metric useful.&lt;/p&gt;</comment>
                            <comment id="13429328" author="dsw" created="Mon, 6 Aug 2012 18:35:25 +0000"  >&lt;p&gt;... for the reason you state (hit return too quickly).&lt;/p&gt;</comment>
                            <comment id="13429330" author="hadoopqa" created="Mon, 6 Aug 2012 18:36:43 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12538254/HBASE-5189-persistent.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12538254/HBASE-5189-persistent.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 9 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2521//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13429452" author="stack" created="Mon, 6 Aug 2012 21:27:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can someone comment on the original idea/use case of the region split counter?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m pretty sure that the original implementation had little thought spent on it (and it sounds plain broke).&lt;/p&gt;

&lt;p&gt;Patch looks good to me (What you think Elliott).  Any chance of a release note documenting its changed format Matteo?  Good on you.&lt;/p&gt;</comment>
                            <comment id="13430605" author="mbertozzi" created="Tue, 7 Aug 2012 20:40:38 +0000"  >&lt;p&gt;@stack&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5189&quot; title=&quot;Add metrics to keep track of region-splits in RS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5189&quot;&gt;&lt;del&gt;HBASE-5189&lt;/del&gt;&lt;/a&gt;-persistent.patch&lt;br/&gt;
split metrics are now persistent across metrics reporting periods, &lt;br/&gt;
and also the min/max/avg time of the split operation are stored.&lt;/p&gt;</comment>
                            <comment id="13430703" author="stack" created="Tue, 7 Aug 2012 22:55:52 +0000"  >&lt;p&gt;Added your comment above as release note.  Committed to trunk.  Thanks for the patch Matteo (Assigned it to you toooooo).&lt;/p&gt;</comment>
                            <comment id="13430813" author="zhihyu@ebaysf.com" created="Wed, 8 Aug 2012 02:27:09 +0000"  >&lt;p&gt;How come Hudson logged build results to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5819&quot; title=&quot;SplitLogs function could leak resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5819&quot;&gt;&lt;del&gt;HBASE-5819&lt;/del&gt;&lt;/a&gt; ?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5819?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=13430809#comment-13430809&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5819?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=13430809#comment-13430809&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13430963" author="stack" created="Wed, 8 Aug 2012 09:07:19 +0000"  >&lt;p&gt;Dyslexia on my part.  I fixed the commit message JIRA number.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12538254" name="HBASE-5189-persistent.patch" size="2790" author="mbertozzi" created="Sat, 28 Jul 2012 20:39:42 +0000"/>
                            <attachment id="12511420" name="HBASE-5189.trunk.v1.patch" size="2937" author="mubarakseyed" created="Sun, 22 Jan 2012 04:56:14 +0000"/>
                            <attachment id="12511544" name="HBASE-5189.trunk.v2.patch" size="3193" author="mubarakseyed" created="Mon, 23 Jan 2012 19:59:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 22 Jan 2012 16:01:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223784</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 19 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02h2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Split metrics are now persistent across metrics reporting periods.  Also the min/max/avg time of the split operation are stored.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>