<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6322/HBASE-6322.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6322] Unnecessary creation of finalizers in HTablePool</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6322</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From a mailing list question:&lt;/p&gt;

&lt;p&gt;While generating some load against a library that makes extensive use of HTablePool in 0.92, I noticed that the largest heap consumer was java.lang.ref.Finalizer.  Digging in, I discovered that HTablePool&apos;s internal PooledHTable extends HTable, which instantiates a ThreadPoolExecutor and supporting objects every time a pooled HTable is retrieved.  Since ThreadPoolExecutor has a finalizer, it and its dependencies can&apos;t get garbage collected until the finalizer runs.  The result is by using HTablePool, we&apos;re creating a ton of objects to be finalized that are stuck on the heap longer than they should be, creating our largest source of pressure on the garbage collector.  It looks like this will also be a problem in 0.94 and trunk.&lt;/p&gt;

&lt;p&gt;The easy fix is just to have PooledHTable implement HTableInterface (rather than subclass HTable), but this does break a unit test that explicitly checks that PooledHTable implements HTable &amp;#8211; I can only assume this test is there for some historical passivity reason.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597348">HBASE-6322</key>
            <summary>Unnecessary creation of finalizers in HTablePool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rbrush">Ryan Brush</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jul 2012 21:33:56 +0000</created>
                <updated>Fri, 31 Aug 2012 05:45:19 +0000</updated>
                                            <version>0.92.0</version>
                    <version>0.92.1</version>
                    <version>0.94.0</version>
                                    <fixVersion>0.92.3</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13406078" author="rbrush" created="Tue, 3 Jul 2012 21:42:07 +0000"  >&lt;p&gt;Simple patch that for the 0.92 branch to implement HTableInterface and remove the test that checks for HTable.&lt;/p&gt;</comment>
                            <comment id="13406572" author="stack" created="Wed, 4 Jul 2012 15:07:47 +0000"  >&lt;p&gt;What I applied to trunk.&lt;/p&gt;</comment>
                            <comment id="13406575" author="stack" created="Wed, 4 Jul 2012 15:12:37 +0000"  >&lt;p&gt;Applied to 0.92.  Thanks for the patch Ryan.  Do we need something like this on 0.94 and trunk too?&lt;/p&gt;</comment>
                            <comment id="13406665" author="hudson" created="Wed, 4 Jul 2012 19:09:25 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #466 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/466/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/466/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6322&quot; title=&quot;Unnecessary creation of finalizers in HTablePool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6322&quot;&gt;HBASE-6322&lt;/a&gt; Unnecessary creation of finalizers in HTablePool (Revision 1357291)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6322&quot; title=&quot;Unnecessary creation of finalizers in HTablePool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6322&quot;&gt;HBASE-6322&lt;/a&gt; Unnecessary creation of finalizers in HTablePool (Revision 1357285)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HTablePool.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestHTablePool.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13406720" author="zhihyu@ebaysf.com" created="Wed, 4 Jul 2012 20:40:14 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-0.92/466/testReport/org.apache.hadoop.hbase.rest/TestTableResource/testTableInfoText/:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-0.92/466/testReport/org.apache.hadoop.hbase.rest/TestTableResource/testTableInfoText/:&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: expected:&amp;lt;500&amp;gt; but was:&amp;lt;200&amp;gt;
	at org.junit.Assert.fail(Assert.java:93)
	at org.junit.Assert.failNotEquals(Assert.java:647)
	at org.junit.Assert.assertEquals(Assert.java:128)
	at org.junit.Assert.assertEquals(Assert.java:472)
	at org.junit.Assert.assertEquals(Assert.java:456)
	at org.apache.hadoop.hbase.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.TestTableResource.testTableInfoText(TestTableResource.java:215)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The failure is reproducible locally.&lt;br/&gt;
In the same test output you can see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-07-04 18:53:29,338 ERROR [2535725@qtp-29012646-0] log.Slf4jLog(87): /TestTableResource/regions
java.lang.ClassCastException: org.apache.hadoop.hbase.client.HTablePool$PooledHTable cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.hadoop.hbase.client.HTable
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13406757" author="rbrush" created="Wed, 4 Jul 2012 21:13:00 +0000"  >&lt;p&gt;My apologies...I had only run the tests around HTablePool since I had run into some apparently unrelated test failures in a full build.  (And I didn&apos;t expect it to be included in the build so quickly. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  It looks like we&apos;ll need to do some refactoring in REST server&apos;s RegionResource for this to apply cleanly, specifically the call to HTable.getRegionsInfo which requires the downcast (and is deprecated, anyway).&lt;/p&gt;

&lt;p&gt;I&apos;m not deeply familiar with this part of the code base and probably won&apos;t be able to dig into it today, but can get back to it in the next couple days, as well as making sure there aren&apos;t any further regressions caused by this change.&lt;/p&gt;</comment>
                            <comment id="13406760" author="stack" created="Wed, 4 Jul 2012 21:16:25 +0000"  >&lt;p&gt;Thanks Ted.  I reverted the patch for now.&lt;/p&gt;

&lt;p&gt;Thank your time Ryan.  Patch looks worth it if you can figure the test fail.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13406792" author="zhihyu@ebaysf.com" created="Thu, 5 Jul 2012 00:20:13 +0000"  >&lt;p&gt;Looks like we can add the following to HTableInterface in trunk:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; NavigableMap&amp;lt;HRegionInfo, ServerName&amp;gt; getRegionLocations() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so that RegionsResource can use it instead of getRegionsInfo().&lt;br/&gt;
And we don&apos;t need a cast in getTableRegions().&lt;/p&gt;</comment>
                            <comment id="13406883" author="apurtell" created="Thu, 5 Jul 2012 06:53:11 +0000"  >&lt;p&gt;Alternatively we can deprecate that part of the REST API in 0.94 and pull it in 0.96. I think use of it would be uncommon. &lt;/p&gt;</comment>
                            <comment id="13407447" author="mkwhitacre" created="Thu, 5 Jul 2012 20:14:19 +0000"  >&lt;p&gt;I believe the methods missing from HTableInterface is being tracked with this issue:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5728&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5728&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13411171" author="hudson" created="Wed, 11 Jul 2012 02:36:56 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #39 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/39/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/39/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6322&quot; title=&quot;Unnecessary creation of finalizers in HTablePool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6322&quot;&gt;HBASE-6322&lt;/a&gt; Unnecessary creation of finalizers in HTablePool; REVERT &amp;#8211; DOESN&apos;T BELONG ON THIS BRANCH (Revision 1357299)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6322&quot; title=&quot;Unnecessary creation of finalizers in HTablePool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6322&quot;&gt;HBASE-6322&lt;/a&gt; Unnecessary creation of finalizers in HTablePool (Revision 1357290)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/client/HTablePool.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestHTablePool.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/client/HTablePool.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestHTablePool.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12534988" name="HBASE-6322-0.92.1.patch" size="2126" author="rbrush" created="Tue, 3 Jul 2012 21:42:07 +0000"/>
                            <attachment id="12535111" name="HBASE-6322-trunk.1.patch" size="2230" author="stack" created="Wed, 4 Jul 2012 15:07:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Jul 2012 15:07:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241718</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>