<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:55:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1638/HBASE-1638.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1638] hfile has entry from wrong family</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1638</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have an hfile with an entry from another family.  It was give us by bryan duxbury.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429992">HBASE-1638</key>
            <summary>hfile has entry from wrong family</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2009 23:21:53 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:50 +0000</updated>
                            <resolved>Wed, 29 Jul 2009 23:10:06 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12729475" author="stack" created="Fri, 10 Jul 2009 00:52:45 +0000"  >&lt;p&gt;Unfinished repair tool for hfile&lt;/p&gt;</comment>
                            <comment id="12729519" author="stack" created="Fri, 10 Jul 2009 04:52:17 +0000"  >&lt;p&gt;Here&apos;s how you run it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ ./bin/hbase shell ./purgewrongfamily.rb /tmp/hbase-stack/hbase/.META./1028785192/info/1261940636599163 info
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It will run through the file 1261940636599163 and drop key not of the &apos;info&apos; family.  If successful, it will replace the original file.&lt;/p&gt;</comment>
                            <comment id="12729522" author="stack" created="Fri, 10 Jul 2009 05:07:23 +0000"  >&lt;p&gt;How&apos;d this happen?&lt;/p&gt;</comment>
                            <comment id="12733086" author="stack" created="Sun, 19 Jul 2009 22:47:26 +0000"  >&lt;p&gt;Bringing into 0.20.0.  This and 1634 make a pair.&lt;/p&gt;</comment>
                            <comment id="12733387" author="stack" created="Mon, 20 Jul 2009 22:47:07 +0000"  >&lt;p&gt;Above I say &apos;If successful, it will replace the original file.&apos;  Thats not right.  It does not replace the old fle.&lt;/p&gt;

&lt;p&gt;If it finds an errant record, it will emit it.  In this case, replace old file with the new one manually.  New file is named for the old with a &apos;.rewrite&apos; suffix.&lt;/p&gt;</comment>
                            <comment id="12733484" author="stack" created="Tue, 21 Jul 2009 05:27:03 +0000"  >&lt;p&gt;First version of script would not find bad keys if they were first in the file.  This one fixes that.  Also if we rewrote keys, then we move the rewritten file over the original.  Here is what it looks like when it runs and finds a bad key:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ ~/checkouts/hbase/cleantrunk/bin/hbase shell purgewrongfamily.rb ./j/.META./1028785192/info/4966765050467496366  info
Writing &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file j/.META./1028785192/info/4966765050467496366.rewrite
Dropped bad key: TestTable,,1248127844086/historian:open/1248127848045/Put/vlen=46
Moving j/.META./1028785192/info/4966765050467496366.rewrite to j/.META./1028785192/info/4966765050467496366
$ ~/checkouts/hbase/cleantrunk/bin/hbase shell purgewrongfamily.rb ./j/.META./1028785192/info/4966765050467496366  info
Writing &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file j/.META./1028785192/info/4966765050467496366.rewrite
No bad keys found... cleaning up j/.META./1028785192/info/4966765050467496366.rewrite
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12735403" author="apurtell" created="Sun, 26 Jul 2009 18:10:56 +0000"  >&lt;p&gt;The script does not seem to work if the filesystem is not local:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[hadoop@BOA01 hbase-0.20.0]$ ./bin/hbase shell /var/tmp/purgewrongfamily.rb hdfs://localhost:50000/hbase/.META./1028785192/info/1682440087021188177 info
org/apache/hadoop/fs/FileSystem.java:305:in `checkPath&apos;: java.lang.IllegalArgumentException: Wrong FS: hdfs://localhost:50000/hbase/.META./1028785192/info/1682440087021188177, expected: file:/// (NativeException)
        from org/apache/hadoop/fs/RawLocalFileSystem.java:47:in `pathToFile&apos;
        from org/apache/hadoop/fs/RawLocalFileSystem.java:357:in `getFileStatus&apos;
        from org/apache/hadoop/fs/FilterFileSystem.java:245:in `getFileStatus&apos;
        from org/apache/hadoop/fs/ChecksumFileSystem.java:125:in `&amp;lt;init&amp;gt;&apos;
        from org/apache/hadoop/fs/ChecksumFileSystem.java:283:in `open&apos;
        from org/apache/hadoop/fs/FileSystem.java:351:in `open&apos;
        from org/apache/hadoop/hbase/io/hfile/HFile.java:688:in `&amp;lt;init&amp;gt;&apos;
        from sun/reflect/NativeConstructorAccessorImpl.java:-2:in `newInstance0&apos;
         ... 38 levels...
        from org/jruby/Main.java:94:in `main&apos;
        from /var/tmp/purgewrongfamily.rb:105:in `load&apos;
        from /opt/hbase-0.20.0/bin/../bin/hirb.rb:105
Complete Java stackTrace
java.lang.IllegalArgumentException: Wrong FS: hdfs://localhost:50000/hbase/.META./1028785192/info/1682440087021188177, expected: file:///
        at org.apache.hadoop.fs.FileSystem.checkPath(FileSystem.java:305)
        at org.apache.hadoop.fs.RawLocalFileSystem.pathToFile(RawLocalFileSystem.java:47)
        at org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:357)
        at org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:245)
        at org.apache.hadoop.fs.ChecksumFileSystem$ChecksumFSInputChecker.&amp;lt;init&amp;gt;(ChecksumFileSystem.java:125)
        at org.apache.hadoop.fs.ChecksumFileSystem.open(ChecksumFileSystem.java:283)
        at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:351)
        at org.apache.hadoop.hbase.io.hfile.HFile$Reader.&amp;lt;init&amp;gt;(HFile.java:688)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
        at org.jruby.javasupport.JavaConstructor.new_instance(JavaConstructor.java:226)
        at org.jruby.java.invokers.ConstructorInvoker.call(ConstructorInvoker.java:80)
        at org.jruby.java.invokers.ConstructorInvoker.call(ConstructorInvoker.java:147)
        at org.jruby.RubyClass.finvoke(RubyClass.java:353)
        at org.jruby.javasupport.util.RuntimeHelpers.invoke(RuntimeHelpers.java:385)
        at org.jruby.java.proxies.ConcreteJavaProxy$2.call(ConcreteJavaProxy.java:40)
        at org.jruby.runtime.callsite.CachingCallSite.cacheAndCall(CachingCallSite.java:233)
        at org.jruby.runtime.callsite.CachingCallSite.callBlock(CachingCallSite.java:41)
        at org.jruby.runtime.callsite.CachingCallSite.call(CachingCallSite.java:46)
        at org.jruby.RubyClass$SpecificArityNew.call(RubyClass.java:542)
        at org.jruby.internal.runtime.methods.DynamicMethod.call(DynamicMethod.java:136)
        at org.jruby.java.proxies.ConcreteJavaProxy$ConcreteNewMethod.call(ConcreteJavaProxy.java:148)
        at org.jruby.runtime.callsite.CachingCallSite.cacheAndCall(CachingCallSite.java:243)
        at org.jruby.runtime.callsite.CachingCallSite.call(CachingCallSite.java:32)
        at org.jruby.ast.CallManyArgsNode.interpret(CallManyArgsNode.java:59)
        at org.jruby.ast.LocalAsgnNode.interpret(LocalAsgnNode.java:123)
        at org.jruby.ast.NewlineNode.interpret(NewlineNode.java:104)
        at org.jruby.ast.BlockNode.interpret(BlockNode.java:71)
        at org.jruby.ast.RootNode.interpret(RootNode.java:129)
        at org.jruby.Ruby.loadFile(Ruby.java:2247)
        at org.jruby.runtime.load.ExternalScript.load(ExternalScript.java:58)
        at org.jruby.runtime.load.LoadService.load(LoadService.java:250)
        at org.jruby.RubyKernel.load(RubyKernel.java:851)
        at org.jruby.RubyKernel$s_method_0_1$RUBYFRAMEDINVOKER$load.call(org/jruby/RubyKernel$s_method_0_1$RUBYFRAMEDINVOKER$load.gen)
        at org.jruby.internal.runtime.methods.DynamicMethod.call(DynamicMethod.java:243)
        at org.jruby.internal.runtime.methods.DynamicMethod.call(DynamicMethod.java:152)
        at org.jruby.runtime.callsite.CachingCallSite.cacheAndCall(CachingCallSite.java:273)
        at org.jruby.runtime.callsite.CachingCallSite.call(CachingCallSite.java:112)
        at opt.hbase_minus_0_dot_20_dot_0.bin.$_dot_dot_.bin.hirb.__file__(hirb.rb:105)
        at opt.hbase_minus_0_dot_20_dot_0.bin.$_dot_dot_.bin.hirb.load(hirb.rb)
        at org.jruby.Ruby.runScript(Ruby.java:577)
        at org.jruby.Ruby.runNormally(Ruby.java:480)
        at org.jruby.Ruby.runFromMain(Ruby.java:354)
        at org.jruby.Main.run(Main.java:229)
        at org.jruby.Main.run(Main.java:110)
        at org.jruby.Main.main(Main.java:94)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12735407" author="apurtell" created="Sun, 26 Jul 2009 18:39:00 +0000"  >&lt;p&gt;This happened in my test setup also and was quite a pain. See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1706&quot; title=&quot;META row with missing HRI breaks UI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1706&quot;&gt;&lt;del&gt;HBASE-1706&lt;/del&gt;&lt;/a&gt;. I think this should be a blocker for 0.20. Currently the solution is to take down the cluster and fix hstore files by hand. Any mistake doing that on the META table and the cluster is dead. &lt;/p&gt;</comment>
                            <comment id="12735410" author="apurtell" created="Sun, 26 Jul 2009 18:42:33 +0000"  >&lt;p&gt;A modest improvement on the current situation would be to have major compaction drop keys of the wrong family. Then at least we could as a user to force a major compaction from the shell, a simple operation, as opposed to delicate file surgery. &lt;/p&gt;</comment>
                            <comment id="12735419" author="ryanobjc" created="Sun, 26 Jul 2009 20:09:59 +0000"  >&lt;p&gt;this seems to be only happening in .META. hey?  Any idea of which codepath might possibly be triggering this?&lt;/p&gt;</comment>
                            <comment id="12736202" author="apurtell" created="Tue, 28 Jul 2009 18:28:43 +0000"  >&lt;p&gt;Based on some observations, it looks like occasionally a column bundled with others in a Put is &quot;broadcast&quot; into all column families.&lt;/p&gt;</comment>
                            <comment id="12736213" author="stack" created="Tue, 28 Jul 2009 18:40:30 +0000"  >&lt;p&gt;Jgray suspects reconstructionlog... looking.&lt;/p&gt;</comment>
                            <comment id="12736333" author="stack" created="Tue, 28 Jul 2009 22:13:07 +0000"  >&lt;p&gt;For jgray to purge bad row in .META.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ ./bin/hbase shell purgerow.rb /tmp/hbase-stack/hbase/.META./1028785192/info/2656626100894786616 &apos;METAROW&apos;
Writing &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file /tmp/hbase-stack/hbase/.META./1028785192/info/2656626100894786616.rewrite
Dropped bad row: METAROW/METAFAMILY:/1248765129901/Put/vlen=17
Dropped bad row: METAROW/info:/1248817222264/DeleteFamily/vlen=0
Moving /tmp/hbase-stack/hbase/.META./1028785192/info/2656626100894786616.rewrite to /tmp/hbase-stack/hbase/.META./1028785192/info/2656626100894786616
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will overwrite file if it finds bad entries.&lt;/p&gt;</comment>
                            <comment id="12736897" author="stack" created="Wed, 29 Jul 2009 23:10:06 +0000"  >&lt;p&gt;Resolving in the belief that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1718&quot; title=&quot;Reuse of KeyValue during log replay could cause the wrong data to be used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1718&quot;&gt;&lt;del&gt;HBASE-1718&lt;/del&gt;&lt;/a&gt; was cause of this issue.  Will reopen if seen again.&lt;/p&gt;</comment>
                            <comment id="12743411" author="larsgeorge" created="Fri, 14 Aug 2009 20:16:41 +0000"  >&lt;p&gt;Note &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1766&quot; title=&quot;Add advanced features to HFile.main() to be able to analyze storefile problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1766&quot;&gt;&lt;del&gt;HBASE-1766&lt;/del&gt;&lt;/a&gt; has an updated version of purgewrongfamily.rb that has a working file swap. The version here fails silently to rename the new file.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12431596">HBASE-1716</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12414563" name="HBASE-1638.patch" size="1198" author="apurtell" created="Sun, 26 Jul 2009 19:06:24 +0000"/>
                            <attachment id="12414813" name="purgerow.rb" size="1369" author="stack" created="Tue, 28 Jul 2009 22:13:07 +0000"/>
                            <attachment id="12414073" name="purgewrongfamily.rb" size="1395" author="stack" created="Tue, 21 Jul 2009 05:27:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 26 Jul 2009 18:10:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25880</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hef3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>