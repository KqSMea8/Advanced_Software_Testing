<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6298/HBASE-6298.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6298] Region balancer not balancing</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6298</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Despite regions being unbalanced, the load balancer takes no action. On my cluster the least-loaded regionserver has 33 regions and the most-loaded regionserver has 44 regions. My cluster has 1084 regions and 29 servers. It might be relevant that a 30th server used to belong to the cluster but was removed.&lt;/p&gt;

&lt;p&gt;The master log has some strange entries when the balancer runs. The attached log file was generated by restarting the master, then running &quot;balancer&quot; in the shell.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12596515">HBASE-6298</key>
            <summary>Region balancer not balancing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dave_revell">Dave Revell</reporter>
                        <labels>
                    </labels>
                <created>Sat, 30 Jun 2012 18:30:46 +0000</created>
                <updated>Mon, 2 Jul 2012 22:33:02 +0000</updated>
                            <resolved>Mon, 2 Jul 2012 22:33:02 +0000</resolved>
                                    <version>0.94.0</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13404598" author="dave_revell" created="Sat, 30 Jun 2012 18:32:12 +0000"  >&lt;p&gt;Attached log file&lt;/p&gt;</comment>
                            <comment id="13404630" author="stack" created="Sat, 30 Jun 2012 21:26:44 +0000"  >&lt;p&gt;Was the problem evident before the master restart Dave?  Its plain that the new master joining cluser is getting wonky picture of cluster state:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-06-30 14:11:46,326 - INFO  [IPC Server handler 4 on 7050:DefaultLoadBalancer@248] - Skipping load balancing because balanced cluster; servers=29 regions=1 average=0.03448276 mostloaded=1 leastloaded=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13404634" author="dave_revell" created="Sat, 30 Jun 2012 21:42:06 +0000"  >&lt;p&gt;@stack: yes, the problem was occurring before the restart. That&apos;s why I restarted the master, to try to get the master to start balancing again.&lt;/p&gt;</comment>
                            <comment id="13404637" author="stack" created="Sat, 30 Jun 2012 21:47:52 +0000"  >&lt;p&gt;Its disturbing the master is so bad at math.  Do you see where it went awry earlier in the logs?  Where master had regions as &amp;gt; 1k and then of a sudden starting thinking one region out on the cluster only?  Good on you D.&lt;/p&gt;</comment>
                            <comment id="13404717" author="rajesh23" created="Sun, 1 Jul 2012 12:04:38 +0000"  >&lt;p&gt;Skipping load balancing because  &quot;hbase.master.loadbalance.bytable&quot; property set to true (true by default) when we set it to true, balancer calls balance table wise(only table regions and corresponding servers considered for balance). Some times even we start new region server also no use in these scenarios. if you configure &quot;hbase.master.loadbalance.bytable&quot; to false load will be balanced on all servers. &lt;br/&gt;
Hope I am clear.&lt;/p&gt;</comment>
                            <comment id="13404890" author="ram_krish" created="Mon, 2 Jul 2012 05:09:28 +0000"  >&lt;p&gt;@Dave/Stack&lt;br/&gt;
As Rajesh suggested pls see the hbase.master.loadbalance.bytable property. I think you 31 tables? few with 86 regions, few with 178 regions and few with 1 region.&lt;/p&gt;</comment>
                            <comment id="13404939" author="stack" created="Mon, 2 Jul 2012 08:30:30 +0000"  >&lt;p&gt;@Dave Want to try what the lads suggest?  Change config and restart master.  See if that fixes it?  If so, there is a problem w/ the table balancer it seems.&lt;/p&gt;</comment>
                            <comment id="13405143" author="zhihyu@ebaysf.com" created="Mon, 2 Jul 2012 17:24:21 +0000"  >&lt;p&gt;This issue should be asked on dev mailing list first.&lt;br/&gt;
There is a sloppy factor used by load balancer (defaulting to 20%):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setConf(Configuration conf) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.slop = conf.getFloat(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regions.slop&quot;&lt;/span&gt;, (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) 0.2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The log message cited above came from this check:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; floor = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.floor(average * (1 - slop));
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ceiling = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil(average * (1 + slop));
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serversByLoad.lastKey().getLoad() &amp;lt;= ceiling &amp;amp;&amp;amp;
       serversByLoad.firstKey().getLoad() &amp;gt;= floor) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The average number of regions is 37 for Dave&apos;s cluster.&lt;br/&gt;
(44-37)/37=19%&lt;/p&gt;

&lt;p&gt;@Dave:&lt;br/&gt;
I suggest you tighten &quot;hbase.regions.slop&quot;&lt;/p&gt;</comment>
                            <comment id="13405399" author="dave_revell" created="Mon, 2 Jul 2012 22:32:38 +0000"  >&lt;p&gt;I changed hbase.regions.slop to 0.1 and the imbalance lessened. So I see no reason to suspect a bug here. I was just unduly scared by the log messages and default slop setting.&lt;/p&gt;

&lt;p&gt;Thanks @Zhihong and everyone for your help.&lt;/p&gt;</comment>
                            <comment id="13405400" author="dave_revell" created="Mon, 2 Jul 2012 22:33:02 +0000"  >&lt;p&gt;Closing as invalid because there was never really a bug.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12534121" name="master_startup.log" size="56045" author="dave_revell" created="Sat, 30 Jun 2012 18:32:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 Jun 2012 21:26:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i067zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>