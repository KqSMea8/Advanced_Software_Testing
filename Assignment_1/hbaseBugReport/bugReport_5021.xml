<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5021/HBASE-5021.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5021] Enforce upper bound on timestamp</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5021</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We have been getting hit with performance problems on our time-series database due to invalid timestamps being inserted by the timestamp.  We are working on adding proper checks to app server, but production performance could be severely impacted with significant recovery time if something slips past.  Since timestamps are considered a fundamental part of the HBase schema &amp;amp; multiple optimizations use timestamp information, we should allow the option to sanity check the upper bound on the server-side in HBase.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535126">HBASE-5021</key>
            <summary>Enforce upper bound on timestamp</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="nspiegelberg">Nicolas Spiegelberg</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Dec 2011 09:50:48 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:13 +0000</updated>
                            <resolved>Thu, 5 Jan 2012 01:37:56 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13169242" author="nspiegelberg" created="Wed, 14 Dec 2011 09:55:28 +0000"  >&lt;p&gt;Note: my original idea was to allow the user to input a specified timerange to perform min/max checks.  This doesn&apos;t seem to be very useful because the lower bound is already handled by the TTL option.&lt;/p&gt;</comment>
                            <comment id="13169247" author="phabricator@reviews.facebook.net" created="Wed, 14 Dec 2011 10:10:30 +0000"  >&lt;p&gt;nspiegelberg requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  We have been getting hit with performance problems on the ODS&lt;br/&gt;
  side due to invalid timestamps being inserted by the timestamp.  ODS is&lt;br/&gt;
  working on adding proper checks to app server, but production&lt;br/&gt;
  performance could be severely impacted with significant recovery time if&lt;br/&gt;
  something slips past.  Therefore, we should also allow the option to&lt;br/&gt;
  check the upper bound in HBase.&lt;/p&gt;

&lt;p&gt;  This is the first draft.  Probably should allow per-CF customization.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mvn test -Dtest=TestHRegion#testPutWithTsTooNew&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/p&gt;</comment>
                            <comment id="13169813" author="phabricator@reviews.facebook.net" created="Wed, 14 Dec 2011 23:39:30 +0000"  >&lt;p&gt;stack has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  +1&lt;/p&gt;

&lt;p&gt;  One thought though is that rather than default be FOREVER, instead have it be one hour?  If &amp;gt; one hour drift, then I&apos;d think this usually indicative of bad cluster setup and you&apos;ll be thankful of the warning or else you are doing something &apos;odd&apos; so you should change the default config.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169816" author="phabricator@reviews.facebook.net" created="Wed, 14 Dec 2011 23:43:31 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  @stack : looking around, will this be addressed better by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4605&quot; title=&quot;Constraints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4605&quot;&gt;&lt;del&gt;HBASE-4605&lt;/del&gt;&lt;/a&gt; Constraints in 0.94?  Should I just put this in 89-fb and help the constraint review so we have feature parity?  I don&apos;t think you&apos;d want to enable sanity checking by default, since not all use cases use currentTimeMillis() are the timestamp.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169817" author="zhihyu@ebaysf.com" created="Wed, 14 Dec 2011 23:46:37 +0000"  >&lt;p&gt;@Nicolas:&lt;br/&gt;
You&apos;re welcome to comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4605&quot; title=&quot;Constraints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4605&quot;&gt;&lt;del&gt;HBASE-4605&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13169822" author="phabricator@reviews.facebook.net" created="Wed, 14 Dec 2011 23:51:30 +0000"  >&lt;p&gt;stack has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  @Nicolas Or apply this patch as is to trunk and 0.89; user can then use this mechanism or constraints in 0.94.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169856" author="phabricator@reviews.facebook.net" created="Thu, 15 Dec 2011 00:19:30 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  @stack : sounds good.  I kind of thought they were slightly different features myself but thought I&apos;d get outside confirmation.  Timestamp is a specific, explicit optimization of the LSMT algorithm, where Constraints are more implicit, application-specific schema enforcement.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169869" author="phabricator@reviews.facebook.net" created="Thu, 15 Dec 2011 00:25:31 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:1851 Does this operation status code still apply ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169889" author="phabricator@reviews.facebook.net" created="Thu, 15 Dec 2011 00:41:30 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:1851 although from a naming perspective it doesn&apos;t apply, it still applies from a functional perspective.  It was used instead of OperationStatusCode.FAILURE solely for the unit test: TestHRegion#testBatchPut&lt;/p&gt;

&lt;p&gt;  I can refactor to something like BAD_CHECK on commit&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169892" author="phabricator@reviews.facebook.net" created="Thu, 15 Dec 2011 00:45:30 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:1851 That&apos;ll do.&lt;/p&gt;

&lt;p&gt;  Thanks&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169896" author="phabricator@reviews.facebook.net" created="Thu, 15 Dec 2011 00:53:30 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:2147 a) Shouldn&apos;t updateKVTimestamps() get called before checkTimestamps() because it is possible the put contains some HConstants.LATEST_TIMESTAMP kvs-- in which case the intent of the application was to let HBase set the timestamp? We don&apos;t want those kvs to be flagged as being too new.&lt;/p&gt;

&lt;p&gt;  b) Same comment for the batched put case also.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:458 could you add some documentation here covering the units (e.g., milliseconds) and semantics. Some thing like:&lt;/p&gt;

&lt;p&gt;  &amp;lt;&amp;lt;&amp;lt;this param allows HBase to enforce that application cannot insert values that are these many milliseconds into the future with respect to current time&amp;gt;&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;  Also, perhaps the param name could be:&lt;/p&gt;

&lt;p&gt;  hbase.hregion.keyvalue.timestamp.slop.millisecs&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13169912" author="phabricator@reviews.facebook.net" created="Thu, 15 Dec 2011 01:47:30 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  Looks good! A couple of comments inline (based on our offline discussion).&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:458 FOREVER is Integer.MAX_VALUE. Since we are dealing with timestamps and here and not TTLs, should the default for this particular conf option be Long.MAX_VALUE instead?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:404 This should probably be Long.MAX_VALUE.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:2232 Long.MAX_VALUE&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:2230-2231 now -&amp;gt; nowMs or nowMillis?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13172961" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 06:11:30 +0000"  >&lt;p&gt;nspiegelberg updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  Addressed peer review feedback&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/p&gt;</comment>
                            <comment id="13172962" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 06:11:32 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  thanks for all the comments &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:2147 going to default the slop to LATEST_TIMESTAMP, so this problem is no longer a worry.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:2230-2231 now defaults to ms in an unix system.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:404 changing to LATEST_TIMESTAMP, which is Long.MAX_VALUE and also solves the updateKVTimestamps() problem&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173605" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:23:30 +0000"  >&lt;p&gt;nspiegelberg updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  Talked with Kannan about the latest timestamp bug.  My last iteration didn&apos;t fix the original issue.  Fixing &amp;amp; adding it to the unit test&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/p&gt;</comment>
                            <comment id="13173610" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:25:31 +0000"  >&lt;p&gt;Kannan has accepted the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  looks good!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173648" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 00:09:30 +0000"  >&lt;p&gt;nspiegelberg has committed the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHBASE1221532&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHBASE1221532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173656" author="jdcryans" created="Wed, 21 Dec 2011 00:15:44 +0000"  >&lt;p&gt;Nicolas, as this changes some behaviors and adds a configuration option, would you mind adding a release note for this jira? Thanks.&lt;/p&gt;</comment>
                            <comment id="13173691" author="hudson" created="Wed, 21 Dec 2011 00:42:54 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2564 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2564/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2564/&lt;/a&gt;)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
We have been getting hit with performance problems on the ODS&lt;br/&gt;
side due to invalid timestamps being inserted by the timestamp.  ODS is&lt;br/&gt;
working on adding proper checks to app server, but production&lt;br/&gt;
performance could be severely impacted with significant recovery time if&lt;br/&gt;
something slips past.  Therefore, we should also allow the option to&lt;br/&gt;
check the upper bound in HBase.&lt;/p&gt;

&lt;p&gt;This is the first draft.  Probably should allow per-CF customization.&lt;/p&gt;

&lt;p&gt;Test Plan:  - mvn test -Dtest=TestHRegion#testPutWithTsTooNew&lt;/p&gt;

&lt;p&gt;Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;CC: stack, nspiegelberg, tedyu, Kannan, mbautin&lt;/p&gt;

&lt;p&gt;Differential Revision: 849&lt;/p&gt;</comment>
                            <comment id="13173700" author="zhihyu@ebaysf.com" created="Wed, 21 Dec 2011 00:52:44 +0000"  >&lt;p&gt;TestHeapSize fails on Jenkins&lt;/p&gt;</comment>
                            <comment id="13173706" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 00:57:30 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  This adds a new field to HRegion but does not update heap size (FIXED_OVERHEAD). I think the unit test still passes because of alignment, but I noticed this problem with the data block encoding patch applied. Let&apos;s see if TestHeapSize fails on Jenkins.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHBASE1221532&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHBASE1221532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173709" author="zhihyu@ebaysf.com" created="Wed, 21 Dec 2011 01:01:23 +0000"  >&lt;p&gt;TestHeapSize of HBase-TRUNK #2564 on Jenkins failed.&lt;/p&gt;</comment>
                            <comment id="13173827" author="stack" created="Wed, 21 Dec 2011 03:51:17 +0000"  >&lt;p&gt;Small addendum to fix the broke TestHeapSize&lt;/p&gt;</comment>
                            <comment id="13173828" author="stack" created="Wed, 21 Dec 2011 03:52:00 +0000"  >&lt;p&gt;Committed to TRUNK&lt;/p&gt;</comment>
                            <comment id="13173880" author="hudson" created="Wed, 21 Dec 2011 06:00:39 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2565 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2565/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2565/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5021&quot; title=&quot;Enforce upper bound on timestamp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5021&quot;&gt;&lt;del&gt;HBASE-5021&lt;/del&gt;&lt;/a&gt; Enforce upper bound on timestamp&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13174038" author="hudson" created="Wed, 21 Dec 2011 12:21:32 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #39 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/39/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/39/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5021&quot; title=&quot;Enforce upper bound on timestamp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5021&quot;&gt;&lt;del&gt;HBASE-5021&lt;/del&gt;&lt;/a&gt; Enforce upper bound on timestamp&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
We have been getting hit with performance problems on the ODS&lt;br/&gt;
side due to invalid timestamps being inserted by the timestamp.  ODS is&lt;br/&gt;
working on adding proper checks to app server, but production&lt;br/&gt;
performance could be severely impacted with significant recovery time if&lt;br/&gt;
something slips past.  Therefore, we should also allow the option to&lt;br/&gt;
check the upper bound in HBase.&lt;/p&gt;

&lt;p&gt;This is the first draft.  Probably should allow per-CF customization.&lt;/p&gt;

&lt;p&gt;Test Plan:  - mvn test -Dtest=TestHRegion#testPutWithTsTooNew&lt;/p&gt;

&lt;p&gt;Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;CC: stack, nspiegelberg, tedyu, Kannan, mbautin&lt;/p&gt;

&lt;p&gt;Differential Revision: 849&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13174271" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 18:19:30 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase-5021&amp;#93;&lt;/span&gt; Enforce upper bound on timestamp&quot;.&lt;/p&gt;

&lt;p&gt;  Liyin reported that the TestHeapSize didn&apos;t pass in the daily builds.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D849&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHBASE1221532&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHBASE1221532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13180094" author="nspiegelberg" created="Thu, 5 Jan 2012 01:37:56 +0000"  >&lt;p&gt;stack fix the TestHeapSize problem in a subsequent commit.  This JIRA shouldn&apos;t have been reopened.&lt;/p&gt;</comment>
                            <comment id="13454503" author="jdcryans" created="Thu, 13 Sep 2012 00:05:32 +0000"  >&lt;p&gt;Since this commit we don&apos;t report NoSuchColumnFamilyException on multi() calls, I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6769&quot; title=&quot;HRS.multi eats NoSuchColumnFamilyException since HBASE-5021&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6769&quot;&gt;&lt;del&gt;HBASE-6769&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508193" name="5021-addendum.txt" size="594" author="stack" created="Wed, 21 Dec 2011 03:51:17 +0000"/>
                            <attachment id="12507328" name="ASF.LICENSE.NOT.GRANTED--D849.1.patch" size="4732" author="phabricator@reviews.facebook.net" created="Wed, 14 Dec 2011 10:10:30 +0000"/>
                            <attachment id="12508053" name="ASF.LICENSE.NOT.GRANTED--D849.2.patch" size="6688" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 06:11:30 +0000"/>
                            <attachment id="12508150" name="ASF.LICENSE.NOT.GRANTED--D849.3.patch" size="7000" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:23:31 +0000"/>
                            <attachment id="12508159" name="HBASE-5021-trunk.patch" size="12518" author="nspiegelberg" created="Wed, 21 Dec 2011 00:04:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Dec 2011 10:10:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220810</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0162n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>