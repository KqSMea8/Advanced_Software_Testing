<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:45:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7365/HBASE-7365.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7365] Safer table creation and deletion using .tmp dir</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7365</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently tables are created in the root directory, and the removal works on the root directory.&lt;br/&gt;
Change the code to use a /hbase/.tmp directory to make the creation and removal a bit safer&lt;/p&gt;

&lt;p&gt;Table Creation steps&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create the table descriptor (table folder, in /hbase/.tmp/)&lt;/li&gt;
	&lt;li&gt;Create the table regions (always in temp)&lt;/li&gt;
	&lt;li&gt;Move the table from temp to the root folder&lt;/li&gt;
	&lt;li&gt;Add the regions to meta&lt;/li&gt;
	&lt;li&gt;Trigger assignment&lt;/li&gt;
	&lt;li&gt;Set enable flag in ZooKeeper&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Table Deletion steps&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Wait for regions in transition&lt;/li&gt;
	&lt;li&gt;Remove regions from meta (use bulk delete)&lt;/li&gt;
	&lt;li&gt;Move the table in /hbase/.tmp&lt;/li&gt;
	&lt;li&gt;Remove the table from the descriptor cache&lt;/li&gt;
	&lt;li&gt;Remove table from zookeeper&lt;/li&gt;
	&lt;li&gt;Archive the table&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The main changes in the current code are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Writing to /hbase/.tmp and then rename&lt;/li&gt;
	&lt;li&gt;using bulk delete in DeletionTableHandler&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12624210">HBASE-7365</key>
            <summary>Safer table creation and deletion using .tmp dir</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12556488">HBASE-6055</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="mbertozzi">Matteo Bertozzi</reporter>
                        <labels>
                    </labels>
                <created>Sun, 16 Dec 2012 21:37:32 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:24 +0000</updated>
                            <resolved>Wed, 13 Feb 2013 00:06:19 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13533532" author="mbertozzi" created="Sun, 16 Dec 2012 21:39:17 +0000"  >&lt;p&gt;review here: &lt;a href=&quot;https://reviews.apache.org/r/8629/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/8629/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13533540" author="hadoopqa" created="Sun, 16 Dec 2012 22:22:31 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12561212/HBASE-7365-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12561212/HBASE-7365-v0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any additional warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 26 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are zombie tests. See build logs for details.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3567//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13534469" author="stack" created="Tue, 18 Dec 2012 00:44:32 +0000"  >&lt;p&gt;Makes sense doing stuff in .tmp (which mirrors table .tmp and region .tmp).&lt;/p&gt;

&lt;p&gt;In below... the archive tool will be able to make sense of the deleted table?&lt;/p&gt;


&lt;p&gt;+    if (fs.exists(tmpdir)) {&lt;br/&gt;
+      // Archive table in temp, maybe are failed deletion left over,&lt;br/&gt;
+      // if not the cleaner will take care of them.&lt;br/&gt;
+      for (Path tabledir: FSUtils.getTableDirs(fs, tmpdir)) {&lt;br/&gt;
+        for (Path regiondir: FSUtils.getRegionDirs(fs, tabledir)) &lt;/p&gt;
{
+          HFileArchiver.archiveRegion(fs, this.rootdir, tabledir, regiondir);
+        }
&lt;p&gt;+      }&lt;br/&gt;
+      fs.delete(tmpdir, true);&lt;/p&gt;


&lt;p&gt;Do you want to check the returned value on the above delete?&lt;/p&gt;


&lt;p&gt;Why not call checkTempDir rather than do this?&lt;/p&gt;

&lt;p&gt;+    // Ensure temp exists&lt;br/&gt;
+    if (!fs.exists(tempdir) &amp;amp;&amp;amp; !fs.mkdirs(tempdir)) {&lt;br/&gt;
+      throw new IOException(&quot;HBase temp directory &apos;&quot; + tempdir + &quot;&apos; creation failure.&quot;);&lt;/p&gt;


&lt;p&gt;I love it when TODOs get cleaned up...&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// TODO: Currently we make the table descriptor and as side-effect the&lt;/li&gt;
	&lt;li&gt;// tableDir is created.  Should we change below method to be createTable&lt;/li&gt;
	&lt;li&gt;// where we create table in tmp dir with its table descriptor file and then&lt;/li&gt;
	&lt;li&gt;// do rename to move it into place?&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Should we remove the old handleCreateTable now we have your fancy new one?  Or is it still used?&lt;/p&gt;


&lt;p&gt;Patch looks good otherwise Matteo.&lt;/p&gt;</comment>
                            <comment id="13534757" author="mbertozzi" created="Tue, 18 Dec 2012 08:39:42 +0000"  >&lt;blockquote&gt;
&lt;p&gt;In below... the archive tool will be able to make sense of the deleted table?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not sure what you mean here, if is something like &quot;can you move that in the archiver?&quot;&lt;br/&gt;
or is more like &quot;does it works?&quot;&lt;/p&gt;

&lt;p&gt;Basically the archiver just takes the specified region folder in the tabledir and&lt;br/&gt;
move it in the rootdir/.archive (not sure why the fancy 2 path arg for tabledir and regiondir)&lt;br/&gt;
In reality the move is done file by file... but this is another story...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Why not call checkTempDir rather than do this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;checkTempDir() does another job, that is more like initTempDir() that means create or cleaning it if exists.&lt;br/&gt;
In this case we don&apos;t want to clean it. What do you think? keep the code as is? rename the checkTempDir() in initTempDir() and create the checkTempDir() that only creates the directory?&lt;/p&gt;</comment>
                            <comment id="13543353" author="hadoopqa" created="Thu, 3 Jan 2013 22:24:30 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12563152/HBASE-7365-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12563152/HBASE-7365-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestMultiColumnScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.security.access.TestTablePermissions&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestMultiSlaveReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestStoreFileBlockCacheSummary&lt;br/&gt;
                  org.apache.hadoop.hbase.TestMultiVersions&lt;br/&gt;
                  org.apache.hadoop.hbase.security.token.TestZKSecretWatcher&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestLogRollAbort&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.handler.TestOpenRegionHandler&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegionServerBulkLoad&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.handler.TestCloseRegionHandler&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.regionserver.TestReplicationSink&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestPriorityRpc&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestStore&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplicationWithCompression&lt;br/&gt;
                  org.apache.hadoop.hbase.TestFullLogReconstruction&lt;br/&gt;
                  org.apache.hadoop.hbase.security.token.TestTokenAuthentication&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestHLog&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegionOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestClientScannerRPCTimeout&lt;br/&gt;
                  org.apache.hadoop.hbase.trace.TestHTraceHooks&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegionBusyWait&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestClusterId&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestRegionServerNoMaster&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegion&lt;br/&gt;
                  org.apache.hadoop.hbase.TestHBaseTestingUtility&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestParallelPut&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 16 zombie test(s): 	at org.apache.hadoop.hbase.master.TestOpenedRegionHandler.testOpenedRegionHandlerOnMasterRestart(TestOpenedRegionHandler.java:104)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.TestEndToEndSplitTransaction.testFromClientSideWhileSplitting(TestEndToEndSplitTransaction.java:180)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.wal.TestHLogSplit.testEmptyOpenLogFiles(TestHLogSplit.java:435)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3836//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13550672" author="hadoopqa" created="Fri, 11 Jan 2013 01:25:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564298/HBASE-7365-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564298/HBASE-7365-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplicationWithCompression&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3969//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13550818" author="stack" created="Fri, 11 Jan 2013 04:49:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;...more like &quot;does it works?&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It was more the above.  Archiver will be able to deal w/ tables and regions over in tmp dir?  Sounds like it can so I have answer for my question.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What do you think? keep the code as is? rename the checkTempDir() in initTempDir() and create the checkTempDir() that only creates the directory?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What you suggest sounds like some nice clean up.  If it is too much to do, don&apos;t bother (You have enough on your plate at moment).&lt;/p&gt;</comment>
                            <comment id="13550907" author="mbertozzi" created="Fri, 11 Jan 2013 07:13:24 +0000"  >&lt;p&gt;v3 fixes javadoc and lineLength issue&lt;/p&gt;</comment>
                            <comment id="13550924" author="stack" created="Fri, 11 Jan 2013 07:31:35 +0000"  >&lt;p&gt;+1 for trunk.  No harm letting hadoopqa have a go at v3 before commit.&lt;/p&gt;</comment>
                            <comment id="13550973" author="hadoopqa" created="Fri, 11 Jan 2013 08:17:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564368/HBASE-7365-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564368/HBASE-7365-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestLocalHBaseCluster&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.hdfs.server.balancer.TestBalancerWithNodeGroup.testBalancerWithRackLocality(TestBalancerWithNodeGroup.java:220)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3978//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13561276" author="mbertozzi" created="Thu, 24 Jan 2013 00:29:29 +0000"  >&lt;p&gt;admin.deleteTable() relies on the fact that the descriptor removal is the last operation, so moving to the .tmp directory archiving can&apos;t be done at the end.&lt;/p&gt;</comment>
                            <comment id="13571021" author="jmhsieh" created="Tue, 5 Feb 2013 04:13:07 +0000"  >&lt;p&gt;Any idea why this worked in the snapshot branch and why it is now flakey in 2/1/13&apos;s trunk?  (I&apos;m investigating now)&lt;/p&gt;</comment>
                            <comment id="13571068" author="yuzhihong@gmail.com" created="Tue, 5 Feb 2013 05:43:14 +0000"  >&lt;p&gt;Patch v4 is rebased on trunk.&lt;/p&gt;</comment>
                            <comment id="13571070" author="mbertozzi" created="Tue, 5 Feb 2013 05:48:46 +0000"  >&lt;p&gt;I&apos;m -1 on this patch at the moment (at least for the Delete handler), &lt;br/&gt;
as per my previous comment, until we have a proper way to handle async operations we cannot change the handler code. The client heavily relies on implementation assumptions.&lt;/p&gt;</comment>
                            <comment id="13571093" author="hadoopqa" created="Tue, 5 Feb 2013 06:48:09 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12567956/7365-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12567956/7365-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4327//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13571426" author="jmhsieh" created="Tue, 5 Feb 2013 16:22:23 +0000"  >&lt;p&gt;Looked at the code,  Master-side DeleteTableHandler does the following steps:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;wait for related RITs to resolve&lt;/li&gt;
	&lt;li&gt;delete entries from META&lt;/li&gt;
	&lt;li&gt;mv table to /hbase/.tmp&lt;/li&gt;
	&lt;li&gt;archive regions in /hbase/.tmp&lt;/li&gt;
	&lt;li&gt;delete .tmp delete table dir&lt;/li&gt;
	&lt;li&gt;update master table desc cache&lt;/li&gt;
	&lt;li&gt;rm AM&apos;s zk entry (is this always present?).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;HBaseAdmin waits for: &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;table meta entries to be deleted&lt;/li&gt;
	&lt;li&gt;HMaster.getTableDescriptors file to be deleted&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Matteo says the problem seems to be that the HMaster.getTableDescriptors looks at the hdfs and file is &quot;deleted&quot; when move hdfs table data to .tmp.  (Thi sseems to say the table returns as deleted before the .tmp stuff and ZK stuff is cleaned up.&lt;/p&gt;

&lt;p&gt;Look like we could:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;use the same steps but check the .tmp dir for the tableinfo descriptor?  We could add a getDeletingTableDescriptors method (that checks the .tmp delete dir) so the HBaseAdmin can poll and waits until it is gone, or trigger on when the .tmp delete table dir is gone.&lt;/li&gt;
	&lt;li&gt;use the AM&apos;s setDeletedTable/getDeletedTable znode as the last set? (need to look into this more)&lt;/li&gt;
	&lt;li&gt;Move table to temp before deleting from meta?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13571433" author="mbertozzi" created="Tue, 5 Feb 2013 16:34:04 +0000"  >&lt;p&gt;Not sure about the 3rd point? how should that work? the problem is that once you&apos;ve moved to .tmp for the client you&apos;re done, but you&apos;re still archiving files. And there&apos;s a test that relies on the deleteTable() to be sync and check for the files to be archived.&lt;/p&gt;

&lt;p&gt;I prefer the 2nd one because I don&apos;t like adding to another place the fancy double check original + temp only because we have a bad fs layout. Also the client already communicate with zookeeper for other operations (e.g. &lt;del&gt;ROOT&lt;/del&gt;).&lt;/p&gt;</comment>
                            <comment id="13571500" author="yuzhihong@gmail.com" created="Tue, 5 Feb 2013 17:44:02 +0000"  >&lt;p&gt;Option #2 should work, until &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7767&quot; title=&quot;Get rid of ZKTable, and table enable/disable state in ZK &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7767&quot;&gt;&lt;del&gt;HBASE-7767&lt;/del&gt;&lt;/a&gt; gets rid of ZKTable &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13571537" author="mbertozzi" created="Tue, 5 Feb 2013 18:21:00 +0000"  >&lt;p&gt;Ok, a simple workaround is updating the descriptor cache before moving to temp, so the next calls from the client are from the cache and not from disk...&lt;/p&gt;

&lt;p&gt;but since we&apos;re rewriting the RPC, we should include a proper handling for the async operations. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; any ideas?&lt;/p&gt;</comment>
                            <comment id="13571552" author="jmhsieh" created="Tue, 5 Feb 2013 18:30:36 +0000"  >&lt;p&gt;There still is a race where the descriptor cache may get reloaded if between the cache remove and he table rename.  probably need to remove again right afterwards.  I&apos;ll tweak and test for the short term.  I think changing the rpcs to have consistent semantics for async calls is a problem bigger than this guy&apos;s scope currently.&lt;/p&gt;</comment>
                            <comment id="13573025" author="jmhsieh" created="Thu, 7 Feb 2013 00:10:05 +0000"  >&lt;p&gt;So I tried &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;&apos;s approach (cache removal earlier) it it incurs a problem with coprocs &amp;#8211; delete completes before the (expected postdeletetablehandler fires), and the archiver test (files not moved yet)&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.coprocessor.TestMasterObserver.testTableOperations &lt;br/&gt;
org.apache.hadoop.hbase.backup.TestHFileArchiving.testArchiveOnTableDelete &lt;/p&gt;

&lt;p&gt;I think it really boils down to picking which event is the &quot;completion&quot; event.  I&apos;d expect all coprocs to be complete before we return so I think we need to move this event to after the post deletetablehandler coproc call.  I like having the cache invalidation be the event, but it breaks some other snapshot restore/clone tests. &lt;/p&gt;</comment>
                            <comment id="13573498" author="jmhsieh" created="Thu, 7 Feb 2013 14:04:12 +0000"  >&lt;p&gt;In the current implementation the clone call waits until after the newly created table isTableEnabled.  However there is another state (apparently orthogonal) that a newly created table is assumed to be &amp;#8211; isTableAvailable (all regions assigned).  The logic for checking after table creation and after clone creation are slightly different &amp;#8211; creation  does the equivalent of isTableAvailable but clone does not check this availability condition.  &lt;/p&gt;

&lt;p&gt;This causes flaky failures in tests that quickly try to use/delete a newly cloned table.&lt;/p&gt;

&lt;p&gt;TestRestoreSnapshotFromClient#testCloneSnapshot&lt;br/&gt;
TestRestoreFlushSnapshotFromCleitn#testCloneSnapshot&lt;/p&gt;

&lt;p&gt;I believe there also are race conditions because of the postTableCreateHandler corpco and postTableDeleteHandler coproc hooks.&lt;/p&gt;</comment>
                            <comment id="13573514" author="jmhsieh" created="Thu, 7 Feb 2013 14:07:48 +0000"  >&lt;p&gt;I&apos;m going to file the fix to this problem as a new issue.  Since this patch has laned in the snapshot branch and not landed on trunk yet, I&apos;m going to suggest we close this issue as a subissue of the snapshot branch.&lt;/p&gt;</comment>
                            <comment id="13577195" author="jmhsieh" created="Wed, 13 Feb 2013 00:06:19 +0000"  >&lt;p&gt;Moved to be a subissue of hbase-6055 since it is committed there and resolving.&lt;/p&gt;</comment>
                            <comment id="13774940" author="stack" created="Mon, 23 Sep 2013 18:30:24 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12624642">HBASE-7389</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12631263">HBASE-7788</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12567956" name="7365-v4.patch" size="23842" author="yuzhihong@gmail.com" created="Tue, 5 Feb 2013 05:43:14 +0000"/>
                            <attachment id="12561212" name="HBASE-7365-v0.patch" size="21724" author="mbertozzi" created="Sun, 16 Dec 2012 21:38:40 +0000"/>
                            <attachment id="12563152" name="HBASE-7365-v1.patch" size="24879" author="mbertozzi" created="Thu, 3 Jan 2013 20:51:19 +0000"/>
                            <attachment id="12564298" name="HBASE-7365-v2.patch" size="24737" author="mbertozzi" created="Fri, 11 Jan 2013 00:22:24 +0000"/>
                            <attachment id="12564368" name="HBASE-7365-v3.patch" size="24741" author="mbertozzi" created="Fri, 11 Jan 2013 07:13:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 16 Dec 2012 22:22:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>298968</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15xjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242733</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>