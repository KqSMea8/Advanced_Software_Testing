<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3797/HBASE-3797.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3797] StoreFile Level Compaction Locking</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3797</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Multithreaded compactions (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1476&quot; title=&quot;scaling compaction with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1476&quot;&gt;&lt;del&gt;HBASE-1476&lt;/del&gt;&lt;/a&gt;) will solve the problem of major compactions clogging high-priority minor compactions.  However, there is still a problem here.  Since compactions are store-level, the store undergoing major compaction will have it&apos;s storefile count increase during the major.  We really need a way to allow multiple outstanding compactions per store.  compactSelection() should lock/reserve the files being used for compaction.  This will also allow us to know what we&apos;re going to compact when inserting into the CompactSplitThread and make more informed priority queueing decisions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504602">HBASE-3797</key>
            <summary>StoreFile Level Compaction Locking</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="nspiegelberg">Nicolas Spiegelberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Apr 2011 20:59:33 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:49 +0000</updated>
                            <resolved>Tue, 10 May 2011 23:36:30 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13028604" author="nspiegelberg" created="Wed, 4 May 2011 05:00:54 +0000"  >&lt;p&gt;Combined patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3797&quot; title=&quot;StoreFile Level Compaction Locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3797&quot;&gt;&lt;del&gt;HBASE-3797&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1476&quot; title=&quot;scaling compaction with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1476&quot;&gt;&lt;del&gt;HBASE-1476&lt;/del&gt;&lt;/a&gt;.  I did not split them up because &amp;gt;50% of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1476&quot; title=&quot;scaling compaction with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1476&quot;&gt;&lt;del&gt;HBASE-1476&lt;/del&gt;&lt;/a&gt; is refactoring code written for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3797&quot; title=&quot;StoreFile Level Compaction Locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3797&quot;&gt;&lt;del&gt;HBASE-3797&lt;/del&gt;&lt;/a&gt;.  Most of the comments I got internally about &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3797&quot; title=&quot;StoreFile Level Compaction Locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3797&quot;&gt;&lt;del&gt;HBASE-3797&lt;/del&gt;&lt;/a&gt; were pertaining to those deprecated code segments, so I wanted to save myself some grief on the external review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Note that I am having problems creating a Review Board account on review.apache.org, or I would post this up (2000+ line patch).&lt;/p&gt;</comment>
                            <comment id="13028612" author="stack" created="Wed, 4 May 2011 05:12:50 +0000"  >&lt;p&gt;I got &apos;Something broke! (Error 500)&apos; when I tried uploading it.  Will try again in morning and then ask INFRA if it persists.&lt;/p&gt;</comment>
                            <comment id="13028792" author="jiraposter@reviews.apache.org" created="Wed, 4 May 2011 15:50:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/693/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;hbase-3797 StoreFile Level Compaction Locking&lt;/p&gt;

&lt;p&gt;I posted this here for nicolas&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-3797.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-3797&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-3797&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 24450ae &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/CompactionRequestor.java fdbf659 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 11fd50e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b910254 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/MemStoreFlusher.java f66a7cd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/PriorityCompactionQueue.java 13bcb3f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java e2295c2 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java 98f962b &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/RegionServerMetrics.java 345e393 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java 6517ba7 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestPriorityCompactionQueue.java c5d876d &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestStore.java adfe1f8 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/693/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Michael&lt;/p&gt;
</comment>
                            <comment id="13028824" author="jiraposter@reviews.apache.org" created="Wed, 4 May 2011 17:02:03 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/693/#review646&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#review646&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This looks great.  Some comments in below.  Have you tried it Nicolas?  Does it work for you?  I&apos;m game for getting this into TRUNK sooner rather than earlier but was thinking the default settings conservative.  Should we have at least one small compactions thread running (Default is zero).&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1293&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1293&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Funny. What you doing at walmart?  Oh yeah, you are from the south!&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/CompactionRequestor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1294&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1294&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Deprecate this in favor of the new API?  Or just remove this one since its an internal-only API?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStoreFlusher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1304&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1304&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How we ensure a compaction and split of same region do not clash?  Or is that not a prob. in this redo?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1300&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1300&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing license&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1301&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1301&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this good name for this?  Would &apos;Split&apos; be a better name?  Or &apos;Splitter&apos;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1302&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1302&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you pass this on construction?  Seems like something that should not be changed post-creation&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1303&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1303&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is a nice refactoring.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1299&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1299&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Did we remove this.  Is it not needed any more?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1296&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1296&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The class comment is off now, is that right?  Now it does more than hold the details.  Now it actually runs the compaction? If so, should we rename the class?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1297&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1297&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You have white space throughout your patch.  No biggie but you might want to fix on commit.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1298&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1298&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do we check that the files that make up the compaction are still around when we go to run?  Is it possible they might have changed between queu&apos;ing and running?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/metrics/RegionServerMetrics.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/693/#comment1295&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/#comment1295&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-04 15:48:58, Michael Stack wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/693/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-04 15:48:58)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;hbase-3797 StoreFile Level Compaction Locking&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I posted this here for nicolas&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug hbase-3797.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-3797&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-3797&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 24450ae &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/CompactionRequestor.java fdbf659 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 11fd50e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b910254 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStoreFlusher.java f66a7cd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/PriorityCompactionQueue.java 13bcb3f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java e2295c2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java 98f962b &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/metrics/RegionServerMetrics.java 345e393 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java 6517ba7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestPriorityCompactionQueue.java c5d876d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestStore.java adfe1f8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/693/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/693/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13029076" author="nspiegelberg" created="Thu, 5 May 2011 00:58:02 +0000"  >&lt;p&gt;@Stack: review board comments.  Note that this is being used in our 0.89 branch, but the 0.90 port hasn&apos;t had any cluster testing, just unit testing.  The main differences were: (1) coprocessors, (2) have to pass the server to CompactRequest/SplitRequest classes, &amp;amp; (3) Split code has changed.  All 3 differences were pretty trivial, so it should work out of the box and we plan to use it for our 0.90 build as well.&lt;/p&gt;

&lt;p&gt;I wanted to keep the defaults the same as the old algorithm, but I certainly agree that we should think of some reasonable default for the throttle size and default to 1 large + 1 small compaction.  It&apos;s just that our use case has 10GB StoreFiles, and I don&apos;t think that&apos;s normal.  Maybe after some auto-split workload uses/tunes this feature?  Also, note that 2 compactions/server means that up to 6 hard disks/server could be busy handling compactions, so there&apos;s diminished benefits on increasing the number of compaction threads past your HD/server count.  However, throttle partitioning will probably always be useful for congestion scenarios even if HD/server is low.&lt;/p&gt;

&lt;p&gt;CompactionRequestor.java#34 : we can remove the Region-level compaction API; but user-requested compactions and unit tests still use it for simplicity, so I was going to limit my refactoring.&lt;/p&gt;

&lt;p&gt;MemStoreFlusher.java#257 : Concurrent Splits &amp;amp; Compactions are fine.  The first thing a split request does is region.close().  This waits for region.writestate.compacting == 0, or all the compactions to finish.  Additionally, compactions prematurely interrupt on a  close request, so the split won&apos;t be stalled for long.&lt;/p&gt;

&lt;p&gt;SplitRequest.java#34 : The whole setServer() stuff was hacked together &lt;span class=&quot;error&quot;&gt;&amp;#91;you can call region.getHRegionServer() in 0.89&amp;#93;&lt;/span&gt;.  I tried to be consistent with CompactionRequest, but constructor is fine as well.&lt;/p&gt;

&lt;p&gt;Store.java#632 : Note that the old store.compact() code was moved to store.requestCompaction().&lt;/p&gt;

&lt;p&gt;CompactionRequest.java#48 : Feel free to change the comments for the class header.  You don&apos;t technically have to call CompactionRequest.run() to execute a compaction &lt;span class=&quot;error&quot;&gt;&amp;#91;see HRegion.compactStores()&amp;#93;&lt;/span&gt;; however you do need a CompactionRequest object for the Store to get the details about a compaction.&lt;/p&gt;

&lt;p&gt;CompactionRequest.java#177 : The Store.filesCompacting variable and associated locking ensures that 2 compactions for the same Store will not have overlapping StoreFiles.  See the Collections.disjoint() check at Store.java#881. Currently, a user can independently add StoreFiles &lt;span class=&quot;error&quot;&gt;&amp;#91;e.g. bulk import&amp;#93;&lt;/span&gt;, but not remove StoreFiles.  We would have to check some code here if the user was allowed to arbitrarily remove StoreFiles outside of a custom compaction algorithm.&lt;/p&gt;</comment>
                            <comment id="13029528" author="stack" created="Thu, 5 May 2011 19:38:09 +0000"  >&lt;p&gt;@N&lt;/p&gt;

&lt;p&gt;That sounds like some good testing done already.  Agree should be good for TRUNK.  Yeah, on commit, lets change default. I&apos;m ok if its sub-optimal on commit and we tune it later rather than other way around because then folks will notice that this fancy new stuff exists.&lt;/p&gt;

&lt;p&gt;CompactionRequestor.java#34: I&apos;m ok on limiting refactoring.&lt;/p&gt;

&lt;p&gt;Would suggest you remove setServer method for SplitRequest.java#34 on commit.&lt;/p&gt;

&lt;p&gt;I&apos;m good on the rest.  You want to make a new patch or you just want me to commit this (with amendments above)?&lt;/p&gt;


</comment>
                            <comment id="13031472" author="nspiegelberg" created="Tue, 10 May 2011 23:36:30 +0000"  >&lt;p&gt;Added with Stack&apos;s requests.  Compaction throttling is turned off by default.  I agree that it should be enabled by default, but decided to save that for another JIRA so we can discuss how we arrive at the default.&lt;/p&gt;</comment>
                            <comment id="15017353" author="lars_francke" created="Fri, 20 Nov 2015 12:42:49 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12504599">HBASE-3796</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12505880">HBASE-3842</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12426953">HBASE-1476</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12478124" name="HBASE-3797+1476.patch" size="82581" author="nspiegelberg" created="Wed, 4 May 2011 05:00:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 May 2011 05:12:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33212</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hnxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101139</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>