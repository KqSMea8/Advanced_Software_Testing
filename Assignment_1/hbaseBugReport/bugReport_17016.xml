<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:20:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-17016/HBASE-17016.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-17016] Reimplement per-region latency histogram metrics</title>
                <link>https://issues.apache.org/jira/browse/HBASE-17016</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Follow up from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10656&quot; title=&quot; high-scale-lib&amp;#39;s Counter depends on Oracle (Sun) JRE, and also has some bug&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10656&quot;&gt;&lt;del&gt;HBASE-10656&lt;/del&gt;&lt;/a&gt;, where &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;the main problem is that we have A LOT of per-region metrics that are latency histograms. These latency histograms create many many Counter / LongAdder objects. We should get rid of per-region latencies and maybe look at reducing the per-region metric overhead.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt; gives us a good candidate to implement pre-region latency histograms &lt;a href=&quot;https://github.com/HdrHistogram/HdrHistogram&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HdrHistogram&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let&apos;s consider removing the per-region latency histograms and reimplement using HdrHistogram.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13017778">HBASE-17016</key>
            <summary>Reimplement per-region latency histogram metrics</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2016 18:29:48 +0000</created>
                <updated>Sat, 5 Nov 2016 00:07:33 +0000</updated>
                                            <version>2.0.0</version>
                    <version>1.4.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                            <comments>
                            <comment id="15634364" author="ghelmling" created="Thu, 3 Nov 2016 21:32:34 +0000"  >&lt;p&gt;We could also look at moving to HdrHistogram for all of our histogram usage.  That would eliminate the tons of Counter instances we generate and outperformed our FastLongHistogram in my testing.&lt;/p&gt;</comment>
                            <comment id="15634425" author="apurtell" created="Thu, 3 Nov 2016 21:59:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;We could also look at moving to HdrHistogram for all of our histogram usage.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Really fine grained latency histograms would be nice to have, if cheap enough. &lt;/p&gt;

&lt;p&gt;Otherwise, external monitoring based on the Canary can still achieve this, at cost/benefit of rolling whatever you need.&lt;/p&gt;

&lt;p&gt;So remove now, then &lt;em&gt;maybe&lt;/em&gt; put back reimplemented with HdirHistogram, if workable?&lt;/p&gt;</comment>
                            <comment id="15634512" author="enis" created="Thu, 3 Nov 2016 22:25:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;So remove now, then maybe put back reimplemented with HdirHistogram, if workable?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sounds like a good plan. &lt;/p&gt;</comment>
                            <comment id="15634858" author="apache9" created="Fri, 4 Nov 2016 01:16:06 +0000"  >&lt;p&gt;So let&apos;s change the title to &quot;Reimplement per-region latency histogram metrics&quot;, and the first sub task is remove the current implementation, and also create other sub tasks to reimplement it with HdrHistogram?&lt;/p&gt;</comment>
                            <comment id="15634867" author="apurtell" created="Fri, 4 Nov 2016 01:21:31 +0000"  >&lt;p&gt;Sounds good, please go ahead and do that.&lt;/p&gt;</comment>
                            <comment id="15634926" author="apache9" created="Fri, 4 Nov 2016 01:53:32 +0000"  >&lt;p&gt;Done.&lt;/p&gt;</comment>
                            <comment id="15637793" author="mantonov" created="Fri, 4 Nov 2016 21:44:42 +0000"  >&lt;p&gt;I think in practice latency outliers are way more often used per server level than per region level (unlike request rate)? Would be fine to remove/replace I think.&lt;/p&gt;</comment>
                            <comment id="15637975" author="enis" created="Fri, 4 Nov 2016 22:58:13 +0000"  >&lt;p&gt;Attached a patch to subtask. Mikhail, are you saying that we should close this as won&apos;t fix after the subtask? I think it should be fine. &lt;/p&gt;</comment>
                            <comment id="15638102" author="mantonov" created="Fri, 4 Nov 2016 23:55:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; not necessary close as won&apos;t fix; I meant to say that I think the unit of request rate outliers is often a single hot region; the unit of latency outlier is mostly (almost always?) RS - GC stall, WAL append failed due to dfsclient hitting error, that kind of thing, that makes latency per region not super useful imo. If we remove them and see any improvement in terms of &quot;less latency outliers since less Counters etc&quot; - great, less remove them. If we can bring them back, and they are cheap - sure, why not. If we find out that any latency histograms are relatively expensive (in some visible form) I&apos;d be in favor or removing them, unless someone has the usecase when they are actually useful.&lt;/p&gt;</comment>
                            <comment id="15638127" author="enis" created="Sat, 5 Nov 2016 00:04:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we can bring them back, and they are cheap - sure, why not.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fair enough. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we find out that any latency histograms are relatively expensive (in some visible form) I&apos;d be in favor or removing them, unless someone has the usecase when they are actually useful.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the findings at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17017&quot; title=&quot;Remove the current per-region latency histogram metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17017&quot;&gt;&lt;del&gt;HBASE-17017&lt;/del&gt;&lt;/a&gt; justifies the removal, other than object allocation, there is 17% perf boost with basic testing. We can only bring them back if we do the same test with a new patch and there is no impact for the same test (both object allocation, and perf impact).  &lt;/p&gt;</comment>
                            <comment id="15638133" author="mantonov" created="Sat, 5 Nov 2016 00:07:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; yeah, +1 to that approach.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13017899">HBASE-17017</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Nov 2016 21:32:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35tn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>