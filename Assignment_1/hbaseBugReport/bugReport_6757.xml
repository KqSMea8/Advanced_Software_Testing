<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6757/HBASE-6757.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6757] Very inefficient behaviour of scan using FilterList</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6757</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The behaviour of scan is very inefficient when using with FilterList.&lt;/p&gt;

&lt;p&gt;The FilterList rewrites the return code from NEXT_ROW to SKIP from a filter if Operator.MUST_PASS_ALL is used. &lt;/p&gt;

&lt;p&gt;This happens when using ColumnPrefixFilter. Even though the ColumnPrefixFilter indicates to jump to NEXT_ROW because no further match can be found, the scan continues to scan all versions of a column in that row and all columns of that row because the ReturnCode from ColumnPrefixFilter has been rewritten by the FilterList from NEXT_ROW to SKIP. &lt;/p&gt;

&lt;p&gt;This is particularly inefficient when there are many versions in a column because the check is performed on all versions of the column instead of just by checking the qualifier of the column name.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607071">HBASE-6757</key>
            <summary>Very inefficient behaviour of scan using FilterList</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="jerrylam">Jerry Lam</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Sep 2012 14:42:24 +0000</created>
                <updated>Sun, 7 Apr 2013 04:58:38 +0000</updated>
                            <resolved>Wed, 12 Sep 2012 04:06:01 +0000</resolved>
                                    <version>0.90.6</version>
                                    <fixVersion>0.94.2</fixVersion>
                                    <component>Filters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13453068" author="lhofhansl" created="Tue, 11 Sep 2012 14:45:49 +0000"  >&lt;p&gt;Interesting. I just looked at the code and I agree this is wrong.&lt;/p&gt;</comment>
                            <comment id="13453072" author="jerrylam" created="Tue, 11 Sep 2012 14:50:00 +0000"  >&lt;p&gt;The TestColumnPrefixFilter demonstrates the inefficiency of the scan by using DisplayFilter which logs all the calls to the filter&apos;s methods. &lt;/p&gt;


&lt;p&gt;testEfficiencyWithoutFliterList only scans 3 keyvalues and return. Whereas, testEfficiencyWithFliterList scans 10002 keyvalues. The only difference between the two tests is that testEfficiencyWithFliterList uses FilterList to wrap the ColumnPrefixFilter and the filterlist is passed to the scan instead of the ColumnPrefixFilter.&lt;/p&gt;

&lt;p&gt;For this to work, DisplayFilter needs to be deployed to hbase first. The log is written to the HMaster log.&lt;/p&gt;</comment>
                            <comment id="13453077" author="lhofhansl" created="Tue, 11 Sep 2012 14:54:52 +0000"  >&lt;p&gt;There are more inefficiencies in there too. For example for MUST_PASS_ONE, we can break the outer loop as soon as we find one filter indicating INCLUDE.&lt;/p&gt;</comment>
                            <comment id="13453094" author="lhofhansl" created="Tue, 11 Sep 2012 15:19:48 +0000"  >&lt;p&gt;Super simple fix.&lt;br/&gt;
There might be more to it (like the consideration to give each filter a chance to look at each KV), but I think this patch should be OK.&lt;/p&gt;</comment>
                            <comment id="13453104" author="jerrylam" created="Tue, 11 Sep 2012 15:28:51 +0000"  >&lt;p&gt;Hi Lars:&lt;/p&gt;

&lt;p&gt;Thanks for looking into it!&lt;br/&gt;
I have a little concern, not about the change but the existing code that depends on the SKIP return code. There might be some users that have a complex FilterList (A filterlist of a filterlist of a filterlist, etc) that might depends on the SKIP behaviour. The users might not aware of it. What do you think?&lt;/p&gt;</comment>
                            <comment id="13453138" author="lhofhansl" created="Tue, 11 Sep 2012 16:05:02 +0000"  >&lt;p&gt;As long as FilterList does the right thing it should be transparent, right?&lt;br/&gt;
Now, if somebody wrote their own filter that wraps a FilterList, then the behavior might be changed slightly. Then again, there FilterList.filterKeyValue can already return other codes (NEXT_COL, SEEK_NEXT_USING_HINT, etc), which the wrapper would have to deal with.&lt;/p&gt;

&lt;p&gt;So I think the change is fine. I&apos;ll let some of my fellow committers comment on this too.&lt;/p&gt;</comment>
                            <comment id="13453142" author="yuzhihong@gmail.com" created="Tue, 11 Sep 2012 16:10:38 +0000"  >&lt;p&gt;I think Jerry has a point.&lt;br/&gt;
The fix should be fine for 0.96&lt;/p&gt;

&lt;p&gt;For 0.94, we should take cautionary stance.&lt;/p&gt;</comment>
                            <comment id="13453160" author="lhofhansl" created="Tue, 11 Sep 2012 16:33:51 +0000"  >&lt;p&gt;The case Jerry mentions is not a problem. &quot;A filterlist of a filterlist of a filterlist, etc&quot; will work fine.&lt;/p&gt;

&lt;p&gt;Also see this code FilterList.filterKeyValue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; == Operator.MUST_PASS_ALL) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (filter.filterAllRemaining()) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ReturnCode.NEXT_ROW;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it is already possible now that FilterList.filterKeyValue return NEXT_ROW and hence calling code must deal with it.&lt;/p&gt;

&lt;p&gt;Definitely fine for 0.96, but I&apos;m cool with this in 0.94 as well.&lt;/p&gt;</comment>
                            <comment id="13453202" author="lhofhansl" created="Tue, 11 Sep 2012 17:28:07 +0000"  >&lt;p&gt;Let me target 0.94.2 for now.&lt;br/&gt;
Simple fix, low risk (see discussion above), performance fix.&lt;/p&gt;

&lt;p&gt;Ted, if you feel strongly about this, I&apos;ll of course remove the 0.94 tag.&lt;/p&gt;</comment>
                            <comment id="13453203" author="apurtell" created="Tue, 11 Sep 2012 17:31:37 +0000"  >&lt;p&gt;+1 for 0.94 as well. The current behavior is wrong. &lt;/p&gt;</comment>
                            <comment id="13453205" author="yuzhihong@gmail.com" created="Tue, 11 Sep 2012 17:33:31 +0000"  >&lt;p&gt;Then this JIRA should be a bug.&lt;/p&gt;</comment>
                            <comment id="13453209" author="apurtell" created="Tue, 11 Sep 2012 17:36:03 +0000"  >&lt;p&gt;@Ted, so then update the jira metadata if you&apos;d like. And per recent discussion on the dev list, I believe the the consensus is the conservative approach is appropriate for 0.92 and earlier, FYI. &lt;/p&gt;</comment>
                            <comment id="13453231" author="lhofhansl" created="Tue, 11 Sep 2012 17:54:22 +0000"  >&lt;p&gt;Generally I am find with Improvements and even (targeted, small) New Features in 0.94, simply because 0.96 will be a while before it can be considered stable.&lt;br/&gt;
0.92 is different, since it is a maintenance release and there is a clean, safe upgrade path to 0.94 (well at least when &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6710&quot; title=&quot;0.92/0.94 compatibility issues due to HBASE-5206&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6710&quot;&gt;&lt;del&gt;HBASE-6710&lt;/del&gt;&lt;/a&gt; is in).&lt;/p&gt;</comment>
                            <comment id="13453232" author="lhofhansl" created="Tue, 11 Sep 2012 17:55:02 +0000"  >&lt;p&gt;But Ted&apos;s right, this should be considered a bug.&lt;/p&gt;</comment>
                            <comment id="13453676" author="hadoopqa" created="Wed, 12 Sep 2012 03:39:36 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12544647/6757.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12544647/6757.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause mvn compile goal to fail.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2849//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2849//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2849//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2849//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13453681" author="lhofhansl" created="Wed, 12 Sep 2012 04:06:01 +0000"  >&lt;p&gt;Committed to 0.94 and 0.96&lt;/p&gt;</comment>
                            <comment id="13453707" author="hudson" created="Wed, 12 Sep 2012 04:49:42 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3321 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3321/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3321/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6757&quot; title=&quot;Very inefficient behaviour of scan using FilterList&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6757&quot;&gt;&lt;del&gt;HBASE-6757&lt;/del&gt;&lt;/a&gt; Very inefficient behaviour of scan using FilterList (Revision 1383748)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/filter/FilterList.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13453710" author="hudson" created="Wed, 12 Sep 2012 04:57:16 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #463 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/463/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/463/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6757&quot; title=&quot;Very inefficient behaviour of scan using FilterList&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6757&quot;&gt;&lt;del&gt;HBASE-6757&lt;/del&gt;&lt;/a&gt; Very inefficient behaviour of scan using FilterList (Revision 1383749)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/filter/FilterList.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13453918" author="hudson" created="Wed, 12 Sep 2012 11:45:40 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #169 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/169/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/169/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6757&quot; title=&quot;Very inefficient behaviour of scan using FilterList&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6757&quot;&gt;&lt;del&gt;HBASE-6757&lt;/del&gt;&lt;/a&gt; Very inefficient behaviour of scan using FilterList (Revision 1383748)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/filter/FilterList.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13455034" author="hudson" created="Thu, 13 Sep 2012 17:28:09 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #52 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/52/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/52/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6757&quot; title=&quot;Very inefficient behaviour of scan using FilterList&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6757&quot;&gt;&lt;del&gt;HBASE-6757&lt;/del&gt;&lt;/a&gt; Very inefficient behaviour of scan using FilterList (Revision 1383749)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/filter/FilterList.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13469906" author="hudson" created="Fri, 5 Oct 2012 00:37:48 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #8 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/8/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/8/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6757&quot; title=&quot;Very inefficient behaviour of scan using FilterList&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6757&quot;&gt;&lt;del&gt;HBASE-6757&lt;/del&gt;&lt;/a&gt; Very inefficient behaviour of scan using FilterList (Revision 1383749)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/filter/FilterList.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13624684" author="stack" created="Sun, 7 Apr 2013 04:58:38 +0000"  >&lt;p&gt;Fix up after bulk move overwrote some 0.94.2 fix versions w/ 0.95.0 (Noticed by Lars Hofhansl)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544647" name="6757.txt" size="560" author="lhofhansl" created="Tue, 11 Sep 2012 15:19:48 +0000"/>
                            <attachment id="12544644" name="CopyOfTestColumnPrefixFilter.java" size="3460" author="jerrylam" created="Tue, 11 Sep 2012 14:50:00 +0000"/>
                            <attachment id="12544645" name="DisplayFilter.java" size="2746" author="jerrylam" created="Tue, 11 Sep 2012 14:50:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Sep 2012 14:45:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02hr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>