<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:57:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14889/HBASE-14889.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14889] Region stuck in transition in OPEN state indefinitely in corner scenario</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14889</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;During a failure scenario when a RS dies and the bulk assigner(BA) is assigning its regions to others RSs, if another RS dies(on which some regions are being moved) on which region is in pending open state, we end up in a situation where two bulk assigners try to assign the same region on the Same RS.&lt;/p&gt;

&lt;p&gt;The following happened - &lt;br/&gt;
1. While one BA was opening the region the second one sees it in pending open state, retries and calls unassign(...) thereby sending CLOSE RPC to the RS.&lt;br/&gt;
2. The RS meanwhile has already opened the region, hence changing the znode state to RS_ZK_REGION_OPENED which triggers event on master.&lt;br/&gt;
3. On master after the unassign is successful we go on to deleting the znode, change region state to Pending open and send open RPC to RS.&lt;br/&gt;
4. The earlier triggered event now sees the state as Pending open and happily changes it to OPEN, but is unable to delete the znode which by this time is not in RS_ZK_REGION_OPENED state but is in M_ZK_REGION_OFFLINE state. Hence the region remains in transition in the OPEN state.&lt;br/&gt;
5. RS goes on to changing the znode states and successfully opens the region (changes znode state to RS_ZK_REGION_OPENED)&lt;br/&gt;
6. This again triggers event on master but this time since the state is OPEN the folloing code path is taken &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;case RS_ZK_REGION_OPENED:
          // Should see OPENED after OPENING but possible after PENDING_OPEN.
          if (regionState == null
              || !regionState.isPendingOpenOrOpeningOnServer(sn)) {
            LOG.warn(&quot;Received OPENED for &quot; + prettyPrintedRegionName
              + &quot; from &quot; + sn + &quot; but the region isn&apos;t PENDING_OPEN/OPENING here: &quot;
              + regionStates.getRegionState(encodedName));

            if (regionState != null) {
              // Close it without updating the internal region states,
              // so as not to create double assignments in unlucky scenarios
              // mentioned in OpenRegionHandler#process
              unassign(regionState.getRegion(), null, -1, null, false, sn);
            }
            return;
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We call unassign here with transitionInZK=false and state=null&lt;br/&gt;
7. RS closes the region but doesn&apos;t update the ZK, also state is not changed in master. Region remains in transition in OPEN state, when its actually closed. We have to restart the RS post which it opens correctly on some other RS.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12916371">HBASE-14889</key>
            <summary>Region stuck in transition in OPEN state indefinitely in corner scenario</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="pankaj2461">Pankaj Kumar</assignee>
                                    <reporter username="abhishek.chouhan">Abhishek Singh Chouhan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Nov 2015 07:31:28 +0000</created>
                <updated>Wed, 7 Sep 2016 09:42:19 +0000</updated>
                                            <version>0.98.14</version>
                    <version>1.0.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="15028351" author="pankaj2461" created="Thu, 26 Nov 2015 08:18:30 +0000"  >&lt;p&gt;Yes, this issue is there in the HBase with ZK assignment.&lt;/p&gt;</comment>
                            <comment id="15028356" author="pankaj2461" created="Thu, 26 Nov 2015 08:23:56 +0000"  >&lt;p&gt;Are you planning to give a patch? &lt;/p&gt;</comment>
                            <comment id="15028512" author="abhishek.chouhan" created="Thu, 26 Nov 2015 10:32:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pankaj2461&quot; class=&quot;user-hover&quot; rel=&quot;pankaj2461&quot;&gt;Pankaj Kumar&lt;/a&gt; Not at the moment. Feel free to take this up if you want.&lt;/p&gt;</comment>
                            <comment id="15028520" author="pankaj2461" created="Thu, 26 Nov 2015 10:37:47 +0000"  >&lt;p&gt;Thanks  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.chouhan&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.chouhan&quot;&gt;Abhishek Singh Chouhan&lt;/a&gt;, I have already fixed this issue in our version, will provide a patch once thorough testing is over.&lt;/p&gt;</comment>
                            <comment id="15089473" author="syuanjiang" created="Fri, 8 Jan 2016 16:38:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pankaj2461&quot; class=&quot;user-hover&quot; rel=&quot;pankaj2461&quot;&gt;Pankaj Kumar&lt;/a&gt;, how is your testing on the patch? Could you post the patch here so that we can make progress?&lt;/p&gt;</comment>
                            <comment id="15470155" author="abhishek.chouhan" created="Wed, 7 Sep 2016 09:42:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pankaj2461&quot; class=&quot;user-hover&quot; rel=&quot;pankaj2461&quot;&gt;Pankaj Kumar&lt;/a&gt; Any updates on this?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Nov 2015 08:18:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2oyrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>