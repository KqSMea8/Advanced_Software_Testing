<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:48:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7723/HBASE-7723.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7723] Remove NameNode URI from ZK splitlogs</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7723</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When moving to HDFS HA or removing HA we end up changing the NN namespace.  This can cause the HMaster not to start up fully due to trying to split phantom HLogs pointing to the wrong FS - java.lang.IllegalArgumentException: Wrong FS: error messages.  The HLogs in question might not even be on HDFS anymore.  You have to go in a manually clear out the ZK splitlogs directory to get HBase to properly boot up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12630035">HBASE-7723</key>
            <summary>Remove NameNode URI from ZK splitlogs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="v.himanshu">Himanshu Vashishtha</assignee>
                                    <reporter username="kevin.odell">Kevin Odell</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2013 23:45:06 +0000</created>
                <updated>Sat, 23 Mar 2013 04:53:24 +0000</updated>
                            <resolved>Mon, 4 Mar 2013 21:43:17 +0000</resolved>
                                    <version>0.94.6</version>
                    <version>0.95.0</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.6</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>hadoop2</component>
                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                <comments>
                            <comment id="13568091" author="v.himanshu" created="Thu, 31 Jan 2013 20:51:58 +0000"  >&lt;p&gt;a patch which removes storing the NN uri in split log znodes. It keeps the .logs znode while creating the znode in the SplitLogManager, and SplitLogWorker re-creates the path using the hbase.rootdir to the actual log. &lt;/p&gt;</comment>
                            <comment id="13568097" author="v.himanshu" created="Thu, 31 Jan 2013 21:04:53 +0000"  >&lt;p&gt;I tested this with a clean zk slate. This is so because it removes the NN uri, otherwise, old znodes will point to non-existent log files. If this approaches sounds good, I will do a similar change for replication znodes handling too.&lt;/p&gt;</comment>
                            <comment id="13568114" author="jxiang" created="Thu, 31 Jan 2013 21:19:25 +0000"  >&lt;p&gt;How do you handle compatibility/migration issue?&lt;/p&gt;</comment>
                            <comment id="13568121" author="yuzhihong@gmail.com" created="Thu, 31 Jan 2013 21:24:12 +0000"  >&lt;p&gt;I got the following test failure:&lt;/p&gt;

&lt;p&gt;testDelayedDeleteOnFailure(org.apache.hadoop.hbase.master.TestDistributedLogSplitting)  Time elapsed: 25.702 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
java.util.concurrent.ExecutionException: java.lang.StringIndexOutOfBoundsException: String index out of range: -1&lt;br/&gt;
  at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:232)&lt;br/&gt;
  at java.util.concurrent.FutureTask.get(FutureTask.java:91)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.TestDistributedLogSplitting.testDelayedDeleteOnFailure(TestDistributedLogSplitting.java:316)&lt;br/&gt;
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
  at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
  at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)&lt;br/&gt;
  at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
  at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)&lt;br/&gt;
  at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
  at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:62)&lt;br/&gt;
Caused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -1&lt;br/&gt;
  at java.lang.String.substring(String.java:1931)&lt;br/&gt;
  at java.lang.String.substring(String.java:1904)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.SplitLogManager.splitLogDistributed(SplitLogManager.java:260)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.SplitLogManager.splitLogDistributed(SplitLogManager.java:228)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.TestDistributedLogSplitting$2.run(TestDistributedLogSplitting.java:297)&lt;/p&gt;</comment>
                            <comment id="13568135" author="yuzhihong@gmail.com" created="Thu, 31 Jan 2013 21:38:00 +0000"  >&lt;p&gt;Here is another failure:&lt;/p&gt;

&lt;p&gt;testVanishingTaskZNode(org.apache.hadoop.hbase.master.TestSplitLogManager)  Time elapsed: 15.048 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
  at org.junit.Assert.fail(Assert.java:92)&lt;br/&gt;
  at org.junit.Assert.assertTrue(Assert.java:43)&lt;br/&gt;
  at org.junit.Assert.assertTrue(Assert.java:54)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.TestSplitLogManager.waitForCounter(TestSplitLogManager.java:154)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.TestSplitLogManager.waitForCounter(TestSplitLogManager.java:134)&lt;br/&gt;
  at org.apache.hadoop.hbase.master.TestSplitLogManager.testVanishingTaskZNode(TestSplitLogManager.java:474)&lt;/p&gt;</comment>
                            <comment id="13568221" author="mbertozzi" created="Thu, 31 Jan 2013 23:06:14 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; indexOfLogsDir = lf.getPath().toString().indexOf(HConstants.HREGION_LOGDIR_NAME)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I bet this will not work in the tests, where there&apos;s no .logs directory but just a /test/abcdef-test-root-dir, also I can immagine strange cases where the server name is called something like srv.logs.something.xyz and similar...&lt;/p&gt;

&lt;p&gt;something like new Path(FSUtils.getRootDir(conf), HConstants.HREGION_LOGDIR_NAME) maybe is better (even if some test can fail, since everyone can specify a path but not set a rootdir)&lt;/p&gt;

&lt;p&gt;other ideas?&lt;/p&gt;</comment>
                            <comment id="13568306" author="v.himanshu" created="Fri, 1 Feb 2013 00:47:56 +0000"  >&lt;p&gt;Yea, that&apos;s the reason why the above tests failed. I am thinking to do:&lt;br/&gt;
a) In SplitLogManager, while inserting the tasks, chomp off the hbase.rootDir prefix from the filename. This will make the path relative from the .logs dir (or whatever the user has used). Use this for the znodes.&lt;/p&gt;

&lt;p&gt;b) For the SplitLogWorkers: Either make the condition to clear out the existing znodes a necessary condition. This way, we don&apos;t have to worry about old znodes with NN URI. Or, re-create splitlog znode when a master becomes active (recursively delete the znode). This might interrupt with the regionservers doing currently the DLS as the task znode is no longer there. But then, the MasterFileSystem.splitLog() will make sure to re-enque the tasks.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13568326" author="yuzhihong@gmail.com" created="Fri, 1 Feb 2013 01:06:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;Either make the condition to clear out the existing znodes a necessary condition.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Which condition is this ? Please be a little more specific.&lt;/p&gt;</comment>
                            <comment id="13568349" author="v.himanshu" created="Fri, 1 Feb 2013 01:29:06 +0000"  >&lt;p&gt;Sorry if I was not clear enough Ted. &lt;br/&gt;
I meant in order to use this feature, either we should clear out the existing znodes under the splitlog znode manually, or, do it in the code. &lt;br/&gt;
Basically, reading an old task znode (hdfs://&amp;lt;server&amp;gt;:&amp;lt;port&amp;gt;/&amp;lt;hbase&amp;gt;/.logs/blah) is not possible if NN is changed. We would like to remove the URI but it gets tricky/messy. &lt;/p&gt;</comment>
                            <comment id="13568392" author="yuzhihong@gmail.com" created="Fri, 1 Feb 2013 02:28:43 +0000"  >&lt;p&gt;Is it possible to develop some script / tool to transform old task znode ?&lt;/p&gt;</comment>
                            <comment id="13568395" author="kevin.odell" created="Fri, 1 Feb 2013 02:31:03 +0000"  >&lt;p&gt;Himanshu,&lt;/p&gt;

&lt;p&gt;  I don&apos;t think it is a big deal to manually remove the znodes once.  We should just get the steps in the Apache book under moving to HA and removing HA(HDFS):&lt;/p&gt;

&lt;p&gt;1.) Make sure HBase is still shutdown&lt;br/&gt;
2.) go to ZK node&lt;br/&gt;
3.) run /usr/lib/zookeeper/bin/zkCli.sh&lt;br/&gt;
4.) run ls /hbase/splitlogs&lt;br/&gt;
5.) if there is content run rmr /hbase/splitlogs&lt;/p&gt;</comment>
                            <comment id="13568968" author="v.himanshu" created="Fri, 1 Feb 2013 18:55:56 +0000"  >&lt;p&gt;Going by above comments, here is a patch which removes the NN uri from new znodes. This should be used with a clean zookeeper state. In case a user wishes to use it 0.94.x, he should clean up the zk data. &lt;br/&gt;
By default, this should be a 0.96 fix.&lt;br/&gt;
I tested both the above failed tests, and also other &lt;b&gt;Log&lt;/b&gt; tests; they pass. &lt;br/&gt;
Running a jenkins now.&lt;/p&gt;</comment>
                            <comment id="13568972" author="v.himanshu" created="Fri, 1 Feb 2013 18:58:27 +0000"  >&lt;p&gt;And yeah, will remove those Warn statements (they are there only for local debug thing). &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13568981" author="yuzhihong@gmail.com" created="Fri, 1 Feb 2013 19:12:09 +0000"  >&lt;p&gt;@Himanshu:&lt;br/&gt;
Are you running test suite for 0.94 ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; removeRootPathFromAGivenPath(Path path, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Configuration conf) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is only one Path parameter. So rename method as removeRootPath ?&lt;/p&gt;</comment>
                            <comment id="13569176" author="v.himanshu" created="Fri, 1 Feb 2013 22:33:23 +0000"  >&lt;p&gt;Changing the approach a bit in order to avoid the manual process of znode removal. &lt;br/&gt;
For 0.94.x: Change the way znodes are read in SplitLogWorker. Let the workers use their hbase.rootdir and append the log file path. This way, we can support rolling upgrade and ha/non-ha changes too.&lt;br/&gt;
For 0.96, change the way znodes are written by the SplitLogManager such that it doesn&apos;t use the NN uri. SplitLogWorker will create the log path by prefixing their hbase.rootdir. &lt;/p&gt;

&lt;p&gt;Attached are the patches for trunk/0.94. Incorporated Ted&apos;s review too. Thanks Elliot for discussing this.&lt;br/&gt;
Ran Log* tests on both. Jenkins on trunk patch passes. Jenkins on .94 in progress.&lt;/p&gt;</comment>
                            <comment id="13569206" author="v.himanshu" created="Fri, 1 Feb 2013 22:57:55 +0000"  >&lt;p&gt;jenkins is clean on 0.94.&lt;/p&gt;</comment>
                            <comment id="13569221" author="yuzhihong@gmail.com" created="Fri, 1 Feb 2013 23:08:28 +0000"  >&lt;p&gt;Looking at 0.94 patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * it exists, it removes it and returns the &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; representation of remaining relative path.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;it removes&apos; -&amp;gt; &apos;this method removes&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; representation of a path.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;a path&apos; -&amp;gt; &apos;remaining relative path&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; path.toString().substring(root.toString().length() + 1);&lt;span class=&quot;code-comment&quot;&gt;// remove the &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; too.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: &apos;else&apos; can be omitted.&lt;/p&gt;</comment>
                            <comment id="13569226" author="hadoopqa" created="Fri, 1 Feb 2013 23:12:07 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12567652/HBASE-7723-trunk-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12567652/HBASE-7723-trunk-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4293//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4293//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13569264" author="v.himanshu" created="Fri, 1 Feb 2013 23:46:08 +0000"  >&lt;p&gt;updated trunk and 0.94 patches.&lt;/p&gt;</comment>
                            <comment id="13569274" author="hadoopqa" created="Fri, 1 Feb 2013 23:52:05 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12567673/HBASE-7723-94-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12567673/HBASE-7723-94-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4295//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4295//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13569317" author="v.himanshu" created="Sat, 2 Feb 2013 00:42:31 +0000"  >&lt;p&gt;QA tried to apply the .94 patch to trunk. Is there any name-format to discern b/w various versions?&lt;/p&gt;</comment>
                            <comment id="13569322" author="yuzhihong@gmail.com" created="Sat, 2 Feb 2013 00:47:50 +0000"  >&lt;p&gt;QA bot picks the newest attachment - even if the file is a pdf &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13569533" author="mbertozzi" created="Sat, 2 Feb 2013 12:49:23 +0000"  >&lt;p&gt;ok for 0.94 patch, but why in 0.96 you still add .logs path?&lt;/p&gt;

&lt;p&gt;The log is created in /hbase/.logs/&amp;lt;serverName&amp;gt;/ as &amp;lt;serverName&amp;gt;.&amp;lt;filenum&amp;gt; and moved to /hbase/.oldlogs so the znode can just contains the &amp;lt;serverName&amp;gt;.&amp;lt;filenum&amp;gt; name. No extra stuff needed. in this way you solve future problem, e.g. if .logs are no longer there.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Example:
/hbase/.logs/localhost,40898,1359808919787/localhost%2C40898%2C1359808919787.1359808923970
moved to
/hbase/.oldlogs/localhost%2C40898%2C1359808919787.1359808923970
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13569585" author="v.himanshu" created="Sat, 2 Feb 2013 16:37:58 +0000"  >&lt;p&gt;Thanks for looking Matteo. &lt;/p&gt;

&lt;p&gt;The latest trunk patch keeps the current behavior whether it is oldlogs, or logs. It only removes the rootdir from the path. In case if it removes that directory too, then how would you determine whether the logs are in .logs, or .oldlogs.&lt;/p&gt;</comment>
                            <comment id="13569783" author="mbertozzi" created="Sun, 3 Feb 2013 14:41:17 +0000"  >&lt;p&gt;currently the only logs split are for the ones present under .logs (the &quot;active&quot; ones)&lt;br/&gt;
and to be 100% correct you should lookup the log by name in both .logs and .oldlogs if it doesn&apos;t exists in the .logs (e.g. snapshot case)&lt;/p&gt;

&lt;p&gt;note also that now, the splitLogDistributed() arg is too open. it can be a dir path or a list of paths to the log files. &lt;br/&gt;
This means that the logs can even be somewhere else and not only in the root dir (e.g. custom tool to apply logs from a backup dir)&lt;/p&gt;</comment>
                            <comment id="13569936" author="v.himanshu" created="Mon, 4 Feb 2013 00:19:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;currently the only logs split are for the ones present under .logs (the &quot;active&quot; ones)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right, I was saying for the sake of what this patch is doing. If the root dir is not present in the given path, it returns as it is.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This means that the logs can even be somewhere else and not only in the root dir (e.g. custom tool to apply logs from a backup dir)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Going by the existing use cases, I see all goes under the hbase root directory. If you want to use some other location in future, then one can use a property to define it. That is beyond the scope of this jira in my opinion (for example, HLog creation per RS also uses root dir).&lt;/p&gt;</comment>
                            <comment id="13571131" author="lhofhansl" created="Tue, 5 Feb 2013 08:07:38 +0000"  >&lt;p&gt;Since we&apos;re passing the fs anyway, can we just store /hbase/... (instead hdfs://&amp;lt;NN&amp;gt;/hbase/...).&lt;br/&gt;
No need to reassemble the path name by prepending the rootDir.&lt;/p&gt;</comment>
                            <comment id="13571768" author="lhofhansl" created="Tue, 5 Feb 2013 21:50:53 +0000"  >&lt;p&gt;And with that I mean: In exec we turn the filename into a Path and from there into a URI and then get the path portion from it. That just use that in getFileStatus.&lt;/p&gt;</comment>
                            <comment id="13572036" author="v.himanshu" created="Wed, 6 Feb 2013 01:33:29 +0000"  >&lt;p&gt;Lars: Sorry, not following your comment. You meant for trunk, or 0.94?&lt;/p&gt;

&lt;p&gt;The existing trunk patch removes the root dir (hdfs://NN/hbase/, for example), and stores only the relevant location (.logs/RS#/log_file_name).&lt;/p&gt;

&lt;p&gt;0.94 is different as we don&apos;t want to change the way those znodes are written (to support rolling upgrade). &lt;/p&gt;</comment>
                            <comment id="13572156" author="lhofhansl" created="Wed, 6 Feb 2013 04:40:59 +0000"  >&lt;p&gt;Yeah, I didn&apos;t state that very clearly. What we could do for 0.94 is to&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;remove the hdfs://NN part for write (not necessary but good form, and the old 0.94 code can deal with a path without hdfs://NN&lt;/li&gt;
	&lt;li&gt;also remove the hdfs://NN part for reading (so that we can deal with old entries written)&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="13572161" author="lhofhansl" created="Wed, 6 Feb 2013 04:42:38 +0000"  >&lt;p&gt;Something like this (untested).&lt;br/&gt;
Could even do away with the write part of the patch, all we really have to do is strip the scheme://host part off.&lt;/p&gt;

&lt;p&gt;Fine with your approach if you prefer that.&lt;/p&gt;

&lt;p&gt;Let&apos;s get this into the next 0.94.5RC.&lt;/p&gt;</comment>
                            <comment id="13572768" author="lhofhansl" created="Wed, 6 Feb 2013 20:09:23 +0000"  >&lt;p&gt;Only that my approach fails TestDistributedLogSplitting and yours doesn&apos;t. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I have no time to track that down so let&apos;s go with your approach.&lt;/p&gt;

&lt;p&gt;Only one comment:&lt;/p&gt;

&lt;p&gt;ZNODE_PATH_SEPARATOR is not correct here, since we building a FS path not a Zookeeper path. Should use Path.SEPARATOR instead.&lt;/p&gt;</comment>
                            <comment id="13572792" author="lhofhansl" created="Wed, 6 Feb 2013 20:34:07 +0000"  >&lt;p&gt;Issue was using URI.getRawPath(), in this case we want the decoded path.&lt;/p&gt;

&lt;p&gt;Here&apos;s a minimal patch that fixes the problem. I propose this for 0.94.&lt;/p&gt;</comment>
                            <comment id="13572871" author="v.himanshu" created="Wed, 6 Feb 2013 21:44:42 +0000"  >&lt;p&gt;looking at it.&lt;/p&gt;</comment>
                            <comment id="13572895" author="stack" created="Wed, 6 Feb 2013 22:04:28 +0000"  >&lt;p&gt;So, when HA NN, the filesystem scheme and host/port are different?  You have an example please Himanshu?  I&apos;d be surprised if splitlogs is only place we don&apos;t have the assumption that different scheme or host or port is not a different filesystem altogether.  Good on you.&lt;/p&gt;</comment>
                            <comment id="13572915" author="v.himanshu" created="Wed, 6 Feb 2013 22:18:03 +0000"  >&lt;p&gt;Yes, with NN HA: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;name&amp;gt;hbase.rootdir&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cloudone/hbase/92&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with non-HA&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;name&amp;gt;hbase.rootdir&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cloudone:1234/hbase/94&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When we change the filesystem, we need to restart the cluster after making changes in the hbase-site.xml file. &lt;br/&gt;
But, we shouldn&apos;t wipe the zk data as part of the upgrade. If the shutdown is not proper, we may have some splitlog znodes, which currently stores the absolute path. When new configuration comes in, the old path becomes obsolete. Therefore, this jira tends to change the read behavior for SplitLog entities for 94 (we may have old znodes written by old master and we need to support rolling upgrade); and change write+read behavior to avoid writing the NN URI for trunk. &lt;/p&gt;</comment>
                            <comment id="13572929" author="v.himanshu" created="Wed, 6 Feb 2013 22:25:56 +0000"  >&lt;p&gt;Lars, will your patch work in case the change is like the above example? looks like toUri() get rid of scheme and host, but what if we change the directory level too? Is it worth considering?&lt;/p&gt;</comment>
                            <comment id="13573055" author="lhofhansl" created="Thu, 7 Feb 2013 01:04:41 +0000"  >&lt;p&gt;No. In that case it will not work, because the path was changed from &quot;/hbase/92&quot; to &quot;/hbase/94&quot;. It only fixes up the HDFS part of things.&lt;/p&gt;

&lt;p&gt;I.e. you came from Hadoop 1.0 with root: hdfs://my.name.node.com/hbase and upgrade to Hadoop 2 where the root would be hdfs://my_cluster_name/hbase.&lt;/p&gt;

&lt;p&gt;So in your scenario somebody renamed the directory in HDFS and then changed the root dir in HBase? Is that a common case? If so, let&apos;s go with your approach (after you remove the use of ZNODE_PATH_SEPARATOR &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) as it would cover this scenario as well.&lt;/p&gt;</comment>
                            <comment id="13573120" author="v.himanshu" created="Thu, 7 Feb 2013 02:46:39 +0000"  >&lt;p&gt;is this okay Lars?&lt;br/&gt;
Thanks for all the reviews so far &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13573123" author="lhofhansl" created="Thu, 7 Feb 2013 02:51:39 +0000"  >&lt;p&gt;Yeah, looks good. Initially I did not like the fact that we have to count 3 levels from the back.&lt;br/&gt;
But with your example I realize that the root dir can be more than one level deep so we have to count from the back.&lt;/p&gt;

&lt;p&gt;TL;DR: +1  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13573144" author="stack" created="Thu, 7 Feb 2013 03:38:10 +0000"  >&lt;p&gt;The difference is port number only? (that 0.92 vs 0.94 is a clouderia-ism?  Or you are thinking log splitting should just work even if hbase.rootdir is relatively shifted?)  HA NN has no &apos;port&apos; number?  Can&apos;t we equate these &apos;filesystems&apos;?  They are the &apos;same&apos;, no?  Its just that one has a NN ensemble serving its metadata?&lt;/p&gt;

&lt;p&gt;Its probably fine making log paths relative to root dir so you can move the root dir and it would still work (Hopefully the case where the zk data from one filesystem is set against a different filesystem will just fail horribly).&lt;/p&gt;

</comment>
                            <comment id="13573150" author="lhofhansl" created="Thu, 7 Feb 2013 03:50:12 +0000"  >&lt;p&gt;The problem occurs every time when the hbase root is changed in any way.&lt;br/&gt;
In our case we moved from a single NN to an HA NN. In that case the host portion of the URI changes.&lt;br/&gt;
Similarly one could imagine that the hbase root Dir is moved.&lt;/p&gt;</comment>
                            <comment id="13573225" author="stack" created="Thu, 7 Feb 2013 05:55:30 +0000"  >&lt;p&gt;Yes.  I get that.   Absolute paths will come back to bite us in various ways.&lt;/p&gt;

&lt;p&gt;My point is that a filesystem that is running HA NN should equate to the filesystem that is running old school NN.  Up to this, a change in the root.dir URL signified &apos;different filesystem&apos; and we depend on this in loads of places around the code (&quot;Filesystems do not match!&quot; type exceptions).  Here is a case where finding a difference in the URL hostname + port does NOT mean a different fs.&lt;/p&gt;

&lt;p&gt;I&apos;m fine w/ log splitter taking relative paths.... thats good.&lt;/p&gt;

&lt;p&gt;Just pointing out that this issue will rear its head again. &lt;/p&gt;</comment>
                            <comment id="13573249" author="lhofhansl" created="Thu, 7 Feb 2013 06:43:09 +0000"  >&lt;p&gt;Sorry, misunderstood your comment.&lt;/p&gt;

&lt;p&gt;I guess two FSs could be considered the same if one is a NN ensemble containing the old pre HA NN.&lt;br/&gt;
Then a NN roundtrip would be needed to verify that.&lt;/p&gt;

&lt;p&gt;Where else are we storing absolute paths?&lt;/p&gt;</comment>
                            <comment id="13573268" author="stack" created="Thu, 7 Feb 2013 07:27:22 +0000"  >&lt;p&gt;I was thinking of those places out in scripts and tools where we want to get to hdfs where the config may have the single nn format but we&apos;re running the ha nn &amp;#8211; or vice versa.  Should just work rather than complain.   I suppose lets just cross that bridge when we come to it.&lt;/p&gt;</comment>
                            <comment id="13573278" author="v.himanshu" created="Thu, 7 Feb 2013 07:42:37 +0000"  >&lt;p&gt;Can you point some of those tools/scripts?&lt;/p&gt;</comment>
                            <comment id="13573631" author="stack" created="Thu, 7 Feb 2013 16:11:27 +0000"  >&lt;p&gt;Do a &apos;grep -r makeQualified&apos; under hbase checkout.   This is us filling out the full path to a file (including scheme, etc.).  That should lead you to compares of paths that factor in the filesystem scheme, host and port.  Let me know if you need more pointers H.&lt;/p&gt;</comment>
                            <comment id="13573668" author="lhofhansl" created="Thu, 7 Feb 2013 16:55:27 +0000"  >&lt;p&gt;Let&apos;s cross that bridge when needed I&apos;d say.&lt;/p&gt;

&lt;p&gt;I think is only an issue where we store fully qualified paths outside of HDFS (such as in ZK). Thinking now maybe we should check the replication code&apos;s usage of ZK (although it is not immediately clear how that &lt;b&gt;should&lt;/b&gt; behave).&lt;/p&gt;

&lt;p&gt;Should I push to 0.94.6, since we&apos;re still discussing?&lt;br/&gt;
Maybe at least document? (It did cost the Salesforce Ops folks some gray hair in a late night session, before they finally called me up).&lt;/p&gt;</comment>
                            <comment id="13573733" author="stack" created="Thu, 7 Feb 2013 18:13:21 +0000"  >&lt;p&gt;0.94.6 I&apos;d say especially given you have them coming out all nice and regular.&lt;/p&gt;</comment>
                            <comment id="13573755" author="v.himanshu" created="Thu, 7 Feb 2013 18:27:43 +0000"  >&lt;p&gt;There are two use cases here:&lt;br/&gt;
a) Supporting a rolling restart&lt;br/&gt;
b) Change in NN URI.&lt;/p&gt;

&lt;p&gt;They are mutually exclusive. This jira deals only with b). This requires a restart of the entire cluster, which is OK. I grepped the above tools, and they are using &quot;conf&quot; object, which is fine too. The only problem is the zondes which contains absolute path now become irrelevant because of the URI change. One needs to manually remove those stale znodes. This patch intends to use relative path to avoid such behavior.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;where we want to get to hdfs where the config may have the single nn format but we&apos;re running the ha nn &#8211; or vice versa.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We need a restart in this case, which should serve the purpose. All the nodes will have right conf property then, right?&lt;/p&gt;

&lt;p&gt;For a), we don&apos;t need to change anything for this imo. &lt;/p&gt;</comment>
                            <comment id="13573785" author="lhofhansl" created="Thu, 7 Feb 2013 19:00:50 +0000"  >&lt;p&gt;There&apos;s also &lt;br/&gt;
c) support changing of HBase root (also requires an HBase restart)&lt;/p&gt;

&lt;p&gt;b) would be handled by my -minimal patch as well.&lt;br/&gt;
for c) your patch is needed.&lt;/p&gt;</comment>
                            <comment id="13573841" author="v.himanshu" created="Thu, 7 Feb 2013 19:40:16 +0000"  >&lt;p&gt;Yes, I considered it to be a special case of b) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But yes, you&apos;re right.&lt;/p&gt;</comment>
                            <comment id="13586716" author="lhofhansl" created="Tue, 26 Feb 2013 04:08:43 +0000"  >&lt;p&gt;Should we commit H&apos;s patch? +1 from me.&lt;/p&gt;

&lt;p&gt;For 0.94 it&apos;ll only affect the read path, for trunk it&apos;ll affect the write path to ZK and only store the path part of the HDFS URL.&lt;/p&gt;</comment>
                            <comment id="13586726" author="yuzhihong@gmail.com" created="Tue, 26 Feb 2013 04:18:34 +0000"  >&lt;p&gt;0.94 patch looks good.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (len &amp;gt; 3) {
+          &lt;span class=&quot;code-comment&quot;&gt;// the last three terms are .logs/server/log-file
&lt;/span&gt;+           relativeLogPath = sb.append(filenameSplits[len - 3]).append(znodeDelimiter)
+              .append(filenameSplits[len - 2]).append(znodeDelimiter)
+              .append(filenameSplits[len - 1]).toString();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Indentation seems to be a bit off.&lt;/p&gt;</comment>
                            <comment id="13586748" author="yuzhihong@gmail.com" created="Tue, 26 Feb 2013 04:46:48 +0000"  >&lt;p&gt;Integrated patch v5 to 0.94, with adjustment to indentation.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Himanshu.&lt;/p&gt;

&lt;p&gt;Thanks for the reviews, Lars and Stack.&lt;/p&gt;</comment>
                            <comment id="13586763" author="lhofhansl" created="Tue, 26 Feb 2013 04:59:43 +0000"  >&lt;p&gt;What about the trunk version?&lt;/p&gt;</comment>
                            <comment id="13586849" author="lhofhansl" created="Tue, 26 Feb 2013 06:30:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13586888" author="hudson" created="Tue, 26 Feb 2013 07:21:03 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #860 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/860/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/860/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7723&quot; title=&quot;Remove NameNode URI from ZK splitlogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7723&quot;&gt;&lt;del&gt;HBASE-7723&lt;/del&gt;&lt;/a&gt; Remove NameNode URI from ZK splitlogs (Himanshu) (Revision 1450018)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13586893" author="hudson" created="Tue, 26 Feb 2013 07:26:59 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #112 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/112/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/112/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7723&quot; title=&quot;Remove NameNode URI from ZK splitlogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7723&quot;&gt;&lt;del&gt;HBASE-7723&lt;/del&gt;&lt;/a&gt; Remove NameNode URI from ZK splitlogs (Himanshu) (Revision 1450018)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13587043" author="yuzhihong@gmail.com" created="Tue, 26 Feb 2013 11:46:21 +0000"  >&lt;p&gt;Trunk patch hasn&apos;t been verified by Hadoop qa yet. &lt;/p&gt;</comment>
                            <comment id="13590043" author="lhofhansl" created="Thu, 28 Feb 2013 23:28:07 +0000"  >&lt;p&gt;Reattaching for Hadoop QA&lt;/p&gt;</comment>
                            <comment id="13590105" author="hadoopqa" created="Fri, 1 Mar 2013 00:33:42 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12571492/HBASE-7723-trunk-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12571492/HBASE-7723-trunk-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplicationQueueFailover&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4612//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13591964" author="lhofhansl" created="Mon, 4 Mar 2013 03:30:51 +0000"  >&lt;p&gt;Test run looks good. I&apos;m going to commit to 0.95 and trunk tonight.&lt;br/&gt;
(Generally I think we should commit to 0.95/trunk first and then into 0.94)&lt;/p&gt;</comment>
                            <comment id="13592666" author="lhofhansl" created="Mon, 4 Mar 2013 21:43:17 +0000"  >&lt;p&gt;Committed to 0.95 and 0.98 as well.&lt;/p&gt;</comment>
                            <comment id="13592873" author="hudson" created="Tue, 5 Mar 2013 00:55:14 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #22 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/22/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/22/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7723&quot; title=&quot;Remove NameNode URI from ZK splitlogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7723&quot;&gt;&lt;del&gt;HBASE-7723&lt;/del&gt;&lt;/a&gt; Remove NameNode URI from ZK splitlogs (Himanshu) (Revision 1452540)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593115" author="hudson" created="Tue, 5 Mar 2013 06:26:48 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #430 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/430/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/430/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7723&quot; title=&quot;Remove NameNode URI from ZK splitlogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7723&quot;&gt;&lt;del&gt;HBASE-7723&lt;/del&gt;&lt;/a&gt; Remove NameNode URI from ZK splitlogs (Himanshu) (Revision 1452542)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593184" author="hudson" created="Tue, 5 Mar 2013 07:52:15 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #12 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7723&quot; title=&quot;Remove NameNode URI from ZK splitlogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7723&quot;&gt;&lt;del&gt;HBASE-7723&lt;/del&gt;&lt;/a&gt; Remove NameNode URI from ZK splitlogs (Himanshu) (Revision 1450018)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13594178" author="jeffreyz" created="Wed, 6 Mar 2013 00:59:01 +0000"  >&lt;p&gt;The check in for trunk breaks test case(the check in for 0.94 seems all right): &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.hadoop.hbase.replication.TestReplicationQueueFailover&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with error message &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Waited too much time &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; queueFailover replication&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;The reason is the we removed the root part of path from splitlogs ZK entries which breaks the following line in file SplitLogManager&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;HLogSplitter.finishSplitLogFile(logFile.toString(), conf);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The path is a short version and the log splitted file won&apos;t be archived which cause the replication failover case fail because it waits for the archiving finish.&lt;/p&gt;

&lt;p&gt;I&apos;ll submit a patch in JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7944&quot; title=&quot;Replication leaks file reader resource &amp;amp; not reset currentNbOperations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7944&quot;&gt;&lt;del&gt;HBASE-7944&lt;/del&gt;&lt;/a&gt; with other fixes for test case TestReplicationQueueFailover.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Jeffrey&lt;/p&gt;</comment>
                            <comment id="13594198" author="v.himanshu" created="Wed, 6 Mar 2013 01:13:09 +0000"  >&lt;p&gt;Thanks Jeffrey. I haven&apos;t look at the trunk patch yet.  QA bot also reported that failure for trunk.&lt;br/&gt;
Lars: yes, I usually try to follow the trunk-&amp;gt;0.94 approach... somehow didn&apos;t do it for this one. Sorry.&lt;/p&gt;</comment>
                            <comment id="13594200" author="lhofhansl" created="Wed, 6 Mar 2013 01:18:26 +0000"  >&lt;p&gt;I was referring to Ted committing this to 0.94 before 0.95 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568293" name="7723-0.94-minimal.txt" size="762" author="lhofhansl" created="Wed, 6 Feb 2013 20:34:07 +0000"/>
                            <attachment id="12568164" name="7723-0.94-simple.txt" size="1498" author="lhofhansl" created="Wed, 6 Feb 2013 04:42:38 +0000"/>
                            <attachment id="12567618" name="HBASE-7723-94-v2.patch" size="3969" author="v.himanshu" created="Fri, 1 Feb 2013 18:57:19 +0000"/>
                            <attachment id="12567651" name="HBASE-7723-94-v3.patch" size="2232" author="v.himanshu" created="Fri, 1 Feb 2013 22:34:31 +0000"/>
                            <attachment id="12567673" name="HBASE-7723-94-v4.patch" size="2581" author="v.himanshu" created="Fri, 1 Feb 2013 23:46:08 +0000"/>
                            <attachment id="12568356" name="HBASE-7723-94-v5.patch" size="1924" author="v.himanshu" created="Thu, 7 Feb 2013 02:46:39 +0000"/>
                            <attachment id="12567433" name="HBASE-7723-94.patch" size="2507" author="v.himanshu" created="Thu, 31 Jan 2013 20:53:37 +0000"/>
                            <attachment id="12567652" name="HBASE-7723-trunk-v1.patch" size="3223" author="v.himanshu" created="Fri, 1 Feb 2013 22:34:31 +0000"/>
                            <attachment id="12571492" name="HBASE-7723-trunk-v2.patch" size="3246" author="lhofhansl" created="Thu, 28 Feb 2013 23:28:07 +0000"/>
                            <attachment id="12567672" name="HBASE-7723-trunk-v2.patch" size="3246" author="v.himanshu" created="Fri, 1 Feb 2013 23:46:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Jan 2013 20:51:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310531</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hlav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310876</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>