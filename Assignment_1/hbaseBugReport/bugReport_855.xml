<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:48:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-855/HBASE-855.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-855] compaction can return less versions then we should in some cases</title>
                <link>https://issues.apache.org/jira/browse/HBASE-855</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;say we have a column with max version = 3 and we have 3 records  &lt;br/&gt;
we insert a new record with a old timestamp.&lt;/p&gt;

&lt;p&gt;What happeds in the compaction is the the new record with the old timestamp get read first and could push out some of our &lt;br/&gt;
versions if the new record(s) with the old timestamp has a expired ttl.&lt;/p&gt;

&lt;p&gt;This happens because we track the total times we see a row/column but do not reduce this count if the cell is expired&lt;br/&gt;
and sense we pass the cell in order of the newest HStoreFile first with the newest records passed might not be the newest timestamps.&lt;/p&gt;

&lt;p&gt;Got to wait for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-834&quot; title=&quot;&amp;#39;Major&amp;#39; compactions and upper bound on files we compact at any one time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-834&quot;&gt;&lt;del&gt;HBASE-834&lt;/del&gt;&lt;/a&gt; to be committed then I can add a patch for this bug. will be a simple fix.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12403351">HBASE-855</key>
            <summary>compaction can return less versions then we should in some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viper799">Billy Pearson</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Aug 2008 07:45:35 +0000</created>
                <updated>Sat, 13 Sep 2008 23:22:45 +0000</updated>
                            <resolved>Sun, 31 Aug 2008 04:21:08 +0000</resolved>
                                    <version>0.2.1</version>
                    <version>0.18.0</version>
                                    <fixVersion>0.2.1</fixVersion>
                    <fixVersion>0.18.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12626895" author="viper799" created="Fri, 29 Aug 2008 07:50:16 +0000"  >&lt;p&gt;This also effects 0.18.0 we can fix it in 0.18.0 or 0.18.1 eather way is fine with me&lt;/p&gt;</comment>
                            <comment id="12627188" author="viper799" created="Sat, 30 Aug 2008 03:09:24 +0000"  >&lt;p&gt;This should fix a problem I seen in the max version and ttl&lt;/p&gt;

&lt;p&gt;stack commented on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-834&quot; title=&quot;&amp;#39;Major&amp;#39; compactions and upper bound on files we compact at any one time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-834&quot;&gt;&lt;del&gt;HBASE-834&lt;/del&gt;&lt;/a&gt; that he still seeing old version of data in .META. historian&lt;/p&gt;

&lt;p&gt;I looked around and thank I might have found a second bug that might be the problem and included it in the patch&lt;/p&gt;

&lt;p&gt;When we see a new row/column we where using the var timesSeen to track the times we have seen the same row/column.&lt;br/&gt;
but on a new row/column we set it to 0 on the first new row/column seen&lt;br/&gt;
then below we where check for max versions limit like this&lt;br/&gt;
if (timesSeen &amp;lt;= family.getMaxVersions()&lt;/p&gt;

&lt;p&gt;With the timesSeen set to 0 that would allow 1 extra cell to pass on to the HStoreFile then the max versions setting&lt;br/&gt;
We should have been setting timesSeen to 1 in place of 0 sense its the first row/column seen not 0&lt;/p&gt;

&lt;p&gt;I thank this might be your problem you are seeing stack when the record is &lt;br/&gt;
deleted there could still be one old cell hidden in the table that will not show up until the newest cell is deleted.&lt;/p&gt;</comment>
                            <comment id="12627189" author="viper799" created="Sat, 30 Aug 2008 03:09:48 +0000"  >&lt;p&gt;patch should apply to trunk and branch&lt;/p&gt;</comment>
                            <comment id="12627234" author="stack" created="Sat, 30 Aug 2008 19:14:51 +0000"  >&lt;p&gt;Thanks Billy.  TestCompactions is failing since we changed how compactions are done.  I was looking at it yesterday and was thinking that 855 was not fully to blame.  This new bug in our max versions logic might explain it.  Let me test.&lt;/p&gt;</comment>
                            <comment id="12627269" author="stack" created="Sun, 31 Aug 2008 04:21:08 +0000"  >&lt;p&gt;Ran tests (took a while).  It works.  Applied to trunk and branch.  Thanks for the patch Billy.  &lt;/p&gt;</comment>
                            <comment id="12627273" author="stack" created="Sun, 31 Aug 2008 04:35:48 +0000"  >&lt;p&gt;This patch also fixes failing compaction test.&lt;/p&gt;</comment>
                            <comment id="12627279" author="stack" created="Sun, 31 Aug 2008 05:05:33 +0000"  >&lt;p&gt;Hudson just passed; build #294.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12389225" name="855-patch.txt" size="954" author="viper799" created="Sat, 30 Aug 2008 03:09:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 Aug 2008 19:14:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h9v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>