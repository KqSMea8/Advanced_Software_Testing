<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:44:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7266/HBASE-7266.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7266] [89-fb] Using pread for non-compaction read request</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7266</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There are 2 kinds of read operations in HBase: pread and seek+read.&lt;br/&gt;
Pread, positional read, is stateless and create a new connection between the DFSClient and DataNode for each operation. While seek+read is to seek to a specific postion and prefetch blocks from data nodes. The benefit of seek+read is that it will cache the prefetch result but the downside is it is stateful and needs to synchronized.&lt;/p&gt;

&lt;p&gt;So far, both compaction and scan are using seek+read, which caused some resource contention. So using the pread for the scan request can avoid the resource contention. In addition, the region server is able to do the prefetch for the scan request (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6874&quot; title=&quot;Implement prefetching for scanners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6874&quot;&gt;&lt;del&gt;HBASE-6874&lt;/del&gt;&lt;/a&gt;) so that it won&apos;t be necessary to let the DFSClient to prefetch the data any more.&lt;/p&gt;

&lt;p&gt;I will run through the scan benchmark (with no block cache) with verify the performance.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12618664">HBASE-7266</key>
            <summary>[89-fb] Using pread for non-compaction read request</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="liyin">Liyin Tang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Dec 2012 00:24:57 +0000</created>
                <updated>Wed, 11 Sep 2013 17:04:19 +0000</updated>
                                                                            <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13509392" author="yuzhihong@gmail.com" created="Tue, 4 Dec 2012 00:57:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;So far, both compaction and scan are using pread, which caused some resource contention. So using the pread for the scan request can avoid the resource contention.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Looks like the above description needs some rephrase.&lt;/p&gt;</comment>
                            <comment id="13509398" author="lhofhansl" created="Tue, 4 Dec 2012 01:08:06 +0000"  >&lt;p&gt;Looks like in 0.94+ we&apos;re already doing this (see HFileReaderV2)&lt;/p&gt;</comment>
                            <comment id="13509466" author="aoxiang" created="Tue, 4 Dec 2012 03:02:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; i don&apos;t get it, when scan the parameter &apos;pread&apos; is determined by Scan.isGetScan(),which is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Scan
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isGetScan() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.startRow != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.startRow.length &amp;gt; 0 &amp;amp;&amp;amp;
      Bytes.equals(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.startRow, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.stopRow);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13724944" author="stepinto" created="Wed, 31 Jul 2013 06:59:55 +0000"  >&lt;p&gt;We are experiencing this too. This happens when a large number of concurrent scan requests on a single region. Because of the lock (on seek+read), only one handler thread is effectively working. Our scan range is very small (just a few adjacent rows, fits into 1 block).&lt;/p&gt;</comment>
                            <comment id="13725387" author="lhofhansl" created="Wed, 31 Jul 2013 16:32:23 +0000"  >&lt;p&gt;In 0.94+ I fixed this by falling back to pread if the lock istream is taken (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7336&quot; title=&quot;HFileBlock.readAtOffset does not work well with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7336&quot;&gt;&lt;del&gt;HBASE-7336&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13725443" author="liyin" created="Wed, 31 Jul 2013 17:18:22 +0000"  >&lt;p&gt;Chao,we have switched all the read operation to pread in the 89-fb branch. There are 2 followup tasks for the pread. 1) The DFSClient maintains a connection pool instead of creating new connection for each pread operation. 2) HBase will actively pre-load the next several blocks in a stream fashion for large sequential scans (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9102&quot; title=&quot;HFile block pre-loading for large sequential scan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9102&quot;&gt;HBASE-9102&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13726207" author="stepinto" created="Thu, 1 Aug 2013 08:12:38 +0000"  >&lt;p&gt;Lars, yes, we&apos;re using an early 0.94 version. Thanks for the fix and we will try to benchmark a newer version. I think the fix is too tricky and I would prefer the idea Liyin proposed. Let&apos;s discus in the new issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 4 Dec 2012 00:57:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>295831</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i13y9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>