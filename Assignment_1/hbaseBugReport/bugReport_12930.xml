<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:37:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12930/HBASE-12930.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12930] Check single row size not exceed configured max row size across families for Get/Scan</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12930</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;StoreScanner#next will check the &apos;totalBytesRead&apos; not exceed configured &#8216;hbase.table.max.rowsize&#8217; for each family. However, if there are several families, the single row will also achieve unexpected big size even if &apos;totalBytesRead&apos; of each family not exceed &apos;hbase.table.max.rowsize&apos;. This may cause the region server fail because of OOM. What about checking single row size across families in StoreScanner#next(List&amp;lt;Cell&amp;gt;, int)?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; totalBytesRead = 0;
    &lt;span class=&quot;code-comment&quot;&gt;// ==&amp;gt; compute the size of cells have been read
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Cell cell : outResult) {
      totalBytesRead += CellUtil.estimatedSerializedSizeOf(old);
    }

    LOOP: &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;((cell = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.heap.peek()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12770351">HBASE-12930</key>
            <summary>Check single row size not exceed configured max row size across families for Get/Scan</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cuijianwei">Jianwei Cui</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Jan 2015 13:37:09 +0000</created>
                <updated>Mon, 13 Apr 2015 16:35:32 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                    <component>Scanners</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14310321" author="jonathan.lawlor" created="Sat, 7 Feb 2015 00:46:27 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cuijianwei&quot; class=&quot;user-hover&quot; rel=&quot;cuijianwei&quot;&gt;Jianwei Cui&lt;/a&gt;, this looks like it might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt;. I&apos;m currently working on a solution over there that I think would also solve this issue. The solution that I&apos;m working towards would allow large rows to be returned as partials to the client.&lt;/p&gt;</comment>
                            <comment id="14490988" author="cuijianwei" created="Sat, 11 Apr 2015 12:10:27 +0000"  >&lt;p&gt;Thanks for the your comment, and sorry to relay late &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathan.lawlor&quot; class=&quot;user-hover&quot; rel=&quot;jonathan.lawlor&quot;&gt;Jonathan Lawlor&lt;/a&gt;. I studied &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-11544 &lt;/a&gt;, it provides a good solution to avoid returning large rows to the client, and could cover this case in my opinion&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. In &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-11544 &lt;/a&gt;, HRegion#nextInternal adds a parameter &apos;remainingResultSize&apos; to limit the returned size of row, as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; NextState nextInternal(List&amp;lt;Cell&amp;gt; results, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; batchLimit, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; remainingResultSize)
+        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the master branch, I notice the &apos;remainingResultSize&apos; is removed from the parameters of HRegion#nextInternal, is there some reason to do this? &lt;/p&gt;</comment>
                            <comment id="14492605" author="jonathan.lawlor" created="Mon, 13 Apr 2015 16:35:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cuijianwei&quot; class=&quot;user-hover&quot; rel=&quot;cuijianwei&quot;&gt;Jianwei Cui&lt;/a&gt; Recently there was a change made (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13421&quot; title=&quot;Reduce the number of object creations introduced by HBASE-11544 in scan RPC hot code paths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13421&quot;&gt;&lt;del&gt;HBASE-13421&lt;/del&gt;&lt;/a&gt;) to the solution initially conceived in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt;. The remaining result size limit still exists, but now it is carried within the new class, ScannerContext (see ScannerContext#incrementaSizeProgress and ScannerContext#checkSizeLimit(...)). ScannerContext was introduced to allow us to reduce the number of object creations in the scanner hot code paths and also provides a nice encapsulation of limits and limit progress. Please let me know if you have any questions &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 7 Feb 2015 00:46:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24ucn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>