<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2696/HBASE-2696.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2696] ZooKeeper cleanup and refactor</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2696</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently almost everything we do with ZooKeeper is stuffed into a single class &lt;tt&gt;ZookeeperWrapper&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This issue will deal with cleaning up our usage of ZK, adding some new abstractions to help with the master changes, splitting up watchers from utility methods, and nailing down the contracts of our ZK methods with respect to setting watchers, throwing exceptions, etc...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466484">HBASE-2696</key>
            <summary>ZooKeeper cleanup and refactor</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12466475">HBASE-2692</parent>
                                    <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jun 2010 19:11:00 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:40 +0000</updated>
                            <resolved>Wed, 1 Sep 2010 05:00:48 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12884962" author="streamy" created="Sat, 3 Jul 2010 19:48:11 +0000"  >&lt;p&gt;First patch of ZK cleanup.  I wanted to cut a patch and get this committed before I really rip stuff up.  This patch does not yet touch the existing ZooKeeperWrapper.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Adds three new classes that will mostly replace current &lt;tt&gt;ZooKeeperWrapper&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;&lt;b&gt;&lt;tt&gt;ZooKeeperWatcher&lt;/tt&gt;&lt;/b&gt; acts as the single watcher for a process and also holds the ZooKeeper connection itself (instantiated class, no longer singleton like ZKWrapper).  All ZK connection events are handled in here, normal events are passed along to any registered &lt;tt&gt;ZooKeeperListeners&lt;/tt&gt;.&lt;/li&gt;
		&lt;li&gt;&lt;b&gt;&lt;tt&gt;ZooKeeperListener&lt;/tt&gt;&lt;/b&gt; is a base class that acts as hbase-internal ZK Watchers.  Consumers of ZK events will extend the class and override any of the events they are interested in.&lt;/li&gt;
		&lt;li&gt;&lt;b&gt;&lt;tt&gt;ZKUtil&lt;/tt&gt;&lt;/b&gt; will contain static methods that actually do things like read/write znodes, list children, etc... These methods will take a &lt;tt&gt;ZooKeeperWatcher&lt;/tt&gt;.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Breaks out parts of &lt;tt&gt;HQuorumPeer&lt;/tt&gt; into new &lt;tt&gt;ZKConfig&lt;/tt&gt; class that just deals with the parsing of stuff&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12884965" author="streamy" created="Sat, 3 Jul 2010 20:44:41 +0000"  >&lt;p&gt;There are many open issues still.&lt;/p&gt;

&lt;p&gt;Basically all ZooKeeper operations will throw both &lt;tt&gt;KeeperException&lt;/tt&gt; and &lt;tt&gt;InterruptedException&lt;/tt&gt;.  Usually for each operation there are some expected KeeperExceptions like NODEEXISTS, BADVERSION, NONODE.  There are also some nastier ones like CONNECTIONLOSS.&lt;/p&gt;

&lt;p&gt;So my thinking there is to explicitly deal with the KeeperExceptions that we expect, make sure to document the contract in the javadoc.  All other KeeperExceptions should abort the server.&lt;/p&gt;

&lt;p&gt;Full list of KeeperException codes: &lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/r3.3.1/api/org/apache/zookeeper/KeeperException.Code.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/r3.3.1/api/org/apache/zookeeper/KeeperException.Code.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As for InterruptedException, this is always one of those special things.  It will get clunky if we let them out of all the methods, can we get away with just returning null/false values and logging the exception? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12884967" author="streamy" created="Sat, 3 Jul 2010 21:01:02 +0000"  >&lt;p&gt;Updated version.  Adds some stuff so we now abort when we get an unhandled KeeperException.&lt;/p&gt;</comment>
                            <comment id="12884999" author="streamy" created="Sun, 4 Jul 2010 04:50:55 +0000"  >&lt;p&gt;part1-v3 adds integration on the RS side and removes the singleton stuff for ZKW.  Adds a new class on the regionserver side &lt;tt&gt;MasterAddressManager&lt;/tt&gt; which encapsulates the watching/setting of the active master and is of the new &lt;tt&gt;ZooKeeperListener&lt;/tt&gt; style.  There&apos;s some partial hack-up on the master side to get things working in this mixed world.  Also disables the regionserver and master abort tests in TestZooKeeper (as we&apos;ve discussed, masters and regionservers don&apos;t restart themselves anymore).&lt;/p&gt;</comment>
                            <comment id="12885000" author="streamy" created="Sun, 4 Jul 2010 05:14:53 +0000"  >&lt;p&gt;Fixes TestMasterTransitions and maybe some other tests.&lt;/p&gt;</comment>
                            <comment id="12885060" author="streamy" created="Sun, 4 Jul 2010 17:55:17 +0000"  >&lt;p&gt;Adds new test &lt;tt&gt;TestMasterAddressManager&lt;/tt&gt;.  All unit tests passing.&lt;/p&gt;</comment>
                            <comment id="12885278" author="tlipcon" created="Mon, 5 Jul 2010 17:35:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;As for InterruptedException, this is always one of those special things. It will get clunky if we let them out of all the methods, can we get away with just returning null/false values and logging the exception? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you let interruption pass through, you should do Thread.currentThread().interrupt() to maintain interruption status.&lt;/p&gt;</comment>
                            <comment id="12885806" author="streamy" created="Wed, 7 Jul 2010 03:42:31 +0000"  >&lt;p&gt;I re-enabled TestZooKeeper.testRegionServerSessionExpired() in the branch.  The only test that is still disabled is the master session expiration but that&apos;s because i removed the auto restart on the master.  After a discussion with jd we might be able to safely allow that.  In any case, need to extend the hbase testing toolkit to support multiple masters so we can test failover.&lt;/p&gt;</comment>
                            <comment id="12885807" author="streamy" created="Wed, 7 Jul 2010 03:43:22 +0000"  >&lt;p&gt;The patch actually applied to the branch this morning.&lt;/p&gt;</comment>
                            <comment id="12888839" author="hbasereviewboard" created="Thu, 15 Jul 2010 16:00:18 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/324/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, stack, Jean-Daniel Cryans, and Karthik Ranganathan.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Next set of changes for ZK cleanup (following master startup cleanup in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2695&quot; title=&quot;HMaster cleanup and refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2695&quot;&gt;&lt;del&gt;HBASE-2695&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;This completes move from ZooKeeperWrapper to ZooKeeperWatcher (and all the new ZK bits) for the RS and Client.  There is still work to do in Master, that is next patch which hopefully comes today.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Rename &lt;tt&gt;ServerStatus&lt;/tt&gt; to &lt;tt&gt;ServerController&lt;/tt&gt; (still have MasterStatus, that will be renamed in next patch)
	&lt;ul&gt;
		&lt;li&gt;Client uses this now, maybe should be ProcessController?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Adds a new client exception &lt;tt&gt;ZooKeeperConnectionException&lt;/tt&gt; which is subclass of IOException.  Thrown from HTable and HBaseAdmin if no ZK connection&lt;/li&gt;
	&lt;li&gt;Fixes client so that it can ride over master changes
	&lt;ul&gt;
		&lt;li&gt;Uses &lt;tt&gt;MasterAddressManager&lt;/tt&gt; already being used on RS&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;HBaseAdmin&lt;/tt&gt; uses accessor method to get master reference rather than a class variable&lt;/li&gt;
		&lt;li&gt;Move all ZK interactions to go via ZKUtil/ZKWatcher not ZKWrapper&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Moves RS completely off of ZKWrapper and onto ZKUtil/ZKWatcher&lt;/li&gt;
	&lt;li&gt;Adds lots of new methods to ZKUtil, every one with full javadoc&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2696&quot; title=&quot;ZooKeeper cleanup and refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2696&quot;&gt;&lt;del&gt;HBASE-2696&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2696&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2696&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerStatus.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ZooKeeperConnectionException.java PRE-CREATION &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnection.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HTable.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/ServerConnectionManager.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/master/MasterStatus.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServer.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKConfig.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/resources/hbase-webapps/master/zk.jsp 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/main/resources/hbase-webapps/regionserver/regionserver.jsp 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java 964096 &lt;br/&gt;
  branches/0.90_master_rewrite/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java 964096 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/324/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Had to fix up some of the ZK unit tests to work on new ZKUtil/ZKWatcher, all those passing.  Existing unit tests on MasterAddressManager.&lt;/p&gt;

&lt;p&gt;Test suite seems to be passing, underway.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12888857" author="streamy" created="Thu, 15 Jul 2010 17:14:22 +0000"  >&lt;p&gt;Next set of changes for ZK cleanup (following master startup cleanup in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2695&quot; title=&quot;HMaster cleanup and refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2695&quot;&gt;&lt;del&gt;HBASE-2695&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;This completes move from ZooKeeperWrapper to ZooKeeperWatcher (and all the new ZK bits) for the RS and Client.  There is still work to do in Master, that is next patch which hopefully comes today.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Rename &lt;tt&gt;ServerStatus&lt;/tt&gt; to &lt;tt&gt;ServerController&lt;/tt&gt; (still have MasterStatus, that will be renamed in next patch)
	&lt;ul&gt;
		&lt;li&gt;Client uses this now, maybe should be ProcessController?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Adds a new client exception &lt;tt&gt;ZooKeeperConnectionException&lt;/tt&gt; which is subclass of IOException.  Thrown from HTable and HBaseAdmin if no ZK connection&lt;/li&gt;
	&lt;li&gt;Fixes client so that it can ride over master changes
	&lt;ul&gt;
		&lt;li&gt;Uses &lt;tt&gt;MasterAddressManager&lt;/tt&gt; already being used on RS&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;HBaseAdmin&lt;/tt&gt; uses accessor method to get master reference rather than a class variable&lt;/li&gt;
		&lt;li&gt;Move all ZK interactions to go via ZKUtil/ZKWatcher not ZKWrapper&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Moves RS completely off of ZKWrapper and onto ZKUtil/ZKWatcher&lt;/li&gt;
	&lt;li&gt;Adds lots of new methods to ZKUtil, every one with full javadoc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12888861" author="hbasereviewboard" created="Thu, 15 Jul 2010 17:24:42 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/324/#review404&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#review404&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Looks good.  Nothing to test in this new code (though most is just replacing and adding new exception).&lt;/p&gt;


&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1716&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1716&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Client &quot;is a&quot; ServerController or do you mean that you can do ServerController actions via client?  (I see later that whats going on here is that the client is proxying Server calls)&lt;/p&gt;


&lt;p&gt;    Also, (don&apos;t kill me), but controller is bad name for this interface.  Going by the current set of methods in this interface, they are methods an actual controller would make use of; e.g. a &quot;Controller&quot; would decide its time to abort the server.&lt;/p&gt;

&lt;p&gt;    I still think it should be &apos;Server&apos; or &apos;Process&apos;&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1717&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1717&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this javadoc right?  Mentions serverstatus&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1718&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1718&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should we remove this exception?  Or deprecate it?  The MasterNotRunning one?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1719&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1719&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Having this bit of code inside each method was really bad... thats good you fixed it&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1720&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1720&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m for a super Interface.  Its odd have server-side in here.  How about Abortable Interface?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1721&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1721&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    There is a Configurable interface up in hadoop (but also has setConf which you don&apos;t want I&apos;d say)... just FYI.&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1722&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1722&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Sorry, don&apos;t remember what I said in last review but did we agree that this class actually &apos;manages&apos; the master address?  It has the watcher and updates itself if change?  That kinda thing?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1723&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1723&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Call this RSZKUpdater to match your pattern naming classes that have to do w/ zk (ZKUtil, ZKConf).&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1726&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1726&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do you mean ensemble?&lt;/p&gt;



&lt;p&gt;branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/#comment1727&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#comment1727&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should probably be ensemble but probably a big change doing that?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12888910" author="hbasereviewboard" created="Thu, 15 Jul 2010 20:27:12 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Looks good.  Nothing to test in this new code (though most is just replacing and adding new exception).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yup.  It also fixes client to follow new masters and adds in a bunch of new methods to ZKUtil (unraveling ZKWrapper mess).&lt;/p&gt;

&lt;p&gt;Next patch is finishing Master side and should be able to completely remove ZKWrapper and &lt;em&gt;all&lt;/em&gt; instances of Watchers/process() methods besides in ZooKeeperWatcher itself.&lt;/p&gt;

&lt;p&gt;Thanks for review!&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java, line 27&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2813#file2813line27&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2813#file2813line27&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Client &quot;is a&quot; ServerController or do you mean that you can do ServerController actions via client?  (I see later that whats going on here is that the client is proxying Server calls)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Also, (don&apos;t kill me), but controller is bad name for this interface.  Going by the current set of methods in this interface, they are methods an actual controller would make use of; e.g. a &quot;Controller&quot; would decide its time to abort the server.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I still think it should be &apos;Server&apos; or &apos;Process&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense and I see the confusion.&lt;/p&gt;

&lt;p&gt;I think what you say below, an Abortable interface, probably makes good sense as the common base class for all of these.  Server anything is bad on client unless it does it &lt;em&gt;to&lt;/em&gt; the server, which is not the case here.  Will do this on the next patch.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/ServerController.java, line 46&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2813#file2813line46&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2813#file2813line46&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is this javadoc right?  Mentions serverstatus&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will cleanup once we finalize&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java, line 325&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2817#file2817line325&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2817#file2817line325&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should we remove this exception?  Or deprecate it?  The MasterNotRunning one?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, this is still valid.&lt;/p&gt;

&lt;p&gt;Clients have two general exceptions now.  HTable will throw ZooKeeperConnectionException.  HBaseAdmin will throw ZK and MasterNotRunningException.&lt;/p&gt;

&lt;p&gt;MNRE is for the case when ZK is up but either has no master address in it or is unable to connect to the master address in zk.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java, line 1681&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2819#file2819line1681&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2819#file2819line1681&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I&apos;m for a super Interface.  Its odd have server-side in here.  How about Abortable Interface?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java, line 1697&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2819#file2819line1697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2819#file2819line1697&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     There is a Configurable interface up in hadoop (but also has setConf which you don&apos;t want I&apos;d say)... just FYI.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Once we add Abortable from above, this will get removed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/MasterAddressManager.java, line 20&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2825#file2825line20&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2825#file2825line20&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Sorry, don&apos;t remember what I said in last review but did we agree that this class actually &apos;manages&apos; the master address?  It has the watcher and updates itself if change?  That kinda thing?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, it actually manages it.  You point it at ZK and it exposes a method getMasterAddress() which will give you the up-to-date address from ZK (it doesn&apos;t actually read from ZK when you hit the method, it&apos;s being kept up to date automagically)&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/regionserver/RSZookeeperUpdater.java, line 1&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2826#file2826line1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2826#file2826line1&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Call this RSZKUpdater to match your pattern naming classes that have to do w/ zk (ZKUtil, ZKConf).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m hoping to rip this apart and put it into Handlers where it belongs.&lt;/p&gt;

&lt;p&gt;Right now it&apos;s kinda mixed, some stuff is ZK some stuff is ZooKeeper.  ZooKeeper is just so friggin long &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-15 10:12:34, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; branches/0.90_master_rewrite/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java, line 54&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/324/diff/2/?file=2830#file2830line54&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/diff/2/?file=2830#file2830line54&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Do you mean ensemble?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I used previous naming convention (all the existing ZK methods are about getting the quorum string).  You are probably right, it&apos;s the ensemble but would change a decent bit of existing code so not sure if we should change or not.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jonathan&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/324/#review404&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/324/#review404&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12888914" author="streamy" created="Thu, 15 Jul 2010 20:33:33 +0000"  >&lt;p&gt;Patch committed to master rewrite branch.&lt;/p&gt;</comment>
                            <comment id="12892956" author="streamy" created="Tue, 27 Jul 2010 22:01:48 +0000"  >&lt;p&gt;Complete in master rewrite branch, keeping as patch available until merge with trunk.&lt;/p&gt;</comment>
                            <comment id="12904904" author="stack" created="Wed, 1 Sep 2010 05:00:48 +0000"  >&lt;p&gt;Committed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="15017310" author="lars_francke" created="Fri, 20 Nov 2015 12:42:40 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12456730">HBASE-2238</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448624" name="HBASE-2696-part1-NewClasses_NotIntegrated.patch" size="40522" author="streamy" created="Sat, 3 Jul 2010 19:48:11 +0000"/>
                            <attachment id="12448629" name="HBASE-2696-part1-v2-NewClasses_NotIntegrated.patch" size="42926" author="streamy" created="Sat, 3 Jul 2010 21:01:02 +0000"/>
                            <attachment id="12448637" name="HBASE-2696-part1-v3-NewClasses_RS.patch" size="87251" author="streamy" created="Sun, 4 Jul 2010 05:14:53 +0000"/>
                            <attachment id="12448653" name="HBASE-2696-part1-v4-NewClasses_RS_Tested.patch" size="91914" author="streamy" created="Sun, 4 Jul 2010 17:55:17 +0000"/>
                            <attachment id="12448851" name="HBASE-2696-part1-v5-NewClasses_RS_Tested.patch" size="95362" author="streamy" created="Wed, 7 Jul 2010 03:43:22 +0000"/>
                            <attachment id="12449590" name="HBASE-2696-part2-v2-FinishRS_FixClient.patch" size="97623" author="streamy" created="Thu, 15 Jul 2010 20:33:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 5 Jul 2010 17:35:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32723</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hisn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100307</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>