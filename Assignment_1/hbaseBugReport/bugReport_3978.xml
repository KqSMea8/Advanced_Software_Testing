<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3978/HBASE-3978.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3978] rowlock lease renew doesn&apos;t work when custom coprocessor/RegionObserver indicates to bypass default action</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3978</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Region server will keep extending the lease on the rowlock as long as there is some action on the row. This is done inside HRegionServer.getLockFromId, where it renew the lease on the rowlock. However, when coprocessor &quot;pre-action&quot; observer is used, getLockFromId is skipped if default action is bypassed. Take HRegionServer.exists as example, RegionCoprocessorHost.preExists could return Boolean object if one of the regionobservers indicates default action should be bypassed; thus getLockFromId didn&apos;t called and the lease on the lock doesn&apos;t get renewed.&lt;/p&gt;

&lt;p&gt;  public boolean exists(byte[] regionName, Get get) throws IOException {&lt;br/&gt;
    checkOpen();&lt;br/&gt;
    requestCount.incrementAndGet();&lt;br/&gt;
    try {&lt;br/&gt;
      HRegion region = getRegion(regionName);&lt;br/&gt;
      if (region.getCoprocessorHost() != null) {&lt;br/&gt;
        Boolean result = region.getCoprocessorHost().preExists(get);&lt;br/&gt;
        if (result != null) &lt;/p&gt;
{
          return result.booleanValue();
        }
&lt;p&gt;      }&lt;br/&gt;
      Result r = region.get(get, getLockFromId(get.getLockId()));&lt;br/&gt;
      boolean result = r != null &amp;amp;&amp;amp; !r.isEmpty();&lt;br/&gt;
      if (region.getCoprocessorHost() != null) &lt;/p&gt;
{
        result = region.getCoprocessorHost().postExists(get, result);
      }
&lt;p&gt;      return result;&lt;br/&gt;
    } catch (Throwable t) &lt;/p&gt;
{
      throw convertThrowableToIOE(cleanup(t));
    }
&lt;p&gt;  }&lt;/p&gt;


&lt;p&gt;The application scenario is:&lt;br/&gt;
a) client application passes in a rowlock object in an action.&lt;br/&gt;
b) there is custom coprocessor/observer used.&lt;br/&gt;
c) For a given action, the custom coprocessor/observer might tell coprocessor framework to bypass the default action.&lt;/p&gt;

&lt;p&gt;From client application point of view, the behavior is sometimes the rowlock will timeout even though client is accessing the row all the time, depending on whether coprocessor/observer wants to bypass the default action.&lt;/p&gt;

&lt;p&gt;This applies to several other actions as well, increment, checkAndPut, checkandDelete.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509878">HBASE-3978</key>
            <summary>rowlock lease renew doesn&apos;t work when custom coprocessor/RegionObserver indicates to bypass default action</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mingma">Ming Ma</assignee>
                                    <reporter username="mingma">Ming Ma</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2011 21:25:36 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:15 +0000</updated>
                            <resolved>Sun, 12 Jun 2011 16:07:37 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>Coprocessors</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13047500" author="stack" created="Fri, 10 Jun 2011 22:09:04 +0000"  >&lt;p&gt;You have a patch Ming?&lt;/p&gt;</comment>
                            <comment id="13047779" author="mingma" created="Fri, 10 Jun 2011 23:49:47 +0000"  >&lt;p&gt;Stack, here is the fix. Please review. Thanks.&lt;/p&gt;</comment>
                            <comment id="13047903" author="apurtell" created="Sat, 11 Jun 2011 14:18:16 +0000"  >&lt;p&gt;Yep, this is a bug. Good catch Ming.&lt;/p&gt;

&lt;p&gt;+1 on patch. Will commit after local tests.&lt;/p&gt;</comment>
                            <comment id="13048365" author="apurtell" created="Sun, 12 Jun 2011 16:07:37 +0000"  >&lt;p&gt;Committed after all local tests pass.&lt;/p&gt;</comment>
                            <comment id="13050993" author="hudson" created="Fri, 17 Jun 2011 11:00:07 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1976 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/1976/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/1976/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="15015702" author="lars_francke" created="Fri, 20 Nov 2015 11:52:15 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482119" name="HBASE-3978-TRUNK.patch" size="4674" author="mingma" created="Fri, 10 Jun 2011 23:48:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Jun 2011 22:09:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27115</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hot3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>