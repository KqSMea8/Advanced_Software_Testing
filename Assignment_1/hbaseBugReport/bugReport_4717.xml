<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:21:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4717/HBASE-4717.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4717] More efficient age-off of old data during major compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4717</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Many applications need to implement efficient age-off of old data. We currently only perform age-off during major compaction by scanning through all of the KVs. Instead, we could implement the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Set hbase.hstore.compaction.max.size reasonably small. Thus, older store files contain only smaller finite ranges of time.&lt;/li&gt;
	&lt;li&gt;Periodically run an &quot;age-off compaction&quot;. This compaction would scan the current list of storefiles. Any store file that falls entirely out of the TTL time range would be dropped. Store files completely within the time range would be un-altered. Those crossing the time-range boundary could either be left alone or compacted using the existing compaction code.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t have a design in mind for how exactly this would be implemented, but hope to generate some discussion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12529705">HBASE-4717</key>
            <summary>More efficient age-off of old data during major compaction</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Nov 2011 17:42:20 +0000</created>
                <updated>Sat, 11 Apr 2015 01:16:14 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 01:16:14 +0000</resolved>
                                    <version>0.94.0</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13141445" author="streamy" created="Tue, 1 Nov 2011 18:34:57 +0000"  >&lt;p&gt;+1 on this general direction.&lt;/p&gt;

&lt;p&gt;We&apos;ve long talked of special compaction heuristics that would bucketize by time in some way (and you could really take advantage of the TimeRangeTracker file selection stuff for read perf).  We did as you describe and set a small max.size, so once a file reached a certain size, it would never be compacted again.  This allowed us to &quot;age out&quot; the data by keeping old stuff separate from new stuff in files.&lt;/p&gt;

&lt;p&gt;We were not trying to actually wipe out the data, only separate it, because this was mostly a read-modify-write workload that needed access to recent data but the old data still needed to be available for user read queries.  It would probably be simple to add a check during compaction time of the time range of each file and if the max is expired, just to wipe out that file.&lt;/p&gt;</comment>
                            <comment id="13141681" author="tlipcon" created="Tue, 1 Nov 2011 22:18:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;It would probably be simple to add a check during compaction time of the time range of each file and if the max is expired, just to wipe out that file.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s one optimization, but only saves on the read of the now-expired file. We still have to read/rewrite all of the rest of the data periodically to do the age-off.&lt;/p&gt;

&lt;p&gt;The new idea above is to introduce something more like a &quot;filtration&quot; than a &quot;compaction&quot; &amp;#8211; you would only rewrite files that have a significant amount of data to be aged.&lt;/p&gt;</comment>
                            <comment id="13141801" author="dhruba" created="Wed, 2 Nov 2011 00:25:56 +0000"  >&lt;p&gt;Is it possible to looks at blooms (that are mostly in block cache) for two Hfiles, estimate how much overlap is there between kvs and then decide whether to compact/merge those two files?&lt;/p&gt;</comment>
                            <comment id="13141851" author="tlipcon" created="Wed, 2 Nov 2011 02:28:08 +0000"  >&lt;p&gt;nice idea - that&apos;s probably useful outside of this use case, too. Another idea is maintaining time range histograms for each storefile to estimate whether it&apos;s worth doing a &quot;filtration&quot;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12539693">HBASE-5274</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12538374">HBASE-5199</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Nov 2011 18:34:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02fhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12109</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>