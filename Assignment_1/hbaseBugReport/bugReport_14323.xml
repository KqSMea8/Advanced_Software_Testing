<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:51:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14323/HBASE-14323.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14323] Encoding rpc payload instead of compression</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14323</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Current HFile block support both encoding and compression, but rpc support only compression and it is slow. If we add encoding in rpc we can slow a little but may use much less network. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12859531">HBASE-14323</key>
            <summary>Encoding rpc payload instead of compression</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aoxiang">binlijin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Aug 2015 07:40:31 +0000</created>
                <updated>Fri, 28 Aug 2015 03:23:25 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="14716233" author="aoxiang" created="Thu, 27 Aug 2015 07:51:21 +0000"  >&lt;p&gt;I find it difficult to reuse code with DataBlockEncoding, so i copy many code and test with it.&lt;/p&gt;</comment>
                            <comment id="14716237" author="aoxiang" created="Thu, 27 Aug 2015 07:53:51 +0000"  >&lt;p&gt;&apos;&apos;&apos;&lt;br/&gt;
    int numRow = 1000000;  &lt;br/&gt;
   int qualifierNum = 10;&lt;br/&gt;
    int valueLength = 10;&lt;br/&gt;
FastDiffDeltaKeyValueCodec size 30&lt;br/&gt;
KeyValueCodec size 84&lt;br/&gt;
org.apache.hadoop.hbase.codec.FastDiffDeltaKeyValueCodec encodeTime 3457 decodeTime 2794, total size 163000000, avg size 163&lt;br/&gt;
Thu Aug 27 15:47:24 CST 2015 avg encodeTime 3457 ns, avg decodeTime 2794 ns&lt;br/&gt;
org.apache.hadoop.hbase.codec.FastDiffDeltaKeyValueCodec encodeTime 2827 decodeTime 2488, total size 163000000, avg size 163&lt;br/&gt;
Thu Aug 27 15:47:34 CST 2015 avg encodeTime 2827 ns, avg decodeTime 2488 ns&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 1105 decodeTime 943, total size 450000000, avg size 450&lt;br/&gt;
Thu Aug 27 15:47:41 CST 2015 avg encodeTime 1105 ns, avg decodeTime 943 ns&lt;br/&gt;
org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 1069 decodeTime 873, total size 450000000, avg size 450&lt;br/&gt;
Thu Aug 27 15:47:48 CST 2015 avg encodeTime 1069 ns, avg decodeTime 873 ns&lt;/p&gt;

&lt;p&gt;Compression org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 61465 decodeTime 6097, total size 196333884, avg size 196&lt;br/&gt;
Thu Aug 27 15:49:14 CST 2015 avg encodeTime 61465 ns, avg decodeTime 6097 ns&lt;br/&gt;
Compression org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 59453 decodeTime 5779, total size 196334653, avg size 196&lt;br/&gt;
Thu Aug 27 15:50:36 CST 2015 avg encodeTime 59453 ns, avg decodeTime 5779 ns&lt;br/&gt;
&apos;&apos;&apos;&lt;/p&gt;</comment>
                            <comment id="14716246" author="aoxiang" created="Thu, 27 Aug 2015 08:02:18 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numRow = 1000000;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; qualifierNum = 10;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; valueLength = 100;

FastDiffDeltaKeyValueCodec size 30
KeyValueCodec size 84
org.apache.hadoop.hbase.codec.FastDiffDeltaKeyValueCodec encodeTime 3459 decodeTime 2557, total size 1063000000, avg size 1063
Thu Aug 27 15:56:13 CST 2015 avg encodeTime 3459 ns, avg decodeTime 2557 ns
org.apache.hadoop.hbase.codec.FastDiffDeltaKeyValueCodec encodeTime 3069 decodeTime 2334, total size 1063000000, avg size 1063

Thu Aug 27 15:56:39 CST 2015 avg encodeTime 3069 ns, avg decodeTime 2334 ns
org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 1643 decodeTime 1061, total size 1350000000, avg size 1350
Thu Aug 27 15:57:02 CST 2015 avg encodeTime 1643 ns, avg decodeTime 1061 ns
org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 1803 decodeTime 1114, total size 1350000000, avg size 1350
Thu Aug 27 15:57:28 CST 2015 avg encodeTime 1803 ns, avg decodeTime 1114 ns

Compression org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 81695 decodeTime 16951, total size 892463832, avg size 892
Thu Aug 27 15:59:41 CST 2015 avg encodeTime 81695 ns, avg decodeTime 16951 ns
Compression org.apache.hadoop.hbase.codec.KeyValueCodec encodeTime 80586 decodeTime 16489, total size 892467912, avg size 892
Thu Aug 27 16:01:50 CST 2015 avg encodeTime 80586 ns, avg decodeTime 16489 ns
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14716314" author="yuzhihong@gmail.com" created="Thu, 27 Aug 2015 09:01:40 +0000"  >&lt;p&gt;Can you outline what difficulties you encountered in reusing the code ?&lt;br/&gt;
We should maximize code reuse&lt;/p&gt;</comment>
                            <comment id="14717298" author="stack" created="Thu, 27 Aug 2015 18:54:21 +0000"  >&lt;p&gt;Thanks for having a go at this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt;. Nice.&lt;/p&gt;

&lt;p&gt;How I read the above?  Encoding takes twice as long as non-decoded with savings of 20% in size but compression takes 16x with savings of 40%?  Encoding only works on key so if values are big, the savings will be smaller. You have notion why the compression takes so long? Extra buffer allocations?  Should we look into why compression is so slow? Thanks.&lt;/p&gt;
</comment>
                            <comment id="14717985" author="aoxiang" created="Fri, 28 Aug 2015 03:10:41 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 28.23%    java  perf-12553.map                  [.] 0x00007fd7e5248f3a                                                                                                         
 12.65%    java  libjvm.so                       [.] 0x00000000006e07c0                                                                                                         
 10.29%    java  libzip.so                       [.] deflate_slow                                                                                                               
  6.03%    java  libzip.so                       [.] pqdownheap                                                                                                                 
  4.57%    java  [kernel.kallsyms]               [k] 0xffffffff8103548a                                                                                                         
  4.17%    java  libzip.so                       [.] inflate_fast                                                                                                               
  4.02%    java  libzip.so                       [.] compress_block                                                                                                             
  3.25%    java  libzip.so                       [.] crc32                                                                                                                      
  3.24%    java  libzip.so                       [.] build_tree                                                                                                                 
  3.06%    java  libzip.so                       [.] inflate_table                                                                                                              
  2.30%    java  libc-2.5.so                     [.] 0x000000000007b874                                                                                                         
  2.22%    java  libzip.so                       [.] longest_match                                                                                                              
  1.35%    java  libzip.so                       [.] inflate                                                                                                                    
  1.25%    java  libzip.so                       [.] fill_window                                                                                                                
  1.23%    java  libjemalloc.so.1                [.] arena_avail_comp                                                                                                           
  1.19%    java  libzip.so                       [.] send_tree                                                                                                                  
  1.09%    java  libintlc.so.5                   [.] __intel_new_memcpy                                                                                                         
  0.84%    java  libjemalloc.so.1                [.] arena_avail_tree_insert                                                                                                    
  0.81%    java  libjemalloc.so.1                [.] arena_avail_tree_remove                                                                                                    
  0.69%    java  libzip.so                       [.] scan_tree                                                                                                                  
  0.55%    java  libzip.so                       [.] Java_java_util_zip_Deflater_deflateBytes                                                                                   
  0.47%    java  libjemalloc.so.1                [.] arena_mapp_get                                                                                                             
  0.43%    java  libzip.so                       [.] deflate                                                                                                                    
  0.34%    java  libzip.so                       [.] _tr_flush_block                                                                                                            
  0.29%  :12553  [unknown]                       [.] 0x00007fd7e81a81a2                                                                                                         
  0.28%    java  libpthread-2.5.so               [.] 0x0000000000008d10                                                                                                         
  0.23%    java  libjemalloc.so.1                [.] arena_mapbits_get                                                                                                          
  0.19%    java  libjemalloc.so.1                [.] arena_run_dalloc                                                                                                           
  0.19%    java  libzip.so                       [.] _tr_init                                                                                                                   
  0.18%    java  libjemalloc.so.1                [.] arena_run_split                                                                                                            
  0.17%    java  libzip.so                       [.] Java_java_util_zip_CRC32_updateBytes                                                                                       
  0.16%    java  libjemalloc.so.1                [.] arena_mapbitsp_get                                                                                                         
  0.15%    java  libjemalloc.so.1                [.] arena_avail_tree_nsearch                                                                                                   
  0.15%    java  libjemalloc.so.1                [.] arena_mapbits_get                                                                                                          
  0.14%    java  libzip.so                       [.] inflateEnd                                                                                                                 
  0.13%    java  libjemalloc.so.1                [.] arena_malloc_large                                                                                                         
  0.12%    java  [vsyscall]                      [.] 0x0000000000000168                                                                                                         
  0.12%    java  libjemalloc.so.1                [.] tcache_alloc_small                                                                                                         
  0.11%    java  libjemalloc.so.1                [.] arena_mapbits_unallocated_set                                                                                              
  0.11%    java  libjemalloc.so.1                [.] arena_dalloc_large_locked                                                                                                  
  0.11%    java  libjemalloc.so.1                [.] arena_mapp_get                                                                                                             
  0.09%    java  libjemalloc.so.1                [.] malloc                     
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14717997" author="aoxiang" created="Fri, 28 Aug 2015 03:23:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, Just as you read above and i perf the compression and the result is posted in the above.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12611074">HBASE-6966</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12519171">HBASE-4218</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12752690" name="HBASE-14323-test.patch" size="26927" author="aoxiang" created="Thu, 27 Aug 2015 07:44:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Aug 2015 09:01:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jfpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>