<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:43:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7191/HBASE-7191.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7191] HBCK - Add offline create/fix hbase.version and hbase.id </title>
                <link>https://issues.apache.org/jira/browse/HBASE-7191</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;One of our clients run into a problem, in which they have the hbase.root.dir, and cluster data, but their hbase.id and hbase.version files are corrupted. HMaster creates those on start, but not if there is already existing data.&lt;/p&gt;

&lt;p&gt;We can add smt like --fixIdFile, and ability for HBCK to do some offline repairs for the version file. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12616867">HBASE-7191</key>
            <summary>HBCK - Add offline create/fix hbase.version and hbase.id </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Nov 2012 00:40:52 +0000</created>
                <updated>Sat, 11 Apr 2015 00:25:32 +0000</updated>
                                            <version>0.94.1</version>
                                                    <component>hbck</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13501214" author="ozhurakousky" created="Tue, 20 Nov 2012 14:45:57 +0000"  >&lt;p&gt;Actually, this affects other versions as well&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HBase 0.94.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Further more; FSUtils spits out a misleading message&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;File system needs to be upgraded.&quot;&lt;/span&gt;
      + &lt;span class=&quot;code-quote&quot;&gt;&quot;  You have version &quot;&lt;/span&gt; + version
      + &lt;span class=&quot;code-quote&quot;&gt;&quot; and I want version &quot;&lt;/span&gt; + HConstants.FILE_SYSTEM_VERSION
      + &lt;span class=&quot;code-quote&quot;&gt;&quot;.  Run the &apos;${HBASE_HOME}/bin/hbase migrate&apos; script.&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As far as I can tell &apos;migrate&apos; script is no longer available&lt;/p&gt;

&lt;p&gt;One would think &apos;hbase hbck -fixVersionFile&apos; would do the trick, but that requires a running instance of HBase which we can&apos;t start unless those two files are in tact &lt;/p&gt;

&lt;p&gt;The current workaround is to temporarily change the value of &apos;hbase.rootdir&apos; -&amp;gt; start/stop hbase (this will re-create the two files) -&amp;gt; copy those files to the original &apos;hbase.rootdir&apos; and change &apos;hbase.rootdir&apos; to point back to the original one. However, this is obviously a hack. May what really needs to happen is to have and offline option of &apos;hbase hbck -fixVersionFile&apos;.&lt;/p&gt;</comment>
                            <comment id="13501323" author="jxiang" created="Tue, 20 Nov 2012 17:41:25 +0000"  >&lt;p&gt;We can add -fixVersionFile to the offline meta repair tool.&lt;/p&gt;</comment>
                            <comment id="13501438" author="ozhurakousky" created="Tue, 20 Nov 2012 20:17:18 +0000"  >&lt;p&gt;Attaching a patch which basically adds two options to OfflineMetaRepair&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ hbase org.apache.hadoop.hbase.util.hbck.OfflineMetaRepair -fixVersionFile

$ hbase org.apache.hadoop.hbase.util.hbck.OfflineMetaRepair -fixClusterIdFile
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also fixed a few other minor things such as System.exit(..) which prevented proper testing and quite frankly not needed as access to the executor can still be obtain via Reflection.&lt;/p&gt;</comment>
                            <comment id="13501442" author="hadoopqa" created="Tue, 20 Nov 2012 20:23:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12554402/7191.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12554402/7191.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3378//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3378//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13501459" author="ozhurakousky" created="Tue, 20 Nov 2012 20:53:49 +0000"  >&lt;p&gt;The new patch includes modified hbase-site.xml file which has hbase.root set which is required by the test&lt;/p&gt;</comment>
                            <comment id="13501462" author="hadoopqa" created="Tue, 20 Nov 2012 21:04:04 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12554407/7191-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12554407/7191-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3379//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3379//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13501489" author="ozhurakousky" created="Tue, 20 Nov 2012 21:26:31 +0000"  >&lt;p&gt;Not sure what I can do. The test does pass but there are other failing tests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed tests:   testSplitCalculatorEq(org.apache.hadoop.hbase.util.TestRegionSplitCalculator): expected:&amp;lt;2&amp;gt; but was:&amp;lt;1&amp;gt;
  testNativeSizes(org.apache.hadoop.hbase.io.TestHeapSize): expected:&amp;lt;56&amp;gt; but was:&amp;lt;64&amp;gt;
  testSizes(org.apache.hadoop.hbase.io.TestHeapSize): expected:&amp;lt;192&amp;gt; but was:&amp;lt;200&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; and looking at the Jenkins report there hasn&apos;t been a successful build since October 30 (as far as I can see).&lt;/p&gt;

&lt;p&gt;The irony is that for example TestRegionSplitCalculator test passes locally if ran in isolation &lt;/p&gt;</comment>
                            <comment id="13501523" author="devaraj" created="Tue, 20 Nov 2012 21:58:00 +0000"  >&lt;p&gt;Haven&apos;t looked at the patch in detail but some things that you should take care of: &lt;br/&gt;
(1) indentation of code (two spaces, look at the existing code for getting a feel of how it should look like).&lt;br/&gt;
(2) patch should be submitted for trunk first (ideally)&lt;br/&gt;
There are flaky tests in the codebase. If you see an unrelated test failing on hudson, and the test passes locally, please make a note of it as a comment on jira.&lt;/p&gt;</comment>
                            <comment id="13501528" author="yuzhihong@gmail.com" created="Tue, 20 Nov 2012 22:01:17 +0000"  >&lt;p&gt;For OfflineVersionAndClusterIdFixTests.java, usually test class starts with Test. Name it TestOfflineVersionAndClusterIdFix&lt;br/&gt;
It should carry the following annotation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Category(SmallTests.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(success ? 0 : 1);
+     shutDownFsck(fsck);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can you log the value of success above ?&lt;br/&gt;
For shutDownFsck(), can you add a method in HBaseFsck which shuts down executor ?&lt;/p&gt;</comment>
                            <comment id="13501529" author="ozhurakousky" created="Tue, 20 Nov 2012 22:03:08 +0000"  >&lt;p&gt;Thanks Deveraj&lt;br/&gt;
The 3 failing tests are mentioned in the previous comment. Actually they pass in isolation, but not as a full build (unrelated to the patch). I&apos;ll check the indentation and resubmit. Let me know if there is anything else you&apos;ll see in the meantime. I&apos;ll also do another one anyway from the trunk&lt;/p&gt;</comment>
                            <comment id="13501530" author="ozhurakousky" created="Tue, 20 Nov 2012 22:04:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt;&lt;br/&gt;
Sure, will do&lt;/p&gt;</comment>
                            <comment id="13501568" author="yuzhihong@gmail.com" created="Tue, 20 Nov 2012 23:17:43 +0000"  >&lt;p&gt;@Oleg:&lt;br/&gt;
w.r.t. the test failures in TestHeapSize, did you run the tests using Java 1.7 ?&lt;br/&gt;
I encountered the same failure on MacBook with 1.7.0_07-b10&lt;/p&gt;</comment>
                            <comment id="13501662" author="ozhurakousky" created="Wed, 21 Nov 2012 02:22:25 +0000"  >&lt;p&gt;That might be the case. I&apos;ll check in the AM. The funny thing is that they all pass in IDE and/or if ran in isolation via maven, but not with other tests. But you may be right, i may have 1.7 as a default. &lt;/p&gt;</comment>
                            <comment id="14490603" author="apurtell" created="Sat, 11 Apr 2015 00:25:32 +0000"  >&lt;p&gt;Cancelling stale patch. I guess this issue can be closed?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12554407" name="7191-2.patch" size="7733" author="ozhurakousky" created="Tue, 20 Nov 2012 20:53:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Nov 2012 14:45:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>258739</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l2vz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121118</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>