<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:52:43 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1342/HBASE-1342.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1342] Add to filesystem info needed to rebuild .META.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1342</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From Cosmin up on list:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Hi,

Is there any way to rebuild the .META. Table with information in HDFS?

&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; story &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;, the namenode ran out of disk and crashed and we couldn&apos;t
have it load the edits.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file at startup (the edits.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file seemed
corrupted and it failed to read some &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; value) so we removed the edits.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;
file. Apparently the edits file had 10 - 15 entries. Some edit data on
-ROOT-, some edit data on .META., some data on a table compaction
(comapction.dir) and some data on some hbase logs. Only last entry seem to
be bogus, having almost a megabyte of trailing zeroes.

After renaming edits.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HDFS started ok and HBase data is present. However
when we started Hbase one table was missing entirely and one table was
empty. The HBase master report shows Regions On FS: 94, but the report on
region servers shows only 10 regions on all the region servers.

Is there any way to cleanup hbase and rebuild the .META. table from HDFS?
This would be ok even &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it implies throwing up some data.

If we would clean the edits.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file and restart HDFS or &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we would
manually apply the edits would that still make consistent changes to HBase
data?

Thanks,
Cosmin
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lets log the info needed to rebuild your .META. or add things like HRegionInfo made creating a region as a file under each region directory.  That don&apos;t seem hard and the info could be used rebuilding.  What else would we need?&lt;/p&gt;

&lt;p&gt;Marking as blocker/critical for 0.20.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12423637">HBASE-1342</key>
            <summary>Add to filesystem info needed to rebuild .META.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Apr 2009 22:52:18 +0000</created>
                <updated>Tue, 23 Mar 2010 14:00:54 +0000</updated>
                            <resolved>Fri, 1 May 2009 22:34:55 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12702154" author="stack" created="Thu, 23 Apr 2009 22:54:29 +0000"  >&lt;p&gt;Relating to the fsck tool&lt;/p&gt;</comment>
                            <comment id="12704791" author="stack" created="Thu, 30 Apr 2009 20:52:25 +0000"  >&lt;p&gt;Currently, I&apos;m thinking of writing a file into the Region subdirectory named regioninfo on region creation.  It would contain the serialized HRegionInfo followed by a text version of HRegionInfo.  Cat&apos;ing the regioninfo file, you&apos;d see binary garbage followed by text representation.  A tool should be able to recreate an HRI just be deserializing from this file.  The text part would be so humans could see what the region was about.&lt;/p&gt;

&lt;p&gt;I was originally thinking of writing this file every time the region was deployed.  This would up the hdfs load on startup. I was thinking we&apos;d do this because parts of the HRI can go stale and rewriting it on every deploy would keep it pretty fresh.  But I think as far as rebuilding the .META., figuring what the table and column descriptors were just before the need for repair will be figured elsewhere.&lt;/p&gt;

&lt;p&gt;A tool that rebuilds the .META. will still not have enough to rebuild the .META. using regioninfo.  The rebuild tool will have to sort and make sense of the list of regions it has figuring which are parent regions and which are daughters, etc., but I think that this can be done up in the tool using common sense checking if storefiles have references, etc.; in other words, there is enough to go on rebuilding table and column descriptors.  The regioninfo is for region name, region id and for easy access to start/end key, critical info needed rebuilding .META.&lt;/p&gt;

&lt;p&gt;Was also going to change master logging so it emitted the HRI at INFO level so could go there ultimately to resolve what happened when &amp;#8211; if needed.&lt;/p&gt;</comment>
                            <comment id="12705119" author="stack" created="Fri, 1 May 2009 21:11:45 +0000"  >&lt;p&gt;Patch coming.  Here is what it does meantime.&lt;/p&gt;

&lt;p&gt;It adds a file on HRegion initialization.  If already there, does nothing.  File is named .regioninfo.  Presumption is that the families list is gotten from schema, not by doing a listing of whats under the region directory (I&apos;ve added code to stop a user creating a family named .regioninfo).&lt;/p&gt;

&lt;p&gt;File looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
^@^@^@^@^@^@^@^@^@^@^@  -ROOT-,,0^@^@^@^@^@^D^F-ROOT-^A^A^@^@^@^B^@^@^@^GIS_ROOT^@^@^@^Dtrue^@^@^@^GIS_META^@^@^@^Dtrue^@^@^@^A^G^Dinfo^@^@^@^H^@^@^@^KBLOOMFILTER^@^@^@^Efalse^@^@^@^KCOMPRESSION^@^@^@^DNONE^@^@^@^HVERSIONS^@^@^@^B10^@^@^@^FLENGTH^@^@^@
2147483647^@^@^@^CTTL^@^@^@^B-1^@^@^@   BLOCKSIZE^@^@^@^D8192^@^@^@     IN_MEMORY^@^@^@^Efalse^@^@^@
BLOCKCACHE^@^@^@^Dtrue^@^@^@^@c&#1582;^O

REGION =&amp;gt; {NAME =&amp;gt; &apos;-ROOT-,,0&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 70236052, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;-ROOT-&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;10&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}], INDEXES =&amp;gt; []}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its the serialized HRI followed by text version.  Two newlines separates them.&lt;/p&gt;

&lt;p&gt;To read the binary part to reconstruct an HRI, just do something like this (using shell):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
durruti:trunk stack$ ./bin/hbase shell
HBase Shell; enter &apos;help&amp;lt;RETURN&amp;gt;&apos; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; list of supported commands.
Version: 0.20.0-dev, r770006, Fri May  1 10:52:11 PDT 2009
hbase(main):001:0&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.fs.FileSystem
=&amp;gt; Java::OrgApacheHadoopFs::FileSystem
hbase(main):002:0&amp;gt; fs = FileSystem.get(@configuration)
=&amp;gt; #&amp;lt;Java::OrgApacheHadoopFs::LocalFileSystem:0x875de82 @java_object=#&amp;lt;Java::JavaObject:0x314dd379&amp;gt;&amp;gt;
hbase(main):003:0&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HRegionInfo
file:/Users/stack/checkouts/hbase/trunk/lib/jruby-complete-1.2.0.jar!/META-INF/jruby.home/lib/ruby/site_ruby/1.8/builtin/javasupport/core_ext/object.rb:34 warning: already initialized constant HRegionInfo
=&amp;gt; Java::OrgApacheHadoopHbase::HRegionInfo
hbase(main):004:0&amp;gt; hri = HRegionInfo.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; 
=&amp;gt; #&amp;lt;Java::OrgApacheHadoopHbase::HRegionInfo:0x12082fd2 @java_object=#&amp;lt;Java::JavaObject:0x45cfa4ed&amp;gt;&amp;gt;
hbase(main):006:0&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.fs.Path
=&amp;gt; Java::OrgApacheHadoopFs::Path
hbase(main):007:0&amp;gt; p = Path.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/hbase-stack/hbase/-ROOT-/70236052/.regioninfo/&quot;&lt;/span&gt;)
=&amp;gt; #&amp;lt;Java::OrgApacheHadoopFs::Path:0x779dfb5a @java_object=#&amp;lt;Java::JavaObject:0x70db5d33&amp;gt;&amp;gt;
hbase(main):009:0&amp;gt; fin = fs.open(p)
=&amp;gt; #&amp;lt;Java::OrgApacheHadoopFs::FSDataInputStream:0x3dbe5cb8 @java_object=#&amp;lt;Java::JavaObject:0x32d7970b&amp;gt;&amp;gt;
hbase(main):011:0&amp;gt; hri.readFields(fin)
hbase(main):012:0&amp;gt; fin.close()
hbase(main):014:0&amp;gt; p hri.toString()
&lt;span class=&quot;code-quote&quot;&gt;&quot;REGION =&amp;gt; {NAME =&amp;gt; &apos;-ROOT-,,0&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 70236052, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;-ROOT-&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;10&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}], INDEXES =&amp;gt; []}}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That should be some help reconstructing .META.&lt;/p&gt;

&lt;p&gt;Let me review the master logging now to make sure good stuff shows there at info level.&lt;/p&gt;</comment>
                            <comment id="12705162" author="stack" created="Fri, 1 May 2009 22:33:19 +0000"  >&lt;p&gt;This patch ups logging on master mostly so region transitions do not log their name only but now log the whole RegionInfo.  Makes it so the encoded name, start and stop keys are to hand debugging or when trying to figure sequence of events &amp;#8211; which is the parent and which the daughter, and which daughter does what part of range.&lt;/p&gt;

&lt;p&gt;If the extra logging intrusive, we can dial it down later.&lt;/p&gt;</comment>
                            <comment id="12705163" author="stack" created="Fri, 1 May 2009 22:34:55 +0000"  >&lt;p&gt;Marking it incompatible because introduces new stipulation regards family names; family names now cannot start with a dot to prevent clashing with such as the new .regioninfo file that we write under region directory.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12384791">HBASE-7</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12384791">HBASE-7</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12459997">HBASE-2366</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12407043" name="1342.patch" size="6088" author="stack" created="Fri, 1 May 2009 22:33:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hcp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99319</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>