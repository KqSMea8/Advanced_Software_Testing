<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:00:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2223/HBASE-2223.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2223] Handle 10min+ network partitions between clusters</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2223</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We need a nice way of handling long network partitions without impacting a master cluster (which pushes the data). Currently it will just retry over and over again.&lt;/p&gt;

&lt;p&gt;I think we could:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Stop replication to a slave cluster if it didn&apos;t respond for more than 10 minutes&lt;/li&gt;
	&lt;li&gt;Keep track of the duration of the partition&lt;/li&gt;
	&lt;li&gt;When the slave cluster comes back, initiate a MR job like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2221&quot; title=&quot;MR to copy a table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2221&quot;&gt;&lt;del&gt;HBASE-2221&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Maybe we want less than 10 minutes, maybe we want this to be all automatic or just the first 2 parts. Discuss.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12456177">HBASE-2223</key>
            <summary>Handle 10min+ network partitions between clusters</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12421518">HBASE-1295</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Feb 2010 19:56:50 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:41 +0000</updated>
                            <resolved>Thu, 1 Jul 2010 00:28:13 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="12833142" author="ryanobjc" created="Fri, 12 Feb 2010 20:03:22 +0000"  >&lt;p&gt;the problem with automatically spawning hard hitting jobs is they usually get spawned at like the worst time possible and take down your site, etc, etc.&lt;/p&gt;

&lt;p&gt;We probably need some kind of replication status/UI/etc.  Hopefully we can leverage ZK and put most/all of the shared state in there.&lt;/p&gt;</comment>
                            <comment id="12833161" author="jdcryans" created="Fri, 12 Feb 2010 20:53:39 +0000"  >&lt;p&gt;That&apos;s my thinking too, so probably that the first version of this tool will just help the hbase administrator make the right choices.&lt;/p&gt;</comment>
                            <comment id="12833187" author="apurtell" created="Fri, 12 Feb 2010 21:52:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;When the slave cluster comes back, initiate a MR job like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2221&quot; title=&quot;MR to copy a table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2221&quot;&gt;&lt;del&gt;HBASE-2221&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Or just restart replication after the slave is back online and interleave edits from the queue with new ones as necessary?&lt;/p&gt;</comment>
                            <comment id="12833192" author="jdcryans" created="Fri, 12 Feb 2010 22:07:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;Or just restart replication after the slave is back online and interleave edits from the queue with new ones as necessary?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;One thing I forgot to add is that the job would be configured to only treat timestamps newer than x.&lt;/p&gt;

&lt;p&gt;So the problem with resending those edits is something I tackled in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2197&quot; title=&quot;Start replication from a point in time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2197&quot;&gt;&lt;del&gt;HBASE-2197&lt;/del&gt;&lt;/a&gt;. If one cluster gets very very late like 2 hours, we have to decide where we are going to get that data. One option is using the old log files but also the log files that are currently in the region servers. It ain&apos;t so bad, but what happens in the case of failure? In 2197, the first solution I described involves using a distributed queue where all RS would participate in processing each log file and interleave them with the rest of the stream.&lt;/p&gt;

&lt;p&gt;Another option is keeping yet another set of log files, separate from the &quot;normal&quot; ones, that we use to flush log entries if some cluster gets late. Then if a region server dies, we process both sets of log files.&lt;/p&gt;</comment>
                            <comment id="12833193" author="ryanobjc" created="Fri, 12 Feb 2010 22:07:30 +0000"  >&lt;p&gt;it might be better not to have a mixed view of the world during the catch up period, this could cause application problems if they need to assume a single arrow of time of edits, and not wanting to see a partial world view.&lt;/p&gt;

&lt;p&gt;With multiPut, catching up should be quite speedy...&lt;/p&gt;</comment>
                            <comment id="12833198" author="apurtell" created="Fri, 12 Feb 2010 22:17:18 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Or just restart replication after the slave is back online and interleave edits from the queue with new ones as necessary?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; this could cause application problems if they need to assume a single arrow of time of edits, and not wanting to see a partial world view&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, makes sense for the first cut. Especially if replication logic is pluggable and subclassable. Applications can plug in their own policies to do what makes the most sense for them. &lt;/p&gt;</comment>
                            <comment id="12833203" author="ryanobjc" created="Fri, 12 Feb 2010 22:26:04 +0000"  >&lt;p&gt;the previous plan was to NOT delete the log files if replication needed them... Sounds like you changed that?&lt;/p&gt;

&lt;p&gt;If replication needs a log file and the server crashed and they are set to be split, we need to NOT delete the logfile, move them to a holding area perhaps and then get someone to pick the up and send them along.&lt;/p&gt;


&lt;p&gt;A 2 hour outage isnt that much, I&apos;d say that we should buffer logs until someone decides it&apos;s not worth the disk space.  Ie: make it a top level admin action/alert and give the administrator an option to drop the log retention and then do alternative catch up later.  &lt;/p&gt;

&lt;p&gt;It would be better to hold on to a few TB of replication logs then replay that after 24-48 hours of downtime than to mess with the map-reduce stuff, since you&apos;d have to be careful to hopefully avoid duplicating keyvalues.&lt;/p&gt;</comment>
                            <comment id="12833209" author="jdcryans" created="Fri, 12 Feb 2010 22:36:15 +0000"  >&lt;blockquote&gt;
&lt;p&gt;the previous plan was to NOT delete the log files if replication needed them... Sounds like you changed that?&lt;br/&gt;
If replication needs a log file and the server crashed and they are set to be split, we need to NOT delete the logfile, move them to a holding area perhaps and then get someone to pick the up and send them along.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2070&quot; title=&quot;Collect HLogs and delete them after a period of time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2070&quot;&gt;&lt;del&gt;HBASE-2070&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;A 2 hour outage isnt that much, I&apos;d say that we should buffer logs until someone decides it&apos;s not worth the disk space. Ie: make it a top level admin action/alert and give the administrator an option to drop the log retention and then do alternative catch up later.&lt;/p&gt;

&lt;p&gt;It would be better to hold on to a few TB of replication logs then replay that after 24-48 hours of downtime than to mess with the map-reduce stuff, since you&apos;d have to be careful to hopefully avoid duplicating keyvalues.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s how I see we could do it if we don&apos;t do the MR path.&lt;/p&gt;</comment>
                            <comment id="12833227" author="ryanobjc" created="Fri, 12 Feb 2010 23:01:53 +0000"  >&lt;p&gt;so if we lose a replication stream, it is an uneven break, at this point we cant say &apos;we are missing all edits from TS=X to TS=Y&apos; and kick off a map-reduce job to read them over.  &lt;/p&gt;

&lt;p&gt;The central question is, do we want to avoid duplicate KeyValues as much as possible?  I say yes, because it messes with the version checking and is in general sloppy.  &lt;/p&gt;

&lt;p&gt;Also edits dont pile up that quickly on mainline serving systems... so in reality we arent talking about a 50TB log storage requirement. &lt;/p&gt;

&lt;p&gt;We should probably be tracking the status of all logfiles in zookeeper so we know who needs what and when.&lt;/p&gt;</comment>
                            <comment id="12835532" author="jdcryans" created="Fri, 19 Feb 2010 00:52:53 +0000"  >&lt;p&gt;Some design notes:&lt;/p&gt;

&lt;p&gt;We need another class to manage multiple ReplicationSources (going to many slave clusters) between ReplicationHLog and ReplicationSrouce, let&apos;s call it ReplicationSourceManager (RSM) for the moment. That class should be responsible to take actions and keep tabs for each outbound stream. When a source successfully sent a batch of edits to a peer, it should report the latest HLogKey to the RSM so that we match it to a HLog file (using the writeTime) and then publish that in Zookeeper for each slave cluster.&lt;/p&gt;

&lt;p&gt;We could detect that a peer is unreachable if the ReplicationSource didn&apos;t report after X time (configurable, not sure what should be the default). Here I&apos;m still wondering what would be the best way to detect that a peer cluster is back... retrying connections to the peer ZK quorum? We also need to manage if the cluster is simply shut down (using the shutdown znode). At that point we stop queuing entries for that source and pile up all the Hlogs to process in a list in ZK. We also need a way here of telling the Master to not delete those logs. We should manage the fact that a hlog may be moved to the oldlogs directory so if the hlog isn&apos;t in the local log dir, it&apos;s probably in the other directory.&lt;/p&gt;

&lt;p&gt;When the cluster comes back, we process in order all HLogs without merging with the current flow of entries since we would now have 2 different set of HLogs to keep track of (we could improve this in the future). It&apos;s only when we reach the current HLog file that we flip the switch to take new entries. I expect that to be very tricky.&lt;/p&gt;

&lt;p&gt;Even trickier is keeping track of those HLogs when a RS dies on the master cluster. The pile of HLogs to process will still be in ZK along the latest HLogKey that was processed. It means we have to somehow hand off that processing to some or one RS. What I&apos;m thinking is that the master, when done splitting logs, should hand that pile to a single RS which will open a new ReplicationSource and hopefully complete the replication.&lt;/p&gt;

&lt;p&gt;We can use the information published in ZK to learn the situation of each replication stream per peer and show that in a UI.&lt;/p&gt;</comment>
                            <comment id="12867015" author="stack" created="Thu, 13 May 2010 04:41:52 +0000"  >&lt;p&gt;Moved from 0.21 to 0.22 just after merge of old 0.20 branch into TRUNK.&lt;/p&gt;</comment>
                            <comment id="12870177" author="jdcryans" created="Fri, 21 May 2010 21:30:41 +0000"  >&lt;p&gt;Moving back into 0.21, this will be in the first dev release.&lt;/p&gt;</comment>
                            <comment id="12870195" author="jdcryans" created="Fri, 21 May 2010 22:20:15 +0000"  >&lt;p&gt;This is the patch I&apos;ve been working on for a while now, almost all new code. It is not in a committable state since there&apos;s a lot of debug information printed out, it needs an up-to-date hadoop jar WRT &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-142&quot; title=&quot;In 0.20, move blocks being written into a blocksBeingWritten directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-142&quot;&gt;&lt;del&gt;HDFS-142&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HDFS-200&lt;/del&gt;&lt;/a&gt;, it&apos;s missing some more unit tests, code is commented all over the place, etc.&lt;/p&gt;

&lt;p&gt;It basically works like I described it in my Feb 18th comment, that is:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We keep track of the HLogs to replicate in Zookeeper in different folders for each region servers. The oldest hlog&apos;s znode contains the position to seek to for the next batch to replicate.&lt;/li&gt;
	&lt;li&gt;The region servers tail their own HLogs in all situations, and listen to log rolling to figure if a log is archived while it needs to be replicated. Since there&apos;s no real tailing in HDFS, we have to reopen and seek every time and this hits the Namenode. So, in order to not DDOS it, we wait a second by default when no data is available for replication. Each time we hit an EOF, we wait a second more than the last time up to 10 seconds (so SLA here is it takes as most as 10 seconds + time to apply data on slave cluster for the data to be available on the other end). The same kind of waiting happens when region servers on a slave cluster aren&apos;t reachable.&lt;/li&gt;
	&lt;li&gt;When a region server fails on the master side, its logs queue is taken over in Zookeeper by another RS during a race for a lock. This can failover as many times as we want e.g. a RS could end up finishing the replication for a queue that was passed on 10 times. Also it is important to note that a failover&apos;ed queue will be processed in parallel. This means that if you have only 1 slave cluster and a RS died, the one that takes over the queue will send edits to the slave cluster in 2 different threads. When the failover&apos;ed queue is done with, that replication stream is closed.&lt;/li&gt;
	&lt;li&gt;The sink side of the region server still works like in the original implementation, it has to be either changed to work like ReplicationSource or remove the part where we log to a file.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;d be happy to sit down with other people to review the patch.&lt;/p&gt;</comment>
                            <comment id="12872051" author="hbasereviewboard" created="Thu, 27 May 2010 01:11:39 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-05-26 18:09:30.362592)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This new patch takes care of almost all comments except:&lt;br/&gt;
ReplicationZookeeperHelper.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use a &amp;lt;pre&amp;gt; block to make this more readable in the HTML version of the javadoc.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ReplicationSink.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think it would be good to document the fact that this method will typically be called from another thread than the thread that executes `run&apos; so that other people reading the code will quickly get a good grasp of what are the concurrency / locking requirements.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;So Delete operations are &quot;unbuffered&quot; unlike Put operations, which you &quot;buffer&quot; in the `puts&apos; list.  Does that mean that a Delete can be executed before the Put that was creating the data in the first place, and that the Delete will fail first and the Put will survive second?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;// Should we log rejected edits in a file for replay?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I vote yes&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;The major change I did was removing ReplicationConnectionManager and using HCM directly since it was the same code (so the comments left by Benoit still apply, but to HCM). Other than that it&apos;s mostly refactoring and fixing nits.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java 13aff26 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 4cbe52a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java a197b8f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b5ff43a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 12a3cd8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 7c1184c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java ed8709f &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12872119" author="hbasereviewboard" created="Thu, 27 May 2010 06:49:31 +0000"  >&lt;p&gt;Message from: &quot;Benoit Sigoure&quot; &amp;lt;tsunanet@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review84&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review84&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I&apos;ll pick up where I stopped in TestReplication.java tomorrow.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment412&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment412&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Terminate this sentence with a period.&lt;/p&gt;

&lt;p&gt;    Generally speak you must terminate the first sentence of a javadoc with a period.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment413&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment413&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t find `replication.source.size.capacity&apos; particularly explicit.  What is it supposed to control?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment414&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment414&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Ditto.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment415&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is unnecessary.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment416&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment416&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Nit pick: mapOfAddr since in English &quot;Address&quot; starts with &quot;Addr&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment417&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment417&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    s/adr/addr/ &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment418&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How about using a do-while instead of repeating this line of code?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment419&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment419&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    If HServerAddress respects the equal contract, consider using a set instead of a map.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment420&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Move this outside of the try block.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment422&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The explicit call to toString() here is useless.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment421&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment421&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is there any reason why you&apos;re checking this here?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment423&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment423&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Log a message too.&lt;br/&gt;
    This will call Log#error(java.lang.Object message) and I presume you meant to call Log#error(java.lang.Object message, java.lang.Throwable t)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment424&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment424&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I find this comment confusing.  Can you make it a bit more explicit, especially towards the &quot;normally has a position&quot; part?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment425&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment425&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Don&apos;t lock in the `try&apos; block.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment426&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why are you checking this again here?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment432&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment432&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    All the double-negations with noIOE are harder to read than if instead you were starting with boolean gotIOE = false and set it to true when you get an IOE.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment427&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment427&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This `try&apos; block is massive, would it be possible to refactor it using a private method to make the code a bit more readable?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment428&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment428&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Use a local variable for entry.getKey() instead of calling it so many times in a row.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment429&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment429&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Unnecessary call to toString().&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment430&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It seems that considerDumping will always be true except when you fail to stat() the file due to an unexpected error.  That seems suspicious to me.  Is this intended?  If yes, can you explain?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment431&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment431&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Need a message in first argument.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment433&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment433&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment434&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment434&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please document everything properly.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment435&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment435&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment436&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment436&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How about storing the result of edit.getKeyValues() in a local instead of repeating that code and repeating the call twice at every loop?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment437&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment437&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please document everything.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment438&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment438&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Put this in a try-finally block.  Just because you&apos;re nulling one reference doesn&apos;t protect you from this thread getting interrupted and then you&apos;re left with a locked lock.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment439&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment439&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why are you doing this?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment440&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment440&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    s/adr/addr/&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment441&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment442&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment442&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment443&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment443&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You need to enclose te &amp;lt;li&amp;gt; in &amp;lt;ul&amp;gt; or &amp;lt;ol&amp;gt; and close the tags properly.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment444&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment444&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Make this private.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment445&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment445&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you please document everything non obvious.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment446&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment446&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    s/ and that/.  This/&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment447&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment447&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ??&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment448&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment448&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment449&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment449&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    queueRecovered should be documented too.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment450&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment450&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does this statement need to be in the synchronized block?  If yes, why?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment451&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Unnecessary call to toString().&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment452&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment452&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &quot;Add&quot; vs &quot;tries&quot; &#8211; be consistent.  Use imperative everywhere or don&apos;t use it.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment453&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment453&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Since log messages can be intertwined if the server is busy logging a lot, how about making this and the previous line a single message.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment457&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment457&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment454&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment454&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This doesn&apos;t need to be in the synchronized block, does it?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment456&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment456&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment455&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment458&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment458&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Remove this line and the next to avoid code duplication with line 250/251.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment459&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment459&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Don&apos;t do this.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment460&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment460&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Document.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment461&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Don&apos;t you only need to synchronize on those two lines instead of all the other ones too?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment464&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment464&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No copyright?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment463&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment463&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No javadoc in this file?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment462&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment462&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Not properly indented.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment465&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment465&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why is this `protected&apos; instead of `private&apos;?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment466&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment466&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Pardon my ignorance but what&apos;s the `2&apos; supposed to mean here?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment467&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment467&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure whether this is useful since junit will already give us all the info in the event of an unexpected exception.  Furthermore, the first argument to LOG.error must be a message.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment468&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment468&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This would be a better API if it received a boolean in argument and transformed it in a String itself.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment470&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Maybe you can add a watcher for yourself too so you get notified when you can continue instead of sleeping SLEEP_TIME and hoping that the timing will work out OK?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment469&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment469&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ??&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment471&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do you need an empty method?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Benoit&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2010-05-26 18:09:30, Jean-Daniel Cryans wrote:&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  -----------------------------------------------------------&lt;br/&gt;
^bq.  This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
^bq.  &lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
^bq.  -----------------------------------------------------------&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  (Updated 2010-05-26 18:09:30)&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Review request for hbase.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Summary&lt;br/&gt;
^bq.  -------&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
^bq.      &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Diffs&lt;br/&gt;
^bq.  -----&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/HConstants.java 13aff26 &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 4cbe52a &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/master/ServerManager.java a197b8f &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b5ff43a &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 12a3cd8 &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 7c1184c &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java PRE-CREATION &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
^bq.    src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
^bq.    src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java ed8709f &lt;br/&gt;
^bq.    src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
^bq.    src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
^bq.    src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
^bq.    src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
^bq.    src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Testing&lt;br/&gt;
^bq.  -------&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Thanks,&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Jean-Daniel&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq. &lt;/p&gt;

</comment>
                            <comment id="12872344" author="hbasereviewboard" created="Thu, 27 May 2010 19:57:38 +0000"  >&lt;p&gt;Message from: &quot;Benoit Sigoure&quot; &amp;lt;tsunanet@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review86&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review86&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment472&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment472&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This test is pretty long and tests quite a few different things.  Consider to break it down into multiple smaller unit tests.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment473&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment473&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure to understand why this test is named like that.  Could you comment this test a bit more to explain what the intent is?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment474&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment474&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This seems brittle to me.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment475&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment475&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment476&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment476&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I believe this method can be made `static&apos;.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment477&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment477&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Copyright header.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment486&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment486&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not a big fan of this.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment478&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment478&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    private.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment479&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment479&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do you really need to define the 3 following empty methods?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment484&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment484&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Consider writing a comment explaining what this test does.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment480&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment480&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing space before `conf&apos;.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment481&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment481&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    +&quot;&quot; is an idiom I don&apos;t like.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment482&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment482&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing spaces.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment483&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment483&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing spaces.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment485&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Don&apos;t do this.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment487&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment487&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Don&apos;t do this.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment488&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment488&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why protected?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment489&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment489&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this really needed?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment490&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment490&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t understand why you&apos;re doing +=2 and /2 instead of just setting the upper bound of the loop to BATCH_SIZE/2.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment491&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment491&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing space before `scanRes&apos;.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment492&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment492&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why protected?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment493&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment493&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment494&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment494&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Uh?  Manual loop unrolling?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Benoit&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12872741" author="hbasereviewboard" created="Fri, 28 May 2010 00:21:38 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


</comment>
                            <comment id="12873112" author="hbasereviewboard" created="Fri, 28 May 2010 18:56:37 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


</comment>
                            <comment id="12873116" author="hbasereviewboard" created="Fri, 28 May 2010 19:04:35 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-05-28 12:03:35.298094)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;New patch that takes care of almost all Benoit&apos;s comments. My current TODO is:&lt;/p&gt;


&lt;p&gt;ReplicationZookeeperHelper.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use a &amp;lt;pre&amp;gt; block to make this more readable in the HTML version of the javadoc.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ReplicationSink.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think it would be good to document the fact that this method will typically be called from another thread than the thread that executes `run&apos; so that other people reading the code will quickly get a good grasp of what are the concurrency / locking requirements.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;So Delete operations are &quot;unbuffered&quot; unlike Put operations, which you &quot;buffer&quot; in the `puts&apos; list.  Does that mean that a Delete can be executed before the Put that was creating the data in the first place, and that the Delete will fail first and the Put will survive second?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;// Should we log rejected edits in a file for replay?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I vote yes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ReplicationSource.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;This `try&apos; block is massive, would it be possible to refactor it using a private method to make the code a bit more readable?&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java 13aff26 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 4cbe52a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java a197b8f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b5ff43a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 12a3cd8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 7c1184c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java ed8709f &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12873175" author="hbasereviewboard" created="Fri, 28 May 2010 23:04:40 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-05-28 16:02:44.219338)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;The remaining issues and some resolutions:&lt;/p&gt;

&lt;p&gt;ReplicationSink.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think it would be good to document the fact that this method will typically be called from another thread than the thread that executes `run&apos; so that other people reading the code will quickly get a good grasp of what are the concurrency / locking requirements.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I chatted with Benoit on this issue, the problem with ReplicationSink at the moment is it&apos;s a mix of two solutions: sync and async. It&apos;s sync&apos;ed because the thread that writes the log file has to wait for the ReplicationSink to apply it&#8230; but instead it could work like the ReplicationSource and leave it up to ZK-based management of log files. It currently work as is, but it&apos;s not efficient. I can fix this in the scope of this jira, which is still named &quot;Handle 10min+ network partitions between clusters&quot;, or in a later one. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;So Delete operations are &quot;unbuffered&quot; unlike Put operations, which you &quot;buffer&quot; in the `puts&apos; list.  Does that mean that a Delete can be executed before the Put that was creating the data in the first place, and that the Delete will fail first and the Put will survive second?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Created a test that inserts 2 rows, deletes the second one, and adds two more. I expect to see the row as deleted, and it works (yeah!). Included in this patch&lt;/p&gt;

&lt;p&gt;// Should we log rejected edits in a file for replay?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I vote yes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This will be in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2626&quot; title=&quot;Log entries we cannot apply in ReplicationSink  &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2626&quot;&gt;&lt;del&gt;HBASE-2626&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;ReplicationSource.java&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;This `try&apos; block is massive, would it be possible to refactor it using a private method to make the code a bit more readable?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Did some refactoring, but still not satisfied.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  bin/replication/add_peer.rb PRE-CREATION &lt;br/&gt;
  bin/replication/copy_tables_desc.rb PRE-CREATION &lt;br/&gt;
  pom.xml 0a009cf &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java 13aff26 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 4cbe52a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java a197b8f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b5ff43a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 12a3cd8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 7c1184c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java ed8709f &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12876907" author="hbasereviewboard" created="Wed, 9 Jun 2010 00:56:39 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-06-08 17:54:19.227006)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Refreshed patch for trunk.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  bin/replication/add_peer.rb PRE-CREATION &lt;br/&gt;
  bin/replication/copy_tables_desc.rb PRE-CREATION &lt;br/&gt;
  pom.xml 03c6ec8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java 13aff26 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java b36f1df &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 82148a6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java a1baff4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 034690e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 5d4cffe &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 2f2f306 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12877350" author="hbasereviewboard" created="Thu, 10 Jun 2010 06:47:40 +0000"  >&lt;p&gt;Message from: &quot;Benoit Sigoure&quot; &amp;lt;tsunanet@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review174&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review174&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment838&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment838&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    One space before `port&apos;.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment839&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment839&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Unnecessary call to `toString()&apos;.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Benoit&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12877648" author="hbasereviewboard" created="Fri, 11 Jun 2010 00:09:10 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-09 23:44:22, Benoit Sigoure wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java, line 1171&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/3-5/?file=724#file724line1171&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/3-5/?file=724#file724line1171&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Unnecessary call to `toString()&apos;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s untouched by my patch, but ok &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review174&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review174&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12877939" author="hbasereviewboard" created="Fri, 11 Jun 2010 19:49:45 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review191&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review191&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I got as far as ReplicationLogCleaner... will continue later.&lt;/p&gt;


&lt;p&gt;bin/replication/add_peer.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment868&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment868&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should you point at some replication documentation here?  Is there such a thing?&lt;/p&gt;



&lt;p&gt;bin/replication/copy_tables_desc.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment870&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment870&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This could get a bit annoying I&apos;d say.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment871&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment871&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This has to go here?  Can it go into one of the replication classes?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment872&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment872&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can&apos;t you just do c.get(&quot;key&quot;, defaultvalue)?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment873&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment873&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You writing startcode into zk?  Why not write servername &amp;#8211; the host+port+startcode combo?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment875&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment875&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this directory name?  Confusingly named given rootdir+regLogPathStr only adds up to repLogPath.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment876&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment876&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Replication needs package documentation or else an article (like metrics) &amp;#8211; oh, i see it later... nm&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment877&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment877&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Peers are named &apos;1&apos;, &apos;2&apos;?  Can&apos;t we have more meaningful names here?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment878&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment878&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    s/replicates/replicate/&lt;/p&gt;




&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment879&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment879&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Use servername instead of startcode&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment880&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment880&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    All RS&apos;s in a master cluster replicate?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment881&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment881&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this class be called WRapper instaad of Helper?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment882&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment882&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Registers it where?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment883&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment883&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You mean &apos;ensemble&apos; here rather than &apos;quorum&apos; (Patrick will kill you if he sees you calling it a &apos;quorum&apos; when you mean the other)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment884&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment884&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We keep up the replication position in zk?  How much do we replicate in one go?  Its not a single edit, is it?  We do this for every log file?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment885&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment885&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    LOG.warn instead?&lt;/p&gt;




&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment887&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment887&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We return empty map if clusters size is == 1?  Should that be clusters.size == 0?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment886&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment886&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats this about?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment888&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment888&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Just logging errors?  What if session expired (our discussion from last day)?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment889&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment889&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Call it alpha&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment890&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment890&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats this about?  You need to run zk yourself but no zoo.cfg?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment891&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment891&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    And if not?  What if replicating single-family only?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment892&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment892&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Has to be offline?  Will this always be the case?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment893&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment893&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    whats ratio?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12878113" author="hbasereviewboard" created="Fri, 11 Jun 2010 22:33:13 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review194&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review194&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;First pass.  Maybe by the 3rd pass I&apos;ll have an idea of whats going on.  General comment is that there is a lot of new code here but tests seem to test replication system.  There are few instances of unit tests ensuring newly added methods are working properly.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment894&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment894&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    For sure setConf will have been called before we get here?  So, stuff gets setup by setConf?  Can setConf be called more than once?  How do I know how to use this class?  Not doc&apos;d.  Doesn&apos;t have a Constructor.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment895&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment895&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The way this is done, if I didn&apos;t want to wait on the ttl, then I&apos;d have to write a new class.  Can&apos;t we have ttl and recplication be distinct and then if I want delete based off ttl and whether log up in zk, then chain them?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment896&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment896&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I dont follow?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment897&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment897&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should read this out of config. rather than hardcode 10.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment898&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment898&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Same here.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment900&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment900&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Long while loop; can break it up?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment899&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment899&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Only operate on the first kv?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment901&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment901&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do you have to write position back to zk?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment903&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment903&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can code from HLog be used here?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment904&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment904&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This ain&apos;t a constructor?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment907&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment907&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We have to copy?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment908&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment908&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Not a constructor.  If javadoc in an interface, you don&apos;t need to reproduce the javadoc in the implementation.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment909&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment909&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This should be SortedSet, not TreeSet... or NavigableSet.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment910&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment910&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment911&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment911&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What does this class do?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment912&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment912&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No dfs in this test.  Thats intentional?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment913&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment913&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can&apos;t you squash some of these tests together?  They each start up own minidfscluster... just start it once?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12878692" author="hbasereviewboard" created="Mon, 14 Jun 2010 18:43:52 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; bin/replication/add_peer.rb, line 21&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1104#file1104line21&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1104#file1104line21&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should you point at some replication documentation here?  Is there such a thing?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;package.html later, should I point to it?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; bin/replication/copy_tables_desc.rb, line 58&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1105#file1105line58&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1105#file1105line58&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This could get a bit annoying I&apos;d say.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It helped me a lot, remove if people complain?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/HConstants.java, line 342&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1107#file1107line342&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1107#file1107line342&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This has to go here?  Can it go into one of the replication classes?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Used by master and region server, to me it belongs there.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/ServerManager.java, line 156&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1109#file1109line156&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1109#file1109line156&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can&apos;t you just do c.get(&quot;key&quot;, defaultvalue)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, I also do a check on replication.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java, line 929&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1110#file1110line929&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1110#file1110line929&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     You writing startcode into zk?  Why not write servername &amp;#8211; the host+port+startcode combo?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To be coherent with the rest of the code that uses zookeeper.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java, line 1075&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1110#file1110line1075&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1110#file1110line1075&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is this directory name?  Confusingly named given rootdir+regLogPathStr only adds up to repLogPath.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t understand you, but this code is going to be removed in my next patch as I&apos;m simplifying RepSink.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 55&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line55&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line55&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Peers are named &apos;1&apos;, &apos;2&apos;?  Can&apos;t we have more meaningful names here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We agreed that peers are identified with a short internally as it is stored. We could use an external mapping of short-&amp;gt;cute_name.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 59&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line59&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line59&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Use servername instead of startcode&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Same comment as before, needs to be coherent.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 60&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line60&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line60&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     All RS&apos;s in a master cluster replicate?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep... was that an implicit way of saying that I need to document that in RZH?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 107&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line107&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should this class be called WRapper instaad of Helper?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 185&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line185&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line185&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     You mean &apos;ensemble&apos; here rather than &apos;quorum&apos; (Patrick will kill you if he sees you calling it a &apos;quorum&apos; when you mean the other)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Argh I&apos;m trying to correct myself but I&apos;m still missing some of them. Thx!&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 263&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line263&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We keep up the replication position in zk?  How much do we replicate in one go?  Its not a single edit, is it?  We do this for every log file?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. A defined amount specified in ReplicationSource. No. Every current log file, we only replicate one at a time per region server.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 328&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line328&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line328&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     LOG.warn instead?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll do like the rest and log.error&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 354&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line354&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line354&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We return empty map if clusters size is == 1?  Should that be clusters.size == 0?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That part isn&apos;t clear enough, so the reason it&apos;s 1 and not 0 is that we put a lock in there so it&apos;s listed in the znodes we fetch. Actually this should be &amp;lt;= 1 rather than ==.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 356&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line356&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line356&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats this about?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See previous comment, we lock the dead region server&apos;s znode by putting a lock in there, but we don&apos;t want to process the hlogs under since... it&apos;s not a cluster. Could use more doc.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java, line 402&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line402&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1113#file1113line402&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Just logging errors?  What if session expired (our discussion from last day)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes I need to review how I handle it in RZH, but I&apos;d also need to review ZKW since some methods will hid it in there.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 41&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line41&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line41&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Call it alpha&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yeah! (j/k)&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 64&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line64&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line64&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats this about?  You need to run zk yourself but no zoo.cfg?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I... don&apos;t remember why I wrote this.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 73&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line73&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line73&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     And if not?  What if replicating single-family only?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Forgot to update that after we added scoping, updating.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 83&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line83&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line83&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Has to be offline?  Will this always be the case?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Currently everything is static, but I hope we can move on from that in the future.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 12:45:29, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 108&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1115#file1115line108&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     whats ratio?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is a log snippet that&apos;s coming from a region server. Do you want to see more documentation about it in package.html or in the logging itself?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review191&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review191&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12878703" author="hbasereviewboard" created="Mon, 14 Jun 2010 19:08:44 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java, line 56&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1114#file1114line56&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1114#file1114line56&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     For sure setConf will have been called before we get here?  So, stuff gets setup by setConf?  Can setConf be called more than once?  How do I know how to use this class?  Not doc&apos;d.  Doesn&apos;t have a Constructor.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;LogCleanerDelegate is the interface that defines the general behavior. Yes should have a constructor.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java, line 111&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1114#file1114line111&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1114#file1114line111&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     The way this is done, if I didn&apos;t want to wait on the ttl, then I&apos;d have to write a new class.  Can&apos;t we have ttl and recplication be distinct and then if I want delete based off ttl and whether log up in zk, then chain them?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t follow, chaining is already how I do it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 54&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1116#file1116line54&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1116#file1116line54&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I dont follow?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, RepSink is a mix of 2 solutions but only features the worst of both. The next patch will significantly make it better.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 126&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1117#file1117line126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1117#file1117line126&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This ain&apos;t a constructor?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I ain&apos;t.. but it&apos;s used like one.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 483&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1117#file1117line483&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1117#file1117line483&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We have to copy?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is the down side of the way of I&apos;m caping the log entries by size or number. I&apos;m reusing the same HLog.Entry[] entriesArray to read from HLogs (and the entries in it). For example, replicationQueueSizeCapacity=64MB and replicationQueueNbCapacity=25k. Let&apos;s say on a first run we reach 25k without reaching the size, so we&apos;ll replicate the whole array. Now on the second run let&apos;s say we reached 64MB after only 10k rows, then we only want to replicate that and not the 15k &quot;leftovers&quot;.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java, line 67&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1123#file1123line67&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1123#file1123line67&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     No dfs in this test.  Thats intentional?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nope, should fix.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-11 15:31:37, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java, line 86&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/5/?file=1124#file1124line86&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/5/?file=1124#file1124line86&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can&apos;t you squash some of these tests together?  They each start up own minidfscluster... just start it once?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;They don&apos;t?&lt;/p&gt;

&lt;p&gt;  @Before&lt;br/&gt;
  public void setUp() throws Exception &lt;/p&gt;
{
    table1 = TEST_UTIL.truncateTable(TABLE_NAME1);
    table2 = TEST_UTIL.truncateTable(TABLE_NAME2);
    Thread.sleep(SLEEP_TIME);
  }


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review194&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review194&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12879909" author="hbasereviewboard" created="Thu, 17 Jun 2010 20:01:58 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-06-17 12:57:07.815144)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Patch rebased on the new Zookeeper/Master and with a cleaned up ReplicationSink. Also some cleanup from Stack&apos;s comments.&lt;/p&gt;

&lt;p&gt;Currently fails TestReplication, hitting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2741&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2741&lt;/a&gt; that kills a master thread. The root cause could be in this code but the NPE doesn&apos;t help debugging.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  bin/replication/add_peer.rb PRE-CREATION &lt;br/&gt;
  bin/replication/copy_tables_desc.rb PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java f5d3e94 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 62617ac &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 66dc697 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java 4c5153e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 10f9dbd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1d95258 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 7ace16a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 05cf17f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 5d4cffe &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperHelper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 04957ca &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12881978" author="hbasereviewboard" created="Thu, 24 Jun 2010 00:28:25 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-06-23 17:24:52.371363)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch now passes its own tests (many core modifications made them unstable) and incorporates comments from Stack&apos;s review. It also has the patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2707&quot; title=&quot;Can&amp;#39;t recover from a dead ROOT server if any exceptions happens during log splitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2707&quot;&gt;&lt;del&gt;HBASE-2707&lt;/del&gt;&lt;/a&gt; applied because without it it&apos;s too easy to fail TestReplication. &lt;/p&gt;

&lt;p&gt;It also relies on using this hadoop jar &lt;a href=&quot;http://people.apache.org/~rawson/repo/org/apache/hadoop/hadoop-core/0.20.3-append-r956776+1240+tail/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~rawson/repo/org/apache/hadoop/hadoop-core/0.20.3-append-r956776+1240+tail/&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  bin/replication/add_peer.rb PRE-CREATION &lt;br/&gt;
  bin/replication/copy_tables_desc.rb PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java 4357ee5 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 62617ac &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 5367638 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java 4c5153e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java 10f9dbd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 9fb1cce &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 33b9a99 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 94f18c6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 5d4cffe &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java b26c071 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 0e69709 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12882738" author="hbasereviewboard" created="Fri, 25 Jun 2010 22:11:51 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review281&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review281&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Missing is more desciption of how this feature works.  There is package doc. on how to get it going but needs fuller description of how replication works (how zk is used, how it manages hlogs, how it sends edits to remote cluster, etc.).  There is insufficient description in javadoc.  Without this, there is a danger that only the author will be able to figure whats going on in here.&lt;/p&gt;

&lt;p&gt;How does one get insight on to how well or badly replication is working?&lt;/p&gt;

&lt;p&gt;Alot of errors are logged and then we just move on.  Thats fine for an alpha package but need a plan for making it all more robust?  What you thinking?&lt;/p&gt;


&lt;p&gt;bin/replication/add_peer.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1187&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1187&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    These log messages add nothing?  Remove?  Just restating what was passed on cmdline.&lt;/p&gt;



&lt;p&gt;bin/replication/add_peer.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1188&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why do this?  Its annoying?&lt;/p&gt;

&lt;p&gt;    It&apos;d be better spending time interrogating what the user passed to see if it makes sense throwing errors if incorrectly formatted or if it doesn&apos;t look like it makes sense?&lt;/p&gt;



&lt;p&gt;bin/replication/add_peer.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1189&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    A message on end saying what it did can be comforting to users.&lt;/p&gt;



&lt;p&gt;bin/replication/copy_tables_desc.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1190&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1190&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    See above comments.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1191&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1191&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Change name of this config to hbase.replication.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1192&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1192&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does this method have prerequisites? For example, does replication have to be enabled?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1193&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1193&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this a leak from another patch?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1194&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1194&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is a leak from another patch?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1195&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1195&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats going on here?  We&apos;re setting into config the logcleaner to use but then in the lines after this we go ahead and create OldLogsCleaner anyways?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1196&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1196&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Just call this &apos;replication&apos; or &apos;replicationEnabled&apos;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1198&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1198&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We are a ReplicationSink or a ReplicationMaster?  One or the other?  Can we not move all of this Replication stuff into a Replication class including the setup of whether we are a Sink or Master rather than have it hang out here in HRS?  &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1197&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1197&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t grok the comment&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1199&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This could be null if we are a replication master?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1200&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1200&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    If the above mentioned Replication class were a singleton, it could be shared here with HRS&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1201&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1201&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It&apos;d be good if we didn&apos;t have to create this byte [] per edit.  I should reinstitute the comparator I had that took KVs but only compared family portion of the KV... no need to create family byte [] then.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1202&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1202&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    YOu might say why its being moved.  Should be INFO level?  WALs are kinda important to track?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1203&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1203&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    isReplicating is what you would name the method that accesses the boolean replicating... with this name the accessor should be named isIsReplicating.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1204&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1204&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why do it this way?  Why an if/else?  Why not do if (...length != 3) throw .... no need of an else.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1205&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1205&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is an error? Is it critical fail (We dropped recording a WAL)  Are we just logging and moving on?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1206&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Same here.... We just log and keep going?  Are any of these fatal?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1207&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1207&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    If this fails, what are the repercusssions?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1208&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1208&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What happens if this server dies?  It gets cleaned up by master?&lt;/p&gt;

&lt;p&gt;    What happens to replication if master dies?  Does master failover need to do anything special to pick up running replication?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1209&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1209&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    spelling&lt;/p&gt;




&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1213&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why this implementation have to know about other implementations?  Can&apos;t we do a chain of decision classes? Any class can say no?  As soon as any decision class says no, we exit the chain.... So in this case, first on the chain would be the ttl decision... then would be this one... and third would be the snapshotting decision. You don&apos;t have to do the chain as part of this patch but please open an issue to implement.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1210&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Its not just MDC, right?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1211&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1211&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is it user tables or CF in user tables?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/package.html&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1212&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1212&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good doc.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1214&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What is the &apos;main thread&apos;?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1215&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you make this clearer?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1216&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1216&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats this mean?  Lost edits?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1217&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1217&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Maybe say something about how it works... pool of HTables to write remote peer, etc.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1218&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why again does replication keep its own set of logs rather than just keep positions on HRS logs (whether local HRS or the HRS of others?)  So it prevails across HRS failures?  Aren&apos;t logs archived now rather than thrown away so this should be fine?  Otherwise, we are writing edits to FS twice, right?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1220&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1220&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This should be inside a finally block?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1221&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1221&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Duplicated code &amp;#8211; see up about ten lines.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1222&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You are stopping the regionserver because replication failed?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1223&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    One second seems short?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1226&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1226&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We carry edits in memory?  And its outside of our normal accounting &amp;#8211; e.g. cache and max for memstores?  How we get it into the mix?  Else we could OOME if we don&apos;t account for this memory payload.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1224&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1224&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Ratio?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1227&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1227&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Not a constructor&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1228&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1228&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Stop cluster or stop the host?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1230&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1230&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats this about?  IN particular, the &apos;handling story&apos;...&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1231&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1231&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    When would it make sense to ever replicate catalog table entries?&lt;/p&gt;

&lt;p&gt;    Why we even in here reading a file if replicating == false&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1232&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1232&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Are you checking size of these edits?  You&apos;ll read 25k entries of any size?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1233&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1233&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Where do you explain replication hlog filenaming convention?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1234&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1234&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can only do one sink, right?  Might want to say so.  How does the source know the sink to replicate to?  Should that be part of the Interface?&lt;/p&gt;

&lt;p&gt;    The comment for the Interface could say how the Interface is used... init, then set sink, then per file archived, call ... etc.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1235&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1235&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Make this &quot;This class manages all the replication sources&quot;&lt;/p&gt;

&lt;p&gt;    &quot;There are two classes of them&quot;... what you mean to say here?  Two classes of source?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1236&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1236&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t follow this commentary.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1238&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1238&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You should say more here about whats going on.. either here or up in the class comment.  It has watchers on all other RSs in current cluster and will try to take on the workloads of others on crash &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1239&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1239&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Comment is cut off.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1240&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1240&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You reporting status or updating updated position into zk?  There is a running status being kept up in zk?  Shouldn&apos;t this log message have the log path in it too?&lt;/p&gt;

&lt;p&gt;    This method does more than update position or report status... looks like it changes state in this class updating set of logs?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1241&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1241&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Shouldn&apos;t this be nonmodifiable List that you give out here since it seems you have it synchronized internally here.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1243&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1243&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What other regionserver?  There is alot that goes unexplained in here?  Could point to the doc. on how replication works.  Same for the transer method above (I have an idea because you white boarded it for me).&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/#comment1244&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#comment1244&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12882787" author="hbasereviewboard" created="Sat, 26 Jun 2010 00:33:54 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/HMaster.java, line 508&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1580#file1580line508&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1580#file1580line508&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is this a leak from another patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like I said in the description of this patch: &quot;It also has the patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2707&quot; title=&quot;Can&amp;#39;t recover from a dead ROOT server if any exceptions happens during log splitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2707&quot;&gt;&lt;del&gt;HBASE-2707&lt;/del&gt;&lt;/a&gt; applied because without it it&apos;s too easy to fail TestReplication. &quot;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java, line 114&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1582#file1582line114&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1582#file1582line114&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is a leak from another patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like I said in the description of this patch: &quot;It also has the patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2707&quot; title=&quot;Can&amp;#39;t recover from a dead ROOT server if any exceptions happens during log splitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2707&quot;&gt;&lt;del&gt;HBASE-2707&lt;/del&gt;&lt;/a&gt; applied because without it it&apos;s too easy to fail TestReplication. &quot;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/ServerManager.java, line 153&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1583#file1583line153&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1583#file1583line153&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats going on here?  We&apos;re setting into config the logcleaner to use but then in the lines after this we go ahead and create OldLogsCleaner anyways?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OldLogsCleaner uses the the class that was specified in the configuration.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java, line 243&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1584#file1584line243&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1584#file1584line243&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Just call this &apos;replication&apos; or &apos;replicationEnabled&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Side note, I think every reviewer had a different preference for the name of this attribute.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java, line 219&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1585#file1585line219&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1585#file1585line219&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     If the above mentioned Replication class were a singleton, it could be shared here with HRS&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I created a visitor list to inspect log entries before they get appended. Replication is now out of HLog.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java, line 1043&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1585#file1585line1043&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1585#file1585line1043&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     It&apos;d be good if we didn&apos;t have to create this byte [] per edit.  I should reinstitute the comparator I had that took KVs but only compared family portion of the KV... no need to create family byte [] then.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Should we open an issue?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java, line 1208&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1585#file1585line1208&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1585#file1585line1208&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     YOu might say why its being moved.  Should be INFO level?  WALs are kinda important to track?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java, line 207&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1587#file1587line207&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1587#file1587line207&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why do it this way?  Why an if/else?  Why not do if (...length != 3) throw .... no need of an else.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ooops yes&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java, line 238&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1587#file1587line238&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1587#file1587line238&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This is an error? Is it critical fail (We dropped recording a WAL)  Are we just logging and moving on?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2791&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2791&lt;/a&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java, line 48&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1588#file1588line48&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1588#file1588line48&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why this implementation have to know about other implementations?  Can&apos;t we do a chain of decision classes? Any class can say no?  As soon as any decision class says no, we exit the chain.... So in this case, first on the chain would be the ttl decision... then would be this one... and third would be the snapshotting decision. You don&apos;t have to do the chain as part of this patch but please open an issue to implement.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2792&lt;/a&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 25&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1589#file1589line25&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1589#file1589line25&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Its not just MDC, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;ll be Multi Cluster Replication then!&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/package.html, line 47&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1589#file1589line47&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1589#file1589line47&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is it user tables or CF in user tables?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;true, CF&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 52&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line52&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line52&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     What is the &apos;main thread&apos;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;stale&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 55&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line55&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line55&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can you make this clearer?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;that was stale too&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 57&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line57&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line57&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats this mean?  Lost edits?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;stale stale&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 59&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line59&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line59&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Maybe say something about how it works... pool of HTables to write remote peer, etc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;sure thing&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 93&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line93&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line93&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why again does replication keep its own set of logs rather than just keep positions on HRS logs (whether local HRS or the HRS of others?)  So it prevails across HRS failures?  Aren&apos;t logs archived now rather than thrown away so this should be fine?  Otherwise, we are writing edits to FS twice, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s totally different in this context, but I currently removed the logs in ReplicationSink until some refactoring happens.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 119&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line119&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line119&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This should be inside a finally block?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;good catch&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 149&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line149&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line149&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Duplicated code &amp;#8211; see up about ten lines.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not it&apos;s different, one inserts and the other deletes&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 162&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line162&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line162&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     You are stopping the regionserver because replication failed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;is it too bold?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 66&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line66&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line66&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     One second seems short?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s actually more like 55 seconds&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 79&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line79&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line79&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     We carry edits in memory?  And its outside of our normal accounting &amp;#8211; e.g. cache and max for memstores?  How we get it into the mix?  Else we could OOME if we don&apos;t account for this memory payload.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You think ReplicationSource should implement HeapSize?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 84&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line84&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line84&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Ratio?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;eh&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 177&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line177&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line177&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Whats this about?  IN particular, the &apos;handling story&apos;...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll talk about this more in the doc&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 367&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line367&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line367&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     When would it make sense to ever replicate catalog table entries?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why we even in here reading a file if replicating == false&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When would it make sense to ever replicate catalog table entries?&lt;br/&gt;
Never I&apos;d say, why do you ask?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Why we even in here reading a file if replicating == false&lt;br/&gt;
A user can switch that at anytime&lt;/li&gt;
&lt;/ul&gt;



&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 372&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line372&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line372&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Are you checking size of these edits?  You&apos;ll read 25k entries of any size?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s exactly what this does:&lt;/p&gt;

&lt;p&gt;      if ((this.reader.getPosition() - this.position)&lt;br/&gt;
          &amp;gt;= this.replicationQueueSizeCapacity ||&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 623&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line623&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1591#file1591line623&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Where do you explain replication hlog filenaming convention?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Replication doesn&apos;t have a special naming convention.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java, line 79&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1592#file1592line79&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1592#file1592line79&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can only do one sink, right?  Might want to say so.  How does the source know the sink to replicate to?  Should that be part of the Interface?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     The comment for the Interface could say how the Interface is used... init, then set sink, then per file archived, call ... etc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;will add that&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java, line 43&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line43&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line43&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Make this &quot;This class manages all the replication sources&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &quot;There are two classes of them&quot;... what you mean to say here?  Two classes of source?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, recovered or not, and it&apos;s even explained the 2 lines after.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java, line 46&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line46&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line46&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I don&apos;t follow this commentary.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Changing it to:&lt;br/&gt;
Old sources, they were recovered from a failed region server and our only goal is to finish replicating the HLog queue it had up in ZK&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java, line 79&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line79&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line79&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     You should say more here about whats going on.. either here or up in the class comment.  It has watchers on all other RSs in current cluster and will try to take on the workloads of others on crash &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java, line 116&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line116&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line116&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     You reporting status or updating updated position into zk?  There is a running status being kept up in zk?  Shouldn&apos;t this log message have the log path in it too?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This method does more than update position or report status... looks like it changes state in this class updating set of logs?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;will change name and add doc&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java, line 194&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line194&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line194&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Shouldn&apos;t this be nonmodifiable List that you give out here since it seems you have it synchronized internally here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yep&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java, line 321&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line321&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1593#file1593line321&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     What other regionserver?  There is alot that goes unexplained in here?  Could point to the doc. on how replication works.  Same for the transer method above (I have an idea because you white boarded it for me).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;k&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review281&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review281&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12883379" author="hbasereviewboard" created="Tue, 29 Jun 2010 01:36:51 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-06-25 15:07:35, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java, line 149&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line149&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff/7/?file=1590#file1590line149&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Duplicated code &amp;#8211; see up about ten lines.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jean-Daniel Cryans wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Not it&apos;s different, one inserts and the other deletes&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok oh yeah there is a better way to do it.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review281&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review281&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12884086" author="hbasereviewboard" created="Wed, 30 Jun 2010 22:40:45 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-06-30 15:36:59.081075)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Final patch&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt; AKA Replication 2.0, it is currently only a &quot;preview patch&quot; as it&apos;s pretty much feature complete, works on a cluster, has unit tests and whatnot, but it could use a lot more testing and cleaning and ideas from others.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2223&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  bin/replication/add_peer.rb PRE-CREATION &lt;br/&gt;
  bin/replication/copy_tables_desc.rb PRE-CREATION &lt;br/&gt;
  pom.xml 400cc0c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java 4357ee5 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java 62617ac &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 04bc95e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java 4c5153e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/OldLogsCleaner.java 07e69b4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 33b9a99 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java 94f18c6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogKey.java 5d4cffe &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeperWrapper.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/package.html PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java b26c071 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java d865e38 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java e96637f &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSource.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSink.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/76/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12884087" author="hbasereviewboard" created="Wed, 30 Jun 2010 22:41:08 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/76/#review297&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/76/#review297&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1 on commit if all tests pass.  I sat w&#233; J-D and went over the changes.  All is good for first commit.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12884107" author="jdcryans" created="Thu, 1 Jul 2010 00:28:12 +0000"  >&lt;p&gt;Committed to trunk, some tests failed when I ran them but they also failed on vanilla trunk for me (need to look more into why, looks flaky).&lt;/p&gt;</comment>
                            <comment id="13250160" author="v.himanshu" created="Mon, 9 Apr 2012 20:39:08 +0000"  >&lt;p&gt;I was skimming through the patch; and it looks like its not there in the current trunk? &lt;br/&gt;
Will be great if anyone can provide its current status, or follow up jiras?&lt;/p&gt;</comment>
                            <comment id="13252602" author="jdcryans" created="Thu, 12 Apr 2012 17:12:32 +0000"  >&lt;p&gt;@Himanshu,&lt;/p&gt;

&lt;p&gt;It&apos;s been in the code base since 0.90.0 but there were a lot of other changes on top of it.&lt;/p&gt;</comment>
                            <comment id="15017867" author="lars_francke" created="Fri, 20 Nov 2015 13:01:41 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12466680">HBASE-2707</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12464392">HBASE-2539</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12467054">HBASE-2735</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12468282">HBASE-2809</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12467955">HBASE-2791</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12468281">HBASE-2808</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12468301">HBASE-2810</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12464197">HBASE-2529</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12464187">HBASE-2527</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12464299">HBASE-2534</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12465318">HBASE-2611</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12445214" name="HBASE-2223.patch" size="127084" author="jdcryans" created="Fri, 21 May 2010 22:20:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 12 Feb 2010 20:03:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32467</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hgtz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>