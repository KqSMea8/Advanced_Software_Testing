<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:29:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5639/HBASE-5639.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5639] The logic used in waiting for region servers during startup is broken</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5639</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See the tail of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4993&quot; title=&quot;Performance regression in minicluster creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4993&quot;&gt;&lt;del&gt;HBASE-4993&lt;/del&gt;&lt;/a&gt;, which I&apos;ll report here:&lt;/p&gt;

&lt;p&gt;Me:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I think a bug was introduced here. Here&apos;s the new waiting logic in waitForRegionServers:&lt;/p&gt;

&lt;p&gt;the &apos;hbase.master.wait.on.regionservers.mintostart&apos; is reached AND&lt;br/&gt;
   there have been no new region server in for&lt;br/&gt;
      &apos;hbase.master.wait.on.regionservers.interval&apos; time&lt;/p&gt;

&lt;p&gt;And the code that verifies that:&lt;/p&gt;

&lt;p&gt;!(lastCountChange+interval &amp;gt; now &amp;amp;&amp;amp; count &amp;gt;= minToStart)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nic:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It seems that changing the code to&lt;/p&gt;

&lt;p&gt;(count &amp;lt; minToStart ||&lt;br/&gt;
lastCountChange+interval &amp;gt; now)&lt;/p&gt;

&lt;p&gt;would make the code works as documented.&lt;br/&gt;
If you have 0 region servers that checked in and you are under the interval, you wait: (true or true) = true.&lt;br/&gt;
If you have 0 region servers but you are above the interval, you wait: (true or false) = true.&lt;br/&gt;
If you have 1 or more region servers that checked in and you are under the interval, you wait: (false or true) = true.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12548202">HBASE-5639</key>
            <summary>The logic used in waiting for region servers during startup is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Mar 2012 23:11:10 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:08 +0000</updated>
                            <resolved>Tue, 27 Mar 2012 20:41:13 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13238973" author="jdcryans" created="Mon, 26 Mar 2012 23:23:45 +0000"  >&lt;p&gt;Oh I forgot to mention that I&apos;m marking this as a blocker for 0.94.0 because right now if you start a sizable cluster you may end up with region servers that checkin too late and miss the re-assignment of regions.&lt;/p&gt;</comment>
                            <comment id="13239155" author="lhofhansl" created="Tue, 27 Mar 2012 03:57:12 +0000"  >&lt;p&gt;Are you planning to work on this, J-D?&lt;br/&gt;
Agree with the blocker status.&lt;/p&gt;</comment>
                            <comment id="13239164" author="jdcryans" created="Tue, 27 Mar 2012 04:24:51 +0000"  >&lt;p&gt;Patch that just changes the line as shown in the jira&apos;s description. I&apos;m currently running the small and medium tests.&lt;/p&gt;</comment>
                            <comment id="13239190" author="lhofhansl" created="Tue, 27 Mar 2012 05:14:17 +0000"  >&lt;p&gt;+1 on patch. Although my mind twisted like a pretzel thinking about the correct condition here.&lt;/p&gt;</comment>
                            <comment id="13239661" author="lhofhansl" created="Tue, 27 Mar 2012 17:20:53 +0000"  >&lt;p&gt;Ready for commit? I&apos;m happy to commit, since I&apos;d have to update CHANGES.txt as well (as this will be an RC candidate build).&lt;/p&gt;</comment>
                            <comment id="13239818" author="jdcryans" created="Tue, 27 Mar 2012 18:49:13 +0000"  >&lt;p&gt;I&apos;ll run a start on a cluster and get back with the answer in a moment.&lt;/p&gt;</comment>
                            <comment id="13239827" author="jdcryans" created="Tue, 27 Mar 2012 18:55:56 +0000"  >&lt;p&gt;Here&apos;s what I see now with the patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-03-27 18:53:07,644 INFO org.apache.hadoop.hbase.master.ServerManager: Waiting for region servers count to settle; currently checked in 0, slept for 0 ms, expecting minimum of 1, maximum of 2147483647, timeout of 4500 ms, interval of 1500 ms.
2012-03-27 18:53:08,638 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r29s44,62023,1332874388301
2012-03-27 18:53:08,638 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r27s44,62023,1332874388324
2012-03-27 18:53:08,649 INFO org.apache.hadoop.hbase.master.ServerManager: Waiting for region servers count to settle; currently checked in 2, slept for 1005 ms, expecting minimum of 1, maximum of 2147483647, timeout of 4500 ms, interval of 1500 ms.
2012-03-27 18:53:08,656 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r5s38,62023,1332874388319
2012-03-27 18:53:08,657 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r6s38,62023,1332874388364
2012-03-27 18:53:08,662 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r8s38,62023,1332874388371
2012-03-27 18:53:08,699 INFO org.apache.hadoop.hbase.master.ServerManager: Waiting for region servers count to settle; currently checked in 5, slept for 1055 ms, expecting minimum of 1, maximum of 2147483647, timeout of 4500 ms, interval of 1500 ms.
2012-03-27 18:53:08,897 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r31s44,62023,1332874388453
2012-03-27 18:53:08,900 INFO org.apache.hadoop.hbase.master.ServerManager: Waiting for region servers count to settle; currently checked in 6, slept for 1256 ms, expecting minimum of 1, maximum of 2147483647, timeout of 4500 ms, interval of 1500 ms.
2012-03-27 18:53:09,602 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv4r30s44,62023,1332874388969
2012-03-27 18:53:09,603 INFO org.apache.hadoop.hbase.master.ServerManager: Waiting for region servers count to settle; currently checked in 7, slept for 1959 ms, expecting minimum of 1, maximum of 2147483647, timeout of 4500 ms, interval of 1500 ms.
2012-03-27 18:53:11,110 INFO org.apache.hadoop.hbase.master.ServerManager: Finished waiting for region servers count to settle; checked in 7, slept for 3466 ms, expecting minimum of 1, maximum of 2147483647, master is running.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It confirms it did the right thing, go wild Lars &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13239931" author="lhofhansl" created="Tue, 27 Mar 2012 20:41:13 +0000"  >&lt;p&gt;Committed to 0.94 and 0.96&lt;/p&gt;</comment>
                            <comment id="13239964" author="hudson" created="Tue, 27 Mar 2012 21:25:32 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #61 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/61/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/61/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5639&quot; title=&quot;The logic used in waiting for region servers during startup is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5639&quot;&gt;&lt;del&gt;HBASE-5639&lt;/del&gt;&lt;/a&gt; The logic used in waiting for region servers during startup is broken (J-D and NKeyval) (Revision 1306011)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13239966" author="hudson" created="Tue, 27 Mar 2012 21:27:18 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #5 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/5/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/5/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5639&quot; title=&quot;The logic used in waiting for region servers during startup is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5639&quot;&gt;&lt;del&gt;HBASE-5639&lt;/del&gt;&lt;/a&gt; The logic used in waiting for region servers during startup is broken (J-D and NKeyval) (Revision 1306011)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13240212" author="hudson" created="Wed, 28 Mar 2012 05:53:29 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #152 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/152/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/152/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5639&quot; title=&quot;The logic used in waiting for region servers during startup is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5639&quot;&gt;&lt;del&gt;HBASE-5639&lt;/del&gt;&lt;/a&gt; The logic used in waiting for region servers during startup is broken (J-D and NKeyval) (Revision 1306012)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13240891" author="hudson" created="Thu, 29 Mar 2012 01:37:01 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2697 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2697/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2697/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5639&quot; title=&quot;The logic used in waiting for region servers during startup is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5639&quot;&gt;&lt;del&gt;HBASE-5639&lt;/del&gt;&lt;/a&gt; The logic used in waiting for region servers during startup is broken (J-D and NKeyval) (Revision 1306012)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12520060" name="HBASE-5639.patch" size="636" author="jdcryans" created="Tue, 27 Mar 2012 04:24:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Mar 2012 03:57:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233299</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0691r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>