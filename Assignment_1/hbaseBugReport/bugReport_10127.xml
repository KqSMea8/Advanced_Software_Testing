<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:10:43 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10127/HBASE-10127.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10127] support balance table</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10127</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HMaster provides a rpc interface : &apos;balance()&apos; to balance all the regions among region servers in the cluster. Sometimes, we might want to balance all the regions belonging to a table while keeping the region assignments of other tables. This demand may reveal in a shared cluster where we want to balance regions for one application&apos;s table without affecting other applications. Therefore, will it be useful if we extend the current &apos;balance()&apos; interface to only balance regions of the same table? &lt;/p&gt;</description>
                <environment></environment>
        <key id="12683999">HBASE-10127</key>
            <summary>support balance table</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cuijianwei">Jianwei Cui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Dec 2013 09:19:14 +0000</created>
                <updated>Tue, 12 Aug 2014 20:36:21 +0000</updated>
                                            <version>0.94.14</version>
                                                    <component>master</component>
                    <component>shell</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13845214" author="cuijianwei" created="Wed, 11 Dec 2013 09:27:50 +0000"  >&lt;p&gt;This patch extends the current balance interface of HMaster by implementing &apos;balance(final byte[] tableName)&apos; interface. HBase shell is also extended to support this feature.&lt;/p&gt;</comment>
                            <comment id="13845400" author="jmspaggi" created="Wed, 11 Dec 2013 13:54:26 +0000"  >&lt;p&gt;Sound good to me.&lt;/p&gt;

&lt;p&gt;some extra spaces after&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;RegionPlan&amp;gt; plans = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;RegionPlan&amp;gt;();
       &amp;lt;=== Here
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getMaster().balance();
   }
+  &amp;lt;=== Here
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the java code, can we say &quot;Balance table&apos;s regions&quot; or &quot;Balance regions of a table&quot;?&lt;/p&gt;

&lt;p&gt;getMaster() is deprecated. Any chance to replace it? (Not 100% required for the scope of this patch)&lt;/p&gt;

&lt;p&gt;Can you do the trunk version to trigger Hadoop QA?&lt;/p&gt;</comment>
                            <comment id="13845560" author="eclark" created="Wed, 11 Dec 2013 17:29:16 +0000"  >&lt;p&gt;I feel pretty strongly that trunk shouldn&apos;t get this functionality.  It&apos;s default balancer relies on there being no per table balancer, and in fact I think that it should only be in the old balancer at all.  I&apos;ve been meaning to remove that code in AM.&lt;/p&gt;</comment>
                            <comment id="13845568" author="jmspaggi" created="Wed, 11 Dec 2013 17:40:11 +0000"  >&lt;p&gt;Hi Elliot,&lt;/p&gt;

&lt;p&gt;Have you take a close look to the patch?&lt;/p&gt;

&lt;p&gt;It seems that it&apos;s still still building the balancing plan based on the entire cluster/tables, not just a single table, but at the end, execute only for a single table. Might be useful if you create a big table, or split it in multiple small pieces, and then want to balance it without impacting the rest of the operations. The generated plan will still take into consideration the other tables/regions.&lt;/p&gt;

&lt;p&gt;So it&apos;s not really a table balancer the way it was before. I think.&lt;/p&gt;</comment>
                            <comment id="13845584" author="eclark" created="Wed, 11 Dec 2013 17:53:56 +0000"  >&lt;p&gt;It still is using the AM.getAssignmentsByTable() and then passing only one table&apos;s worth of assignments if that table name matches.  That function depends on hbase.master.loadbalance.bytable&apos;s value and will give different results based on if it&apos;s turned on or off.&lt;/p&gt;

&lt;p&gt;In trunk this won&apos;t work at all (by table is turned off).  In 0.94 this won&apos;t work when hbase.master.loadbalance.bytable is false.&lt;/p&gt;

&lt;p&gt;By table balancing is there only because the balancer hasn&apos;t done it&apos;s job well. All things that by table balancing handled should be fixed in 0.96 and forward.&lt;/p&gt;</comment>
                            <comment id="13846051" author="cuijianwei" created="Thu, 12 Dec 2013 04:08:05 +0000"  >&lt;p&gt;Thanks for your comments &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;. I go through the implementation of &apos;balance()&apos; in trunk. The &apos;getAssignmentByTable()&apos; has been moved to RegionStates. The current implementation also includes the following logic:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!server.getConfiguration().getBoolean(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.master.loadbalance.bytable&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
        Map&amp;lt;ServerName, List&amp;lt;HRegionInfo&amp;gt;&amp;gt; svrToRegions =
          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;ServerName, List&amp;lt;HRegionInfo&amp;gt;&amp;gt;(serverHoldings.size());
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;ServerName, Set&amp;lt;HRegionInfo&amp;gt;&amp;gt; e: serverHoldings.entrySet()) {
          svrToRegions.put(e.getKey(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;HRegionInfo&amp;gt;(e.getValue()));
        }
        result.put(TableName.valueOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;ensemble&quot;&lt;/span&gt;), svrToRegions);
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems &apos;hbase.master.loadbalance.bytable&apos; will decide whether regions can be returned by table? Will this logic be removed soon? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;, as you mentioned, the balancer hasn&apos;t done the job well when doing table balancing, is there any jira issue discuss this problem? Thanks.&lt;/p&gt;</comment>
                            <comment id="13846508" author="lhofhansl" created="Thu, 12 Dec 2013 17:57:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;, are you saying that trunk should get this patch or this functionality?&lt;br/&gt;
It seems regardless of how trunk currently implements balancing this is a valid scenario.&lt;/p&gt;

&lt;p&gt;Or are you saying that such control is not needed, since the balancer in trunk will do a better job? That&apos;d be a valid point too. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;For 0.94 this is a simple patch. I&apos;d &amp;#43;1 for that part. But it would be strange if 0.94 had this, but 0.96+ won&apos;t.&lt;br/&gt;
But it would be OK (IMHO) if the trunk balancer is just better and hence to need to give this kind of control to the user.&lt;/p&gt;</comment>
                            <comment id="13846644" author="eclark" created="Thu, 12 Dec 2013 19:30:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;Elliott Clark, are you saying that trunk should get this patch or this functionality?&lt;/p&gt;&lt;/blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;I think that it shouldn&apos;t need it.  It has an idea of spreading the one table to lots of region servers.&lt;/li&gt;
	&lt;li&gt;Additionally the balancer in 96+ will fight with itself if we balance by table only and then balance the whole cluster.&lt;/li&gt;
	&lt;li&gt;Lastly I think that the getAssignmentByTable function is an abomination, and should be removed.  I would prefer to move things off that function and not onto it.
	&lt;ul&gt;
		&lt;li&gt;Deciding to balance by table or in total should be something the balancer does, it shouldn&apos;t be part of the AM that&apos;s grouping by table name.&lt;/li&gt;
		&lt;li&gt;Having the function return something completely different than the name suggests because of a config is just hacky.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;&lt;p&gt;For 0.94 this is a simple patch. I&apos;d +1 for that part. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It will be broken for anyone with by table balancing turned off though (People with lots of tables might have turned this off as it can result in a really bad balance).  Seems weird to have a command that will run but not work depending upon the settings.&lt;/p&gt;</comment>
                            <comment id="13846748" author="lhofhansl" created="Thu, 12 Dec 2013 21:17:28 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;. So trunk neither wants nor needs this patch it seems.&lt;br/&gt;
So if hbase.master.loadbalance.bytable is true in 0.94, will the balancer not do the right thing?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cuijianwei&quot; class=&quot;user-hover&quot; rel=&quot;cuijianwei&quot;&gt;Jianwei Cui&lt;/a&gt;, did you see a specific issue where the resulting balancing was bad?&lt;/p&gt;</comment>
                            <comment id="13846752" author="eclark" created="Thu, 12 Dec 2013 21:24:06 +0000"  >&lt;p&gt;If hbase.master.loadbalance.bytable is false getAssignmentByTable doesn&apos;t actually group things by table.  it will create a fake table name and put all of the regions for all tables into that map entry.  Then when this command is called that table won&apos;t exist and will exit without doing anything.&lt;/p&gt;</comment>
                            <comment id="13846770" author="lhofhansl" created="Thu, 12 Dec 2013 21:38:17 +0000"  >&lt;p&gt;What I meant is that maybe we don&apos;t need this in 0.94 either -&amp;gt; either the balancer already balances by table, or this command is a no-op anyway&lt;/p&gt;

&lt;p&gt;Only if there is a specific issue with the balancer not doing the right thing should either fix the specific problem or have this as a crutch.&lt;/p&gt;</comment>
                            <comment id="13847057" author="cuijianwei" created="Fri, 13 Dec 2013 02:10:36 +0000"  >&lt;p&gt;Thanks for your comment &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;. I go through the logic of &apos;balance()&apos; and try the patch in our cluster, the balancing result seems good. I will take a close look at the logic of &apos;balance()&apos;. On the other hand, if there is a specific issue where the resulting balancing was bad, I think we might need to fix the problem because bad cluster balancing result may also be generated if there is only one table in the cluster.&lt;/p&gt;</comment>
                            <comment id="14094622" author="busbey" created="Tue, 12 Aug 2014 20:36:21 +0000"  >&lt;p&gt;Should this be closed as wontfix?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12618204" name="HBASE-10127-0.94-v1.patch" size="5297" author="cuijianwei" created="Wed, 11 Dec 2013 09:27:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Dec 2013 13:54:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363071</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 18 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ql1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>