<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3906/HBASE-3906.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3906] When HMaster is running,there are a lot of RegionLoad instances&#65288;far greater than the regions&#65289;,it has risk of OOME.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3906</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;1&#12289;Start hbase cluster;&lt;br/&gt;
2&#12289;After hmaster finish regions assignement,use jmap to dump the memory of hmaster;&lt;br/&gt;
3&#12289;Use MAT to analyse the dump file,there are too many RegionLoad instances,and these instances occupy more than 3G memory;&lt;/p&gt;</description>
                <environment>&lt;p&gt;1 hmaster,4 regionserver,about 100,000 regions.&lt;/p&gt;</environment>
        <key id="12507842">HBASE-3906</key>
            <summary>When HMaster is running,there are a lot of RegionLoad instances&#65288;far greater than the regions&#65289;,it has risk of OOME.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jianzhang">jian zhang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 May 2011 04:28:58 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:45 +0000</updated>
                            <resolved>Thu, 26 May 2011 03:58:56 +0000</resolved>
                                    <version>0.90.2</version>
                    <version>0.90.3</version>
                                    <fixVersion>0.90.4</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="604800">168h</timeoriginalestimate>
                            <timeestimate seconds="604800">168h</timeestimate>
                                        <comments>
                            <comment id="13037000" author="yuzhihong@gmail.com" created="Fri, 20 May 2011 18:53:22 +0000"  >&lt;p&gt;The patch wouldn&apos;t apply to trunk where heart beat has been removed.&lt;/p&gt;</comment>
                            <comment id="13037011" author="stack" created="Fri, 20 May 2011 19:15:20 +0000"  >&lt;p&gt;@Ted I think the patch is for branch only. It has the problem.  I don&apos;t believe TRUNK does.&lt;/p&gt;

&lt;p&gt;@Jian This should work though its ugly; i.e. refreshing an HServerInfo instance (Do we need to keep load in the Map of regions?  What about clearing the load from the HSI we add to the Map of regions to HSI?  Would that work?  Or is this Map used balancing?).  Does your patch work for you?  Any issues w/ the new synchronize blocks?&lt;/p&gt;</comment>
                            <comment id="13037257" author="apurtell" created="Sat, 21 May 2011 03:24:15 +0000"  >&lt;p&gt;How many of those &quot;3G&quot; of objects on the heap are live?&lt;/p&gt;</comment>
                            <comment id="13037816" author="jianzhang" created="Mon, 23 May 2011 09:23:17 +0000"  >&lt;p&gt;1, Ted, This patch is only for branch.&lt;br/&gt;
2, Andrew, In my hmaster dump, there are 1481 HServerInfo and HServerLoad objects,24,423,058 RegionLoad objects,one RegionLoad occupy 136B.I&apos;m not native speaker,so i&apos;m not very sure that i understand your question correctly. Can i understand &quot;live objects&quot; as the objects which cann&apos;t be garbage collected by jvm?if so,i think all these objects are live.&lt;br/&gt;
3,stack, I tested serveral senarios,the patch can work correctly,no issues found about synchronize blocks.&lt;br/&gt;
Indeed,refreshing hserverinfo is not grace enough. and balancing don&apos;t use the load of the HSI in regions map i think. according to your suggestion, i cleared the load and patched on my cluster to test,until now,it works ok.i will try to test more senarios and then provide the new patch to you for reviewing again.&lt;br/&gt;
BTW,one hserverinfo object occupy about 350B memory though cleared the load,if we don&apos;t use my ugly refreshing solution, in worst case,one region need one hserverinfo object,if a big hbase cluster have 500,000 regions,the hserverinfo objects will occupy about 175,000,000B memory.do you think this can be acceptable?&lt;/p&gt;</comment>
                            <comment id="13038059" author="stack" created="Mon, 23 May 2011 17:16:18 +0000"  >&lt;p&gt;Jian:  Thanks for trying out my suggestion.  I think 175M is fine if you have 500k regions.&lt;/p&gt;</comment>
                            <comment id="13038061" author="stack" created="Mon, 23 May 2011 17:17:16 +0000"  >&lt;p&gt;Jian: Yes, Andrew is asking how many of the 24M objects are not collectable by the JVM?  Does your heap analysis tool have a means of cleaning dead objects and only showing &apos;live objects&apos;?&lt;/p&gt;</comment>
                            <comment id="13039495" author="jianzhang" created="Thu, 26 May 2011 03:00:12 +0000"  >&lt;p&gt;The 24M objects are all live,not include dead objects.&lt;br/&gt;
I have test senarios below with this new patch:&lt;br/&gt;
1,start cluster normally,insert data and then dump hmaster memory;&lt;br/&gt;
2,when cluster is running,kill active hmaster and standby hmaster switch to active hmaster,then dump the new active hmaster memory;&lt;br/&gt;
3,kill or join new regionserver to running cluster,when balance finished,dump hmaster memory.&lt;/p&gt;

&lt;p&gt;All senarios above,the hmaster does not have unnessessary HServerLoad objects and the balance can work too.&lt;/p&gt;</comment>
                            <comment id="13039496" author="jianzhang" created="Thu, 26 May 2011 03:07:02 +0000"  >&lt;p&gt;please use this new attachement.&lt;/p&gt;</comment>
                            <comment id="13039503" author="stack" created="Thu, 26 May 2011 03:58:56 +0000"  >&lt;p&gt;Committed to branch (Doesn&apos;t make sense on TRUNK).  Thanks for the patch Jian.&lt;/p&gt;</comment>
                            <comment id="15017612" author="lars_francke" created="Fri, 20 Nov 2015 12:43:45 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480502" name="HBASE-3906.patch" size="918" author="jianzhang" created="Thu, 26 May 2011 03:07:02 +0000"/>
                            <attachment id="12479879" name="HBASE-3906.patch" size="3282" author="jianzhang" created="Fri, 20 May 2011 06:33:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 May 2011 18:53:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33262</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hogn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>