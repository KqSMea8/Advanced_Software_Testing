<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:00:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2240/HBASE-2240.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2240] Balancer should not reassign (because of overloading) a region that was just opened</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2240</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;m running a mapreduce job.  I see a region split and its daughters come on line and then 8 seconds later, master judges the regionserver overloaded and so closes the just-opened region.  This messes up clients.   They may have just picked up the new location for their row query and now its moved again and client has to go hunting anew. &lt;/p&gt;

&lt;p&gt;We need to assign the vintage regions first.&lt;/p&gt;

&lt;p&gt;I&apos;m going to change balancer slop.  Its not sloppy enough and balancing cuts in too early.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12456829">HBASE-2240</key>
            <summary>Balancer should not reassign (because of overloading) a region that was just opened</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Feb 2010 19:38:44 +0000</created>
                <updated>Fri, 6 May 2011 17:23:09 +0000</updated>
                            <resolved>Fri, 6 May 2011 17:23:09 +0000</resolved>
                                                                    <component>documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12905100" author="stack" created="Wed, 1 Sep 2010 17:28:18 +0000"  >&lt;p&gt;This issue can happen with the new balancer.  New balancer is better in that it looks at the cluster as a whole and generates a plan that includes specification of where regions should be rebalanced too &amp;#8211; an improvement over what was there previous where any regionserver could be passed the unloaded region &amp;#8211; but the new balancer does not keep a history of what rebalances its done recently.  It should.&lt;/p&gt;</comment>
                            <comment id="12905115" author="streamy" created="Wed, 1 Sep 2010 17:45:48 +0000"  >&lt;p&gt;This seems invalid now, in my mind.&lt;/p&gt;

&lt;p&gt;What is the reasoning behind wanting to have a history of rebalances?  Is there some reason we would never want to rebalance a region that was just recently opened (for some definition of recent).&lt;/p&gt;

&lt;p&gt;I&apos;m pretty sure this jira was dealing with the region assignment churn because we are determining to balance on each heartbeat, so it was literally balancing a region to be on a server, then unassigning for another server almost immediately.  Now that it&apos;s in the background, waits for no regions to be in transition, and will only ever do one move of a given region per load-balance, this does not seem valid anymore.&lt;/p&gt;

&lt;p&gt;A load-balance will run periodically (minutes).  Is it the case that we would not want to move a region from A to B in one balance.  And then 30 minutes later to move the same region from B to C (or wherever)?  Not sure I follow why this is very important to not move a region in successive balances (if our algorithm, now or later, decides this is best to achieve &quot;balance&quot;).&lt;/p&gt;

&lt;p&gt;We should put smarts into that algorithm.  A high cost could be associated with moving a region if, for example, it had a large MemStore so it would require a big flush.  Or, even to implement what&apos;s being discussed here, a high cost could be related to how long ago a region opened at its current location (but again, I&apos;m having a hard time knowing whether we&apos;d bias old or new ones... other stuff is probably better to make decisions based on)&lt;/p&gt;</comment>
                            <comment id="12905119" author="stack" created="Wed, 1 Sep 2010 17:56:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there some reason we would never want to rebalance a region that was just recently opened (for some definition of recent).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. It takes clients a while finding new locations.  With our current client at least, reopens that come close together can result in the client failing with NSRE.&lt;/p&gt;

&lt;p&gt;History would also help prevent the slightly pathological case where its always the same region that gets moved on a rebalance.&lt;/p&gt;

&lt;p&gt;Currently balancer runs every minute.  I should up the default.&lt;/p&gt;

&lt;p&gt;Marking issue minor.&lt;/p&gt;</comment>
                            <comment id="12905121" author="streamy" created="Wed, 1 Sep 2010 18:04:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes. It takes clients a while finding new locations. With our current client at least, reopens that come close together can result in the client failing with NSRE.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t see how this would be different whether region was open for a long time at its location or not.  If the region had been in one place for a while, most clients will have a valid cache value, so moving it will invalidate every client.  This will give clients an NSRE.  A region that had just recently moved probably has clients that still are stale when it moves the second time.  So you&apos;d potentially have less NSREs in total.  Right?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;History would also help prevent the slightly pathological case where its always the same region that gets moved on a rebalance.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That would be somewhat weird behavior, but this history approach is kind of at odds with the cost-based approach.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Currently balancer runs every minute. I should up the default.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Marking issue minor.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Cool with me.  Just want to push for a more generalizable, cost-based approach to balancing.&lt;/p&gt;</comment>
                            <comment id="12905125" author="stack" created="Wed, 1 Sep 2010 18:14:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;A region that had just recently moved probably has clients that still are stale when it moves the second time. So you&apos;d potentially have less NSREs in total. Right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No.  What I saw was retries trying to find location 1 chained to retries looking for location 2.  The sum of the two retries cased ERROR NSRE and failed MR task.&lt;/p&gt;</comment>
                            <comment id="12905127" author="streamy" created="Wed, 1 Sep 2010 18:17:28 +0000"  >&lt;p&gt;Got it.  Okay, well hopefully just having 10 minutes or more between balances should suffice.&lt;/p&gt;</comment>
                            <comment id="12905129" author="streamy" created="Wed, 1 Sep 2010 18:18:05 +0000"  >&lt;p&gt;Or even longer.  We could always add something to trigger a prematurely balance, either user-triggered or when the cluster gets especially out of balance.&lt;/p&gt;</comment>
                            <comment id="13030038" author="stack" created="Fri, 6 May 2011 17:23:09 +0000"  >&lt;p&gt;Resolving as invalid (Jon argues this in body of this issue and stuff suggested in the issue &amp;#8211; upping balancer period &amp;#8211; has been implemented)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12462821">HBASE-2480</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Sep 2010 17:45:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26219</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hgw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>