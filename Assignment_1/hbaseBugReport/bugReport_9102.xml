<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:01:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9102/HBASE-9102.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9102] HFile block pre-loading for large sequential scan</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9102</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The current HBase scan model cannot take full advantage of the aggrediate disk throughput, especially for the large sequential scan cases. And for the large sequential scan, it is easy to predict what the next block to read in advance so that it can pre-load and decompress/decoded these data blocks from HDFS into block cache right before the current read point. &lt;/p&gt;

&lt;p&gt;Therefore, this jira is to optimized the large sequential scan performance by pre-loading the HFile blocks into the block cache in a stream fashion so that the scan query can read from the cache directly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12660940">HBASE-9102</key>
            <summary>HFile block pre-loading for large sequential scan</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="liyin">Liyin Tang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Jul 2013 17:14:47 +0000</created>
                <updated>Mon, 25 Jan 2016 19:51:46 +0000</updated>
                                            <version>0.89-fb</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="13725446" author="lhofhansl" created="Wed, 31 Jul 2013 17:19:52 +0000"  >&lt;p&gt;Should we handle this from the client instead. Part of the problem is that the network pipe is not kept full, so by triggering prefetching from the client we can solve both problems.&lt;/p&gt;</comment>
                            <comment id="13725453" author="vrodionov" created="Wed, 31 Jul 2013 17:24:38 +0000"  >&lt;p&gt;This is what, actually, OS does and all modern disk controllers do on a lower lvel. If short-circuit reads are enabled and HBase cluster has good HDFS locality and data is compacted you will get dick blocks pre-fetching for free. &lt;/p&gt;</comment>
                            <comment id="13725515" author="liyin" created="Wed, 31 Jul 2013 18:05:26 +0000"  >&lt;p&gt;It is true that OS cached the compressed/encoded blocks and the DFSClient non-pread operation is also able to pre-load all the bytes up to that DFS block. And this feature is to pre-load (decompress/decoded) these data blocks in additional to the OS cache/disk read-ahead.&lt;/p&gt;

&lt;p&gt;Also the scan prefetch is currently implemented in the RegionScanner level. I think it is a good idea to implement some prefetch logic in the HBase client as well.&lt;/p&gt;</comment>
                            <comment id="13726224" author="stepinto" created="Thu, 1 Aug 2013 08:41:40 +0000"  >&lt;p&gt;I don&apos;t think block cache should be used for such prefetch, as large sequential scan will swap-out blocks for random read.&lt;br/&gt;
If we use hdfs client for prefetch, we also need to implement scanner-sticky DFSInputStream, as seek called by another scanner will clear all the prefetch work. &lt;/p&gt;

&lt;p&gt;Another question is how do we consider if a scan is sequential or random. The current implementation (before Lars&apos;s patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7336&quot; title=&quot;HFileBlock.readAtOffset does not work well with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7336&quot;&gt;&lt;del&gt;HBASE-7336&lt;/del&gt;&lt;/a&gt;) only treats Get as random and thus uses pread. In our scenario, there are two kinds of scans: a) from online system and b) MR. Most of a) does not scan more than 1 block and are expected to return within tens of milliseconds.&lt;/p&gt;</comment>
                            <comment id="13726635" author="liyin" created="Thu, 1 Aug 2013 17:25:00 +0000"  >&lt;p&gt;Chao, You are right that the pre-load will run in a rate/limit fashion to make sure it won&apos;t pollute the block cache substantially.&lt;br/&gt;
The pre-loading targets on the large sequential scan case. The client is able to enable/disable on each request basis. &lt;/p&gt;</comment>
                            <comment id="13727242" author="stepinto" created="Fri, 2 Aug 2013 02:59:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;The client is able to enable/disable on each request basis.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is this switch available for now? I guess this is enough to improve under our workload (as most of our scan requests only touch 1 block). For such requests, we can enable this switch to use pread.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12783345">HBASE-13291</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 31 Jul 2013 17:19:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mu1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>