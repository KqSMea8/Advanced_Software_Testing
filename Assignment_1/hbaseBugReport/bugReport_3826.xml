<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3826/HBASE-3826.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3826] Minor compaction needs to check if still over compactionThreshold after compacting</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3826</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have a busy region, and there are 43 StoreFiles (&amp;gt;compactionThreshold=8) in this region.&lt;br/&gt;
Now, I stopped the client and stopped putting new data into it. I expect these StoreFiles to be compacted later.&lt;/p&gt;

&lt;p&gt;But, almost one day later, these 43 StoreFiles are still there.&lt;br/&gt;
(Note: in my hbase instance, I disabled the major compaction.)&lt;/p&gt;

&lt;p&gt;It seems the minor compaction does not be started continuiously to compact remaining storefiles.&lt;br/&gt;
And I checked the code, it is true.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;After more test, a obvious issue/problem is, the complete of a minor compaction does not check if current storefiles need more minor compaction.&lt;/p&gt;

&lt;p&gt;I think this may be a bug or leak.&lt;/p&gt;

&lt;p&gt;Try this test:&lt;/p&gt;

&lt;p&gt;1. Put many data to a region, then there are 30 storefiles accumulated, because the backend compaction cannot catch up with the fast puts. (hbase.hstore.compactionThreshold=8, base.hstore.compaction.max=12)&lt;/p&gt;

&lt;p&gt;2. Then stop put.&lt;/p&gt;

&lt;p&gt;3. Then, these 30 storefiles are still there for a long time, (no automatic minor compaction)&lt;/p&gt;

&lt;p&gt;4. Submit a compaction on this region, then, only 12 files are compaction, now, we have 19 storefiles. The minor compaction stopped.&lt;/p&gt;

&lt;p&gt;I think, when a minor compaction complete, it should check if the number of storefiles still many, if so, another minor compaction should start continuiously.&lt;/p&gt;</description>
                <environment>&lt;p&gt;hbase-0.90.1&lt;br/&gt;
hbase-0.90.1-cdh3u0&lt;/p&gt;</environment>
        <key id="12505369">HBASE-3826</key>
            <summary>Minor compaction needs to check if still over compactionThreshold after compacting</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="schubertzhang">Schubert Zhang</reporter>
                        <labels>
                            <label>compaction</label>
                    </labels>
                <created>Thu, 28 Apr 2011 03:53:19 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:01 +0000</updated>
                            <resolved>Thu, 19 May 2011 22:00:40 +0000</resolved>
                                    <version>0.90.1</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13026647" author="jdcryans" created="Thu, 28 Apr 2011 19:23:56 +0000"  >&lt;p&gt;Editing the title and marking against 0.92&lt;/p&gt;</comment>
                            <comment id="13026764" author="nspiegelberg" created="Thu, 28 Apr 2011 23:10:39 +0000"  >&lt;p&gt;I think recursive compactions are pretty dangerous.  Although re-enqueuing after compaction is the optimal solution, Exceptions or other weird bugs in the compaction code would cause spin-waiting problems.  I think the optimal solution is to have quick response for the blocking StoreFile case and asynchronous, rate-limited enqueuing for less severe cases.&lt;/p&gt;</comment>
                            <comment id="13027318" author="schubertzhang" created="Sat, 30 Apr 2011 11:00:14 +0000"  >&lt;p&gt;The patch seems re-queue compaction at reigion level.&lt;br/&gt;
How about in store.&lt;/p&gt;</comment>
                            <comment id="13027369" author="stack" created="Sat, 30 Apr 2011 20:16:06 +0000"  >&lt;p&gt;@Nicolas How does this relate to &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3796&quot; title=&quot;Per-Store Entries in Compaction Queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3796&quot;&gt;&lt;del&gt;HBASE-3796&lt;/del&gt;&lt;/a&gt; Per-Store Entries in Compaction Queue&apos;?&lt;/p&gt;</comment>
                            <comment id="13029040" author="stack" created="Wed, 4 May 2011 23:17:33 +0000"  >&lt;p&gt;Marking patch available though there are some questions about the attached patch.&lt;/p&gt;</comment>
                            <comment id="13031482" author="nspiegelberg" created="Tue, 10 May 2011 23:58:37 +0000"  >&lt;p&gt;Attached the 0.92 patch.  Note that the recursive enqueue was added by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1476&quot; title=&quot;scaling compaction with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1476&quot;&gt;&lt;del&gt;HBASE-1476&lt;/del&gt;&lt;/a&gt;, so the only change necessary for this JIRA is to change the MajorCompactionChecker to a CompactionChecker.&lt;/p&gt;

&lt;p&gt;@Zhang : I assume since you want a Store-level diff, you want to use 0.92 &amp;amp; not 0.90 (the environment you reported).  The old patch should work for 0.90.&lt;/p&gt;</comment>
                            <comment id="13036520" author="stack" created="Thu, 19 May 2011 22:00:40 +0000"  >&lt;p&gt;Committed the 0.92 patch to TRUNK.  Thanks Nicolas.&lt;/p&gt;</comment>
                            <comment id="13037170" author="hudson" created="Sat, 21 May 2011 00:04:26 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1930 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1930/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1930/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="15017410" author="lars_francke" created="Fri, 20 Nov 2015 12:43:01 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477713" name="HBASE-3826.patch" size="7034" author="nspiegelberg" created="Thu, 28 Apr 2011 23:43:57 +0000"/>
                            <attachment id="12478749" name="HBASE-3826_0.92.patch" size="5452" author="nspiegelberg" created="Tue, 10 May 2011 23:58:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 Apr 2011 19:23:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ho33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>compaction</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>