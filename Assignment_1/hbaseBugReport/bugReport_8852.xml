<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:59:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8852/HBASE-8852.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8852] Close scanners when at end in Thrift 2</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8852</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6073&quot; title=&quot;Add support for scan filters in Thrift2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6073&quot;&gt;&lt;del&gt;HBASE-6073&lt;/del&gt;&lt;/a&gt; adds the following to the overall patch:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; resultsFromHBase(scanner.next(numRows));
+      List&amp;lt;TResult&amp;gt; results = resultsFromHBase(scanner.next(numRows));
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(results.size() &amp;lt; numRows) {
+        removeScanner(scannerId);
+      }
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; results;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We need to see if we have to add this to Thrift2 as separate patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12655758">HBASE-8852</key>
            <summary>Close scanners when at end in Thrift 2</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12655350">HBASE-8818</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="larsgeorge">Lars George</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                            <label>thrift2</label>
                    </labels>
                <created>Tue, 2 Jul 2013 12:25:38 +0000</created>
                <updated>Tue, 16 Jul 2013 17:57:27 +0000</updated>
                            <resolved>Tue, 16 Jul 2013 17:57:27 +0000</resolved>
                                                                    <component>Thrift</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13701260" author="larsgeorge" created="Sat, 6 Jul 2013 06:18:58 +0000"  >&lt;p&gt;I tried this patch:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- hbase-server/src/main/java/org/apache/hadoop/hbase/thrift2/ThriftHBaseServiceHandler.java	(revision 1500028)
+++ hbase-server/src/main/java/org/apache/hadoop/hbase/thrift2/ThriftHBaseServiceHandler.java	(revision )
@@ -328,7 +328,11 @@
     }
 
     &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
-      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; resultsFromHBase(scanner.next(numRows));
+      List&amp;lt;TResult&amp;gt; results = resultsFromHBase(scanner.next(numRows));
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(results.size() &amp;lt; numRows) {
+        removeScanner(scannerId);
+      }
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; results;
     } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
       &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; getTIOError(e);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but that caused the scan tests of TestThriftHBaseHandler to fail, because the closeScanner() call now triggers an TIllegalArgument error, because the scanner has been removed implicitly. &lt;/p&gt;

&lt;p&gt;We need a better way I think to handle this implicit closing. Maybe incorporate into &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3852&quot; title=&quot;ThriftServer leaks scanners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3852&quot;&gt;&lt;del&gt;HBASE-3852&lt;/del&gt;&lt;/a&gt; is the better way.&lt;/p&gt;</comment>
                            <comment id="13701262" author="madani" created="Sat, 6 Jul 2013 06:47:50 +0000"  >&lt;p&gt;I found most of our scan calls to thrift usually involves opening a scanner , getting results and closing the scanner immediately. This could be very specific to our use case but I ended up adding a new function to thrift2 server to open scanner , get results and close the scanner all in one function. so Instead of 3 calls to thrift (openScanner , getScannerRows, closeScanner), we just call a new function &quot;getScannerResults&quot; to open scanner , get x number of rows, then close scanner all with only one call to thrift server.&lt;/p&gt;

&lt;p&gt;If you also think, others might find a new function like this useful , I can make a patch. &lt;/p&gt;
</comment>
                            <comment id="13701309" author="larsgeorge" created="Sat, 6 Jul 2013 10:39:57 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=madani&quot; class=&quot;user-hover&quot; rel=&quot;madani&quot;&gt;Hamed Madani&lt;/a&gt;, better create a new JIRA issue for that new feature. But makes sense I think as it reduce overhead. Similar to the getMultiple() but without the need to know all the keys.&lt;/p&gt;</comment>
                            <comment id="13710003" author="larsgeorge" created="Tue, 16 Jul 2013 17:57:27 +0000"  >&lt;p&gt;I am closing this for now in favor of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8946&quot; title=&quot;Add a new function to Thrift 2 to open scanner, get results and close scanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8946&quot;&gt;&lt;del&gt;HBASE-8946&lt;/del&gt;&lt;/a&gt;. Here we have an issue removing the scanner at the end implicitly. We could - for example - at least release the resources, i.e. close the ClientScanner instance. But that is covered in the linked issues at a broader scope.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12506128">HBASE-3852</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12657646">HBASE-8946</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 6 Jul 2013 06:47:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336033</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lyon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thrift2</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>