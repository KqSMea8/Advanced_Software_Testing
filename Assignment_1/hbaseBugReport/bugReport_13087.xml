<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:39:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13087/HBASE-13087.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13087] branch-1 isn&apos;t rolling upgradable from 0.98</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13087</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 1 action: org.apache.hadoop.hbase.regionserver.NoSuchColumnFamilyException: Column family table does not exist in region hbase:meta,,1.1588230740 in table &apos;hbase:meta&apos;, {TABLE_ATTRIBUTES =&amp;gt; {IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, coprocessor$1 =&amp;gt; &apos;|org.apache.hadoop.hbase.coprocessor.MultiRowMutationEndpoint|536870911|&apos;}, {NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;10&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;FALSE&apos;, DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;FOREVER&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, MIN_VERSIONS =&amp;gt; &apos;0&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;}
	at org.apache.hadoop.hbase.regionserver.HRegionServer.doBatchOp(HRegionServer.java:4513)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.doNonAtomicRegionMutation(HRegionServer.java:3687)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.multi(HRegionServer.java:3576)
	at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:30816)
	at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2029)
	at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:107)
	at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:130)
	at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:107)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
: 1 time, 
	at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.makeException(AsyncProcess.java:228)
	at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.access$1700(AsyncProcess.java:208)
	at org.apache.hadoop.hbase.client.AsyncProcess.waitForAllPreviousOpsAndReset(AsyncProcess.java:1689)
	at org.apache.hadoop.hbase.client.BufferedMutatorImpl.backgroundFlushCommits(BufferedMutatorImpl.java:208)
	at org.apache.hadoop.hbase.client.BufferedMutatorImpl.flush(BufferedMutatorImpl.java:183)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:1404)
	at org.apache.hadoop.hbase.client.HTable.put(HTable.java:1017)
	at org.apache.hadoop.hbase.MetaTableAccessor.put(MetaTableAccessor.java:1123)
	at org.apache.hadoop.hbase.MetaTableAccessor.putToMetaTable(MetaTableAccessor.java:1113)
	at org.apache.hadoop.hbase.MetaTableAccessor.updateTableState(MetaTableAccessor.java:1436)
	at org.apache.hadoop.hbase.MetaTableAccessor.updateTableState(MetaTableAccessor.java:948)
	at org.apache.hadoop.hbase.master.TableStateManager.writeMetaState(TableStateManager.java:195)
	at org.apache.hadoop.hbase.master.TableStateManager.setTableState(TableStateManager.java:69)
	at org.apache.hadoop.hbase.master.AssignmentManager.setEnabledTable(AssignmentManager.java:3427)
	at org.apache.hadoop.hbase.master.HMaster.assignMeta(HMaster.java:903)
	at org.apache.hadoop.hbase.master.HMaster.finishActiveMasterInitialization(HMaster.java:698)
	at org.apache.hadoop.hbase.master.HMaster.access$500(HMaster.java:166)
	at org.apache.hadoop.hbase.master.HMaster$1.run(HMaster.java:1494)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12776987">HBASE-13087</key>
            <summary>branch-1 isn&apos;t rolling upgradable from 0.98</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="rajesh0042">Rajesh Nishtala</assignee>
                                    <reporter username="eclark">Elliott Clark</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Feb 2015 23:30:06 +0000</created>
                <updated>Tue, 28 Apr 2015 17:26:27 +0000</updated>
                            <resolved>Tue, 28 Apr 2015 17:26:27 +0000</resolved>
                                    <version>1.1.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="14334083" author="enis" created="Mon, 23 Feb 2015 23:34:17 +0000"  >&lt;p&gt;This is probably due to the table states in meta. We should alter table meta for this it seems. &lt;/p&gt;</comment>
                            <comment id="14334547" author="lhofhansl" created="Tue, 24 Feb 2015 07:38:49 +0000"  >&lt;p&gt;Isn&apos;t this a blocker for 1.0? Or should we just say &quot;mia culpa&quot; and fix it in 1.0.1?&lt;/p&gt;</comment>
                            <comment id="14334572" author="enis" created="Tue, 24 Feb 2015 08:11:35 +0000"  >&lt;p&gt;Luckily, the table state in meta patch is only in 1.1, not 1.0. We have also tested 0.98 -&amp;gt; 1.0 route (although not with the latest RC, maybe RC2 or 3).  &lt;/p&gt;</comment>
                            <comment id="14335426" author="eclark" created="Tue, 24 Feb 2015 20:51:19 +0000"  >&lt;p&gt;Moving to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh0042&quot; class=&quot;user-hover&quot; rel=&quot;rajesh0042&quot;&gt;Rajesh Nishtala&lt;/a&gt; as he has a few cycles to look at getting this.&lt;/p&gt;</comment>
                            <comment id="14336978" author="eclark" created="Wed, 25 Feb 2015 18:56:12 +0000"  >&lt;p&gt;So this doesn&apos;t seem to happen in local only mode. Most likely this requires a server to be holding the meta. So here are some repro steps that worked for me.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
git checkout 0.98
git pull
mvn clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -DskipTests
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set this into hbase-site.xml&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.cluster.distributed&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now on tab one:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/hbase zookeeper
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On tab two:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/hbase regionserver start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On Tab three:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/hbase master start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Wait for the master to fully come up and assign all regions ( I checked the web ui too ).&lt;/p&gt;

&lt;p&gt;Ctrl-c the master.&lt;/p&gt;

&lt;p&gt;On Tab three:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
git checkout branch-1
git pull
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now here I had to remove some code in RPCServices.java ( see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13102&quot; title=&quot;Fix Pseudo-distributed Mode which was broken in 1.0.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13102&quot;&gt;&lt;del&gt;HBASE-13102&lt;/del&gt;&lt;/a&gt; )&lt;br/&gt;
so I removed line 787-794:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mode == HConstants.CLUSTER_IS_DISTRIBUTED &amp;amp;&amp;amp; hostname.equals(HConstants.LOCALHOST)) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg =
          &lt;span class=&quot;code-quote&quot;&gt;&quot;The hostname of regionserver cannot be set to localhost &quot;&lt;/span&gt;
              + &lt;span class=&quot;code-quote&quot;&gt;&quot;in a fully-distributed setup because it won&apos;t be reachable. &quot;&lt;/span&gt;
              + &lt;span class=&quot;code-quote&quot;&gt;&quot;See \&quot;&lt;/span&gt;Getting Started\&lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more information.&quot;&lt;/span&gt;;
      LOG.fatal(msg);
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(msg);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Still in tab three:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvn clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -DskipTests
bin/hbase master start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That produced the error for me.&lt;/p&gt;</comment>
                            <comment id="14341131" author="rajesh0042" created="Sat, 28 Feb 2015 01:01:55 +0000"  >&lt;p&gt;So Elliot and I spent some time digging into this over the past few days and we found a couple of interesting things. The META table descriptions are correct in Master and in HDFS. So we thought forcing the RegionServer to reload META would fix it. However, when we tried this we found that it was still reading the old META table descriptor. After diving deeper into the code Elliot found that  FSTableDescriptors::get(final TableName tablename) used a hard coded value for the HTableDescriptor of META. As a result no amount of reloading and forced reloading would fix this.&lt;/p&gt;

&lt;p&gt;So there are two not so great paths forward:&lt;br/&gt;
(1) Patch 0.98 so that 0.98 can be hot upgradable to branch-1&lt;br/&gt;
(2) Change the upgrade process to tell users to upgrade the region servers first and then master.&lt;/p&gt;

&lt;p&gt;Neither of these options are particularly pleasing but I wanted to open this up to the broader group to get people&apos;s thoughts.&lt;/p&gt;</comment>
                            <comment id="14341377" author="lhofhansl" created="Sat, 28 Feb 2015 06:28:34 +0000"  >&lt;p&gt;Seems very reasonable to me put a change into 0.98 now to enable a rolling upgrade to 1.1.0 (I assume we have to do the same for 1.0.x).&lt;/p&gt;</comment>
                            <comment id="14341383" author="stack" created="Sat, 28 Feb 2015 06:39:54 +0000"  >&lt;p&gt;+1 on #1.&lt;/p&gt;

&lt;p&gt;#2 would be against the usual upgrade grain and it would be missed by all but those paying close attention.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14342378" author="ndimiduk" created="Sun, 1 Mar 2015 18:43:07 +0000"  >&lt;p&gt;Can we back out the breaking change from branch-1 and try again? Requiring gymnastics is not consistent with our semver commitment.&lt;/p&gt;</comment>
                            <comment id="14344214" author="rajesh0042" created="Tue, 3 Mar 2015 01:10:20 +0000"  >&lt;p&gt;I just uploaded a git revert of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13017&quot; title=&quot;Backport HBASE-12035 Keep table state in Meta to branch-1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13017&quot;&gt;HBASE-13017&lt;/a&gt; on branch-1. I had to make a few minor changes primarily with imports to get it to work. It passed all the unit tests and I verified that the steps above work and the bug is not reproduced.&lt;/p&gt;</comment>
                            <comment id="14344354" author="eclark" created="Tue, 3 Mar 2015 02:31:20 +0000"  >&lt;p&gt;I&apos;d be +1 the revert. I don&apos;t think that adding more to meta is always great. I&apos;m unsure that all clients will act well with keeping the table state in meta.&lt;br/&gt;
AsyncHBase being one that will almost certainly be different.&lt;/p&gt;

&lt;p&gt;I just don&apos;t see a way that&apos;s rolling upgradable and doesn&apos;t break the compatibility story we&apos;re trying to tell for 1.X.&lt;/p&gt;</comment>
                            <comment id="14344378" author="hadoopqa" created="Tue, 3 Mar 2015 02:42:12 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12702038/HBASE-13087-v1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12702038/HBASE-13087-v1.txt&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 5fc3d6ed0d306cd6c5e05712bea98649ca0df1f5.&lt;br/&gt;
  ATTACHMENT ID: 12702038&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 110 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13049//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13049//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14344383" author="rajesh0042" created="Tue, 3 Mar 2015 02:45:21 +0000"  >&lt;p&gt;BTW this patch is not intended to be applied against master so that Hadoop QA message is probably expected.&lt;/p&gt;</comment>
                            <comment id="14344515" author="stack" created="Tue, 3 Mar 2015 04:57:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;After diving deeper into the code Elliot found that FSTableDescriptors::get(final TableName tablename) used a hard coded value for the HTableDescriptor of META.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good diving. Thats a bug.&lt;/p&gt;

&lt;p&gt;Any input on 1.0 to 1.1? We&apos;d need to patch that too to be rolling upgradable? 0.98 to 1.1 would be nice but it is also important undoing our violation of the no-perm-data-in-zk axiom as well. Any input here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=octo47&quot; class=&quot;user-hover&quot; rel=&quot;octo47&quot;&gt;Andrey Stepachev&lt;/a&gt;? Folks want to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13017&quot; title=&quot;Backport HBASE-12035 Keep table state in Meta to branch-1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13017&quot;&gt;HBASE-13017&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14344700" author="octo47" created="Tue, 3 Mar 2015 07:56:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; seems we can revert that, that is a bit bigger change for rolling upgrade without major version bump.&lt;br/&gt;
+1 for revert in 0.98.&lt;/p&gt;</comment>
                            <comment id="14344712" author="octo47" created="Tue, 3 Mar 2015 08:12:57 +0000"  >&lt;p&gt;for 1.1 I think we can make dual system, duplicate states from meta to zk using some chore.&lt;br/&gt;
it will copy states back and forth, so new region servers will use meta, and old will use zk until&lt;br/&gt;
full restart complete. &lt;br/&gt;
also table state manager can handle missing family by forcibly switching to zk states.&lt;/p&gt;

&lt;p&gt;reverting for 1.1 is not a good idea, that just prolongs zk states and we will face with upgrade&lt;br/&gt;
issues later.&lt;/p&gt;</comment>
                            <comment id="14344871" author="octo47" created="Tue, 3 Mar 2015 10:16:04 +0000"  >&lt;p&gt;seems I misunderstood &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, nevermind.&lt;br/&gt;
read my next comment.&lt;/p&gt;</comment>
                            <comment id="14345269" author="stack" created="Tue, 3 Mar 2015 16:20:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=octo47&quot; class=&quot;user-hover&quot; rel=&quot;octo47&quot;&gt;Andrey Stepachev&lt;/a&gt; Thanks. Any chance you&apos;d be up for the migration step (as long as it not as complicated as you describe above &amp;#8211; smile)?  Maybe write it out in a bit more detail first?  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="14345386" author="eclark" created="Tue, 3 Mar 2015 17:41:19 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
reverting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1.1 is not a good idea, that just prolongs zk states and we will face with upgrade
issues later.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ll face the upgrade issue on a major release not on a release that we promised is rolling. Putting state into both just means that we&apos;ll have the worst of both worlds. We&apos;ve done these transitions before but only when the user is getting lots. For the end user(on branch-1) this is almost never going to be worth the added complexity or read/writes to meta.&lt;/p&gt;

&lt;p&gt;On top of that I actually think that the table state should be kept in a different table. We&apos;re already worrying about meta being a bottleneck. Adding more rpc&apos;s to that table seems wrong. Branch-1 should not be a place that patches that could see major changes are committed.&lt;/p&gt;</comment>
                            <comment id="14345400" author="stack" created="Tue, 3 Mar 2015 17:49:19 +0000"  >&lt;p&gt;Lets revert then unless you have a more simple means of doing migration &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=octo47&quot; class=&quot;user-hover&quot; rel=&quot;octo47&quot;&gt;Andrey Stepachev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Keeping the little bit of state needed for table enable/disable in meta actually works out kinda nice. Doing it in another system table that has to be assigned and available for there to be forward progress would be overkill IMO.&lt;/p&gt;</comment>
                            <comment id="14345430" author="octo47" created="Tue, 3 Mar 2015 18:16:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt; I understand your concern for meta. but keep in mind, that meta is only special table which is handled separately. During first implementation (in table descriptors) I thought about introducing special table for tables or state or whatever, but I dropped that idea. It complicates table state management, because we need to keep two tables online to do most operations, so we can&apos;t start recovering until we are onlined meta &lt;em&gt;and&lt;/em&gt; our new table. That will definitely introduce more methods named like assignMeta which is definitely bad.&lt;br/&gt;
With introduction of meta replicas we can go further and prohibit requests to primary replica and always try secondary for state requests first.&lt;br/&gt;
But in general I agree that may be this change is too early for branch-1. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; As for steps for fixing that, here are two problems at once:&lt;br/&gt;
1. we need&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; to be compatible with 0.98 clients, which use zk for table states. That can be solved by optionally duplicating states in readonly mode to zk (actually nobody doing writes there, so basically it will not hurt clients, they just can be a bit lagged)&lt;br/&gt;
2. we faced with no sharing of knowledge of compatibility between master and regions. We can solve that in two ways:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;hackery way, adding &apos;mark&apos; coprocessor to ServerLoad report, say &apos;compatCoprocessor:haveMeta,disabledZk,whateverWeHave&apos; and find out which region servers will be capable to handle new meta (i.e thay were upgraded)&lt;/li&gt;
	&lt;li&gt;send/request additional information once on registration or later by additional RPC which allows to query (that definitely need to be with new jira):&lt;br/&gt;
     a) any config values if needed (say ask do regions server thinks zk assigment enabled?)&lt;br/&gt;
     b) list of compatibilities in strict enum-like list (meta, branch-1, release, amInZk...) and master can make conscious decisions on what is going on.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;just my 5 cents.&lt;/p&gt;</comment>
                            <comment id="14345721" author="eclark" created="Tue, 3 Mar 2015 20:59:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;But in general I agree that may be this change is too early for branch-1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 for this. I totally want this change on branch-1 if we can get migration from 0.98 to 1.0.0 to 1.x clean and tested.&lt;/p&gt;</comment>
                            <comment id="14345765" author="stack" created="Tue, 3 Mar 2015 21:27:25 +0000"  >&lt;p&gt;I reverted &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13017&quot; title=&quot;Backport HBASE-12035 Keep table state in Meta to branch-1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13017&quot;&gt;HBASE-13017&lt;/a&gt; for now till migration figured.&lt;/p&gt;</comment>
                            <comment id="14345778" author="stack" created="Tue, 3 Mar 2015 21:33:26 +0000"  >&lt;p&gt;Can we fix the bug found above where we are reading static meta schema?&lt;/p&gt;</comment>
                            <comment id="14345789" author="octo47" created="Tue, 3 Mar 2015 21:44:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; I hope so. Last time I cleaned up places where static field was accessed directly. Seems I can try to remove this shortcut and see what  will happen.&lt;/p&gt;</comment>
                            <comment id="14345803" author="octo47" created="Tue, 3 Mar 2015 21:50:55 +0000"  >&lt;p&gt;created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13147&quot; title=&quot;Load actual META table descriptor, don&amp;#39;t use statically defined one.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13147&quot;&gt;HBASE-13147&lt;/a&gt; to deal with bug around static meta table descriptor&lt;/p&gt;</comment>
                            <comment id="14507319" author="ndimiduk" created="Wed, 22 Apr 2015 16:08:59 +0000"  >&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13017&quot; title=&quot;Backport HBASE-12035 Keep table state in Meta to branch-1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13017&quot;&gt;HBASE-13017&lt;/a&gt; was reverted, can we resolve this one and move work back onto that ticket? Blockers have me nervous &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14507327" author="eclark" created="Wed, 22 Apr 2015 16:12:23 +0000"  >&lt;p&gt;Yeah I think so.&lt;/p&gt;</comment>
                            <comment id="14513903" author="octo47" created="Mon, 27 Apr 2015 10:49:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;, I&apos;ll try to resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13147&quot; title=&quot;Load actual META table descriptor, don&amp;#39;t use statically defined one.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13147&quot;&gt;HBASE-13147&lt;/a&gt; as soon as possible. &lt;br/&gt;
Sorry for delay here. As soon we will be able to distinguish what version of meta is used&lt;br/&gt;
it should be possible to do rolling upgrade.&lt;br/&gt;
Once we have meta version we need to invent some way to let AssignmentManager&lt;br/&gt;
to know what version of Meta RegionServer is expected.&lt;br/&gt;
We could add to server status, reported by RS, version&lt;br/&gt;
of expected META, so AM could consult this infomation and assign meta&lt;br/&gt;
to compatible RS only. &lt;br/&gt;
As I think it should looks like:&lt;br/&gt;
1. Master restarted.&lt;br/&gt;
2. AM checks META versions and in case mismatch unassign META from&lt;br/&gt;
RS with old expected version.&lt;br/&gt;
3. Once there is RS with compatible version META could be assigned to it&lt;br/&gt;
(in case of rolling upgrade exepected delay could be time of master&lt;br/&gt;
restart + 1 region server restart).&lt;/p&gt;</comment>
                            <comment id="14514492" author="enis" created="Mon, 27 Apr 2015 17:31:28 +0000"  >&lt;p&gt;Why does the RS hosting new meta have to be running new version, is it because of hard coded meta table description?&lt;br/&gt;
We can make it so that the feature is gracefully not used as long as the meta is on an old server without complicating assignment. &lt;/p&gt;</comment>
                            <comment id="14514521" author="octo47" created="Mon, 27 Apr 2015 17:45:43 +0000"  >&lt;p&gt;Because it can have no code for coprocessors for example.&lt;br/&gt;
So when we add new coprocessors we should be sure, that&lt;br/&gt;
those coprocessors have recent code. That is why it much better&lt;br/&gt;
to have strict policy on which RS can run system tables.&lt;br/&gt;
(actually that is wider problem, any system coprocessors&lt;br/&gt;
need to be consistent with expected structure of system table).&lt;/p&gt;</comment>
                            <comment id="14516399" author="ndimiduk" created="Tue, 28 Apr 2015 05:24:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;That is why it much better to have strict policy on which RS can run system tables.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is a pretty big change. Is there no other alternative? If this is it, I think the ship has sailed on 1.1, try again for 1.2.&lt;/p&gt;</comment>
                            <comment id="14517474" author="ndimiduk" created="Tue, 28 Apr 2015 17:26:27 +0000"  >&lt;p&gt;Closing this since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13017&quot; title=&quot;Backport HBASE-12035 Keep table state in Meta to branch-1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13017&quot;&gt;HBASE-13017&lt;/a&gt; was reverted from 1.1. We&apos;ll need to keep an eye on it for 1.2.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12779193">HBASE-13147</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12774163">HBASE-13017</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12702038" name="HBASE-13087-v1.txt" size="356775" author="rajesh0042" created="Tue, 3 Mar 2015 01:08:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 23 Feb 2015 23:34:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25y6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>