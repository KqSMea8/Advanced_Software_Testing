<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:44:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-483/HBASE-483.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-483] Merge tool won&apos;t merge two overlapping regions</title>
                <link>https://issues.apache.org/jira/browse/HBASE-483</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;hbase-480 adds a merge tool. Seems to work for two adjacent regions in tests but not for the case where we&apos;ve made two overlapping regions: i.e. both have a start key of &apos;A&apos; but one regions endkey is less than the end key of the others (See up on Lars cluster hbase-471).  I ran the merge and it made a new region with the right start and end keys but there was nothing in it.&lt;/p&gt;

&lt;p&gt;We need this tool to do fix up when hbase goes awry.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12389948">HBASE-483</key>
            <summary>Merge tool won&apos;t merge two overlapping regions</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 1 Mar 2008 01:04:52 +0000</created>
                <updated>Fri, 22 Aug 2008 21:17:40 +0000</updated>
                            <resolved>Thu, 20 Mar 2008 16:16:50 +0000</resolved>
                                    <version>0.1.0</version>
                                    <fixVersion>0.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12574123" author="stack" created="Sat, 1 Mar 2008 16:25:31 +0000"  >&lt;p&gt;To make this work, need to fix mergeStoreFiles to instead of appending to the new store file the passed src store files, instead it interweaves as scanners do currently.  Will also have to amend the check in HRegion which prevents merging of non-adjacent regions so it allows merging overlapping regions.&lt;/p&gt;</comment>
                            <comment id="12575994" author="stack" created="Fri, 7 Mar 2008 00:54:42 +0000"  >&lt;p&gt;Illustration of table w/ multiple regions that all have same start key but different end keys.... Some mentions do not have associated startcode nor server code.&lt;/p&gt;</comment>
                            <comment id="12580234" author="jimk" created="Wed, 19 Mar 2008 05:16:09 +0000"  >&lt;p&gt;FileSystemVersionException: new exception&lt;/p&gt;

&lt;p&gt;HLog: make rollWriter public&lt;/p&gt;

&lt;p&gt;HMaster:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;deleteRegion throws exception rather than returning status&lt;/li&gt;
	&lt;li&gt;Replace deprecatate FileSystem.listPaths with FileSystem.listStatus&lt;/li&gt;
	&lt;li&gt;FSUtils.checkVersion throws exception rather than returning status&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HMerge: remove main program and baggage that it carried&lt;/p&gt;

&lt;p&gt;HRegion:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;replace closeAndMerge with mergeAdjacent&lt;/li&gt;
	&lt;li&gt;add new method merge: merging is now done by copy and compaction&lt;/li&gt;
	&lt;li&gt;added debugging method listFiles&lt;/li&gt;
	&lt;li&gt;make compactStores public&lt;/li&gt;
	&lt;li&gt;added new private method rowIsInRange&lt;/li&gt;
	&lt;li&gt;make createHRegion public&lt;/li&gt;
	&lt;li&gt;added new public method openHRegion&lt;/li&gt;
	&lt;li&gt;make addRegionToMETA public&lt;/li&gt;
	&lt;li&gt;deleteRegion throws exceptions rather than return status&lt;/li&gt;
	&lt;li&gt;new private method deleteRegion uses FileUtil.fullyDelete&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HStoreFile: removed method mergeStoreFiles&lt;/p&gt;

&lt;p&gt;FSUtils: checkVersion throws exception rather than returning status, optionally prints message to console if upgrade required.&lt;/p&gt;

&lt;p&gt;JenkinsHash: now has main program to compute hash of file specified on command line&lt;/p&gt;

&lt;p&gt;Merge: new file that implements merge utility&lt;/p&gt;

&lt;p&gt;MetaUtils: new file that consolidates methods shared by Merge and Migrate utilities&lt;/p&gt;

&lt;p&gt;Migrate: modified to use MetaUtils&lt;/p&gt;

&lt;p&gt;TestHRegion: modified to use HRegion.mergeAdjacent&lt;/p&gt;

&lt;p&gt;TestMergeTool: new test case for Merge&lt;/p&gt;

&lt;p&gt;TestMigrate: modified to reflect HBase as a subproject rather than contrib&lt;/p&gt;
</comment>
                            <comment id="12580235" author="jimk" created="Wed, 19 Mar 2008 05:16:41 +0000"  >&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="12580536" author="stack" created="Wed, 19 Mar 2008 20:16:59 +0000"  >&lt;p&gt;Looks great.  A few notes:&lt;/p&gt;

&lt;p&gt;Below works on windows?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/test/org/apache/hadoop/hbase/util/TestMigrate.java
===================================================================
--- src/test/org/apache/hadoop/hbase/util/TestMigrate.java  (revision 638708)
+++ src/test/org/apache/hadoop/hbase/util/TestMigrate.java  (working copy)
@@ -96,11 +96,11 @@

           &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; path is &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; running test with ant
&lt;/span&gt;
-          &lt;span class=&quot;code-quote&quot;&gt;&quot;../../../../../src/contrib/hbase/src/testdata/HADOOP-2478-testdata.zip&quot;&lt;/span&gt;)
+          &lt;span class=&quot;code-quote&quot;&gt;&quot;../../../src/testdata/HADOOP-2478-testdata.zip&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why not remove the below from same file?&lt;/p&gt;

&lt;p&gt;Why in +  public TestMergeTool() { do you do some setup in constructor rather than go by the usual idiom of putting up (all of) the environment to test in the &apos;setup&apos; method? (Great test, by the way).&lt;/p&gt;

&lt;p&gt;If you look at your patch, it completely removes HSF and then readds it.  I can&apos;t see whats changed.&lt;/p&gt;

&lt;p&gt;Want to fix the class comment on HMerge?&lt;/p&gt;

&lt;p&gt;I like the way its done &amp;#8211; moving mapfiles and then running compactor.  I like that we&apos;re reusing code.&lt;/p&gt;

&lt;p&gt;This code belongs in a method of its own &amp;#8211; perhaps in a utility class somewhere?  It should be in a method of its own because it acts on intimate knowledge of the region dir layout and it should be in util because I wouldn&apos;t be surprised we&apos;d want to make use of it again outside of this current context.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      fs.mkdirs(HStoreFile.getMapDir(basedir, encodedRegionName,
+          colFamily));
+      fs.mkdirs(HStoreFile.getInfoDir(basedir, encodedRegionName,
+          colFamily));
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tabledesc.families().get(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(colFamily + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;)).getBloomFilter()
+          != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        fs.mkdirs(HStoreFile.getFilterDir(basedir, encodedRegionName,
+            colFamily));
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does this method not already exist up in hadoop?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void listPaths
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why the &apos;\n&apos;s in this message: +      LOG.debug(&quot;\n\n\nOpening region: &quot; + info);  Ain&apos;t that going to be annoying?  Capitalize rather than &apos;\n\n\n&apos;... i&apos;d say.&lt;/p&gt;

&lt;p&gt;Merge needs a class comment (Needs to be distingushed from HMerge &amp;#8211; should we remove HMerge?).&lt;/p&gt;

&lt;p&gt;This is unnecessary in the JenkinsHash main: +    System.exit(0);&lt;/p&gt;

&lt;p&gt;MetaUtils class javadoc should be HBase Meta/Catalog tables?&lt;/p&gt;

&lt;p&gt;Verifying that hbase is not running should be moved out of MetaUtil?  Other tools will need this facility too.&lt;/p&gt;

&lt;p&gt;The below is a path in hdfs?  You might want to do it in the users home directory &amp;#8211; you can get that from fs IIRC &amp;#8211; rather than at top-level to avoid permission problems in hdfs.  If its local filesystem, add name of the program to the name I&apos;d say so that folks who are looking /tmp can have some idea where these files are coming from.... if they haven&apos;t been cleaned up properly (Should we have a tmp dir in the hbase.rootdir for doing stuff like this?)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.log = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLog(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, 
+          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp&quot;&lt;/span&gt;, HConstants.HREGION_LOGDIR_NAME + &lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt; +
+              &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()
+          ),
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why this line in Migrate? Its not needed, right?  Or if it is, then something needs to be documented here.&lt;/p&gt;

&lt;p&gt;Good stuff&lt;/p&gt;


</comment>
                            <comment id="12580626" author="jimk" created="Wed, 19 Mar 2008 23:58:00 +0000"  >&lt;p&gt;Revised patch per Stack&apos;s comments&lt;/p&gt;</comment>
                            <comment id="12580627" author="jimk" created="Wed, 19 Mar 2008 23:58:45 +0000"  >&lt;p&gt;Have not run entire test suite yet, but please review.&lt;/p&gt;</comment>
                            <comment id="12580629" author="bryanduxbury" created="Thu, 20 Mar 2008 00:12:42 +0000"  >&lt;p&gt;Latest patch still does not apply for me - removal of mergeStoreFiles method and one of the imports are rejected.&lt;/p&gt;</comment>
                            <comment id="12580638" author="jimk" created="Thu, 20 Mar 2008 02:02:46 +0000"  >&lt;p&gt;Bryan,&lt;/p&gt;

&lt;p&gt;Don&apos;t know why the patch does not apply for you as I tried it on another source tree of mine and it still applies.&lt;br/&gt;
Perhaps because it contains crlf&apos;s?&lt;/p&gt;

&lt;p&gt;I&apos;ll put up another patch sans \r&apos;s and see if that applies for you.&lt;/p&gt;</comment>
                            <comment id="12580639" author="jimk" created="Thu, 20 Mar 2008 02:04:26 +0000"  >&lt;p&gt;Same as latest patch.txt but without \r&apos;s&lt;/p&gt;</comment>
                            <comment id="12580648" author="jimk" created="Thu, 20 Mar 2008 03:12:34 +0000"  >&lt;p&gt;All tests passed except TTMR.&lt;/p&gt;</comment>
                            <comment id="12580650" author="bryanduxbury" created="Thu, 20 Mar 2008 03:33:11 +0000"  >&lt;p&gt;I just ran the unit tests, and all tests passed except TTMR. That makes me nervous because Jim had a similar experience. Two occurrences is a pattern.&lt;/p&gt;</comment>
                            <comment id="12580653" author="stack" created="Thu, 20 Mar 2008 03:57:36 +0000"  >&lt;p&gt;Here&apos;s a version that applies for me.  Interestingly, TTMR fails for me too.  Will remove patch and try and see if TTMR fails w/o this patch&lt;/p&gt;</comment>
                            <comment id="12580657" author="bryanduxbury" created="Thu, 20 Mar 2008 04:32:48 +0000"  >&lt;p&gt;I assumed that it was Jim&apos;s patch, but after reverting, TTMR still fails for me. Last thing to change was upgrading hadoop jar to 0.16.1. Wasn&apos;t there a remark on the list about 0.16.1 containing a regression?&lt;/p&gt;</comment>
                            <comment id="12580661" author="jimk" created="Thu, 20 Mar 2008 05:04:01 +0000"  >&lt;p&gt;TTMR fails for me on branch 0.1.latest without my patch&lt;/p&gt;</comment>
                            <comment id="12580673" author="stack" created="Thu, 20 Mar 2008 05:50:09 +0000"  >&lt;p&gt;I reverted hadoop libs.  Patch looks fine to me.  Going ahead and applying it myself so I can build candidate release.&lt;/p&gt;</comment>
                            <comment id="12580825" author="jimk" created="Thu, 20 Mar 2008 16:16:50 +0000"  >&lt;p&gt;Stack committed. Resolving issue. The forward porting of this patch to trunk is addressed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-531&quot; title=&quot;Port HBASE-483 to trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-531&quot;&gt;&lt;del&gt;HBASE-531&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12391833">HBASE-532</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12391830">HBASE-531</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12378293" name="483-that-applies.patch" size="80504" author="stack" created="Thu, 20 Mar 2008 03:57:36 +0000"/>
                            <attachment id="12378288" name="patch.no.cr.txt" size="79676" author="jimk" created="Thu, 20 Mar 2008 02:04:26 +0000"/>
                            <attachment id="12378282" name="patch.txt" size="81980" author="jimk" created="Wed, 19 Mar 2008 23:58:00 +0000"/>
                            <attachment id="12378198" name="patch.txt" size="133107" author="jimk" created="Wed, 19 Mar 2008 05:16:09 +0000"/>
                            <attachment id="12377303" name="subset_of_meta.txt" size="36302" author="stack" created="Fri, 7 Mar 2008 00:54:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Mar 2008 05:16:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31722</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>