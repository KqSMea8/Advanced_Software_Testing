<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:04:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15549/HBASE-15549.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15549] Undo HMaster carrying regions in master branch as default</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15549</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I thought we had an issue to do this but I can&apos;t find it so here is a new one.&lt;/p&gt;

&lt;p&gt;Currently, in master branch, HMaster is a RegionServer and carries meta regions such as hbase:meta. Disable this facility by default until better thought through (I think we should undo master ever carrying regions; FBers are thinking we should go forward with notion that master carries meta/system regions. TODO). I want to disable it because this facility is not finished and meantime I want to test new stuff coming in on master branch w/o this new feature getting in the way.&lt;/p&gt;

&lt;p&gt;Parking here a patch that has how to disable master carrying regions and a probably redundant test that ensures all works when master is not carrying meta regions (added because it WASN&apos;T working for me &amp;#8211; but was pilot error).&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12954081">HBASE-15549</key>
            <summary>Undo HMaster carrying regions in master branch as default</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Mar 2016 20:21:05 +0000</created>
                <updated>Thu, 31 Mar 2016 00:09:18 +0000</updated>
                                                                            <component>Balancer</component>
                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="15214858" author="eclark" created="Mon, 28 Mar 2016 20:46:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I want to disable it because this facility is not finished and meantime&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What&apos;s not finished? What issues are you seeing with it? For us meta on master is the only thing that gets IT tests to pass on a more consistent basis. I&apos;d prefer to fix any issues if possible.&lt;/p&gt;</comment>
                            <comment id="15214947" author="stack" created="Mon, 28 Mar 2016 21:40:37 +0000"  >&lt;p&gt;Add a means of disabling  master-as-regionserver. Default in patch is that master CAN carry regions as it currently does but would change this on commit. Adds test of this new config.&lt;/p&gt;</comment>
                            <comment id="15214953" author="eclark" created="Mon, 28 Mar 2016 21:50:19 +0000"  >&lt;p&gt;How is this different from hbase.balancer.tablesOnMaster ? Seems weird to have to configs that do the same thing.&lt;/p&gt;</comment>
                            <comment id="15214956" author="stack" created="Mon, 28 Mar 2016 21:51:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;What&apos;s not finished? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What Master&apos;s personality is going forward. What we have now is just wrong with master carrying regions but only some regions and then the ones it does carry are the critical ones. Master is now inline with writes. This sort of deploy won&apos;t scale (one server only carrying metadata), etc.&lt;/p&gt;

&lt;p&gt;I&apos;m game for entertaining Master being a RegionServer or Master not being a RegionServer but this half-baked notion where Master is sort of a RegionServer.&lt;/p&gt;

&lt;p&gt;Testing, ITBLL doesn&apos;t work for me. Trying to figure why. Want to be able to undo this behavior.&lt;/p&gt;</comment>
                            <comment id="15214963" author="stack" created="Mon, 28 Mar 2016 21:56:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;How is this different from hbase.balancer.tablesOnMaster ? Seems weird to have to configs that do the same thing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; pointed out same thing. tablesOnMaster is kinda wonky. You pass &apos;none&apos; to have no tables on master (As Matteo notes, you better not name your table &apos;none&apos;). If you pass nothing, you get &apos;tables on master&apos; (I passed &apos;false&apos; because I misread that its supposed to be a list of Strings and got extra confused because it &apos;worked&apos;). Matteo also notes for this to work all needs to subclass the base load balancer... not all balancers do.&lt;/p&gt;

&lt;p&gt;Will do another version of patch.&lt;/p&gt;

&lt;p&gt;Wanted to get an issue in to start catching the master-is-a-regionserver flak too.&lt;/p&gt;</comment>
                            <comment id="15214965" author="eclark" created="Mon, 28 Mar 2016 21:56:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;What we have now is just wrong with master carrying regions but only some regions and then the ones it does carry are the critical ones.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I disagree with this so strongly. With a large enough cluster I get double assignments, failed splits, and every nasty horrible thing if master can&apos;t talk to meta. Without meta on master I can fail ITBLL in less than 2 days. Every single time. So without meta on master there&apos;s something seriously wrong. But even if we fixed that meta and master are wedded.&lt;/p&gt;

&lt;p&gt;Master at it&apos;s heart is something that&apos;s there to alter system tables. It doesn&apos;t really do much except read and write meta and security related tables and tell others that it&apos;s done that. Why would you put that somewhere else? For data locality it makes sense. However it is different from a regionserver in that if it goes down things in the cluster are bad. So not putting user tables on that totally makes sense.&lt;/p&gt;</comment>
                            <comment id="15216108" author="stack" created="Tue, 29 Mar 2016 14:42:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;With a large enough cluster I get double assignments, failed splits, and every nasty horrible thing if master can&apos;t talk to meta.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not being able to talk to hbase:meta is an issue apart from meta-on-master.&lt;/p&gt;

&lt;p&gt;An RPC to do metaupdates will be more prone to issues than going local, yes. Master 2.0 with its local procedure store mitigates somewhat by only publishing final state in hbase:meta, not intermediary.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Why would you put that somewhere else?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Scale. Size of hbase:meta, scaling i/o, memory.&lt;/p&gt;

&lt;p&gt;Lets have this discussion as other than a comment on JIRA. Can try and restart the scaling/master discussion out on dev list.&lt;/p&gt;</comment>
                            <comment id="15216180" author="eclark" created="Tue, 29 Mar 2016 15:29:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Not being able to talk to hbase:meta is an issue apart from meta-on-master.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Except it&apos;s not. Master always uses the short circuit path to write to meta. There&apos;s no times that we need to finalize a risky operation and can&apos;t.&lt;/p&gt;
</comment>
                            <comment id="15216207" author="stack" created="Tue, 29 Mar 2016 15:51:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;There&apos;s no times that we need to finalize a risky operation and can&apos;t.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Your argument is built on no RPCing which is a bit hard to get away with in a distributed system.&lt;/p&gt;

&lt;p&gt;Again, lets do this properly as a discussion thread rather than a back and forth in a JIRA comment.&lt;/p&gt;</comment>
                            <comment id="15219097" author="stack" created="Thu, 31 Mar 2016 00:09:18 +0000"  >&lt;p&gt;Balancer gets messed up if master is not carrying regions:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):008:0* balancer force
NameError: undefined local variable or method `force&apos; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; #&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;:0x3d620a1&amp;gt;

hbase(main):009:0&amp;gt; balancer &apos;force&apos;

ERROR: java.io.IOException: 6
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2285)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:109)
        at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:137)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:112)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.ArrayIndexOutOfBoundsException: 6
        at org.apache.hadoop.hbase.master.balancer.BaseLoadBalancer$Cluster.getLocalityOfRegion(BaseLoadBalancer.java:869)
        at org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer$LocalityCostFunction.cost(StochasticLoadBalancer.java:1186)
        at org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer.computeCost(StochasticLoadBalancer.java:521)
        at org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer.balanceCluster(StochasticLoadBalancer.java:335)
        at org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer.balanceCluster(StochasticLoadBalancer.java:264)
        at org.apache.hadoop.hbase.master.HMaster.balance(HMaster.java:1276)
        at org.apache.hadoop.hbase.master.MasterRpcServices.balance(MasterRpcServices.java:352)
        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:60465)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2240)
        ... 4 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is w/ my setting tables for master to &apos;none&apos; (which makes for some nice stack traces in logs complaining about no such table &apos;none&apos;)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12795713" name="15549.patch" size="6405" author="stack" created="Mon, 28 Mar 2016 21:40:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Mar 2016 20:46:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vb33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>