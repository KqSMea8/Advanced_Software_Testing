<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:27:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5422/HBASE-5422.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5422] StartupBulkAssigner would cause a lot of timeout on RIT when assigning large numbers of regions (timeout = 3 mins)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5422</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In our produce environment&lt;br/&gt;
We find a lot of timeout on RIT when cluster up, there are about 7w regions in the cluster( 25 regionservers ).&lt;/p&gt;

&lt;p&gt;First, we could see the following log:(See the region 33cf229845b1009aa8a3f7b0f85c9bd0)&lt;br/&gt;
master&apos;s log&lt;br/&gt;
2012-02-13 18:07:41,409 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x348f4a94723da5 Async create of unassigned node for 33cf229845b1009aa8a3f7b0f85c9bd0 with OFFLINE state &lt;br/&gt;
2012-02-13 18:07:42,560 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$CreateUnassignedAsyncCallback: rs=item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. state=OFFLINE, ts=1329127661409, server=r03f11025.yh.aliyun.com,60020,1329127549907 &lt;br/&gt;
2012-02-13 18:07:42,996 DEBUG org.apache.hadoop.hbase.master.AssignmentManager$ExistsUnassignedAsyncCallback: rs=item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. state=OFFLINE, ts=1329127661409 &lt;br/&gt;
2012-02-13 18:10:48,072 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out: item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. state=PENDING_OPEN, ts=1329127662996&lt;br/&gt;
2012-02-13 18:10:48,072 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been PENDING_OPEN for too long, reassigning region=item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. &lt;br/&gt;
2012-02-13 18:11:16,744 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENED, server=r03f11025.yh.aliyun.com,60020,1329127549907, region=33cf229845b1009aa8a3f7b0f85c9bd0 &lt;br/&gt;
2012-02-13 18:38:07,310 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Handling OPENED event for 33cf229845b1009aa8a3f7b0f85c9bd0; deleting unassigned node &lt;br/&gt;
2012-02-13 18:38:07,310 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x348f4a94723da5 Deleting existing unassigned node for 33cf229845b1009aa8a3f7b0f85c9bd0 that is in expected state RS_ZK_REGION_OPENED &lt;br/&gt;
2012-02-13 18:38:07,314 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x348f4a94723da5 Successfully deleted unassigned node for region 33cf229845b1009aa8a3f7b0f85c9bd0 in expected state RS_ZK_REGION_OPENED &lt;br/&gt;
2012-02-13 18:38:07,573 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Opened region item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. on r03f11025.yh.aliyun.com,60020,1329127549907 &lt;br/&gt;
2012-02-13 18:50:54,428 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) for item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. so generated a random one; hri=item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0., src=, dest=r01b05043.yh.aliyun.com,60020,1329127549041; 29 (online=29, exclude=null) available servers &lt;br/&gt;
2012-02-13 18:50:54,428 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. to r01b05043.yh.aliyun.com,60020,1329127549041 &lt;br/&gt;
2012-02-13 19:31:50,514 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out: item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. state=PENDING_OPEN, ts=1329132528086 &lt;br/&gt;
2012-02-13 19:31:50,514 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been PENDING_OPEN for too long, reassigning region=item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. &lt;/p&gt;



&lt;p&gt;Regionserver&apos;s log&lt;br/&gt;
2012-02-13 18:07:43,537 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Received request to open region: item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. &lt;br/&gt;
2012-02-13 18:11:16,560 DEBUG org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Processing open of item_20120208,\x009,1328794343859.33cf229845b1009aa8a3f7b0f85c9bd0. &lt;/p&gt;





&lt;p&gt;Through the RS&apos;s log, we could find it is larger than 3mins from receive openRegion request to start processing openRegion, causing timeout on RIT in master for the region.&lt;/p&gt;

&lt;p&gt;Let&apos;s see the code of StartupBulkAssigner, we could find regionPlans are not added when assigning regions, therefore, when one region opened, it will not updateTimers of other regions whose destination is the same.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12542990">HBASE-5422</key>
            <summary>StartupBulkAssigner would cause a lot of timeout on RIT when assigning large numbers of regions (timeout = 3 mins)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Feb 2012 03:33:01 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:58 +0000</updated>
                            <resolved>Wed, 22 Feb 2012 17:47:08 +0000</resolved>
                                                    <fixVersion>0.92.1</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13210629" author="stack" created="Fri, 17 Feb 2012 22:42:24 +0000"  >&lt;p&gt;I think I understand what is going on.  Help me out Chunhui.  So, on region open, we do update of the RIT timers.  When bulk opening, we are not adding plans to this.regionPlans so that when an open comes in from a bulk assign, since we go against this.regionPlans, we&apos;ll not update timers of other outstanding RITs?  This seems like nice bug fix.&lt;/p&gt;

&lt;p&gt;I see that BulkReOpen adds to this.regionPlans but it does it one at a time.  Should it use your putAll?  Maybe we should make an addPlan method that takes a Map of plans and have it used by BulkReOpen and by BulkOpen?&lt;/p&gt;</comment>
                            <comment id="13210766" author="zjushch" created="Sat, 18 Feb 2012 02:24:40 +0000"  >&lt;p&gt;Yes, we should add regionPlans, so that when an open comes in from the StartupBulkAssign, we could update timers of RIT, where they have the same assigning destination.&lt;/p&gt;

&lt;p&gt;I agree with make an addPlan method that takes a Map of plans.&lt;/p&gt;</comment>
                            <comment id="13211113" author="stack" created="Sat, 18 Feb 2012 21:43:27 +0000"  >&lt;p&gt;@Chunhui Want to make a new patch that does this --&amp;gt; &apos;I agree with make an addPlan method that takes a Map of plans.&apos;?&lt;/p&gt;</comment>
                            <comment id="13211179" author="zjushch" created="Sun, 19 Feb 2012 01:24:23 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
OK, I will submit a new patch tomorrow.(today is outing...)&lt;br/&gt;
Also I think it&apos;s ok to make the new addPlan method when commit if no other problems.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13212297" author="zjushch" created="Tue, 21 Feb 2012 02:19:36 +0000"  >&lt;p&gt;Make an addPlan method that takes a Map of plans in patchv2&lt;/p&gt;</comment>
                            <comment id="13213214" author="zhihyu@ebaysf.com" created="Wed, 22 Feb 2012 02:49:12 +0000"  >&lt;p&gt;Minor comments:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-comment&quot;&gt;// add plans &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the regions that needs to be reopened
&lt;/span&gt;+      Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, RegionPlan&amp;gt; plans = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, RegionPlan&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Comment should read &apos;that need to ...&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addPlan(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, RegionPlan&amp;gt; plans) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The method should be called addPlans().&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Add region plans, so we can updateTimers when one region opened, in order
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// to unnecessary timeout on RIT&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Comment should read &apos;region is opened so that unnecessary timeout on RIT is reduced&apos;&lt;/p&gt;

&lt;p&gt;Please attach 0.90 patch first, trunk patch second so that Hadoop QA picks up trunk patch.&lt;/p&gt;</comment>
                            <comment id="13213476" author="zjushch" created="Wed, 22 Feb 2012 09:14:17 +0000"  >&lt;p&gt;Thanks for Ted&apos;s review.&lt;/p&gt;</comment>
                            <comment id="13213478" author="zjushch" created="Wed, 22 Feb 2012 09:17:39 +0000"  >&lt;p&gt;Amend it in patch v3&lt;/p&gt;</comment>
                            <comment id="13213684" author="zhihyu@ebaysf.com" created="Wed, 22 Feb 2012 15:09:12 +0000"  >&lt;p&gt;Chunhui&apos;s patch v3.&lt;/p&gt;</comment>
                            <comment id="13213719" author="hadoopqa" created="Wed, 22 Feb 2012 15:51:31 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12515596/5422-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12515596/5422-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -136 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 151 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1010//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1010//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1010//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1010//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1010//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1010//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13213735" author="zhihyu@ebaysf.com" created="Wed, 22 Feb 2012 16:12:44 +0000"  >&lt;p&gt;@Stack:&lt;br/&gt;
Do you want to take a look at patch v3 ?&lt;/p&gt;</comment>
                            <comment id="13213786" author="stack" created="Wed, 22 Feb 2012 17:47:08 +0000"  >&lt;p&gt;Committed to 0.92 branch and to trunk.  Thanks for the patch Chunhui.&lt;/p&gt;</comment>
                            <comment id="13500592" author="stack" created="Mon, 19 Nov 2012 20:03:38 +0000"  >&lt;p&gt;I committed with an issue number of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5542&quot; title=&quot;Unify HRegion.mutateRowsWithLocks() and HRegion.processRow()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5542&quot;&gt;&lt;del&gt;HBASE-5542&lt;/del&gt;&lt;/a&gt; by mistake.  I just corrected it by doing the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ svn propset -r1292409 --revprop svn:log &lt;span class=&quot;code-quote&quot;&gt;&quot;HBASE-5422 StartupBulkAssigner would cause a lot of timeout on RIT when assigning large numbers of regions (timeout = 3 mins)&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I did it in 0.92, 0.94 and trunk.&lt;/p&gt;</comment>
                            <comment id="13500593" author="stack" created="Mon, 19 Nov 2012 20:04:37 +0000"  >&lt;p&gt;Oh, it was @Alexandr Shulman who noticed my error.&lt;/p&gt;</comment>
                            <comment id="15016365" author="lars_francke" created="Fri, 20 Nov 2015 11:54:58 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514942" name="5422-90.patch" size="1518" author="zjushch" created="Fri, 17 Feb 2012 03:38:05 +0000"/>
                            <attachment id="12515309" name="5422-90v2.patch" size="1384" author="zjushch" created="Tue, 21 Feb 2012 02:19:36 +0000"/>
                            <attachment id="12515563" name="5422-90v3.patch" size="1926" author="zjushch" created="Wed, 22 Feb 2012 09:16:54 +0000"/>
                            <attachment id="12515596" name="5422-v3.txt" size="3474" author="zhihyu@ebaysf.com" created="Wed, 22 Feb 2012 15:09:12 +0000"/>
                            <attachment id="12514941" name="hbase-5422.patch" size="1048" author="zjushch" created="Fri, 17 Feb 2012 03:34:45 +0000"/>
                            <attachment id="12515308" name="hbase-5422v2.patch" size="3462" author="zjushch" created="Tue, 21 Feb 2012 02:19:36 +0000"/>
                            <attachment id="12515562" name="hbase-5422v3.patch" size="3474" author="zjushch" created="Wed, 22 Feb 2012 09:14:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Feb 2012 22:42:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228276</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i069bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34443</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>