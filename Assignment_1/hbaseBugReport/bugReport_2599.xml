<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:03:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2599/HBASE-2599.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2599] BaseScanner says &quot;Current assignment of X is not valid&quot; over and over for same region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2599</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From IRC today&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
12:41 &amp;lt; cmorgan&amp;gt; hey guys. I&apos;m having a recent  issue with a single node cluster running 0.20.4. After stopping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a backup I now get region assignment churn. Seems master keeps thinking that region
                 assignment is not valid even when it is. Following is a log snippet:
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443246 [        HMaster] DEBUG ter.RegionServerOperationQueue  - Processing todo: PendingOpenOperation from localhost.,7802,1274425405680
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443246 [        HMaster] INFO  e.master.RegionServerOperation  - net_troove_coin_account_AccountCredentials,,1234913258116 open on 127.0.0.1:7802
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443246 [        HMaster] INFO  e.master.RegionServerOperation  - Updated row net_troove_coin_account_AccountCredentials,,1234913258116 in region .META.,,1 with
                 startcode=1274425405680, server=127.0.0.1:7802
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443246 [        HMaster] DEBUG ter.RegionServerOperationQueue  - Processing todo: PendingOpenOperation from localhost.,7802,1274425405680
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443246 [        HMaster] INFO  e.master.RegionServerOperation  - net_troove_application_request_TemporaryRequest,,1234913268355 open on 127.0.0.1:7802
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443247 [        HMaster] INFO  e.master.RegionServerOperation  - Updated row net_troove_application_request_TemporaryRequest,,1234913268355 in region .META.,,1 with
                 startcode=1274425405680, server=127.0.0.1:7802
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443247 [ger.metaScanner] DEBUG adoop.hbase.master.BaseScanner  - Current assignment of net_troove_coin_account_AccountEntry,,1271448856984 is not valid;
                 serverAddress=127.0.0.1:7802, startCode=1274425405680 unknown.
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443248 [ger.metaScanner] DEBUG adoop.hbase.master.BaseScanner  - Current assignment of net_troove_coin_account_AccountEntry-Base_EntryDay_DESCENDING,,1273266418876
                 is not valid;  serverAddress=127.0.0.1:7802, startCode=1274425405680 unknown.
12:41 &amp;lt; cmorgan&amp;gt; [21/05/10 00:59:42] 3443251 [ger.metaScanner] DEBUG adoop.hbase.master.BaseScanner  - Current assignment of net_troove_coin_bank_BankStatement,,1266433980935 is not valid;
                 serverAddress=127.0.0.1:7802, startCode=1274425405680 unknown.

12:58 &amp;lt; cmorgan&amp;gt; stack: I&apos;d been running with 0.20.4 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a week or so starting/stopping every night. Now &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; happens...

14:11 &amp;lt; cmorgan&amp;gt; stack: some more info: On our mini production server the regionserver is getting &lt;span class=&quot;code-quote&quot;&gt;&quot;My address is localhost.:7802&quot;&lt;/span&gt; (notice the dot after localhost). But the master is also sometimes
                 referring to it as 127.0.0.1. I just used the same data and config on my laptop, and its binding to my external LAN ip (&lt;span class=&quot;code-quote&quot;&gt;&quot;My address is 10.0.1.4:7802&quot;&lt;/span&gt;). Under &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; setup hbase comes up
                 stable (no region assignment churn).

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at this, I think issue is that when we register a server we use a getServerName on a HServerInfo provided by the regionserver (though we are on the master side) but BaseScanner uses a getServerName that is made by doing a dns lookup using the IP that it finds in the server column of .META.  My sense is that is possible for the regionserver hostname and what the master finds when it does a lookup against dns can disagree, fatally.&lt;/p&gt;

&lt;p&gt;This issue seems popular over last few weeks.  Was reported at least once more on a standalone instance and also on krispykola&apos;s 15-node ec2 cluster (He went back to 0.20.3 and then it went away?).  It made for what looked like double-assignment in his case (Our attempt at caching DNS names may be amiss &amp;#8211; I tihnk tht the main diff between 0.20.3 and 0.20.4 in this area).&lt;/p&gt;

&lt;p&gt;My thought is to purge DNS from the HServerInfo passed by the RS to Master on startup and heartbeating and to use IPs only (and even then, the IP that the master tells the RS to use, its remote address as seen by the master).  We might have to do this fix for 0.20.5 since it seems to happen more in 0.20.4.&lt;/p&gt;

&lt;p&gt;I&apos;m looking into this.  Opinions welcome.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12465182">HBASE-2599</key>
            <summary>BaseScanner says &quot;Current assignment of X is not valid&quot; over and over for same region</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 May 2010 04:45:20 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:33 +0000</updated>
                            <resolved>Sat, 29 May 2010 00:41:57 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12870318" author="stack" created="Sat, 22 May 2010 20:59:35 +0000"  >&lt;p&gt;Or, maybe better is to use hostnames everywhere &amp;#8211; hostnames in the .META. and hostnames in the HServerInfo#getServerName result.&lt;/p&gt;

&lt;p&gt;We should probably go this route only, not allow for fact that may be disagreement over what a RS is called because Master may get one answer doing DNS lookup wherease the RS might get another. &lt;/p&gt;

&lt;p&gt;So, the HServerInfo that is passed between Master and RegionServer, instead of being filled out by the RS and then updated with the remote address as seen by the master on the RS&apos;s initial checkin leaving the &apos;name&apos; (hostname) in HServerInfo as whatever the RS set it too, instead, lets change things so the Master fully specifies the HServerInfo and then the RS whenever it communicates w/ the master, it always proffers the HSI it got from the master, not a HSI that is a composite of RS and Master setting.&lt;/p&gt;

&lt;p&gt;Let me make a patch.&lt;/p&gt;</comment>
                            <comment id="12870323" author="stack" created="Sat, 22 May 2010 22:07:29 +0000"  >&lt;p&gt;Or, we put into .META. the hostname the RS gave us.  The RS gets its hostname by doing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    machineName = DNS.getDefaultHost(
        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.dns.&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;),
        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.dns.nameserver&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12870324" author="stack" created="Sat, 22 May 2010 22:14:35 +0000"  >&lt;p&gt;Fix this too:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// Set the address &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; now even tho it will not be persisted on HRS side
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// If the address given is not the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; one, use IP given by the user.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverInfo.getServerAddress().getBindAddress().equals(DEFAULT_HOST)) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; rsAddress = HBaseServer.getRemoteAddress();
      serverInfo.setServerAddress(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HServerAddress(rsAddress,
        serverInfo.getServerAddress().getPort()));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12870325" author="stack" created="Sat, 22 May 2010 22:25:28 +0000"  >&lt;p&gt;I should add port to the server in .META.  Currently its the ip of the RS only.&lt;/p&gt;</comment>
                            <comment id="12871316" author="hbasereviewboard" created="Tue, 25 May 2010 19:38:23 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/85/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/85/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase and Ryan Rawson.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;First cut at a patch that removes DNS lookups from HServerInfo and that writes the regionserver hostname into the .META. (with a port).&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-2599.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/hbase-2599&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/hbase-2599&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HServerInfo.java 43906a5 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/BaseScanner.java 57f745e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 603159c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 14433b8 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 94bbc34 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java fb65ed1 &lt;br/&gt;
  src/main/resources/webapps/master/table.jsp 095d6dd &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/TestServerInfo.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/85/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/85/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Not finished yet.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12871402" author="hbasereviewboard" created="Tue, 25 May 2010 22:55:31 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Version of hbase-2599 for 0.20 branch for 0.20.5.&lt;/p&gt;

&lt;p&gt;It cuts DNS lookups from HServerInfo and uses the regionservers name everywhere instead of ip sometimes and a lookedup hostname at other times.  Also puts hostname:port into .META. rather than IP.&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-2599.&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.20/src/java/org/apache/hadoop/hbase/ClusterStatus.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/HServerInfo.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/BaseScanner.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/HMaster.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/ServerManager.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 948218 &lt;br/&gt;
  branches/0.20/src/test/org/apache/hadoop/hbase/TestServerInfo.java PRE-CREATION &lt;br/&gt;
  branches/0.20/src/webapps/master/table.jsp 948218 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/88/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Doing now.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12871404" author="hbasereviewboard" created="Tue, 25 May 2010 22:57:33 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-05-25 15:55:50.626407)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Changed summary&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Version of hbase-2599 for 0.20 branch for 0.20.5.&lt;/p&gt;

&lt;p&gt;It cuts DNS lookups from HServerInfo and uses the regionservers name everywhere instead of ip sometimes and a lookedup hostname at other times.  Also puts hostname:port into .META. rather than IP.&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-2599.&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.20/src/java/org/apache/hadoop/hbase/ClusterStatus.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/HServerInfo.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/BaseScanner.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/HMaster.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/ServerManager.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 948218 &lt;br/&gt;
  branches/0.20/src/test/org/apache/hadoop/hbase/TestServerInfo.java PRE-CREATION &lt;br/&gt;
  branches/0.20/src/webapps/master/table.jsp 948218 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/88/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Doing now.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12871409" author="hbasereviewboard" created="Tue, 25 May 2010 23:05:23 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-05-25 16:04:24.285624)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added some description&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Version of hbase-2599 for 0.20 branch for 0.20.5.&lt;/p&gt;

&lt;p&gt;It cuts DNS lookups from HServerInfo and uses the regionservers name everywhere instead of ip sometimes and a lookedup hostname at other times.  Also puts hostname:port into .META. rather than IP.  Removing DNS lookups makes it so there is no possibility for disagreement over hostname if master gets one answer for an IP and the regionserver has another.&lt;/p&gt;

&lt;p&gt;Other notes:&lt;/p&gt;

&lt;p&gt;It replaces variable servername with hostnameandport so its clear whats going on.&lt;/p&gt;

&lt;p&gt;Does some cleanup in HServerInfo renaming data member &apos;name&apos; as &apos;hostname&apos; and then purges DNS caching and lookups from this class.  It removes some unnecessary setters and does some javadoc fix ups.&lt;/p&gt;

&lt;p&gt;Removes the dumb serverAddressToServerInfo from ServerManager.&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-2599.&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  branches/0.20/src/java/org/apache/hadoop/hbase/ClusterStatus.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/HServerInfo.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/BaseScanner.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/HMaster.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/master/ServerManager.java 948218 &lt;br/&gt;
  branches/0.20/src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 948218 &lt;br/&gt;
  branches/0.20/src/test/org/apache/hadoop/hbase/TestServerInfo.java PRE-CREATION &lt;br/&gt;
  branches/0.20/src/webapps/master/table.jsp 948218 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/88/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Doing now.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12871412" author="hbasereviewboard" created="Tue, 25 May 2010 23:07:34 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/#review68&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/#review68&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;




</comment>
                            <comment id="12871433" author="hbasereviewboard" created="Tue, 25 May 2010 23:31:25 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/#review69&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/#review69&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I tried it, I think there&apos;s some other places we need to review the HSA stuff, see these lines I picked from a log:&lt;/p&gt;

&lt;p&gt;2010-05-25 16:26:08,555 INFO org.apache.hadoop.hbase.master.ServerManager: Received start message from: hbasedev,60020,1274829968544&lt;br/&gt;
2010-05-25 16:26:08,561 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Updated ZNode /hbase/rs/1274829968544 with data 127.0.0.1:60020&lt;br/&gt;
2010-05-25 16:26:31,712 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_OPEN: &lt;del&gt;ROOT&lt;/del&gt;,,0 from hbasedev,60020,1274829968544; 1 of 1&lt;br/&gt;
2010-05-25 16:26:31,726 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: SetData of ZNode /hbase/root-region-server with 127.0.0.1:60020&lt;br/&gt;
2010-05-25 16:26:31,727 INFO org.apache.hadoop.hbase.master.BaseScanner: RegionManager.rootScanner scanning meta region &lt;/p&gt;
{server: 127.0.0.1:60020, regionname: -ROOT-,,0, startKey: &amp;lt;&amp;gt;}
&lt;p&gt;2010-05-25 16:26:32,742 INFO org.apache.hadoop.hbase.master.RegionServerOperation: .META.,,1 open on hbasedev,60020,1274829968544&lt;/p&gt;

&lt;p&gt;Basically there&apos;s a very nice mix of IPs and hostnames.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;




</comment>
                            <comment id="12871527" author="hbasereviewboard" created="Wed, 26 May 2010 06:30:26 +0000"  >&lt;p&gt;Message from: &quot;Ryan Rawson&quot; &amp;lt;ryanobjc@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/#review75&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/#review75&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1 lets do it&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ryan&lt;/li&gt;
&lt;/ul&gt;




</comment>
                            <comment id="12871532" author="ryanobjc" created="Wed, 26 May 2010 06:37:40 +0000"  >&lt;p&gt;+1 lets go with it. &lt;/p&gt;

&lt;p&gt;There are some IP things being inserted into ZK, but that isnt part of the original problem, so let&apos;s go with what we have for now (simpler change)&lt;/p&gt;
</comment>
                            <comment id="12871557" author="stack" created="Wed, 26 May 2010 08:08:04 +0000"  >&lt;p&gt;Here is what got reviewed.&lt;/p&gt;

&lt;p&gt;I&apos;m now kinda reluctant to commit as a test of a rolling restart reassigns all regions when the master comes up &amp;#8211; so really it&apos;d require a complete restart of cluster.  Thinking on it.&lt;/p&gt;</comment>
                            <comment id="12871561" author="stack" created="Wed, 26 May 2010 08:17:18 +0000"  >&lt;p&gt;@jdcryans Thanks for trying my patch.  Those ips are coming out of zkwatcher &amp;#8211; serialized HSA into zk znodes &amp;#8211; and are ips for root and meta used by the masters HCM instance.  I did not change these, only stuff related to .META. and generation of the key identifying regionservers.  I started to go this route but change runs deep.  Also, veers into recording master address in a HSI which is a RS thing.  I ran into a wall too inside in ChangeTableState#getMetaRegion where only a HSA to hand.  Gave up on changing any more.&lt;/p&gt;</comment>
                            <comment id="12871953" author="hbasereviewboard" created="Wed, 26 May 2010 21:03:42 +0000"  >&lt;p&gt;Message from: &quot;Todd Lipcon&quot; &amp;lt;todd@cloudera.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/88/#review81&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/#review81&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;this seems reasonable, but only way we&apos;ll know is testing on various systems with different kinds of DNS setups. Can we get those who have had issues to try this and make sure it fixes, before we release it?&lt;/p&gt;


&lt;p&gt;branches/0.20/src/java/org/apache/hadoop/hbase/ClusterStatus.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/88/#comment409&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/#comment409&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t like that this function is called getServerNames and returns hostnameports.&lt;/p&gt;



&lt;p&gt;branches/0.20/src/test/org/apache/hadoop/hbase/TestServerInfo.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/88/#comment410&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/#comment410&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    using the junit4 expected thing here doesn&apos;t quite work, cuz we don&apos;t know that it didn&apos;t throw on line 34, right?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Todd&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2010-05-25 16:04:24, stack wrote:&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  -----------------------------------------------------------&lt;br/&gt;
^bq.  This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
^bq.  &lt;a href=&quot;http://review.hbase.org/r/88/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/&lt;/a&gt;&lt;br/&gt;
^bq.  -----------------------------------------------------------&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  (Updated 2010-05-25 16:04:24)&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Review request for hbase.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Summary&lt;br/&gt;
^bq.  -------&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Version of hbase-2599 for 0.20 branch for 0.20.5.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  It cuts DNS lookups from HServerInfo and uses the regionservers name everywhere instead of ip sometimes and a lookedup hostname at other times.  Also puts hostname:port into .META. rather than IP.  Removing DNS lookups makes it so there is no possibility for disagreement over hostname if master gets one answer for an IP and the regionserver has another.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Other notes:&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  It replaces variable servername with hostnameandport so its clear whats going on.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Does some cleanup in HServerInfo renaming data member &apos;name&apos; as &apos;hostname&apos; and then purges DNS caching and lookups from this class.  It removes some unnecessary setters and does some javadoc fix ups.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Removes the dumb serverAddressToServerInfo from ServerManager.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  This addresses bug hbase-2599.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Diffs&lt;br/&gt;
^bq.  -----&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/ClusterStatus.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/HServerInfo.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/master/BaseScanner.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/master/HMaster.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/master/ServerManager.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 948218 &lt;br/&gt;
^bq.    branches/0.20/src/test/org/apache/hadoop/hbase/TestServerInfo.java PRE-CREATION &lt;br/&gt;
^bq.    branches/0.20/src/webapps/master/table.jsp 948218 &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Diff: &lt;a href=&quot;http://review.hbase.org/r/88/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/88/diff&lt;/a&gt;&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Testing&lt;br/&gt;
^bq.  -------&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Doing now.&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  Thanks,&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq.  stack&lt;br/&gt;
^bq.  &lt;br/&gt;
^bq. &lt;/p&gt;

</comment>
                            <comment id="12872046" author="jdcryans" created="Thu, 27 May 2010 01:03:43 +0000"  >&lt;p&gt;The patch won&apos;t apply now that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2613&quot; title=&quot;Remove the code around MSG_CALL_SERVER_STARTUP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2613&quot;&gt;&lt;del&gt;HBASE-2613&lt;/del&gt;&lt;/a&gt; went in. It will actually make it leaner.&lt;/p&gt;</comment>
                            <comment id="12872320" author="stack" created="Thu, 27 May 2010 18:45:00 +0000"  >&lt;p&gt;I&apos;m not going to apply this to branch.  Too risky not to mention the fact that it breaks rolling restart.  Going to apply to TRUNK.  Should be enough time before release for any issues w/ different DNS configs. to surface (So, seems like we required reverse lookups to work before this patch; with it they are no longer needed).&lt;/p&gt;

&lt;p&gt;Todd, I&apos;ll address your two items on commit (Thanks for the review). On getting fellas to try it, its a bit tough.  Seems like the error is often transient; e.g. clint above was running fine for days then something changed so localhost and 127.0.0.1 weren&apos;t the same any more.&lt;/p&gt;
</comment>
                            <comment id="12872709" author="stack" created="Thu, 27 May 2010 23:20:47 +0000"  >&lt;p&gt;Version for trunk that has todd suggested changes.  Will apply soon.&lt;/p&gt;</comment>
                            <comment id="12873199" author="stack" created="Sat, 29 May 2010 00:41:57 +0000"  >&lt;p&gt;Thanks all for the review.  This patch changes how we do DNS.  Should make it more straight-forward but you never know.  We need to keep an eye on it.&lt;/p&gt;</comment>
                            <comment id="12914683" author="jdcryans" created="Fri, 24 Sep 2010 22:23:01 +0000"  >&lt;p&gt;I still see people with this issue from time to time, and they don&apos;t all want to upgrade to 0.89, so here&apos;s an updated version of that patch for 0.20&lt;/p&gt;

&lt;p&gt;Also I have a 0.20.6 distro patched with it here: &lt;a href=&quot;http://people.apache.org/~jdcryans/hbase-0.20.6.tar.gz&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~jdcryans/hbase-0.20.6.tar.gz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15017553" author="lars_francke" created="Fri, 20 Nov 2015 12:43:33 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12445536" name="2599-0.20.txt" size="31971" author="stack" created="Wed, 26 May 2010 08:08:04 +0000"/>
                            <attachment id="12445718" name="2599-trunk.txt" size="33088" author="stack" created="Thu, 27 May 2010 23:20:47 +0000"/>
                            <attachment id="12455530" name="HBASE-2599-0.20-refresh.patch" size="33448" author="jdcryans" created="Fri, 24 Sep 2010 22:23:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 May 2010 19:38:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hifz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100250</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>