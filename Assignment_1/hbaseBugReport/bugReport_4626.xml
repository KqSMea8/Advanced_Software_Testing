<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:20:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4626/HBASE-4626.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4626] Filters unnecessarily copy byte arrays...</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4626</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Just looked at SingleCol and ValueFilter... And on every column compared they create a copy of the column and/or value portion of the KV.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12527833">HBASE-4626</key>
            <summary>Filters unnecessarily copy byte arrays...</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Oct 2011 21:24:16 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:09 +0000</updated>
                            <resolved>Fri, 21 Oct 2011 18:56:57 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13131047" author="yuzhihong@gmail.com" created="Wed, 19 Oct 2011 21:54:01 +0000"  >&lt;p&gt;Interesting finding.&lt;br/&gt;
WritableByteArrayComparable should be enhanced with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compareTo(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buffer, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which would delegate to this method in Bytes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compareTo(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buffer1, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset1, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length1,
      &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buffer2, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset2, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length2) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13131086" author="lhofhansl" created="Wed, 19 Oct 2011 22:36:44 +0000"  >&lt;p&gt;Exactly!&lt;/p&gt;

&lt;p&gt;There are a bunch subclasses of WritableByteArrayComparable to deal with, so I refactored some code slightly.&lt;/p&gt;

&lt;p&gt;The only funky thing is the NullComparator. All other comparators would fail with an NPE if a null byte[] is passed (even before my change); so for this one comparator I have the compareTo(byte[],int,int[]) method throw an unsupportedOperationException.&lt;/p&gt;

&lt;p&gt;I have a patch. Running tests now.&lt;/p&gt;</comment>
                            <comment id="13131171" author="lhofhansl" created="Wed, 19 Oct 2011 23:50:22 +0000"  >&lt;p&gt;Patch against trunk.&lt;br/&gt;
Tests still running...&lt;/p&gt;

&lt;p&gt;On scans touching many rows with a filter, this should significantly cut down garbage.&lt;/p&gt;</comment>
                            <comment id="13131198" author="lhofhansl" created="Thu, 20 Oct 2011 00:14:13 +0000"  >&lt;p&gt;Targeting 0.94. But this is simple and could be put into 0.92 as well.&lt;/p&gt;</comment>
                            <comment id="13131203" author="lhofhansl" created="Thu, 20 Oct 2011 00:15:41 +0000"  >&lt;p&gt;Also there are many more filters that do this kind of thing (all subclasses of CompareFilter).&lt;br/&gt;
All fixed now.&lt;/p&gt;</comment>
                            <comment id="13131207" author="yuzhihong@gmail.com" created="Thu, 20 Oct 2011 00:19:37 +0000"  >&lt;p&gt;Nice work.&lt;/p&gt;

&lt;p&gt;Please fill in javadoc for return value:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compareTo(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] value, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13131353" author="lhofhansl" created="Thu, 20 Oct 2011 04:15:42 +0000"  >&lt;p&gt;Fixed Javadoc&lt;/p&gt;</comment>
                            <comment id="13131354" author="lhofhansl" created="Thu, 20 Oct 2011 04:16:33 +0000"  >&lt;p&gt;I will commit this to trunk tomorrow, unless there are objections.&lt;/p&gt;</comment>
                            <comment id="13131355" author="yuzhihong@gmail.com" created="Thu, 20 Oct 2011 04:22:20 +0000"  >&lt;p&gt;Since this is a bug, I think it should go to 0.92 as well.&lt;/p&gt;</comment>
                            <comment id="13131358" author="lhofhansl" created="Thu, 20 Oct 2011 04:27:50 +0000"  >&lt;p&gt;All tests pass BTW. (TestHFileBlock fails with or without my change).&lt;/p&gt;</comment>
                            <comment id="13131359" author="lhofhansl" created="Thu, 20 Oct 2011 04:29:15 +0000"  >&lt;p&gt;Agreed.&lt;/p&gt;</comment>
                            <comment id="13131360" author="lhofhansl" created="Thu, 20 Oct 2011 04:32:19 +0000"  >&lt;p&gt;Well, actually... It is a performance improvement, not a bug per se.&lt;br/&gt;
Would make a nice addition to our 0.94 performance release (shortly after 0.92, right? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;

&lt;p&gt;Seriously, if this is considered a bug I&apos;ll commit it to 0.92 too, it&apos;s pretty low risk.&lt;/p&gt;</comment>
                            <comment id="13131370" author="yuzhihong@gmail.com" created="Thu, 20 Oct 2011 04:47:05 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Since you have confidence in the patch, I think we should push it to 0.92&lt;/p&gt;</comment>
                            <comment id="13131378" author="streamy" created="Thu, 20 Oct 2011 05:01:16 +0000"  >&lt;p&gt;I&apos;m okay with this in 92 but would prefer it goes to 94.  Put the perf in the next release so we release it soon.&lt;/p&gt;</comment>
                            <comment id="13131878" author="stack" created="Thu, 20 Oct 2011 18:29:27 +0000"  >&lt;p&gt;+1 on patch.  I&apos;m fine w/ it in 0.92 (doesn&apos;t have to go into 0.92 though).&lt;/p&gt;</comment>
                            <comment id="13132005" author="lhofhansl" created="Thu, 20 Oct 2011 20:40:13 +0000"  >&lt;p&gt;I forgot to actually attach the right patch (the one that passes all test).&lt;/p&gt;

&lt;p&gt;V2 is wrong... Does compareTo(val, offset, offset+length), should be compareTo(val, offset, length).&lt;/p&gt;

&lt;p&gt;Nobody noticed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;This patch passes all tests.&lt;/p&gt;

&lt;p&gt;I did a quick and dirty performance test and it brought a full scan with SingleColValueValue from 163s to 105s.&lt;/p&gt;</comment>
                            <comment id="13132299" author="lhofhansl" created="Fri, 21 Oct 2011 03:19:54 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13132318" author="lhofhansl" created="Fri, 21 Oct 2011 04:24:38 +0000"  >&lt;p&gt;In the widest sense this could be considered an incompatible change. WritableByteArrayComparable is part of the public API and a client might have subclassed WritableByteArrayComparable in order pass it to a Filter. That would break now, as the client has to implement compareTo(byte[], int offset, int length) instead of compareTo(byte[]).&lt;/p&gt;

&lt;p&gt;I&apos;ll hold off committing this to 0.92.&lt;/p&gt;</comment>
                            <comment id="13132371" author="hudson" created="Fri, 21 Oct 2011 06:45:33 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2348 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2348/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2348/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4626&quot; title=&quot;Filters unnecessarily copy byte arrays...&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4626&quot;&gt;&lt;del&gt;HBASE-4626&lt;/del&gt;&lt;/a&gt;  Filters unnecessarily copy byte arrays&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/BinaryComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/BinaryPrefixComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/BitComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/CompareFilter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/NullComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/RegexStringComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/SingleColumnValueFilter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/SubstringComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/filter/WritableByteArrayComparable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13132932" author="lhofhansl" created="Fri, 21 Oct 2011 18:56:58 +0000"  >&lt;p&gt;I prefer to keep this in trunk only for now.&lt;br/&gt;
Please pull back in for 0.92 if you feel otherwise (the patch is simple and safe).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12499809" name="4626-v2.txt" size="7155" author="lhofhansl" created="Thu, 20 Oct 2011 04:15:41 +0000"/>
                            <attachment id="12499941" name="4626-v3.txt" size="7612" author="lhofhansl" created="Thu, 20 Oct 2011 20:40:13 +0000"/>
                            <attachment id="12499782" name="4626.txt" size="7016" author="lhofhansl" created="Wed, 19 Oct 2011 23:50:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Oct 2011 21:54:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92091</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08qmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48915</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>