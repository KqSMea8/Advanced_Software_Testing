<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:19:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4488/HBASE-4488.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4488] Store could miss rows during flush</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4488</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;While looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4344&quot; title=&quot;Persist memstoreTS to disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4344&quot;&gt;&lt;del&gt;HBASE-4344&lt;/del&gt;&lt;/a&gt; I found that my change &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4241&quot; title=&quot;Optimize flushing of the Store cache for max versions and (new) min versions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4241&quot;&gt;&lt;del&gt;HBASE-4241&lt;/del&gt;&lt;/a&gt; contains a critical mistake:&lt;br/&gt;
The while(scanner.next(kvs)) loop is incorrect and might miss the last edits.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524740">HBASE-4488</key>
            <summary>Store could miss rows during flush</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12519782">HBASE-4241</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Sep 2011 21:07:46 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:47 +0000</updated>
                            <resolved>Sat, 8 Oct 2011 05:27:54 +0000</resolved>
                                    <version>0.92.0</version>
                    <version>0.94.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13114941" author="lhofhansl" created="Mon, 26 Sep 2011 21:24:29 +0000"  >&lt;p&gt;The fact that this has not tripped any test (and we have quite a lot of tests that flush the store during the test) might indicate that the StoreScanner used this way only returns false from next(...) if there are no rows left. Regardless, this violates the InternalScanner contract and might cause problems in the future.&lt;/p&gt;</comment>
                            <comment id="13114947" author="lhofhansl" created="Mon, 26 Sep 2011 21:38:25 +0000"  >&lt;p&gt;Simple fix, safe to apply &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13114948" author="lhofhansl" created="Mon, 26 Sep 2011 21:39:36 +0000"  >&lt;p&gt;Also removes two unused variables and an unused import.&lt;/p&gt;</comment>
                            <comment id="13115209" author="streamy" created="Tue, 27 Sep 2011 04:46:51 +0000"  >&lt;p&gt;@Lars, patch seems fine.  Do you think there&apos;s a way to trigger the bug in a test so we can catch these edge cases in the future?&lt;/p&gt;</comment>
                            <comment id="13115220" author="lhofhansl" created="Tue, 27 Sep 2011 05:11:00 +0000"  >&lt;p&gt;Looking at the StoreScanner/ScanQueryMatcher code, it seems that luckily this cannot be triggered.&lt;br/&gt;
In order to this to happen the ScanQueryMatcher in StoreScanner has to return one of DONE_SCAN or SEEK_NEXT_ROW.&lt;br/&gt;
The matcher only return DONE_SCAN for filters. In this case there are none, so that won&apos;t happen.&lt;br/&gt;
SEEK_NEXT_ROW can be return from filters (so also out) or if the next row is &amp;lt; the current row (not sure how to make that happen... Should never happen).&lt;br/&gt;
The column tracker used here is ScanWildcardColumnTracker, which will only ever return SKIP, SEEK_NEXT_COL, or INCLUDE.&lt;/p&gt;

&lt;p&gt;So we were actually lucky here, and this bug cannot be triggered at all. Based on this I&apos;ll change the priority. Unless we rig it, this bug cannot be triggered.&lt;/p&gt;

&lt;p&gt;It should still be changed, though, but it will be for readability, and future correctness if somebody changes Matcher/Tracker.&lt;/p&gt;</comment>
                            <comment id="13115221" author="streamy" created="Tue, 27 Sep 2011 05:14:08 +0000"  >&lt;p&gt;Got it.  Nice investigation.&lt;/p&gt;

&lt;p&gt;+1 for commit&lt;/p&gt;</comment>
                            <comment id="13115805" author="lhofhansl" created="Tue, 27 Sep 2011 18:59:36 +0000"  >&lt;p&gt;@Jon, so you gonna commit this? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13115825" author="stack" created="Tue, 27 Sep 2011 19:15:11 +0000"  >&lt;p&gt;Marking patch available.&lt;/p&gt;</comment>
                            <comment id="13115876" author="streamy" created="Tue, 27 Sep 2011 20:15:44 +0000"  >&lt;p&gt;Aren&apos;t you a committer now?  Or didn&apos;t get the rights yet? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Yes, I will commit later today.&lt;/p&gt;</comment>
                            <comment id="13115877" author="lhofhansl" created="Tue, 27 Sep 2011 20:19:19 +0000"  >&lt;p&gt;Not yet... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13116547" author="lhofhansl" created="Wed, 28 Sep 2011 15:43:10 +0000"  >&lt;p&gt;Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4433&quot; title=&quot;avoid extra next (potentially a seek) if done with column/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4433&quot;&gt;&lt;del&gt;HBASE-4433&lt;/del&gt;&lt;/a&gt; can potentially trigger this issue.&lt;/p&gt;</comment>
                            <comment id="13116552" author="streamy" created="Wed, 28 Sep 2011 15:47:30 +0000"  >&lt;p&gt;Can you explain what you mean Lars?  Something is wrong with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4433&quot; title=&quot;avoid extra next (potentially a seek) if done with column/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4433&quot;&gt;&lt;del&gt;HBASE-4433&lt;/del&gt;&lt;/a&gt; or there&apos;s nothing to worry about once I commit this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13116558" author="streamy" created="Wed, 28 Sep 2011 15:51:12 +0000"  >&lt;p&gt;Committed to 92 branch and trunk, marking against 92.&lt;/p&gt;

&lt;p&gt;Thanks Lars!&lt;/p&gt;</comment>
                            <comment id="13116572" author="lhofhansl" created="Wed, 28 Sep 2011 16:10:34 +0000"  >&lt;p&gt;Nothing to worry once this is committed.&lt;br/&gt;
Just saw that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4433&quot; title=&quot;avoid extra next (potentially a seek) if done with column/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4433&quot;&gt;&lt;del&gt;HBASE-4433&lt;/del&gt;&lt;/a&gt; changes the conditions under which the StoreScanner still has rows while returning false.&lt;/p&gt;</comment>
                            <comment id="13116663" author="hudson" created="Wed, 28 Sep 2011 18:19:45 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #25 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/25/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/25/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4488&quot; title=&quot;Store could miss rows during flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4488&quot;&gt;&lt;del&gt;HBASE-4488&lt;/del&gt;&lt;/a&gt;  Store could miss rows during flush (Lars H via jgray)&lt;/p&gt;

&lt;p&gt;jgray : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13116761" author="hudson" created="Wed, 28 Sep 2011 20:15:26 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2264 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2264/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2264/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4488&quot; title=&quot;Store could miss rows during flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4488&quot;&gt;&lt;del&gt;HBASE-4488&lt;/del&gt;&lt;/a&gt;  Store could miss rows during flush (Lars H via jgray)&lt;/p&gt;

&lt;p&gt;jgray : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13122482" author="lhofhansl" created="Fri, 7 Oct 2011 01:40:05 +0000"  >&lt;p&gt;I see that Store.compactStore does the same thing. The same reasoning goes there, that currently we are lucky that StoreScanner.next() never returns false when more rows are waiting.&lt;/p&gt;

&lt;p&gt;There&apos;s even a comment about a do/while loop, but then it&apos;s just a while loop.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// since scanner.next() can &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos; but still be delivering data,
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// we have to use a &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; loop.
&lt;/span&gt;ArrayList&amp;lt;KeyValue&amp;gt; kvs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;KeyValue&amp;gt;();
&lt;span class=&quot;code-comment&quot;&gt;// Limit to &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.hstore.compaction.kv.max&quot;&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; 10) to avoid OOME
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (scanner.next(kvs,&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compactionKVMax)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at the history of the file this has been like this forever. This is a bug waiting to happen.&lt;br/&gt;
Should we have another patch with this one, or a separate jira?&lt;/p&gt;</comment>
                            <comment id="13123365" author="lhofhansl" created="Sat, 8 Oct 2011 04:05:30 +0000"  >&lt;p&gt;Reopening for the related change to Store.compactStore&lt;/p&gt;</comment>
                            <comment id="13123367" author="lhofhansl" created="Sat, 8 Oct 2011 04:09:57 +0000"  >&lt;p&gt;Everybody OK with the addendum?&lt;/p&gt;</comment>
                            <comment id="13123379" author="gqchen" created="Sat, 8 Oct 2011 05:10:17 +0000"  >&lt;p&gt;I recall seeing some unit tests are written in the wrong while loop fashion as well. &lt;/p&gt;</comment>
                            <comment id="13123383" author="lhofhansl" created="Sat, 8 Oct 2011 05:20:31 +0000"  >&lt;p&gt;I&apos;ll open another jira and fix all those.&lt;/p&gt;</comment>
                            <comment id="13123384" author="lhofhansl" created="Sat, 8 Oct 2011 05:32:03 +0000"  >&lt;p&gt;created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4556&quot; title=&quot;Fix all incorrect uses of InternalScanner.next(...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4556&quot;&gt;&lt;del&gt;HBASE-4556&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13126169" author="stack" created="Wed, 12 Oct 2011 21:24:09 +0000"  >&lt;p&gt;+1 on addendum (though its already committed).&lt;/p&gt;</comment>
                            <comment id="13126185" author="lhofhansl" created="Wed, 12 Oct 2011 21:44:31 +0000"  >&lt;p&gt;Let&apos;s do this as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4556&quot; title=&quot;Fix all incorrect uses of InternalScanner.next(...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4556&quot;&gt;&lt;del&gt;HBASE-4556&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15015829" author="lars_francke" created="Fri, 20 Nov 2015 11:52:47 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12498275" name="4488-add.txt" size="1011" author="lhofhansl" created="Sat, 8 Oct 2011 04:09:57 +0000"/>
                            <attachment id="12496566" name="4488.txt" size="1644" author="lhofhansl" created="Mon, 26 Sep 2011 21:38:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Sep 2011 04:46:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1827</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hr2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>