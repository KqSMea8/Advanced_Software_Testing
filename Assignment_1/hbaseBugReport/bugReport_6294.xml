<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6294/HBASE-6294.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6294] Detect leftover data in ZK after a user delete all its HBase data</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6294</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It seems we have a new failure mode when a user deletes the hbase root.dir but doesn&apos;t delete the ZK data. For example a user on IRC came with this log:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-06-30 09:07:48,017 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Received request to open region: kw,,1340981821308.2e8a318837602c9c9961e9d690b7fd02.
2012-06-30 09:07:48,017 WARN org.apache.hadoop.hbase.util.FSTableDescriptors: The following folder is in HBase&apos;s root directory and doesn&apos;t contain a table descriptor, do consider deleting it: kw
2012-06-30 09:07:48,018 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:34193-0x1383bfe01b70001 Attempting to transition node 2e8a318837602c9c9961e9d690b7fd02 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING
2012-06-30 09:07:48,018 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=M_ZK_REGION_OFFLINE, server=localhost,50890,1341036299694, region=2e8a318837602c9c9961e9d690b7fd02
2012-06-30 09:07:48,020 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_FAILED_OPEN, server=localhost,34193,1341036300138, region=b254af24c9127b8bb22cb6d24e523dad
2012-06-30 09:07:48,020 DEBUG org.apache.hadoop.hbase.master.handler.ClosedRegionHandler: Handling CLOSED event for b254af24c9127b8bb22cb6d24e523dad
2012-06-30 09:07:48,020 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Forcing OFFLINE; was=kw_r,,1340981822374.b254af24c9127b8bb22cb6d24e523dad. state=CLOSED, ts=1341036467998, server=localhost,34193,1341036300138
2012-06-30 09:07:48,020 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:50890-0x1383bfe01b70000 Creating (or updating) unassigned node for b254af24c9127b8bb22cb6d24e523dad with OFFLINE state
2012-06-30 09:07:48,028 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:34193-0x1383bfe01b70001 Successfully transitioned node 2e8a318837602c9c9961e9d690b7fd02 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING
2012-06-30 09:07:48,028 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Opening region: {NAME =&amp;gt; &apos;kw,,1340981821308.2e8a318837602c9c9961e9d690b7fd02.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 2e8a318837602c9c9961e9d690b7fd02,}
2012-06-30 09:07:48,029 ERROR org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Failed open of region=kw,,1340981821308.2e8a318837602c9c9961e9d690b7fd02., starting to roll back the global memstore size.
java.lang.IllegalStateException: Could not instantiate a region instance.
	at org.apache.hadoop.hbase.regionserver.HRegion.newHRegion(HRegion.java:3490)
	at org.apache.hadoop.hbase.regionserver.HRegion.openHRegion(HRegion.java:3628)
	at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.openRegion(OpenRegionHandler.java:332)
	at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.process(OpenRegionHandler.java:108)
	at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:169)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.Thread.run(Thread.java:679)
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.GeneratedConstructorAccessor15.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:532)
	at org.apache.hadoop.hbase.regionserver.HRegion.newHRegion(HRegion.java:3487)
	... 7 more
Caused by: java.lang.NullPointerException
	at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.loadTableCoprocessors(RegionCoprocessorHost.java:133)
	at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.&amp;lt;init&amp;gt;(RegionCoprocessorHost.java:125)
	at org.apache.hadoop.hbase.regionserver.HRegion.&amp;lt;init&amp;gt;(HRegion.java:411)
	... 11 more
2012-06-30 09:07:48,031 INFO org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Opening of region {NAME =&amp;gt; &apos;kw,,1340981821308.2e8a318837602c9c9961e9d690b7fd02.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 2e8a318837602c9c9961e9d690b7fd02,} failed, marking as FAILED_OPEN in ZK
2012-06-30 09:07:48,032 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:34193-0x1383bfe01b70001 Attempting to transition node 2e8a318837602c9c9961e9d690b7fd02 from RS_ZK_REGION_OPENING to RS_ZK_REGION_FAILED_OPEN
2012-06-30 09:07:48,031 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=localhost,34193,1341036300138, region=2e8a318837602c9c9961e9d690b7fd02
2012-06-30 09:07:48,043 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=M_ZK_REGION_OFFLINE, server=localhost,50890,1341036299694, region=b254af24c9127b8bb22cb6d24e523dad
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exception itself is not very useful, nor is the NPE deep in the coproc stack. What was really useful was this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-06-30 09:07:48,017 WARN org.apache.hadoop.hbase.util.FSTableDescriptors: The following folder is in HBase&apos;s root directory and doesn&apos;t contain a table descriptor, do consider deleting it: kw
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the HBase wants to assign a region from a table that doesn&apos;t exist and we fail in an obscure way. I told the user to shut down HBase, nuke /tmp/hbase-user as it will contain both the HBase data and the ZK data, and restart. It worked.&lt;/p&gt;

&lt;p&gt;This situation is new in 0.94, we need to detect it so our users have a better experience getting started with HBase.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12596473">HBASE-6294</key>
            <summary>Detect leftover data in ZK after a user delete all its HBase data</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jun 2012 23:28:42 +0000</created>
                <updated>Mon, 23 Sep 2013 19:08:37 +0000</updated>
                            <resolved>Tue, 7 May 2013 18:27:51 +0000</resolved>
                                    <version>0.94.0</version>
                                    <fixVersion>0.95.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13405430" author="lhofhansl" created="Mon, 2 Jul 2012 23:13:06 +0000"  >&lt;p&gt;In a similar vain I found it impossible to switch a cluster from HBase &amp;lt;= 0.94 to HBase 0.96 (protobufs) without wiping the ZK state.&lt;br/&gt;
We typically say that the ZK is not important for operating HBase, but that is not strictly true. For example we need to the ZK state for replication.&lt;/p&gt;</comment>
                            <comment id="13405945" author="stack" created="Tue, 3 Jul 2012 14:09:27 +0000"  >&lt;p&gt;Thats a bug Lars.  Aim is to just stop/start to move 0.94 to 0.96.  Most of the znodes are automigrated.  I must have missed some.  I made &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6316&quot; title=&quot;Confirm can upgrade to 0.96 from 0.94 by just stopping and restarting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6316&quot;&gt;&lt;del&gt;HBASE-6316&lt;/del&gt;&lt;/a&gt; to make sure this not necessary going to 0.96.&lt;/p&gt;</comment>
                            <comment id="13407631" author="lhofhansl" created="Fri, 6 Jul 2012 00:48:14 +0000"  >&lt;p&gt;Hmm... Upon starting a new cluster AssignmentManager already calls cleanoutUnassigned().&lt;/p&gt;</comment>
                            <comment id="13407639" author="jdcryans" created="Fri, 6 Jul 2012 01:13:21 +0000"  >&lt;p&gt;It won&apos;t clear the table state tho.&lt;/p&gt;</comment>
                            <comment id="13408787" author="lhofhansl" created="Sat, 7 Jul 2012 22:03:05 +0000"  >&lt;p&gt;It&apos;s not entirely clear how to fix this quickly.&lt;br/&gt;
Let&apos;s move this to 0.94.2.&lt;/p&gt;

&lt;p&gt;Please pull back if you disagree.&lt;/p&gt;</comment>
                            <comment id="13410269" author="larsgeorge" created="Tue, 10 Jul 2012 11:47:31 +0000"  >&lt;p&gt;Another issue reported by someone on IM is that an entry in /hbase/tables is causing an problem where you cannot create a table with a previously known name. For some reason the table was first disabled, then HDFS wiped clean, yet the entry in ZK remains and causes some check to fail when you try to create the table.&lt;/p&gt;</comment>
                            <comment id="13435569" author="devaraj" created="Wed, 15 Aug 2012 22:13:19 +0000"  >&lt;p&gt;I just gave a shot at trying to address the issue, and tried to reproduce the problem. I couldn&apos;t reproduce this problem when I removed all the directory contents (/tmp/hbase-ddas/hbase that is). But when I removed one table directory (/tmp/hbase-ddas/hbase/&amp;lt;table&amp;gt;), hbase failed to start up. I could fix that up by running &quot;bin/hbase hbck -fixMeta&quot;, and then hbase started up fine.&lt;/p&gt;</comment>
                            <comment id="13435592" author="stack" created="Wed, 15 Aug 2012 22:59:45 +0000"  >&lt;p&gt;@Deveraj So that seems like a decent workaround.&lt;/p&gt;

&lt;p&gt;Going back to J-Ds&apos; original comment, sounds like we shouldn&apos;t be assigning regions for tables that don&apos;t exist.  Or if a regionserver gets a region to open that is for a non-existent table, it should just eat it up with a nice log message.&lt;/p&gt;

&lt;p&gt;@LarsG Should we make a new issue for that?  Seems like again we should eat up the zk data if no corresponding table in HDFS/.META. and proceed?&lt;/p&gt;

&lt;p&gt;@J-D Lars says &quot;We typically say that the ZK is not important for operating HBase, but that is not strictly true. For example we need to the ZK state for replication.&quot;&lt;/p&gt;

&lt;p&gt;Can we fix that?  It&apos;d be cool if we could keep the axiom that zk state is transient.  Or maybe, for the likes of data that needs to prevail across restarts and upgrades, it should be recorded elsewhere in zk, outside of the per-cluster location?&lt;/p&gt;
</comment>
                            <comment id="13442821" author="lhofhansl" created="Tue, 28 Aug 2012 00:06:26 +0000"  >&lt;p&gt;I think this can be moved to 0.94.3 (unless somebody has a concrete plan about what to do here).&lt;/p&gt;</comment>
                            <comment id="13482957" author="lhofhansl" created="Wed, 24 Oct 2012 04:49:11 +0000"  >&lt;p&gt;Still no patch... Moving to 0.94.4&lt;/p&gt;</comment>
                            <comment id="13535648" author="lhofhansl" created="Wed, 19 Dec 2012 05:15:36 +0000"  >&lt;p&gt;No fix... Does not seem to be critical to anyone &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13558481" author="lhofhansl" created="Mon, 21 Jan 2013 02:00:39 +0000"  >&lt;p&gt;Unscheduling from 0.94.&lt;/p&gt;</comment>
                            <comment id="13650302" author="jdcryans" created="Tue, 7 May 2013 00:36:35 +0000"  >&lt;p&gt;At least on the tip of 0.94 in standalone mode I can wipe out HBase&apos;s root dir and restart without problems, ZK uses a new data folder when it&apos;s restarted. Not sure when this was introduced. I&apos;m fine closing this unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larsgeorge&quot; class=&quot;user-hover&quot; rel=&quot;larsgeorge&quot;&gt;Lars George&lt;/a&gt; have something against it.&lt;/p&gt;</comment>
                            <comment id="13650343" author="devaraj" created="Tue, 7 May 2013 01:23:19 +0000"  >&lt;p&gt;I am fine resolving this.&lt;/p&gt;</comment>
                            <comment id="13650464" author="stack" created="Tue, 7 May 2013 03:35:20 +0000"  >&lt;p&gt;Lets resolve and open issue when we run into a real obstacle?&lt;/p&gt;</comment>
                            <comment id="13650750" author="larsgeorge" created="Tue, 7 May 2013 11:55:32 +0000"  >&lt;p&gt;I am fine too, but have that strange feeling that this is still going to rear its ugly head somewhere. But agree, we should create a better JIRA then.&lt;/p&gt;</comment>
                            <comment id="13651149" author="jdcryans" created="Tue, 7 May 2013 18:27:51 +0000"  >&lt;p&gt;Resolving as Incomplete.&lt;/p&gt;</comment>
                            <comment id="13660468" author="nphung" created="Fri, 17 May 2013 08:26:55 +0000"  >&lt;p&gt;I don&apos;t know if it is related to &lt;a href=&quot;http://arnon.me/2013/01/killing-hbase-zombie-table/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://arnon.me/2013/01/killing-hbase-zombie-table/&lt;/a&gt;. We got a zombie HBase table and &quot;nuke /tmp/hbase-user as it will contain both the HBase data and the ZK data, and restart&quot; helps us get rid of it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 Jul 2012 23:13:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241885</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02g6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>