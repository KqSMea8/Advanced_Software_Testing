<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3877/HBASE-3877.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3877] Determine Proper Defaults for Compaction ThreadPools</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3877</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;With the introduction of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1476&quot; title=&quot;scaling compaction with multiple threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1476&quot;&gt;&lt;del&gt;HBASE-1476&lt;/del&gt;&lt;/a&gt;, we now have multithreaded compactions + 2 different ThreadPools for large and small compactions.  However, this is disabled by default until we can determine a proper default throttle point.  Opening this JIRA to log all discussion on how to select a good default for this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506906">HBASE-3877</key>
            <summary>Determine Proper Defaults for Compaction ThreadPools</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="nspiegelberg">Nicolas Spiegelberg</reporter>
                        <labels>
                            <label>compaction</label>
                    </labels>
                <created>Wed, 11 May 2011 21:07:12 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:07 +0000</updated>
                            <resolved>Wed, 5 Sep 2012 00:09:20 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13032086" author="nspiegelberg" created="Wed, 11 May 2011 21:26:37 +0000"  >&lt;p&gt;For some data point.  In our cluster, we do not automatically split regions and keep our region count low.  Therefore, we have StoreFiles that reach in the 10GB range.  Obviously, if all the compaction threads were processing a 10GB compaction, the queue would get stopped up.  We put the throttle point at 500MB.  Since compactions are network-bound.  We have 1Gbps network links &amp;amp; are seeing roughly 40MBps speed (3x == 1Gbps), so about 12 sec per compaction max on the small threadpool.  Therefore, our use case doesn&apos;t directly correspond to the common auto-split use case.&lt;/p&gt;

&lt;p&gt;My original thought is to default the throttle to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
min(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.hregion.memstore.flush.size&quot;&lt;/span&gt; * 2, &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.hregion.max.filesize&quot;&lt;/span&gt; / 2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that the default split/flush ratio is 4, so this number should be in the middle.  Since most users do compression, the actual flush size should be ~20% of the MemStore size (so flushSize*2 is really more like flushSize*10).  I will submit a patch with this default.  Please feel free to chime in with your experience using it and we&apos;ll see if we can improve this default.&lt;/p&gt;</comment>
                            <comment id="13033243" author="hudson" created="Fri, 13 May 2011 19:49:34 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1918 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1918/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1918/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13276346" author="hudson" created="Tue, 15 May 2012 23:54:12 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #5 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/5/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/5/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5867&quot; title=&quot;Improve Compaction Throttle Default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5867&quot;&gt;&lt;del&gt;HBASE-5867&lt;/del&gt;&lt;/a&gt; Improve Compaction Throttle Default&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
We recently had a production issue where our compactions fell&lt;br/&gt;
behind because our compaction throttle was improperly tuned and&lt;br/&gt;
accidentally upgraded all compactions to the large pool. The default&lt;br/&gt;
from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3877&quot; title=&quot;Determine Proper Defaults for Compaction ThreadPools&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3877&quot;&gt;&lt;del&gt;HBASE-3877&lt;/del&gt;&lt;/a&gt; makes 1 bad assumption: the default number of flushed&lt;br/&gt;
files in a compaction. MinFilesToCompact should be taken into&lt;br/&gt;
consideration. As a default, it is less damaging for the large thread&lt;br/&gt;
to be slightly higher than it needs to be and only get timed-majors&lt;br/&gt;
versus having everything accidentally promoted.&lt;/p&gt;

&lt;p&gt;Test Plan:  - mvn test&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, Kannan, Liyin&lt;br/&gt;
Reviewed By: Kannan&lt;br/&gt;
CC: stack&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D2943&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2943&lt;/a&gt; (Revision 1338809)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
nspiegelberg : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13448232" author="lhofhansl" created="Wed, 5 Sep 2012 00:09:20 +0000"  >&lt;p&gt;Looks like this got committed. Marking it such.&lt;/p&gt;</comment>
                            <comment id="15017438" author="lars_francke" created="Fri, 20 Nov 2015 12:43:07 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12426953">HBASE-1476</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 13 May 2011 19:49:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33248</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hoav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101199</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>