<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:47:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-750/HBASE-750.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-750] NPE caused by StoreFileScanner.updateReaders</title>
                <link>https://issues.apache.org/jira/browse/HBASE-750</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Running a test to determine performance during inserts of many 100,000s of cells into a single column family in a single row, the region server involved went down after taking a NPE:&lt;/p&gt;

&lt;p&gt;2008-07-17 18:12:18,051 FATAL org.apache.hadoop.hbase.regionserver.Flusher: Replay of hlog required. Forcing server restart&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1040)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:942)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Flusher.flushRegion(Flusher.java:174)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Flusher.run(Flusher.java:93)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at java.lang.String.&amp;lt;init&amp;gt;(String.java:516)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Bytes.toString(Bytes.java:71)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.updateReaders(StoreFileScanner.java:374)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.notifyChangedReadersObservers(HStore.java:797)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:784)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:755)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:682)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1030)&lt;br/&gt;
        ... 3 more&lt;/p&gt;

&lt;p&gt;Any ideas about this one?&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.1 x86_64 / 64-bit JDK build 1.6.0_03-b05&lt;/p&gt;</environment>
        <key id="12400502">HBASE-750</key>
            <summary>NPE caused by StoreFileScanner.updateReaders</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jul 2008 18:21:43 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:20 +0000</updated>
                            <resolved>Wed, 23 Jul 2008 19:33:10 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12614498" author="apurtell" created="Thu, 17 Jul 2008 19:14:21 +0000"  >&lt;p&gt;Regarding the performance test itself, these were my findings:&lt;/p&gt;

&lt;p&gt;I created a test table with a single column family and a single row. The test added 1000 cells at a time, using unique qualified column family addresses, into the single column family in that single row. The test attempted to add eventually 1M cells to the family/row and hence 1M unique qualified column family members. During the test both the time required for insert of 1000 cells in batch, the time required to read back one cell from the row, and the time required to read back all cells from the row were measured.&lt;/p&gt;

&lt;p&gt;I executed the test using a test cluster running Hadoop 0.17.1 and HBase trunk (0.2.0-dev) revision 675659. The test client and regionserver ran on different hosts linked by a Gigabit Ethernet network. &lt;/p&gt;

&lt;p&gt;The time required to insert 1000 cells remained within a narrow range over the duration of the test, ranging from 6 to 85 milliseconds.&lt;/p&gt;

&lt;p&gt;The time required to retrieve a single cell from the column/row remained within a narrower range over the duration of the test, ranging from 1 to 42 milliseconds.&lt;/p&gt;

&lt;p&gt;The time required to read back all values in the column/row increased in essentially a linear manner over the duration of the test, rising from 18 milliseconds to 6,064 milliseconds from 1,000 cells to 865,000 cells. See attached chart. I don&apos;t find this surprising and I do not think this behavior indicates a bug. Maybe the slope and possibly also some of the variability can be decreased through profile driven changes, but there will always be this kind of linear increase as cells are added to a column family/row in this manner. &lt;/p&gt;</comment>
                            <comment id="12614579" author="jimk" created="Fri, 18 Jul 2008 00:14:20 +0000"  >&lt;p&gt;WRT the NPE in StoreFileScanner, please update your source. It has been fixed (I believe) since the revision you are running.&lt;/p&gt;</comment>
                            <comment id="12614596" author="apurtell" created="Fri, 18 Jul 2008 01:09:42 +0000"  >&lt;p&gt;I can reproduce this also with 677784, updated maybe 60 minutes ago.&lt;/p&gt;</comment>
                            <comment id="12614599" author="jimk" created="Fri, 18 Jul 2008 01:18:26 +0000"  >&lt;p&gt;Can you please attach a current stack trace? The line numbers of your previous stack trace do  not line up with the current source. Thanks!&lt;/p&gt;</comment>
                            <comment id="12614607" author="apurtell" created="Fri, 18 Jul 2008 02:43:19 +0000"  >&lt;p&gt;2008-07-18 02:38:09,912 FATAL org.apache.hadoop.hbase.regionserver.Flusher: Replay of hlog required. Forcing server restart&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: t1,,1216346719330&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1050)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:949)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.Flusher.flushRegion(Flusher.java:173)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.Flusher.run(Flusher.java:91)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at java.lang.String.&amp;lt;init&amp;gt;(String.java:516)&lt;br/&gt;
	at org.apache.hadoop.hbase.util.Bytes.toString(Bytes.java:71)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.StoreFileScanner.updateReadersStoreFileScanner.java:379)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HStore.notifyChangedReadersObservers(HStore.java:677)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:664)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:634)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:565)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1037)&lt;br/&gt;
	... 3 more&lt;br/&gt;
2008-07-18 02:38:09,913 INFO org.apache.hadoop.hbase.regionserver.Flusher: regionserver/0:0:0:0:0:0:0:0:60020.cacheFlusher exiting&lt;br/&gt;
2008-07-18 02:38:10,594 INFO org.apache.hadoop.hbase.regionserver.LogRoller: LogRoller exiting.&lt;/p&gt;</comment>
                            <comment id="12615789" author="stack" created="Tue, 22 Jul 2008 20:59:55 +0000"  >&lt;p&gt;I committed this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java (revision 678878)
+++ src/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java (working copy)
@@ -377,7 +377,8 @@
       ViableRow viableRow = getNextViableRow();
       openReaders(viableRow.getRow());
       LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Replaced Scanner Readers at row &quot;&lt;/span&gt; +
-        Bytes.toString(viableRow.getRow()));
+        (viableRow == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || viableRow.getRow() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;? &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;:
+          Bytes.toString(viableRow.getRow())));
     } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lock.writeLock().unlock();
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lets see if we see the exception again.&lt;/p&gt;</comment>
                            <comment id="12615821" author="apurtell" created="Tue, 22 Jul 2008 22:51:58 +0000"  >&lt;p&gt;Did not fix.&lt;/p&gt;

&lt;p&gt;Version: 0.2.0-dev, r678937&lt;/p&gt;

&lt;p&gt;2008-07-22 22:48:19,800 FATAL org.apache.hadoop.hbase.regionserver.Flusher: Replay of hlog required. Forcing server restart&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: t1,,1216764706358&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1067)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:965)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Flusher.flushRegion(Flusher.java:173)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Flusher.run(Flusher.java:91)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at java.lang.String.&amp;lt;init&amp;gt;(String.java:516)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Bytes.toString(Bytes.java:71)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.updateReaders(StoreFileScanner.java:379)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.notifyChangedReadersObservers(HStore.java:678)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:665)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:635)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:566)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1054)&lt;br/&gt;
        ... 3 more&lt;/p&gt;</comment>
                            <comment id="12615825" author="apurtell" created="Tue, 22 Jul 2008 22:56:06 +0000"  >&lt;p&gt;Let me check again. Just noticed that the &apos;-dev&apos; has been dropped from the version (and jar file).&lt;/p&gt;</comment>
                            <comment id="12615844" author="apurtell" created="Wed, 23 Jul 2008 00:39:06 +0000"  >&lt;p&gt;Looks good. The always repeatable test case I have for this now runs to completion, and it never did prior to today&apos;s commit to StoreFileScanner. &lt;/p&gt;</comment>
                            <comment id="12616231" author="stack" created="Wed, 23 Jul 2008 19:33:10 +0000"  >&lt;p&gt;OK.  Resolving.  Looking more at code, seems like a ViableRow with a null row is a distinct possibility. All code but silly debug statement had explicit handling of null row.&lt;/p&gt;</comment>
                            <comment id="12616232" author="stack" created="Wed, 23 Jul 2008 19:33:23 +0000"  >&lt;p&gt;Oh, thanks for testing Andrew.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386331" name="HRegionServer-sjdc-atr-test-4.log" size="14884" author="apurtell" created="Thu, 17 Jul 2008 18:25:03 +0000"/>
                            <attachment id="12386337" name="chart.png" size="11958" author="apurtell" created="Thu, 17 Jul 2008 19:14:30 +0000"/>
                            <attachment id="12386330" name="columntest.java" size="2547" author="apurtell" created="Thu, 17 Jul 2008 18:24:50 +0000"/>
                            <attachment id="12386332" name="output.txt" size="17792" author="apurtell" created="Thu, 17 Jul 2008 18:28:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Jul 2008 00:14:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25375</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h97z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>