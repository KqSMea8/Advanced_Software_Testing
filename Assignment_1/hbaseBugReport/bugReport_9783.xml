<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:07:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9783/HBASE-9783.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9783] o.a.h.h.r.HRegion.mutateRow() with non-existent CF cause NPE</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9783</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;h6&gt;&lt;a name=&quot;0.94branchonly&quot;&gt;&lt;/a&gt;0.94 branch only&lt;/h6&gt;

&lt;p&gt;Calling &lt;tt&gt;HTable.mutateRow()&lt;/tt&gt; with non-existent column families result in a NPE on the region server which is wrapped into &lt;tt&gt;RemoteException&lt;/tt&gt; and returned to the client. Since NPE is not a &lt;tt&gt;DoNotRetryIOException&lt;/tt&gt;, client keeps repeating it until the number of retries are exhausted.&lt;/p&gt;

&lt;p&gt;Negative case, hence creating as minor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674175">HBASE-9783</key>
            <summary>o.a.h.h.r.HRegion.mutateRow() with non-existent CF cause NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adityakishore">Aditya Kishore</assignee>
                                    <reporter username="adityakishore">Aditya Kishore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Oct 2013 18:51:26 +0000</created>
                <updated>Fri, 8 Nov 2013 00:03:15 +0000</updated>
                            <resolved>Mon, 21 Oct 2013 20:32:11 +0000</resolved>
                                    <version>0.94.12</version>
                                    <fixVersion>0.94.13</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13797125" author="adityakishore" created="Wed, 16 Oct 2013 18:54:59 +0000"  >&lt;p&gt;Patch for 0.94 branch.&lt;/p&gt;</comment>
                            <comment id="13797330" author="ndimiduk" created="Wed, 16 Oct 2013 22:02:54 +0000"  >&lt;p&gt;lgtm.&lt;/p&gt;

&lt;p&gt;Mind formatting a patch for trunk as well?&lt;/p&gt;</comment>
                            <comment id="13797384" author="adityakishore" created="Wed, 16 Oct 2013 22:47:47 +0000"  >&lt;p&gt;Thanks Nick for reviewing.&lt;/p&gt;

&lt;p&gt;Trunk code is significantly different and as far as I looked, does not have the same issue.&lt;/p&gt;</comment>
                            <comment id="13798520" author="adityakishore" created="Thu, 17 Oct 2013 22:12:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Would you like to pull this in 0.94.13?&lt;/p&gt;</comment>
                            <comment id="13798664" author="lhofhansl" created="Fri, 18 Oct 2013 00:39:06 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Should we have a quick test for this?&lt;/p&gt;</comment>
                            <comment id="13798977" author="adityakishore" created="Fri, 18 Oct 2013 10:12:56 +0000"  >&lt;p&gt;Updated patch with test case.&lt;/p&gt;</comment>
                            <comment id="13799340" author="adityakishore" created="Fri, 18 Oct 2013 17:53:16 +0000"  >&lt;p&gt;Had to move the coprocessor check inside the for loop since {{coprocessorHost }} is not created if region is not hosted inside the region server and instantiated standalone (which is the case with Test case). Should not have any side effect.&lt;/p&gt;</comment>
                            <comment id="13799487" author="lhofhansl" created="Fri, 18 Oct 2013 20:32:17 +0000"  >&lt;p&gt;Looking at the patch. Two comments:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Nit: In the test, just let the unexpected exception fall through. That way it shows up in the test log rather than an assertion failure&lt;/li&gt;
	&lt;li&gt;The problem seems to be that checkFamilies is inside the try block and in the finally clause we attempt to get the store for a family, which returns null. The same check is done in prepareDelete&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think it would be better to either have a null check for the store in the finally clause, or add another boolean that we set to true right before we update the memstore and only rollback if that is set.&lt;/p&gt;</comment>
                            <comment id="13799516" author="adityakishore" created="Fri, 18 Oct 2013 21:08:08 +0000"  >&lt;p&gt;Thanks for the review (and suggestions) Lars. The new patch is lot cleaner (applying your second suggestion).&lt;/p&gt;</comment>
                            <comment id="13800233" author="lhofhansl" created="Sun, 20 Oct 2013 21:10:49 +0000"  >&lt;p&gt;memstoreUpdated should be set to true before we call applyFamilyMapToMemstore, so we roll back any partial memstore updates.&lt;/p&gt;

&lt;p&gt;It&apos;s only really important to set this after we call checkFamily...&lt;/p&gt;</comment>
                            <comment id="13800247" author="adityakishore" created="Sun, 20 Oct 2013 21:36:14 +0000"  >&lt;p&gt;I see it now, thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Patch updated.&lt;/p&gt;</comment>
                            <comment id="13800260" author="lhofhansl" created="Sun, 20 Oct 2013 22:22:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Will commit later today unless I hear objections.&lt;/p&gt;</comment>
                            <comment id="13800965" author="adityakishore" created="Mon, 21 Oct 2013 19:09:11 +0000"  >&lt;p&gt;Updated the summary to correctly reflect the issue and fix.&lt;/p&gt;</comment>
                            <comment id="13801045" author="lhofhansl" created="Mon, 21 Oct 2013 20:32:11 +0000"  >&lt;p&gt;Committed to 0.94. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adityakishore&quot; class=&quot;user-hover&quot; rel=&quot;adityakishore&quot;&gt;Aditya Kishore&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13801260" author="hudson" created="Mon, 21 Oct 2013 22:31:55 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1178 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1178/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1178/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9783&quot; title=&quot;o.a.h.h.r.HRegion.mutateRow() with non-existent CF cause NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9783&quot;&gt;&lt;del&gt;HBASE-9783&lt;/del&gt;&lt;/a&gt; o.a.h.h.r.HRegion.mutateRow() with non-existent CF cause NPE (Aditya Kishore) (larsh: rev 1534365)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13801265" author="hudson" created="Mon, 21 Oct 2013 22:36:11 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #319 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/319/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/319/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9783&quot; title=&quot;o.a.h.h.r.HRegion.mutateRow() with non-existent CF cause NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9783&quot;&gt;&lt;del&gt;HBASE-9783&lt;/del&gt;&lt;/a&gt; o.a.h.h.r.HRegion.mutateRow() with non-existent CF cause NPE (Aditya Kishore) (larsh: rev 1534365)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609336" name="HBASE-9783.patch" size="3372" author="adityakishore" created="Sun, 20 Oct 2013 21:36:14 +0000"/>
                            <attachment id="12609210" name="HBASE-9783.patch" size="3431" author="adityakishore" created="Fri, 18 Oct 2013 21:08:08 +0000"/>
                            <attachment id="12609121" name="HBASE-9783.patch" size="4370" author="adityakishore" created="Fri, 18 Oct 2013 10:12:56 +0000"/>
                            <attachment id="12608777" name="HBASE-9783.patch" size="1607" author="adityakishore" created="Wed, 16 Oct 2013 18:54:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Oct 2013 22:02:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ozwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>