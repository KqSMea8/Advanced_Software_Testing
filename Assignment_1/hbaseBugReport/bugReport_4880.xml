<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:22:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4880/HBASE-4880.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4880] Region is on service before openRegionHandler completes, may cause data loss</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4880</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;OpenRegionHandler in regionserver is processed as the following steps:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1.openregion()(Through it, closed = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, closing = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
2.addToOnlineRegions(region)
3.update .meta. table 
4.update ZK&apos;s node state to RS_ZK_REGION_OPEND
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can find that region is on service before Step 4.&lt;br/&gt;
It means client could put data to this region after step 3.&lt;br/&gt;
What will happen if step 4 is failed processing?&lt;br/&gt;
It will execute OpenRegionHandler#cleanupFailedOpen which will do closing region, and master assign this region to another regionserver.&lt;br/&gt;
If closing region is failed, the data which is put between step 3 and step 4 may loss, because the region has been opend on another regionserver and be put new data. Therefore, it may not be recoverd through replayRecoveredEdit() because the edit&apos;s LogSeqId is smaller than current region SeqId.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12532862">HBASE-4880</key>
            <summary>Region is on service before openRegionHandler completes, may cause data loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Nov 2011 05:17:23 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:28 +0000</updated>
                            <resolved>Fri, 9 Dec 2011 06:12:14 +0000</resolved>
                                    <version>0.92.0</version>
                    <version>0.94.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13158197" author="zjushch" created="Mon, 28 Nov 2011 05:55:48 +0000"  >&lt;p&gt;Region isn&apos;t on service unitl completing openRegionHanlder successfully.&lt;/p&gt;</comment>
                            <comment id="13158224" author="ram_krish" created="Mon, 28 Nov 2011 06:37:36 +0000"  >&lt;p&gt;If we are going to make this change, why don&apos;t we avoid the step of adding the region into online region before step 3.&lt;br/&gt;
And add it only at the end?&lt;br/&gt;
Let&apos;s see what others have to say on this.&lt;/p&gt;</comment>
                            <comment id="13158234" author="zjushch" created="Mon, 28 Nov 2011 06:46:21 +0000"  >&lt;p&gt;@ramkrishna&lt;br/&gt;
If we avoid the step of adding the region into online region before step 3.&lt;br/&gt;
We need modify the HReionserver#postOpenDeployTasks, it seems changing too much.&lt;br/&gt;
In my patchv1, remove it from online regions immediately at memory level after updating .META.&lt;/p&gt;</comment>
                            <comment id="13158240" author="yuzhihong@gmail.com" created="Mon, 28 Nov 2011 06:51:07 +0000"  >&lt;p&gt;@Chunhui:&lt;br/&gt;
HadoopQA isn&apos;t functional at the moment.&lt;/p&gt;

&lt;p&gt;Can you let us know if test suite passes ?&lt;/p&gt;</comment>
                            <comment id="13158242" author="zjushch" created="Mon, 28 Nov 2011 06:55:00 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
I&apos;m running test for trunk now.&lt;/p&gt;</comment>
                            <comment id="13158331" author="zjushch" created="Mon, 28 Nov 2011 10:21:14 +0000"  >&lt;p&gt;Test results in the Linux OS:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Results :

Failed tests:   testClosing(org.apache.hadoop.hbase.client.TestHCM)

Tests run: 1174, Failures: 1, Errors: 0, Skipped: 8

[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2:01:55.336s
[INFO] Finished at: Mon Nov 28 17:08:43 CST 2011
[INFO] Final Memory: 35M/351M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13161502" author="zjushch" created="Fri, 2 Dec 2011 09:20:27 +0000"  >&lt;p&gt;How to deal with this issue?&lt;/p&gt;</comment>
                            <comment id="13162278" author="yuzhihong@gmail.com" created="Sun, 4 Dec 2011 04:38:10 +0000"  >&lt;p&gt;I think the patch makes sense.&lt;/p&gt;

&lt;p&gt;I ran TestHCM with patch applied. It passed.&lt;/p&gt;</comment>
                            <comment id="13163263" author="ram_krish" created="Tue, 6 Dec 2011 01:48:06 +0000"  >&lt;p&gt;I am ok with the change.  What if we add the region to online region only after we are sure that META update is successful.  &lt;br/&gt;
Chenhui, feels the change will be bigger if we do like that.  If others are ok with the change then I am +1 on it.&lt;/p&gt;</comment>
                            <comment id="13163333" author="lhofhansl" created="Tue, 6 Dec 2011 04:14:46 +0000"  >&lt;p&gt;I would agree with Ram. Adding the region to onlineRegions, then removing it, just to add it again seems a bit hack&apos;ish. We should avoid adding it in the first place. How much bigger would the patch be?&lt;br/&gt;
(Disclaimer: I do not know this part of the code very well).&lt;/p&gt;</comment>
                            <comment id="13163473" author="zjushch" created="Tue, 6 Dec 2011 09:47:33 +0000"  >&lt;p&gt;I think we should separate the step2 and step3 in the HRegionserver#postOpenDeployTasks.&lt;/p&gt;</comment>
                            <comment id="13163925" author="stack" created="Tue, 6 Dec 2011 22:29:07 +0000"  >&lt;p&gt;Excellent detective work here lads.&lt;/p&gt;

&lt;p&gt;I too would lean toward Rams&apos; original suggestion, that we only online the region after zk update and edit to .meta. has gone in.&lt;/p&gt;
</comment>
                            <comment id="13163928" author="stack" created="Tue, 6 Dec 2011 22:30:55 +0000"  >&lt;p&gt;I took a look at the patch.  Yeah, its a bit messy but nice first cut at the problem.&lt;/p&gt;</comment>
                            <comment id="13163943" author="zhihyu@ebaysf.com" created="Tue, 6 Dec 2011 22:51:49 +0000"  >&lt;p&gt;TestAdmin#testForceSplit would fail if I comment out the following line in HRegionServer.postOpenDeployTasks():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-    addToOnlineRegions(r);
+    &lt;span class=&quot;code-comment&quot;&gt;// addToOnlineRegions(r);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is the error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 1 action: NotServingRegionException: 1 time, servers with issues: lm-sjn-xx:65442, 
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatchCallback(HConnectionManager.java:1641)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatch(HConnectionManager.java:1409)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:892)
	at org.apache.hadoop.hbase.client.HTable.doPut(HTable.java:750)
	at org.apache.hadoop.hbase.client.HTable.put(HTable.java:725)
	at org.apache.hadoop.hbase.client.TestAdmin.splitTest(TestAdmin.java:805)
	at org.apache.hadoop.hbase.client.TestAdmin.testForceSplit(TestAdmin.java:108)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13163953" author="stack" created="Tue, 6 Dec 2011 22:58:24 +0000"  >&lt;p&gt;@Zhihong We need to fix the above split issue if we refactor so we only put region online as last step?&lt;/p&gt;</comment>
                            <comment id="13164083" author="zjushch" created="Wed, 7 Dec 2011 02:35:20 +0000"  >&lt;p&gt;@all&lt;br/&gt;
what about the patchv2?&lt;br/&gt;
I remove &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
addToOnlineRegions(r);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; from HReionserver#postOpenDeployTasks.&lt;br/&gt;
It means that step2 and step3 are independent now, &lt;br/&gt;
After calling postOpenDeployTasks, we should add region to onlineregions timely by the transaction&lt;/p&gt;</comment>
                            <comment id="13164104" author="yuzhihong@gmail.com" created="Wed, 7 Dec 2011 03:11:03 +0000"  >&lt;p&gt;Did TestAdmin pass for patch v2?&lt;/p&gt;</comment>
                            <comment id="13164110" author="zjushch" created="Wed, 7 Dec 2011 03:28:26 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
TestAdmin has passed for patch v2, and you could try again.&lt;/p&gt;</comment>
                            <comment id="13164122" author="zhihyu@ebaysf.com" created="Wed, 7 Dec 2011 04:19:22 +0000"  >&lt;p&gt;Patch v2 is cleaner.&lt;/p&gt;

&lt;p&gt;Minor comment:&lt;br/&gt;
The change in RegionServerServices.java shouldn&apos;t put explanation for parameters on a separate line - parameter name and explanation should be on the same line.&lt;/p&gt;

&lt;p&gt;Good job Chunhui.&lt;/p&gt;</comment>
                            <comment id="13164133" author="zjushch" created="Wed, 7 Dec 2011 04:32:18 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
I use the code style by the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3678&quot; title=&quot;Add Eclipse-based Apache Formatter to HBase Wiki&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3678&quot;&gt;&lt;del&gt;HBASE-3678&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
It will put explanation for parameters on a separate line automatically.&lt;br/&gt;
Is there any problem of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3678&quot; title=&quot;Add Eclipse-based Apache Formatter to HBase Wiki&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3678&quot;&gt;&lt;del&gt;HBASE-3678&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13164149" author="zjushch" created="Wed, 7 Dec 2011 04:57:53 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Amend the problem of putting explanation for parameters on a separate line in patchv3.&lt;br/&gt;
Please check.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13164154" author="hadoopqa" created="Wed, 7 Dec 2011 05:07:28 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12506391/hbase-4880v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12506391/hbase-4880v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -160 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 72 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestColumnSeeking&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/458//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/458//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/458//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/458//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/458//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/458//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13164155" author="hadoopqa" created="Wed, 7 Dec 2011 05:09:32 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12506380/hbase-4880v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12506380/hbase-4880v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -160 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 72 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.hbck.TestOfflineMetaRebuildHole&lt;br/&gt;
                  org.apache.hadoop.hbase.util.hbck.TestOfflineMetaRebuildBase&lt;br/&gt;
                  org.apache.hadoop.hbase.util.hbck.TestOfflineMetaRebuildOverlap&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/457//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/457//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/457//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/457//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/457//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/457//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13164168" author="yuzhihong@gmail.com" created="Wed, 7 Dec 2011 05:59:39 +0000"  >&lt;p&gt;Please check failed tests. &lt;br/&gt;
It seems trunk is broken now. &lt;/p&gt;</comment>
                            <comment id="13164169" author="zjushch" created="Wed, 7 Dec 2011 06:04:52 +0000"  >&lt;p&gt;I think it is not related to this patch.&lt;br/&gt;
The same failed tests appear in &lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/456/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/456/testReport/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13164412" author="ram_krish" created="Wed, 7 Dec 2011 14:09:51 +0000"  >&lt;p&gt;The patch looks fine to me.. Checking the test failures. &lt;br/&gt;
@Chenhui&lt;br/&gt;
Have you done some testing after this patch?&lt;br/&gt;
Nice work&lt;/p&gt;</comment>
                            <comment id="13164605" author="zhihyu@ebaysf.com" created="Wed, 7 Dec 2011 18:38:46 +0000"  >&lt;p&gt;The three test failures would be fixed by addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4927&quot; title=&quot;CatalogJanior:SplitParentFirstComparator doesn&amp;#39;t sort as expected, for the last region when the endkey is empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4927&quot;&gt;&lt;del&gt;HBASE-4927&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13164720" author="zhihyu@ebaysf.com" created="Wed, 7 Dec 2011 21:30:10 +0000"  >&lt;p&gt;Patch testing again.&lt;/p&gt;</comment>
                            <comment id="13164773" author="hadoopqa" created="Wed, 7 Dec 2011 22:17:53 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12506518/4880.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12506518/4880.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -160 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 72 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/466//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/466//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/466//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/466//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/466//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/466//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13164777" author="zhihyu@ebaysf.com" created="Wed, 7 Dec 2011 22:22:23 +0000"  >&lt;p&gt;Latest patch passes all tests.&lt;/p&gt;

&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13164953" author="ram_krish" created="Thu, 8 Dec 2011 02:54:01 +0000"  >&lt;p&gt;@Chenuhui&lt;br/&gt;
A minor comment.  As we are not adding it into online regions and we are adding it only after the openRegionHandler is processed&lt;br/&gt;
The line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rsServices.removeFromOnlineRegions(regionInfo.getEncodedName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;may not be needed in cleanupFailedOpen(). What do you feel ? &lt;/p&gt;</comment>
                            <comment id="13164973" author="zjushch" created="Thu, 8 Dec 2011 04:11:00 +0000"  >&lt;p&gt;@ram&lt;br/&gt;
I think so.&lt;br/&gt;
It is not needed in cleanupFailedOpen() for the current openRegionHanlder transaction&lt;/p&gt;</comment>
                            <comment id="13165044" author="stack" created="Thu, 8 Dec 2011 06:50:04 +0000"  >&lt;p&gt;@Chunhui Nice patch.  If you are going to make a new version to address Ram comment, here are some other comments to consider:&lt;/p&gt;

&lt;p&gt;I think your patch can be smaller.  Much of your patch is trying to explain that postopendeploy now no longer onlines a region as part of its opening.  I think you do not have to explain this change in multiple places in the code; just change the code to no longer do it.   For example, this part of diff looks unneeded to me:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@@ -110,10 +109,14 @@
         tryTransitionToFailedOpen(regionInfo);
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
       }
-
       &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; failed = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tickleOpening(&lt;span class=&quot;code-quote&quot;&gt;&quot;post_region_open&quot;&lt;/span&gt;)) {
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (updateMeta(region)) failed = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+        &lt;span class=&quot;code-comment&quot;&gt;// Just update .META. table ,but not add it to online regions.
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// We shouldn&apos;t serve &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region before master receive region opened
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// message.(see HBASE-4880)
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (updateMeta(region)) {
+          failed = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+        }
       }
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (failed || &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.isStopped() ||
           &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rsServices.isStopping()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its just comments but I think that to a reader who comes along later, they won&apos;t be able to make much sense of what the comment is about &amp;#8211; not without hbase-4880 (in other words, the comment will have a short shelf-life; it makes sense to the few of us who have been looking at this bit of code but soon we&apos;ll all forget that postopendeploy used online the region too.&lt;/p&gt;

&lt;p&gt;Similar with this change:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@@ -212,9 +217,11 @@
   }
 
   /**
-   * &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; to run region post open tasks.  Call {@link #getException()} after
-   * the thread finishes to check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; exceptions running
-   * {@link RegionServerServices#postOpenDeployTasks(HRegion, org.apache.hadoop.hbase.catalog.CatalogTracker, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)}.
+   * &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; to run region post open tasks, which would update meta, but would
+   * not add region to OnlineRegions . Call {@link #getException()} after the
+   * thread finishes to check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; exceptions running
+   * {@link RegionServerServices#postOpenDeployTasks(HRegion, org.apache.hadoop.hbase.catalog.CatalogTracker, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)}
+   * .
    */
   &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class PostOpenDeployTasksThread &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Exception exception = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the change to the class RegionServerServices.&lt;/p&gt;

&lt;p&gt;Otherwise, patch is great. +1.  Would be nice to have a test for it but its a bit too ornery of a context to conjure in tests so I&apos;d be fine w/ it going into trunk and 0.92.&lt;/p&gt;</comment>
                            <comment id="13165737" author="zjushch" created="Fri, 9 Dec 2011 01:34:41 +0000"  >&lt;p&gt;Address Ram and Stack comments in patchv4&lt;br/&gt;
Thanks.&lt;br/&gt;
Please check&lt;/p&gt;</comment>
                            <comment id="13165779" author="hadoopqa" created="Fri, 9 Dec 2011 02:26:19 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12506692/hbase-4880v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12506692/hbase-4880v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -160 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 74 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/477//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/477//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/477//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/477//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/477//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/477//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13165783" author="ram_krish" created="Fri, 9 Dec 2011 02:29:47 +0000"  >&lt;p&gt;+1 on patch. &lt;/p&gt;</comment>
                            <comment id="13165837" author="yuzhihong@gmail.com" created="Fri, 9 Dec 2011 04:37:22 +0000"  >&lt;p&gt;+1 on patch v4.&lt;/p&gt;</comment>
                            <comment id="13165874" author="stack" created="Fri, 9 Dec 2011 06:11:40 +0000"  >&lt;p&gt;0.92 patch is a little different; e.g. no test categories in branch.&lt;/p&gt;</comment>
                            <comment id="13165875" author="stack" created="Fri, 9 Dec 2011 06:12:14 +0000"  >&lt;p&gt;Committed branch and trunk.  Nice work Chunhui.&lt;/p&gt;</comment>
                            <comment id="13165977" author="hudson" created="Fri, 9 Dec 2011 09:23:00 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2532 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2532/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2532/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4880&quot; title=&quot;Region is on service before openRegionHandler completes, may cause data loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4880&quot;&gt;&lt;del&gt;HBASE-4880&lt;/del&gt;&lt;/a&gt; Region is on service before openRegionHandler completes, may cause data loss&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestEndToEndSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13166080" author="hudson" created="Fri, 9 Dec 2011 11:15:34 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #34 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/34/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/34/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4880&quot; title=&quot;Region is on service before openRegionHandler completes, may cause data loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4880&quot;&gt;&lt;del&gt;HBASE-4880&lt;/del&gt;&lt;/a&gt; Region is on service before openRegionHandler completes, may cause data loss&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestEndToEndSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13166180" author="hudson" created="Fri, 9 Dec 2011 13:41:36 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #26 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/26/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/26/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4880&quot; title=&quot;Region is on service before openRegionHandler completes, may cause data loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4880&quot;&gt;&lt;del&gt;HBASE-4880&lt;/del&gt;&lt;/a&gt; Region is on service before openRegionHandler completes, may cause data loss&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestEndToEndSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13166251" author="hudson" created="Fri, 9 Dec 2011 15:39:02 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #180 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/180/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/180/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4880&quot; title=&quot;Region is on service before openRegionHandler completes, may cause data loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4880&quot;&gt;&lt;del&gt;HBASE-4880&lt;/del&gt;&lt;/a&gt; Region is on service before openRegionHandler completes, may cause data loss&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestEndToEndSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15015753" author="lars_francke" created="Fri, 20 Nov 2015 11:52:28 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506707" name="4880-0.92.txt" size="8139" author="stack" created="Fri, 9 Dec 2011 06:11:40 +0000"/>
                            <attachment id="12506518" name="4880.txt" size="10236" author="zhihyu@ebaysf.com" created="Wed, 7 Dec 2011 21:29:44 +0000"/>
                            <attachment id="12505293" name="hbase-4880.patch" size="2807" author="zjushch" created="Mon, 28 Nov 2011 05:55:47 +0000"/>
                            <attachment id="12506380" name="hbase-4880v2.patch" size="10236" author="zjushch" created="Wed, 7 Dec 2011 02:29:34 +0000"/>
                            <attachment id="12506391" name="hbase-4880v3.patch" size="9986" author="zjushch" created="Wed, 7 Dec 2011 04:53:22 +0000"/>
                            <attachment id="12506692" name="hbase-4880v4.patch" size="10274" author="zjushch" created="Fri, 9 Dec 2011 01:33:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Nov 2011 06:37:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>218595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06a93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34592</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>