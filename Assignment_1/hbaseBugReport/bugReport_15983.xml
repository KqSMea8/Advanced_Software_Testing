<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:09:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15983/HBASE-15983.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15983] Replication improperly discards data from end-of-wal in some cases.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15983</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In some particular deployments, the Replication code believes it has&lt;br/&gt;
reached EOF for a WAL prior to successfully parsing all bytes known to&lt;br/&gt;
exist in a cleanly closed file.&lt;/p&gt;

&lt;p&gt;The underlying issue is that several different underlying problems with a WAL reader are all treated as end-of-file by the code in ReplicationSource that decides if a given WAL is completed or needs to be retried.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12976617">HBASE-15983</key>
            <summary>Replication improperly discards data from end-of-wal in some cases.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="busbey">Sean Busbey</assignee>
                                    <reporter username="busbey">Sean Busbey</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2016 20:46:41 +0000</created>
                <updated>Fri, 18 Nov 2016 04:50:14 +0000</updated>
                                            <version>0.98.0</version>
                    <version>1.0.0</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>0.98.23</fixVersion>
                    <fixVersion>1.2.5</fixVersion>
                    <fixVersion>1.1.9</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                            <comments>
                            <comment id="15319379" author="busbey" created="Tue, 7 Jun 2016 20:52:39 +0000"  >&lt;p&gt;The proximal failure that brought this to my attention is an error in handling offsets (but I don&apos;t know exactly what the root cause is yet). Here&apos;s a summary:&lt;/p&gt;

&lt;p&gt;During our attempts to tail an in-progress WAL, at some point we mishandle some underlying error condition and get to a (saved) offset that is not a valid beginning of a message. The Reader properly gets and propogates a InvalidProtobufException and the ReplicationSource effectively treats this as &quot;something happened at the end of the file, rewind.&quot; The problem is that the saved offset is bad, so rewinding just puts us back at the same location. We loop indefinitely so long as the WAL is the active one, then once it rolls we treat this failure as an end of file and dump the remainder of the file. In the particular deployment where this happened the result was 40-60% row loss.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a root cause yet, but I have a general work around that doesn&apos;t violate our current promises for replication (though it does make them more pronounced and more likely to be noticed). I plan to handle this in three subtasks:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;the workaround to ensure that in the case of a cleanly closed WAL file we are parsing all of the bytes that we expect to be present&lt;/li&gt;
	&lt;li&gt;a docs update that makes ours promises around replication more precise (namely that we are at-least-once delivery, with no order guarantees)&lt;/li&gt;
	&lt;li&gt;solving the proximal error on parsing while tailing the end of the active wal&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15319397" author="busbey" created="Tue, 7 Jun 2016 20:56:10 +0000"  >&lt;p&gt;for the curious, I didn&apos;t mark this as a blocker and I think it can be moved out of in-progress releases because at least the &quot;every possible error means silently treat as end of file&quot; has been present essentially since we&apos;ve had replication and I don&apos;t know yet what versions are impacted by the offset error (and I don&apos;t know how long finding that cause will take).&lt;/p&gt;

&lt;p&gt;In the test runs I was able to perform, replaying the now-closed-WAL once we detect there&apos;s an error while there are bytes left a single time was sufficient to remove the problem entirely, so I think having that done will suffice for current production deployments.&lt;/p&gt;</comment>
                            <comment id="15338282" author="mantonov" created="Sat, 18 Jun 2016 23:56:26 +0000"  >&lt;p&gt;looking forward to get it in 1.3.1&lt;/p&gt;</comment>
                            <comment id="15422262" author="stack" created="Tue, 16 Aug 2016 06:04:28 +0000"  >&lt;p&gt;Moving out of 1.2.3 per Sean suggestion above.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12976620">HBASE-15984</subtask>
                            <subtask id="12976631">HBASE-15985</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 18 Jun 2016 23:56:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z49r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>