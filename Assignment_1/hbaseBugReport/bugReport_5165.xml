<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5165/HBASE-5165.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5165] Concurrent processing of DeleteTableHandler and ServerShutdownHandler may cause deleted region to assign again</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5165</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Concurrent processing of DeleteTableHandler and ServerShutdownHandler may cause following situation&lt;br/&gt;
1.Table has already be disabled.&lt;br/&gt;
2.ServerShutdownHandler is doing MetaReader.getServerUserRegions.&lt;br/&gt;
3.When step2 is processing or is completed just now, DeleteTableHandler starts to delete region(Remove region from META and Delete region from FS)&lt;br/&gt;
4.DeleteTableHandler set table enabled.&lt;br/&gt;
4.ServerShutdownHandler is starting to assign region which is alread deleted by DeleteTableHandler.&lt;/p&gt;

&lt;p&gt;The result of above operations is producing an invalid record in .META.  and can&apos;t be fixed by hbck &lt;/p&gt;</description>
                <environment></environment>
        <key id="12537853">HBASE-5165</key>
            <summary>Concurrent processing of DeleteTableHandler and ServerShutdownHandler may cause deleted region to assign again</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jan 2012 02:14:40 +0000</created>
                <updated>Sat, 11 Apr 2015 00:17:06 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 00:17:06 +0000</resolved>
                                    <version>0.90.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13183017" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 02:23:31 +0000"  >&lt;p&gt;This looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13183018" author="zjushch" created="Tue, 10 Jan 2012 02:28:00 +0000"  >&lt;p&gt;Oh, sorry, I have not seen it.&lt;br/&gt;
They are the same issue, I will watch &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, please close this. &lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13183026" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 02:38:24 +0000"  >&lt;p&gt;@Chunhui:&lt;br/&gt;
Ram hasn&apos;t provided patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; yet.&lt;br/&gt;
We can start with your patch.&lt;/p&gt;</comment>
                            <comment id="13183061" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 04:15:57 +0000"  >&lt;p&gt;Patch looks interesting.&lt;/p&gt;

&lt;p&gt;Have you verified that the patch fixes the problem ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waiting on processing of deadserver or initiallizing of master, deadServersInProgress = &quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above log should be removed. At least, its frequency should be reduced.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (masterServices.getServerManager().areDeadServersInProgress()
        || ((HMaster) server).isInitialized()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the above should be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (masterServices.getServerManager().areDeadServersInProgress()
        || !((HMaster) server).isInitialized()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13183065" author="zjushch" created="Tue, 10 Jan 2012 04:37:25 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
This patch doesn&apos;t solve the problem of fixUpDaughters() considered by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
So, I need to make a new approach.&lt;/p&gt;</comment>
                            <comment id="13183143" author="zjushch" created="Tue, 10 Jan 2012 08:36:54 +0000"  >&lt;p&gt;Modify it as Ted&apos;s comment in 5165v2.patch.(DeleteTableHandler doesn&apos;t set table enabled until no ServerShutdownHanler)&lt;/p&gt;

&lt;p&gt;Since fixupDaughters() will not be executed if table is disabled, I think patchv2 fix this issue including &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Waiting for better approach.&lt;/p&gt;</comment>
                            <comment id="13183167" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 09:38:58 +0000"  >&lt;p&gt;As Stack said in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;now when a table is disabled, we now set a flag for the table in zk rather than do it individually on each region&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;@Chunhui:&lt;br/&gt;
Can you address the above in ServerShutdownHandler ?&lt;/p&gt;</comment>
                            <comment id="13183170" author="hadoopqa" created="Tue, 10 Jan 2012 09:58:34 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510019/hbase-5165v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510019/hbase-5165v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/714//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/714//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/714//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/714//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/714//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/714//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13183181" author="zjushch" created="Tue, 10 Jan 2012 10:43:38 +0000"  >&lt;p&gt;I&apos;m not clear why we need to set disabled flag for each region in zk.&lt;br/&gt;
It seems no help for the issue.(DeleteTableHandler will delete these nodes, and ServerShutdownHandler will assign region if nodes not exist)&lt;/p&gt;

&lt;p&gt;We only need to synchronize DeleteTableHandler and ServerShutdownHandler, to ensure deleted region not assigned.&lt;br/&gt;
Since regions of disabled table will not be assigned and fixed up in current strategy, we only need to ensure that no regions in assigning queue before set table enabled&lt;/p&gt;</comment>
                            <comment id="13183308" author="ram_krish" created="Tue, 10 Jan 2012 15:00:41 +0000"  >&lt;p&gt;@Chunhui&lt;br/&gt;
I just now saw your issue.  It is same as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.  Can you see my comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.  I propose to use the TableState.ENABLED.  Currently i am working on a patch for it.  Will upload it by tomorrow. &lt;/p&gt;</comment>
                            <comment id="13237309" author="hadoopqa" created="Fri, 23 Mar 2012 23:49:35 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510019/hbase-5165v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510019/hbase-5165v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestForceCacheImportantBlocks&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1287//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1287//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1287//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1287//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1287//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1287//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509995" name="hbase-5165.patch" size="2360" author="zjushch" created="Tue, 10 Jan 2012 02:16:23 +0000"/>
                            <attachment id="12510019" name="hbase-5165v2.patch" size="2333" author="zjushch" created="Tue, 10 Jan 2012 08:36:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Jan 2012 02:23:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02czz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>