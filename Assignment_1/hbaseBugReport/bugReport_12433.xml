<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:33:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12433/HBASE-12433.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12433] Coprocessors not dynamically reordered when reset priority</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12433</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When modifying the coprocessor priority through the HBase shell, the order of the firing of the coprocessors wasn&apos;t changing. It probably would have with a cluster bounce, but if we can make it dynamic easily, that would be preferable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753289">HBASE-12433</key>
            <summary>Coprocessors not dynamically reordered when reset priority</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10004">Not A Bug</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jamestaylor">James Taylor</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Nov 2014 03:07:50 +0000</created>
                <updated>Fri, 11 Nov 2016 18:07:21 +0000</updated>
                            <resolved>Fri, 11 Nov 2016 18:07:21 +0000</resolved>
                                    <version>0.98.7</version>
                                                    <component>Coprocessors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14205951" author="jingcheng.du@intel.com" created="Tue, 11 Nov 2014 05:08:32 +0000"  >&lt;p&gt;Hi James &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamestaylor&quot; class=&quot;user-hover&quot; rel=&quot;jamestaylor&quot;&gt;James Taylor&lt;/a&gt;, you changed the coprocessor priority by altering table in HBase shell? Did you disabled/enabled the table at that time?&lt;/p&gt;</comment>
                            <comment id="14205967" author="jamestaylor" created="Tue, 11 Nov 2014 05:29:20 +0000"  >&lt;p&gt;No, no disable/enable. I thought that wasn&apos;t necessary anymore?&lt;/p&gt;</comment>
                            <comment id="14206094" author="jingcheng.du@intel.com" created="Tue, 11 Nov 2014 07:53:52 +0000"  >&lt;p&gt;No, there wasn&apos;t.&lt;br/&gt;
The coprocessors could be reloaded/reordered when the regions are instantiated. It means if the coprocessor priority is changed, disabling/enabling the table would help reorder the coprocessors in regions. Is that possible to disable/enable tables in your case? Thanks!&lt;/p&gt;</comment>
                            <comment id="14206181" author="anoop.hbase" created="Tue, 11 Nov 2014 08:58:34 +0000"  >&lt;p&gt;Alter table is not complaining when table is not disabled? Or you have set online alter config to true?&lt;/p&gt;</comment>
                            <comment id="14206228" author="jingcheng.du@intel.com" created="Tue, 11 Nov 2014 10:05:16 +0000"  >&lt;p&gt;Hi all, found the issues.&lt;br/&gt;
if an online modifying table is allowed and that table is modified online, its regions will be reassigned, but this assignment is asynchronous, you could see the code in TableEventHandler.process(), the reOpenAllRegions(hris) will invoke the BulkAssigner.bulkOpen (actually here the implementation BulkReopen is used).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (eventType.isOnlineSchemaChangeSupported() &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.masterServices.
          getAssignmentManager().getTableStateManager().isTableState(
          tableName, ZooKeeperProtos.Table.State.ENABLED)) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (reOpenAllRegions(hris)) {
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Completed table operation &quot;&lt;/span&gt; + eventType + &lt;span class=&quot;code-quote&quot;&gt;&quot; on table &quot;&lt;/span&gt; +
              tableName);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error on reopening the regions&quot;&lt;/span&gt;);
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whether the assignment is asynchronous depends on the implementation of the method waitUntilDone(timeout). In the BulkReopen, this method directly returns true without any waiting. Until the region is reopened, the order won&apos;t be changed.&lt;br/&gt;
So do we need to re-implement the method BulkReopen.waitUtilDone(timeout) here for this case? Any ideas, thanks.&lt;/p&gt;</comment>
                            <comment id="14208413" author="apurtell" created="Wed, 12 Nov 2014 18:34:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;In the BulkReopen, this method directly returns true without any waiting. Until the region is reopened, the order won&apos;t be changed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is that the issue though?  We just need to, eventually, when the region is reopened to apply the schema update, have the coprocessor ordering change apply. I don&apos;t think James is reporting the changes have to be applied before the admin call returns. I think he&apos;s reporting that time goes by and the changes never seem to be applied.&lt;/p&gt;

&lt;p&gt;When the region is reopened, is the schema change available at that time?&lt;/p&gt;

&lt;p&gt;Are the coprocessors on the region being reloaded?&lt;/p&gt;</comment>
                            <comment id="14208415" author="apurtell" created="Wed, 12 Nov 2014 18:35:11 +0000"  >&lt;p&gt;Online schema change is enabled by default on 0.98+ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14209154" author="anoop.hbase" created="Thu, 13 Nov 2014 02:54:09 +0000"  >&lt;p&gt;I see. Thanks Andy&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jingcheng.du%40intel.com&quot; class=&quot;user-hover&quot; rel=&quot;jingcheng.du@intel.com&quot;&gt;Jingcheng Du&lt;/a&gt; done some testing and he will write back his observation.&lt;/p&gt;</comment>
                            <comment id="14209178" author="jingcheng.du@intel.com" created="Thu, 13 Nov 2014 03:21:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; for the comments.&lt;/p&gt;

&lt;p&gt;The assignment is asynchronous, after the region assignment and reopened is finished, the coprocessors will be reordered.&lt;br/&gt;
I had done some testing recently,&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;adding two coprocessors in the HTableDescriptor.&lt;/li&gt;
	&lt;li&gt;put/scan/get a row.&lt;/li&gt;
	&lt;li&gt;modify the coprocessor priority and modify the HTD online.&lt;/li&gt;
	&lt;li&gt;put/scan/get a row again.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;in the testing output, the put could get the ordered coprocessors every time. The scan and get will get the ordered coprocessors only after the region is reassigned (it&apos;s possible to get the unordered coprocessors in these ops, sometimes in the testing we could get the exception NotServingRegionException: &lt;/p&gt;
{regionName}
&lt;p&gt;. is closing)..&lt;/p&gt;

&lt;p&gt;I guess after the table is modified online, the ops might be processed successfully before the region is marked as closing.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We just need to, eventually, when the region is reopened to apply the schema update, have the coprocessor ordering change apply.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;According to the testing, the coprocessors will be reloaded/orded after the region is reopened.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I don&apos;t think James is reporting the changes have to be applied before the admin call returns. I think he&apos;s reporting that time goes by and the changes never seem to be applied.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hi James, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamestaylor&quot; class=&quot;user-hover&quot; rel=&quot;jamestaylor&quot;&gt;James Taylor&lt;/a&gt;, what&apos;s the issue encountered? The coprocessors are not reordered after a long time from the online modification? Please advise, thanks.&lt;/p&gt;</comment>
                            <comment id="14214236" author="jiajia" created="Mon, 17 Nov 2014 04:07:48 +0000"  >&lt;p&gt;hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamestaylor&quot; class=&quot;user-hover&quot; rel=&quot;jamestaylor&quot;&gt;James Taylor&lt;/a&gt;, I only know can  can add a table coprocessor by setting a table coprocessor attribute in the hbase shell:&lt;br/&gt;
  hbase&amp;gt; alter &apos;t1&apos;,  &apos;coprocessor&apos;=&amp;gt;&apos;hdfs:///foo.jar|com.foo.FooRegionObserver|1001|arg1=1,arg2=2&apos;&lt;br/&gt;
and the 1001 is the priority, can you tell me how to change the priority of coprocessor in the hbase shell? thanks~&lt;/p&gt;</comment>
                            <comment id="14214253" author="jamestaylor" created="Mon, 17 Nov 2014 04:45:30 +0000"  >&lt;p&gt;Here&apos;s the command we used to modify the priority of an existing coprocessor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
alter &apos;PHERF.PHERF_FIELD_HISTORY_ARCHIVE&apos;, METHOD =&amp;gt; &apos;table_att&apos;, &apos;coprocessor$2&apos; =&amp;gt; &apos;|org.apache.phoenix.coprocessor.UngroupedAggregateRegionObserver|1|&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14214314" author="jiajia" created="Mon, 17 Nov 2014 06:06:16 +0000"  >&lt;p&gt;hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamestaylor&quot; class=&quot;user-hover&quot; rel=&quot;jamestaylor&quot;&gt;James Taylor&lt;/a&gt;, I use your command to modify the priority of an existing coprocessor, but after this command, a new coprocessor added, it that right used?&lt;/p&gt;

&lt;p&gt;hbase(main):001:0&amp;gt; create &apos;t6&apos;,&apos;f1&apos;&lt;/p&gt;

&lt;p&gt;hbase(main):002:0&amp;gt; describe &apos;t6&apos;&lt;br/&gt;
DESCRIPTION                                                                                                                              ENABLED&lt;br/&gt;
 &apos;t6&apos;, &lt;/p&gt;
{NAME =&amp;gt; &apos;f1&apos;, DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;, BLOOMFILTER =&amp;gt; &apos;ROW&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NO true
 NE&apos;, MIN_VERSIONS =&amp;gt; &apos;0&apos;, TTL =&amp;gt; &apos;FOREVER&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;false&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, BLOCKCACHE =&amp;gt; &apos;t
 rue&apos;}

&lt;p&gt;hbase(main):001:0&amp;gt; alter &apos;t6&apos;, METHOD =&amp;gt; &apos;table_att&apos;,&apos;coprocessor&apos;=&amp;gt;&apos;|org.apache.hadoop.hbase.client.coprocessor.TestCoprocessor2|1001|&apos;&lt;br/&gt;
2014-11-17 14:01:37,170 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
0/1 regions updated.&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 3.0290 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):002:0&amp;gt; describe &apos;t6&apos;&lt;br/&gt;
DESCRIPTION                                                                                                                              ENABLED&lt;br/&gt;
 &apos;t6&apos;, {TABLE_ATTRIBUTES =&amp;gt; &lt;/p&gt;
{coprocessor$1 =&amp;gt; &apos;|org.apache.hadoop.hbase.client.coprocessor.TestCoprocessor2|1001|&apos;}
&lt;p&gt;, &lt;/p&gt;
{NAME =&amp;gt; &apos;f1&apos;, DATA true
 _BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;, BLOOMFILTER =&amp;gt; &apos;ROW&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, MIN_VERSIONS =&amp;gt; &apos;0&apos;,
  TTL =&amp;gt; &apos;FOREVER&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;false&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, BLOCKCACHE =&amp;gt; &apos;true&apos;}
&lt;p&gt;1 row(s) in 0.0290 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):003:0&amp;gt; alter &apos;t6&apos;, METHOD =&amp;gt; &apos;table_att&apos;,&apos;coprocessor$1&apos;=&amp;gt;&apos;|org.apache.hadoop.hbase.client.coprocessor.TestCoprocessor2|1002|&apos;&lt;br/&gt;
Updating all regions with the new schema...&lt;br/&gt;
0/1 regions updated.&lt;br/&gt;
1/1 regions updated.&lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 2.1110 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):004:0&amp;gt; describe &apos;t6&apos;&lt;br/&gt;
DESCRIPTION                                                                                                                              ENABLED&lt;br/&gt;
 &apos;t6&apos;, {TABLE_ATTRIBUTES =&amp;gt; &lt;/p&gt;
{coprocessor$1 =&amp;gt; &apos;|org.apache.hadoop.hbase.client.coprocessor.TestCoprocessor2|1001|&apos;, coprocessor$1$2 =&amp;gt; &apos; true
 |org.apache.hadoop.hbase.client.coprocessor.TestCoprocessor2|1002|&apos;}
&lt;p&gt;, &lt;/p&gt;
{NAME =&amp;gt; &apos;f1&apos;, DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;, BLOOMFILTER =&amp;gt; &apos;ROW
 &apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, MIN_VERSIONS =&amp;gt; &apos;0&apos;, TTL =&amp;gt; &apos;FOREVER&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;fals
 e&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, BLOCKCACHE =&amp;gt; &apos;true&apos;}
&lt;p&gt;1 row(s) in 0.0240 seconds&lt;/p&gt;</comment>
                            <comment id="14214430" author="jiajia" created="Mon, 17 Nov 2014 08:53:53 +0000"  >&lt;p&gt;hi,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamestaylor&quot; class=&quot;user-hover&quot; rel=&quot;jamestaylor&quot;&gt;James Taylor&lt;/a&gt;, as the above test , I think now the hbase shell can only add a new  coprocessor, but can not change the coprocessor priority, ref&#65306;&lt;a href=&quot;https://github.com/apache/hbase/blob/master/hbase-shell/src/main/ruby/hbase/admin.rb#L530&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hbase/blob/master/hbase-shell/src/main/ruby/hbase/admin.rb#L530&lt;/a&gt;&#65292; is that right? please give some advice, thanks~&lt;/p&gt;
</comment>
                            <comment id="14215241" author="apurtell" created="Mon, 17 Nov 2014 21:47:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiajia&quot; class=&quot;user-hover&quot; rel=&quot;jiajia&quot;&gt;Jiajia Li&lt;/a&gt; yes&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=giacomotaylor&quot; class=&quot;user-hover&quot; rel=&quot;giacomotaylor&quot;&gt;James Taylor&lt;/a&gt; so this might well work as expected if using the Java admin API. &lt;/p&gt;</comment>
                            <comment id="14215404" author="jamestaylor" created="Mon, 17 Nov 2014 23:31:51 +0000"  >&lt;p&gt;We didn&apos;t do any extensive testing on this, so user error is possible. We just tried to change the priority of a coprocessor from the HBase shell (the metadata did seem to look correct after that command, but we didn&apos;t look that closely to be honest). Then we noticed that the coprocessors seemed to not be reordered. FWIW, this isn&apos;t blocking us in any way, I just wanted to report it before we forgot about it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Nov 2014 05:08:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i221fr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>