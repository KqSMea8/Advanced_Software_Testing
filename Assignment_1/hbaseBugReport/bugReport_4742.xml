<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:21:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4742/HBASE-4742.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4742] Split dead server&apos;s log in parallel</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4742</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When one region server goes down, the master will shutdown the region server and split its log.&lt;br/&gt;
However, splitting log is a blocking call and it would take some time.&lt;/p&gt;

&lt;p&gt;If more than one region server go down, the master will split its log one by one, which is not efficient.&lt;br/&gt;
Since we have the distributed log split, we could split these logs from the dead servers in parallel. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12530109">HBASE-4742</key>
            <summary>Split dead server&apos;s log in parallel</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="liyin">Liyin Tang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2011 20:52:01 +0000</created>
                <updated>Wed, 2 May 2012 23:03:02 +0000</updated>
                            <resolved>Wed, 2 May 2012 23:03:02 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="13143781" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 06:28:31 +0000"  >&lt;p&gt;Karthik has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:65 Could we write a one-line comment about the state? I think ABORT means there is no need to split any logs, right?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:331 Might be missing something here... this break will just cause the operation to return as if it succeeded, but log splitting is still in progress right? We would then proceed to open the regions without ensuring this is completed?&lt;/p&gt;

&lt;p&gt;  Maybe we need:&lt;br/&gt;
  this.requeue();&lt;br/&gt;
  return false;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13143782" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 06:29:10 +0000"  >&lt;p&gt;Liyin requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  When one region server goes down, the master will shutdown the region server and split its log.&lt;br/&gt;
  However, splitting log is a blocking call and it would take some time.&lt;/p&gt;

&lt;p&gt;  If more than one region server go down, the master will split its log one by one, which is not efficient.&lt;br/&gt;
  Since we have the distributed log split, we could split these logs from the dead servers in parallel.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  1) add one unit test for multiple region server shut down case&lt;br/&gt;
  2) running all the unit test&lt;br/&gt;
  3) will test it in dev cluster&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13144009" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 13:35:00 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:351 Something seems to be missing after the log statement.&lt;/p&gt;

&lt;p&gt;  Minor: missing space between double quote and &apos;and&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:311 A return statement is missing, if I understand correctly.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144316" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 20:39:51 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:316 name the thread for better jstacks&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:311 I don&apos;t think there is a need for ABORT state. There is no aborting the log-splitting ... we should just keep retrying.&lt;/p&gt;

&lt;p&gt;  In this particular case when deadServer doesn&apos;t exist then you can return success&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:295 You could put the retry loop with sleeps here? Then the main thread has a very simple state where it just requeues itself if the log-splitting is not done.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144331" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 20:55:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Thanks Prakash, Ted and Karthik.&lt;br/&gt;
  I removed the ABORT status now.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13144338" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 21:01:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Address Karthik&apos;s comments.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13144418" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 22:29:52 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:152 How can the master close? It should not under any of these circumstances.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144433" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 22:57:51 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  also, I think we should maintain the old single threaded behavior when distributed log splitting is not enabled. (You might not have to make any change becasue of splitLogLock in HMaster.splitLog() function ... but please verify)&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144488" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 00:37:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Address Prakash&apos;s comments.&lt;br/&gt;
  Also I try to classify that if the distributed log splitting is true, then the master will launch multiple threads to split the log in parallel. If the distributed log splitting is not true,  the master will launch multiple threads to split the log in sequentially.&lt;br/&gt;
  The motivation is to stop blocking the region server operation queue.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13144536" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 03:01:52 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Liyin, good stuff! Some comments inline:&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:56 Should this field be remove now that it is superseded by logSplitResult?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:337 Succeed to split -&amp;gt; Succeeded splitting&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:82 Indentation&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:93 Space between ) and op&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:133 Space between try and {&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:135 1. Please don&apos;t ignore the exception. Log it at least. What is the expected exception here? Can we catch only one particular kind of exception and fail the unit test for all other exceptions?&lt;br/&gt;
  2. Indentation&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:52 This variable is never read&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:68 Insert an empty line here&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:347-348 Would it make sense to throw an IOException instead?&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:113 This variable is never read&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:143 all the listener -&amp;gt; all the listeners&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:49 Rename to numClosedRegionServers. Otherwise it is not clear whether this is a regionserver ID or the number of them.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:72 Line longer than 80 characters (this is currently not reported by this Phabricator setup).&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:333 Are you sure that it is OK to requeue this split request before the worker thread splitting this region server&apos;s logs completes?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:312 Instead of spawning threads in an uncontrolled way like this, it would be nice to use an ExecutorService. Also, if there are hundreds of logs to split, we would probably like to restrict the number of concurrent log-splitting threads, which can also be achieved using a thread-pool executor service.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144551" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 03:49:51 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:312 Here the new thread is per dead server, right ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144599" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 05:34:51 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:312 Ted: yes, that is correct. However, there could be a considerable number of unique servers to split logs for, and some throttling of the number of concurrent log splitting threads might still be good.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144786" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 18:50:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Answer the comments inline.&lt;/p&gt;


&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:312 I agree with Ted.&lt;br/&gt;
  The thread number is bounded by the number of dead servers at one time naturally.&lt;/p&gt;

&lt;p&gt;  Prakash, what do you think?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:333 Why do you think it is NOT OK ???&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:337 What&apos; wrong with &quot;Succeed to split&quot; ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:347-348 I believe it is more reasonable to throw RuntimeExcpetion.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:135 I try to ignore this Exception here on purpose.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144803" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 19:22:51 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:333 My concern is that there might be two threads at some point splitting logs for the same server.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:337 &quot;Succeed&quot; is infinitive and &quot;succeeded&quot; is past, so e.g. &quot;succeeded to split&quot; would be more appropriate. But this does not really matter.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:347-348 OK, this is fine. In general, unchecked exceptions should only be thrown when the program is not expected to recover from the error (&lt;a href=&quot;http://bit.ly/RuntimeException&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://bit.ly/RuntimeException&lt;/a&gt;). This is probably appropriate in case of an unknown enum element.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:135 What do you mean by &quot;this exception&quot; and what&apos;s the purpose of ignoring it? This will ignore all exceptions and make the code hard to debug in case something goes wrong in the try block.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:312 OK, if we believe there will be no more than say 10% of servers going down at the same time, and the current cluster size is 100 nodes, this is fine. However, if we had 1000 servers and half of them went down, then the master might choke trying to split 500 logs at once.&lt;/p&gt;

&lt;p&gt;  Prakash: do we use distributed log splitting only on master startup or during normal master operation as well?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144863" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 22:58:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Thank Mikhail for your quick response.&lt;br/&gt;
  We have agreed on most of the discussion here.&lt;/p&gt;

&lt;p&gt;  The remaining discussion is focusing on the number of threads launched in master for splitting dead servers log, which has made me re-considering our motivation about parallel distributed log splitting here.&lt;/p&gt;

&lt;p&gt;  Our basic motivation is splitting log should not block the region server process queue. Also the distributed log splitting itself is designed to split log for a large number region servers. So we could batch all the dead region servers together into a queue and launch single thread to do the distributed log splitting,  instead of distribute log splitting for each dead server as a separate thread.&lt;/p&gt;



&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:333 Thank you for clarify your concern&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;  For each dead server, the master would receive the znode expire event for this dead server only once.&lt;br/&gt;
  So the master wouldn&apos;t have 2 threads split the same dead region server at same time.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:337 Fine. I would change it to &quot;Succeeded in splitting&quot;.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:347-348 Thanks for clarifying.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java:135 Actually, I don&apos;t have to catch the exceptions here explicitly.&lt;br/&gt;
  It won&apos;t affect the unit test results.&lt;br/&gt;
  Thanks for the discussion.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:312 1) We use distributed log splitting for the dead region server as well.&lt;/p&gt;

&lt;p&gt;  2) Even though we use thread pool to execute, I would bound the max thread as the number of region server.&lt;br/&gt;
  What do you think of the max thread we should bound for the execute thread pool here?&lt;/p&gt;

&lt;p&gt;  Also as your example mentioned here, 500 region server went down. The master would launch 500 threads to distributed log splitting in parallel. It won&apos;t choke the master too much since the split job is done on each region server side.&lt;/p&gt;

&lt;p&gt;  3) But this discussion also leads us to another good point. Let&apos;s say if there are a large number region server dead for some reason. Shall we batch these dead region servers to split instead of splitting their log in parallel.&lt;/p&gt;

&lt;p&gt;  Any ideas? Mikhail and Prakash ?&lt;/p&gt;



&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144877" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 00:28:51 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  In practice, the actual log splitting will happen in region server... so at the master level it is only going to consume as many threads as concurrently dead region servers... but the threads won&apos;t really be doing much expensive work. I would imagine it would to spawn say even 1000 threads without much adverse affect.&lt;/p&gt;

&lt;p&gt;  Having said that, if region servers are repeatedly starting/dying etc. it could end in some degenerate cases where things could grow unbounded and take the master down. So limiting this seems the safer thing to do.&lt;/p&gt;

&lt;p&gt;  Liyin: In practice, while I think what you have is just fine and unlikely to cause any serious issues... does it complicate the design too much to back this by a threadpool backed with a queue and set the limit pretty high to say 1000? If the changes are not too intrusive, I would suggest doing the threadpool. If more involved, we can layer that in in a second pass.&lt;/p&gt;

&lt;p&gt;  regards,&lt;br/&gt;
  Kannan&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144889" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 02:14:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Kannan, Mikhail, Prakash and Ted,&lt;br/&gt;
  How about batch all the dead servers in a blocking queue and only launch one thread in HMaster to distributed log splitting these dead regions together.&lt;/p&gt;

&lt;p&gt;  The interface of distributed log splitting is:&lt;br/&gt;
  public void splitLog(final List&amp;lt;String&amp;gt; serverNames) {}&lt;br/&gt;
  So it naturally designed to split a list region servers.&lt;/p&gt;

&lt;p&gt;  The reason I proposed this idea is because the function to split log in HMaster is not well-tested in a multithread situations.&lt;br/&gt;
  It may involve some race condition when 2 threads are going to distributed log splitting for 2 different dead region servers.&lt;/p&gt;

&lt;p&gt;  If the master split dead servers log in batch in a single thread, then we can avoid these potential problems and also matches our original motivations.&lt;/p&gt;

&lt;p&gt;  What do you guys think?&lt;/p&gt;

&lt;p&gt;  Thanks&lt;br/&gt;
  Liyin&lt;/p&gt;



&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144894" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 02:38:51 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Liyin, could you please clarify how that single thread is going to control log splitting done remotely by multiple regionservers in parallel? Would that be some kind of an event loop? If that is easier than fixing the race conditions in HMaster you are concerned about, I&apos;m fine with it. Or, as another alternative, we could test the existing solution more thoroughly.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144895" author="yuzhihong@gmail.com" created="Sun, 6 Nov 2011 02:43:20 +0000"  >&lt;p&gt;I don&apos;t see ProcessServerShutdown.java in 0.90 or TRUNK. So I assume it is from 0.89 branch.&lt;br/&gt;
I am not familiar with 0.89 branch. So my discussion below is tailored toward 0.92/TRUNK.&lt;/p&gt;

&lt;p&gt;From Liyin:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;instead of distribute log splitting for each dead server as a separate thread.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree with the above statement.&lt;/p&gt;

&lt;p&gt;In TRUNK, the method Liyin mentioned:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void splitLog(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;ServerName&amp;gt; serverNames) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;translates server names to log paths and uses the following to split the paths:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        splitLogSize = splitLogManager.splitLogDistributed(logDirs);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can introduce a short interval for master to group the malfunctioning region servers so that the above splitLog() API can be used.&lt;br/&gt;
If region servers go down with non-trivial interval in between, it is not obvious how the above splitLog() API can be used.&lt;/p&gt;</comment>
                            <comment id="13144914" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 04:50:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Address Mikhail and Kannan&apos;s comments for using thread pool to bound the total number thread.&lt;br/&gt;
  The default max thread is 1000.&lt;/p&gt;

&lt;p&gt;  Also keep testing it on the dev cluster.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13144917" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 04:56:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Mikhail, since the function to split log is a blocking function. So it will return unit the splitLogManager says all the logs has been spitted successfully.&lt;/p&gt;

&lt;p&gt;  Anyway, I implemented the ThreadPool version, which is much easy to change.&lt;br/&gt;
  I will keep test it in the dev cluster and discuss with Prakash about the above concern.&lt;/p&gt;

&lt;p&gt;  In addition, in apache trunk, it handle these region server shut down cases in parallel. So by design, the function to distributed log splitting is supposed to be run in parallel.&lt;br/&gt;
  Let&apos;s get it confirmed by Prakash and testing.&lt;/p&gt;

&lt;p&gt;  Thank all of you guys  for reviewing it in the weekend&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;  Liyin&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144928" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 06:04:51 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:311 I think thread index starting from 1 would be more readable to user.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:314 Please the following call before returning:&lt;br/&gt;
  (logSplitThreadPool).allowCoreThreadTimeOut(true);&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13144932" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 06:08:51 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:314 Should read: &apos;Please add the following call before returning&apos;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145050" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 17:51:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Thanks for reviewing it in the weekend.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:311 OK I can start with 1 instead of 0&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:314 I don&apos;t think it is necessary here.&lt;br/&gt;
  Because the coreThreadNumber is 0.&lt;br/&gt;
  Every thread launched by this thread pool is not from core pool.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145059" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 18:09:51 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  If you splitLog(list-of-servernames) then the function won&apos;t return until all the servers&apos; logs are split.&lt;/p&gt;

&lt;p&gt;  If you call multiple splitLog(servername) then each one returns as soon as it is done. This is what we are doing now and we should stay with it.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:305 managing threads through a thread pool is a good thing. But I doubt that there is any scenario where the number of threads will increase without limit. The number of threads will always be limited by the number of region servers. And a new incarnation of a region server is not instantiated by the master unless the old one&apos;s log splitting is done.&lt;/p&gt;

&lt;p&gt;  but i think we should still use the thread pool. it is a better abstraction.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:304 Can you please do a new Runnable inline over here. That will make it easier for someone to read ProcessServerShutdown() code. Having two methods run() and process() kind of makes it confusing to understand ProcessServerShutdown.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:323 This should be LOG.debug. You might consider rate limiting this debug output.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:333 This should be LOG.warn&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:339 Runtime.halt()? Even if you throw an exception the retry mechanism will kick in.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:304 If master shutdown is called (abort or regular shutdown) then I am not sure that the pool is shutting down properly. Someone has to interrupt each of the threads that are have called splitLog(). Or those splitLog() threads have to be daemons.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:316 Now that you have a thread pool you can look at the status of the submitted tasks instead of maintaining  special states &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145071" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 18:55:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Address Prakash and Ted&apos;s comments.&lt;br/&gt;
  Thanks for reviewing in the weekend.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13145109" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 21:07:51 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Very nice improvment!&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:285 This method is not used anywhere, correct?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145200" author="phabricator@reviews.facebook.net" created="Mon, 7 Nov 2011 03:40:52 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:306 Why use a SynchronousQueue ... won&apos;t that cause the task.submitting() thread to block if the thread-pool is at capacity? (Not that we will hit this issue with default capacity set at 1000)&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:313 I am not very sure about the ThreadPoolExecutor&apos;s behavior ... is it possible that when waiting for a task the thread pool keeps its threads  in daemon mode and before a thread is chosen to execute a task it&apos;s made into a non-daemon thread?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145251" author="phabricator@reviews.facebook.net" created="Mon, 7 Nov 2011 06:41:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:304 I have made these threads as daemons threads.&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:285 yes, stale code. I shall remove this function.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:306 Good point, Prakash.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java:313 I think all the threads created by this thread executor pool will run as daemon mode, which means the thread will either run until  it completes or until all User Threads have completed.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145253" author="phabricator@reviews.facebook.net" created="Mon, 7 Nov 2011 06:51:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Address Prakash and lhofhansl &apos;s comments.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13145575" author="phabricator@reviews.facebook.net" created="Mon, 7 Nov 2011 15:56:52 +0000"  >&lt;p&gt;Karthik has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Looks good to me... +1&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145624" author="phabricator@reviews.facebook.net" created="Mon, 7 Nov 2011 17:12:51 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  +1&lt;/p&gt;

&lt;p&gt;  Great work, Liyin!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13145989" author="phabricator@reviews.facebook.net" created="Tue, 8 Nov 2011 00:22:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMultiRegionServerShutDown.java&lt;/p&gt;</comment>
                            <comment id="13146638" author="phabricator@reviews.facebook.net" created="Tue, 8 Nov 2011 23:13:51 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Nice work Liyin. One inlined comment.&lt;/p&gt;


&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:323 there are two queues, the toDoQueue and the delayedToDoQueue.&lt;/p&gt;

&lt;p&gt;  From reading the code, it seems like &quot;return false&quot; will cause this to be put in the toDoQueue upstream in RegionServerOperationQueue.java.&lt;/p&gt;

&lt;p&gt;  Should we instead use &quot;this.requeue()&quot; so that it is back in the delay queue, but then, return &lt;b&gt;true&lt;/b&gt;, so that it doesn&apos;t &lt;b&gt;also&lt;/b&gt; get put in the toDoQueue?&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13146675" author="phabricator@reviews.facebook.net" created="Wed, 9 Nov 2011 00:09:51 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java:323 Hi Kannan,&lt;br/&gt;
  When testing this revision internally, I have already made this change to add this operation back to delay queue but in a different way.&lt;/p&gt;

&lt;p&gt;  There are 2 ways to add this operation back to the delay queue instead of to do queue.&lt;br/&gt;
  1) call this.requeue(), which is add the operation to the delay queue and return true. It means this operation has succeeded and all the post-process-listener will be called.&lt;/p&gt;

&lt;p&gt;  2) Throw out some exceptions here, which will be caught in the RegionServerOperationQueue. Then this operation will be put back to the delay queue bu RegionServerOperationQueue.&lt;/p&gt;

&lt;p&gt;  After discussion with Prakash and Mikhail,  Prakash prefers the 2nd solutions and Mikhail suggests to refactor the code. So each operation should return OPERATION.SUCCESS, OPERATION.FAILED and OPERATION.DLAYED.&lt;/p&gt;

&lt;p&gt;  I have already implemented the 2nd solutions internally and get it tested in big cluster. But now I try to refactor the code as Mikhail suggested.&lt;/p&gt;

&lt;p&gt;  I will update this revision once every thing settled down during the test.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13147312" author="phabricator@reviews.facebook.net" created="Wed, 9 Nov 2011 21:37:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;  Refactor the code of RegionServerOperationQueue.&lt;/p&gt;

&lt;p&gt;  Each operation will return OPERATION.SUCCEEDED, OPERATION.FAILED and OPERATON.DELAYED every time when it is processed.&lt;/p&gt;

&lt;p&gt;  Based on this return value, the RegionServerOperationQueue will put them back to todo queue, delay queue or call the post-process-listener.&lt;/p&gt;



&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestScannerTimeout.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMasterTransitions.java&lt;br/&gt;
  src/test/resources/hbase-site.xml&lt;/p&gt;</comment>
                            <comment id="13147323" author="phabricator@reviews.facebook.net" created="Wed, 9 Nov 2011 21:57:51 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;br/&gt;
Reviewers: Kannan, khemani, Karthik, mbautin, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionClose.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionOpen.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessRegionStatusChange.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ProcessServerShutdown.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperation.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionServerOperationQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestScannerTimeout.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestMasterTransitions.java&lt;br/&gt;
  src/test/resources/hbase-site.xml&lt;/p&gt;</comment>
                            <comment id="13147347" author="phabricator@reviews.facebook.net" created="Wed, 9 Nov 2011 22:57:51 +0000"  >&lt;p&gt;mbautin has accepted the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4742&quot; title=&quot;Split dead server&amp;#39;s log in parallel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4742&quot;&gt;&lt;del&gt;HBASE-4742&lt;/del&gt;&lt;/a&gt; Split dead server&apos;s log in parallel&quot;.&lt;/p&gt;

&lt;p&gt;  Looks good to me! Nice fix in TestMasterTransitions!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D237&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13147367" author="nspiegelberg" created="Wed, 9 Nov 2011 23:33:57 +0000"  >&lt;p&gt;+1. I take it this is for 89?  Will commit when ported to trunk&lt;/p&gt;</comment>
                            <comment id="13172723" author="liyin" created="Mon, 19 Dec 2011 23:10:20 +0000"  >&lt;p&gt;@Nicolas, this is only for 89-fb. Trunk has already splited the dead server&apos;s log in parallel in another way.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12502360" name="ASF.LICENSE.NOT.GRANTED--D237.1.patch" size="10751" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 06:29:11 +0000"/>
                            <attachment id="12503138" name="ASF.LICENSE.NOT.GRANTED--D237.10.patch" size="30781" author="phabricator@reviews.facebook.net" created="Wed, 9 Nov 2011 21:57:52 +0000"/>
                            <attachment id="12502526" name="ASF.LICENSE.NOT.GRANTED--D237.2.patch" size="10020" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 20:55:52 +0000"/>
                            <attachment id="12502528" name="ASF.LICENSE.NOT.GRANTED--D237.3.patch" size="10050" author="phabricator@reviews.facebook.net" created="Fri, 4 Nov 2011 21:01:52 +0000"/>
                            <attachment id="12502560" name="ASF.LICENSE.NOT.GRANTED--D237.4.patch" size="9235" author="phabricator@reviews.facebook.net" created="Sat, 5 Nov 2011 00:37:52 +0000"/>
                            <attachment id="12502642" name="ASF.LICENSE.NOT.GRANTED--D237.5.patch" size="12850" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 04:50:52 +0000"/>
                            <attachment id="12502680" name="ASF.LICENSE.NOT.GRANTED--D237.6.patch" size="12726" author="phabricator@reviews.facebook.net" created="Sun, 6 Nov 2011 18:55:52 +0000"/>
                            <attachment id="12502731" name="ASF.LICENSE.NOT.GRANTED--D237.7.patch" size="13516" author="phabricator@reviews.facebook.net" created="Mon, 7 Nov 2011 06:51:52 +0000"/>
                            <attachment id="12502852" name="ASF.LICENSE.NOT.GRANTED--D237.8.patch" size="13447" author="phabricator@reviews.facebook.net" created="Tue, 8 Nov 2011 00:22:52 +0000"/>
                            <attachment id="12503135" name="ASF.LICENSE.NOT.GRANTED--D237.9.patch" size="24644" author="phabricator@reviews.facebook.net" created="Wed, 9 Nov 2011 21:37:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Nov 2011 06:28:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215968</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015xr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Resolving this issue as has already been fixed  in trunk.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>